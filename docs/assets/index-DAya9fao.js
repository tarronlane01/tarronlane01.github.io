(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const c of l.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function n(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerPolicy&&(l.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?l.credentials="include":a.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(a){if(a.ep)return;a.ep=!0;const l=n(a);fetch(a.href,l)}})();var zp={exports:{}},qc={};var Iv;function NA(){if(Iv)return qc;Iv=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function n(i,a,l){var c=null;if(l!==void 0&&(c=""+l),a.key!==void 0&&(c=""+a.key),"key"in a){l={};for(var h in a)h!=="key"&&(l[h]=a[h])}else l=a;return a=l.ref,{$$typeof:t,type:i,key:c,ref:a!==void 0?a:null,props:l}}return qc.Fragment=e,qc.jsx=n,qc.jsxs=n,qc}var Mv;function PA(){return Mv||(Mv=1,zp.exports=NA()),zp.exports}var d=PA(),Fp={exports:{}},Ue={};var Ov;function LA(){if(Ov)return Ue;Ov=1;var t=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),n=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),l=Symbol.for("react.consumer"),c=Symbol.for("react.context"),h=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),_=Symbol.for("react.lazy"),b=Symbol.for("react.activity"),v=Symbol.iterator;function T(V){return V===null||typeof V!="object"?null:(V=v&&V[v]||V["@@iterator"],typeof V=="function"?V:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},w=Object.assign,D={};function L(V,z,$){this.props=V,this.context=z,this.refs=D,this.updater=$||E}L.prototype.isReactComponent={},L.prototype.setState=function(V,z){if(typeof V!="object"&&typeof V!="function"&&V!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,V,z,"setState")},L.prototype.forceUpdate=function(V){this.updater.enqueueForceUpdate(this,V,"forceUpdate")};function q(){}q.prototype=L.prototype;function B(V,z,$){this.props=V,this.context=z,this.refs=D,this.updater=$||E}var ee=B.prototype=new q;ee.constructor=B,w(ee,L.prototype),ee.isPureReactComponent=!0;var Q=Array.isArray;function J(){}var O={H:null,A:null,T:null,S:null},R=Object.prototype.hasOwnProperty;function j(V,z,$){var X=$.ref;return{$$typeof:t,type:V,key:z,ref:X!==void 0?X:null,props:$}}function I(V,z){return j(V.type,z,V.props)}function M(V){return typeof V=="object"&&V!==null&&V.$$typeof===t}function F(V){var z={"=":"=0",":":"=2"};return"$"+V.replace(/[=:]/g,function($){return z[$]})}var k=/\/+/g;function Y(V,z){return typeof V=="object"&&V!==null&&V.key!=null?F(""+V.key):z.toString(36)}function H(V){switch(V.status){case"fulfilled":return V.value;case"rejected":throw V.reason;default:switch(typeof V.status=="string"?V.then(J,J):(V.status="pending",V.then(function(z){V.status==="pending"&&(V.status="fulfilled",V.value=z)},function(z){V.status==="pending"&&(V.status="rejected",V.reason=z)})),V.status){case"fulfilled":return V.value;case"rejected":throw V.reason}}throw V}function N(V,z,$,X,re){var ue=typeof V;(ue==="undefined"||ue==="boolean")&&(V=null);var he=!1;if(V===null)he=!0;else switch(ue){case"bigint":case"string":case"number":he=!0;break;case"object":switch(V.$$typeof){case t:case e:he=!0;break;case _:return he=V._init,N(he(V._payload),z,$,X,re)}}if(he)return re=re(V),he=X===""?"."+Y(V,0):X,Q(re)?($="",he!=null&&($=he.replace(k,"$&/")+"/"),N(re,z,$,"",function(te){return te})):re!=null&&(M(re)&&(re=I(re,$+(re.key==null||V&&V.key===re.key?"":(""+re.key).replace(k,"$&/")+"/")+he)),z.push(re)),1;he=0;var Se=X===""?".":X+":";if(Q(V))for(var fe=0;fe<V.length;fe++)X=V[fe],ue=Se+Y(X,fe),he+=N(X,z,$,ue,re);else if(fe=T(V),typeof fe=="function")for(V=fe.call(V),fe=0;!(X=V.next()).done;)X=X.value,ue=Se+Y(X,fe++),he+=N(X,z,$,ue,re);else if(ue==="object"){if(typeof V.then=="function")return N(H(V),z,$,X,re);throw z=String(V),Error("Objects are not valid as a React child (found: "+(z==="[object Object]"?"object with keys {"+Object.keys(V).join(", ")+"}":z)+"). If you meant to render a collection of children, use an array instead.")}return he}function G(V,z,$){if(V==null)return V;var X=[],re=0;return N(V,X,"","",function(ue){return z.call($,ue,re++)}),X}function W(V){if(V._status===-1){var z=V._result;z=z(),z.then(function($){(V._status===0||V._status===-1)&&(V._status=1,V._result=$)},function($){(V._status===0||V._status===-1)&&(V._status=2,V._result=$)}),V._status===-1&&(V._status=0,V._result=z)}if(V._status===1)return V._result.default;throw V._result}var ne=typeof reportError=="function"?reportError:function(V){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var z=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof V=="object"&&V!==null&&typeof V.message=="string"?String(V.message):String(V),error:V});if(!window.dispatchEvent(z))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",V);return}console.error(V)},ie={map:G,forEach:function(V,z,$){G(V,function(){z.apply(this,arguments)},$)},count:function(V){var z=0;return G(V,function(){z++}),z},toArray:function(V){return G(V,function(z){return z})||[]},only:function(V){if(!M(V))throw Error("React.Children.only expected to receive a single React element child.");return V}};return Ue.Activity=b,Ue.Children=ie,Ue.Component=L,Ue.Fragment=n,Ue.Profiler=a,Ue.PureComponent=B,Ue.StrictMode=i,Ue.Suspense=f,Ue.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=O,Ue.__COMPILER_RUNTIME={__proto__:null,c:function(V){return O.H.useMemoCache(V)}},Ue.cache=function(V){return function(){return V.apply(null,arguments)}},Ue.cacheSignal=function(){return null},Ue.cloneElement=function(V,z,$){if(V==null)throw Error("The argument must be a React element, but you passed "+V+".");var X=w({},V.props),re=V.key;if(z!=null)for(ue in z.key!==void 0&&(re=""+z.key),z)!R.call(z,ue)||ue==="key"||ue==="__self"||ue==="__source"||ue==="ref"&&z.ref===void 0||(X[ue]=z[ue]);var ue=arguments.length-2;if(ue===1)X.children=$;else if(1<ue){for(var he=Array(ue),Se=0;Se<ue;Se++)he[Se]=arguments[Se+2];X.children=he}return j(V.type,re,X)},Ue.createContext=function(V){return V={$$typeof:c,_currentValue:V,_currentValue2:V,_threadCount:0,Provider:null,Consumer:null},V.Provider=V,V.Consumer={$$typeof:l,_context:V},V},Ue.createElement=function(V,z,$){var X,re={},ue=null;if(z!=null)for(X in z.key!==void 0&&(ue=""+z.key),z)R.call(z,X)&&X!=="key"&&X!=="__self"&&X!=="__source"&&(re[X]=z[X]);var he=arguments.length-2;if(he===1)re.children=$;else if(1<he){for(var Se=Array(he),fe=0;fe<he;fe++)Se[fe]=arguments[fe+2];re.children=Se}if(V&&V.defaultProps)for(X in he=V.defaultProps,he)re[X]===void 0&&(re[X]=he[X]);return j(V,ue,re)},Ue.createRef=function(){return{current:null}},Ue.forwardRef=function(V){return{$$typeof:h,render:V}},Ue.isValidElement=M,Ue.lazy=function(V){return{$$typeof:_,_payload:{_status:-1,_result:V},_init:W}},Ue.memo=function(V,z){return{$$typeof:p,type:V,compare:z===void 0?null:z}},Ue.startTransition=function(V){var z=O.T,$={};O.T=$;try{var X=V(),re=O.S;re!==null&&re($,X),typeof X=="object"&&X!==null&&typeof X.then=="function"&&X.then(J,ne)}catch(ue){ne(ue)}finally{z!==null&&$.types!==null&&(z.types=$.types),O.T=z}},Ue.unstable_useCacheRefresh=function(){return O.H.useCacheRefresh()},Ue.use=function(V){return O.H.use(V)},Ue.useActionState=function(V,z,$){return O.H.useActionState(V,z,$)},Ue.useCallback=function(V,z){return O.H.useCallback(V,z)},Ue.useContext=function(V){return O.H.useContext(V)},Ue.useDebugValue=function(){},Ue.useDeferredValue=function(V,z){return O.H.useDeferredValue(V,z)},Ue.useEffect=function(V,z){return O.H.useEffect(V,z)},Ue.useEffectEvent=function(V){return O.H.useEffectEvent(V)},Ue.useId=function(){return O.H.useId()},Ue.useImperativeHandle=function(V,z,$){return O.H.useImperativeHandle(V,z,$)},Ue.useInsertionEffect=function(V,z){return O.H.useInsertionEffect(V,z)},Ue.useLayoutEffect=function(V,z){return O.H.useLayoutEffect(V,z)},Ue.useMemo=function(V,z){return O.H.useMemo(V,z)},Ue.useOptimistic=function(V,z){return O.H.useOptimistic(V,z)},Ue.useReducer=function(V,z,$){return O.H.useReducer(V,z,$)},Ue.useRef=function(V){return O.H.useRef(V)},Ue.useState=function(V){return O.H.useState(V)},Ue.useSyncExternalStore=function(V,z,$){return O.H.useSyncExternalStore(V,z,$)},Ue.useTransition=function(){return O.H.useTransition()},Ue.version="19.2.3",Ue}var kv;function ty(){return kv||(kv=1,Fp.exports=LA()),Fp.exports}var A=ty(),qp={exports:{}},Hc={},Hp={exports:{}},Gp={};var Nv;function BA(){return Nv||(Nv=1,(function(t){function e(N,G){var W=N.length;N.push(G);e:for(;0<W;){var ne=W-1>>>1,ie=N[ne];if(0<a(ie,G))N[ne]=G,N[W]=ie,W=ne;else break e}}function n(N){return N.length===0?null:N[0]}function i(N){if(N.length===0)return null;var G=N[0],W=N.pop();if(W!==G){N[0]=W;e:for(var ne=0,ie=N.length,V=ie>>>1;ne<V;){var z=2*(ne+1)-1,$=N[z],X=z+1,re=N[X];if(0>a($,W))X<ie&&0>a(re,$)?(N[ne]=re,N[X]=W,ne=X):(N[ne]=$,N[z]=W,ne=z);else if(X<ie&&0>a(re,W))N[ne]=re,N[X]=W,ne=X;else break e}}return G}function a(N,G){var W=N.sortIndex-G.sortIndex;return W!==0?W:N.id-G.id}if(t.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var l=performance;t.unstable_now=function(){return l.now()}}else{var c=Date,h=c.now();t.unstable_now=function(){return c.now()-h}}var f=[],p=[],_=1,b=null,v=3,T=!1,E=!1,w=!1,D=!1,L=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,B=typeof setImmediate<"u"?setImmediate:null;function ee(N){for(var G=n(p);G!==null;){if(G.callback===null)i(p);else if(G.startTime<=N)i(p),G.sortIndex=G.expirationTime,e(f,G);else break;G=n(p)}}function Q(N){if(w=!1,ee(N),!E)if(n(f)!==null)E=!0,J||(J=!0,F());else{var G=n(p);G!==null&&H(Q,G.startTime-N)}}var J=!1,O=-1,R=5,j=-1;function I(){return D?!0:!(t.unstable_now()-j<R)}function M(){if(D=!1,J){var N=t.unstable_now();j=N;var G=!0;try{e:{E=!1,w&&(w=!1,q(O),O=-1),T=!0;var W=v;try{t:{for(ee(N),b=n(f);b!==null&&!(b.expirationTime>N&&I());){var ne=b.callback;if(typeof ne=="function"){b.callback=null,v=b.priorityLevel;var ie=ne(b.expirationTime<=N);if(N=t.unstable_now(),typeof ie=="function"){b.callback=ie,ee(N),G=!0;break t}b===n(f)&&i(f),ee(N)}else i(f);b=n(f)}if(b!==null)G=!0;else{var V=n(p);V!==null&&H(Q,V.startTime-N),G=!1}}break e}finally{b=null,v=W,T=!1}G=void 0}}finally{G?F():J=!1}}}var F;if(typeof B=="function")F=function(){B(M)};else if(typeof MessageChannel<"u"){var k=new MessageChannel,Y=k.port2;k.port1.onmessage=M,F=function(){Y.postMessage(null)}}else F=function(){L(M,0)};function H(N,G){O=L(function(){N(t.unstable_now())},G)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(N){N.callback=null},t.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):R=0<N?Math.floor(1e3/N):5},t.unstable_getCurrentPriorityLevel=function(){return v},t.unstable_next=function(N){switch(v){case 1:case 2:case 3:var G=3;break;default:G=v}var W=v;v=G;try{return N()}finally{v=W}},t.unstable_requestPaint=function(){D=!0},t.unstable_runWithPriority=function(N,G){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var W=v;v=N;try{return G()}finally{v=W}},t.unstable_scheduleCallback=function(N,G,W){var ne=t.unstable_now();switch(typeof W=="object"&&W!==null?(W=W.delay,W=typeof W=="number"&&0<W?ne+W:ne):W=ne,N){case 1:var ie=-1;break;case 2:ie=250;break;case 5:ie=1073741823;break;case 4:ie=1e4;break;default:ie=5e3}return ie=W+ie,N={id:_++,callback:G,priorityLevel:N,startTime:W,expirationTime:ie,sortIndex:-1},W>ne?(N.sortIndex=W,e(p,N),n(f)===null&&N===n(p)&&(w?(q(O),O=-1):w=!0,H(Q,W-ne))):(N.sortIndex=ie,e(f,N),E||T||(E=!0,J||(J=!0,F()))),N},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(N){var G=v;return function(){var W=v;v=G;try{return N.apply(this,arguments)}finally{v=W}}}})(Gp)),Gp}var Pv;function VA(){return Pv||(Pv=1,Hp.exports=BA()),Hp.exports}var $p={exports:{}},Tn={};var Lv;function UA(){if(Lv)return Tn;Lv=1;var t=ty();function e(f){var p="https://react.dev/errors/"+f;if(1<arguments.length){p+="?args[]="+encodeURIComponent(arguments[1]);for(var _=2;_<arguments.length;_++)p+="&args[]="+encodeURIComponent(arguments[_])}return"Minified React error #"+f+"; visit "+p+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function n(){}var i={d:{f:n,r:function(){throw Error(e(522))},D:n,C:n,L:n,m:n,X:n,S:n,M:n},p:0,findDOMNode:null},a=Symbol.for("react.portal");function l(f,p,_){var b=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:a,key:b==null?null:""+b,children:f,containerInfo:p,implementation:_}}var c=t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function h(f,p){if(f==="font")return"";if(typeof p=="string")return p==="use-credentials"?p:""}return Tn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=i,Tn.createPortal=function(f,p){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!p||p.nodeType!==1&&p.nodeType!==9&&p.nodeType!==11)throw Error(e(299));return l(f,p,null,_)},Tn.flushSync=function(f){var p=c.T,_=i.p;try{if(c.T=null,i.p=2,f)return f()}finally{c.T=p,i.p=_,i.d.f()}},Tn.preconnect=function(f,p){typeof f=="string"&&(p?(p=p.crossOrigin,p=typeof p=="string"?p==="use-credentials"?p:"":void 0):p=null,i.d.C(f,p))},Tn.prefetchDNS=function(f){typeof f=="string"&&i.d.D(f)},Tn.preinit=function(f,p){if(typeof f=="string"&&p&&typeof p.as=="string"){var _=p.as,b=h(_,p.crossOrigin),v=typeof p.integrity=="string"?p.integrity:void 0,T=typeof p.fetchPriority=="string"?p.fetchPriority:void 0;_==="style"?i.d.S(f,typeof p.precedence=="string"?p.precedence:void 0,{crossOrigin:b,integrity:v,fetchPriority:T}):_==="script"&&i.d.X(f,{crossOrigin:b,integrity:v,fetchPriority:T,nonce:typeof p.nonce=="string"?p.nonce:void 0})}},Tn.preinitModule=function(f,p){if(typeof f=="string")if(typeof p=="object"&&p!==null){if(p.as==null||p.as==="script"){var _=h(p.as,p.crossOrigin);i.d.M(f,{crossOrigin:_,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0})}}else p==null&&i.d.M(f)},Tn.preload=function(f,p){if(typeof f=="string"&&typeof p=="object"&&p!==null&&typeof p.as=="string"){var _=p.as,b=h(_,p.crossOrigin);i.d.L(f,_,{crossOrigin:b,integrity:typeof p.integrity=="string"?p.integrity:void 0,nonce:typeof p.nonce=="string"?p.nonce:void 0,type:typeof p.type=="string"?p.type:void 0,fetchPriority:typeof p.fetchPriority=="string"?p.fetchPriority:void 0,referrerPolicy:typeof p.referrerPolicy=="string"?p.referrerPolicy:void 0,imageSrcSet:typeof p.imageSrcSet=="string"?p.imageSrcSet:void 0,imageSizes:typeof p.imageSizes=="string"?p.imageSizes:void 0,media:typeof p.media=="string"?p.media:void 0})}},Tn.preloadModule=function(f,p){if(typeof f=="string")if(p){var _=h(p.as,p.crossOrigin);i.d.m(f,{as:typeof p.as=="string"&&p.as!=="script"?p.as:void 0,crossOrigin:_,integrity:typeof p.integrity=="string"?p.integrity:void 0})}else i.d.m(f)},Tn.requestFormReset=function(f){i.d.r(f)},Tn.unstable_batchedUpdates=function(f,p){return f(p)},Tn.useFormState=function(f,p,_){return c.H.useFormState(f,p,_)},Tn.useFormStatus=function(){return c.H.useHostTransitionStatus()},Tn.version="19.2.3",Tn}var Bv;function zA(){if(Bv)return $p.exports;Bv=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),$p.exports=UA(),$p.exports}var Vv;function FA(){if(Vv)return Hc;Vv=1;var t=VA(),e=ty(),n=zA();function i(r){var s="https://react.dev/errors/"+r;if(1<arguments.length){s+="?args[]="+encodeURIComponent(arguments[1]);for(var o=2;o<arguments.length;o++)s+="&args[]="+encodeURIComponent(arguments[o])}return"Minified React error #"+r+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function l(r){var s=r,o=r;if(r.alternate)for(;s.return;)s=s.return;else{r=s;do s=r,(s.flags&4098)!==0&&(o=s.return),r=s.return;while(r)}return s.tag===3?o:null}function c(r){if(r.tag===13){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function h(r){if(r.tag===31){var s=r.memoizedState;if(s===null&&(r=r.alternate,r!==null&&(s=r.memoizedState)),s!==null)return s.dehydrated}return null}function f(r){if(l(r)!==r)throw Error(i(188))}function p(r){var s=r.alternate;if(!s){if(s=l(r),s===null)throw Error(i(188));return s!==r?null:r}for(var o=r,u=s;;){var g=o.return;if(g===null)break;var y=g.alternate;if(y===null){if(u=g.return,u!==null){o=u;continue}break}if(g.child===y.child){for(y=g.child;y;){if(y===o)return f(g),r;if(y===u)return f(g),s;y=y.sibling}throw Error(i(188))}if(o.return!==u.return)o=g,u=y;else{for(var S=!1,P=g.child;P;){if(P===o){S=!0,o=g,u=y;break}if(P===u){S=!0,u=g,o=y;break}P=P.sibling}if(!S){for(P=y.child;P;){if(P===o){S=!0,o=y,u=g;break}if(P===u){S=!0,u=y,o=g;break}P=P.sibling}if(!S)throw Error(i(189))}}if(o.alternate!==u)throw Error(i(190))}if(o.tag!==3)throw Error(i(188));return o.stateNode.current===o?r:s}function _(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r;for(r=r.child;r!==null;){if(s=_(r),s!==null)return s;r=r.sibling}return null}var b=Object.assign,v=Symbol.for("react.element"),T=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),D=Symbol.for("react.strict_mode"),L=Symbol.for("react.profiler"),q=Symbol.for("react.consumer"),B=Symbol.for("react.context"),ee=Symbol.for("react.forward_ref"),Q=Symbol.for("react.suspense"),J=Symbol.for("react.suspense_list"),O=Symbol.for("react.memo"),R=Symbol.for("react.lazy"),j=Symbol.for("react.activity"),I=Symbol.for("react.memo_cache_sentinel"),M=Symbol.iterator;function F(r){return r===null||typeof r!="object"?null:(r=M&&r[M]||r["@@iterator"],typeof r=="function"?r:null)}var k=Symbol.for("react.client.reference");function Y(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===k?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case w:return"Fragment";case L:return"Profiler";case D:return"StrictMode";case Q:return"Suspense";case J:return"SuspenseList";case j:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case E:return"Portal";case B:return r.displayName||"Context";case q:return(r._context.displayName||"Context")+".Consumer";case ee:var s=r.render;return r=r.displayName,r||(r=s.displayName||s.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case O:return s=r.displayName||null,s!==null?s:Y(r.type)||"Memo";case R:s=r._payload,r=r._init;try{return Y(r(s))}catch{}}return null}var H=Array.isArray,N=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,G=n.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,W={pending:!1,data:null,method:null,action:null},ne=[],ie=-1;function V(r){return{current:r}}function z(r){0>ie||(r.current=ne[ie],ne[ie]=null,ie--)}function $(r,s){ie++,ne[ie]=r.current,r.current=s}var X=V(null),re=V(null),ue=V(null),he=V(null);function Se(r,s){switch($(ue,s),$(re,r),$(X,null),s.nodeType){case 9:case 11:r=(r=s.documentElement)&&(r=r.namespaceURI)?ev(r):0;break;default:if(r=s.tagName,s=s.namespaceURI)s=ev(s),r=tv(s,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}z(X),$(X,r)}function fe(){z(X),z(re),z(ue)}function te(r){r.memoizedState!==null&&$(he,r);var s=X.current,o=tv(s,r.type);s!==o&&($(re,r),$(X,o))}function Ee(r){re.current===r&&(z(X),z(re)),he.current===r&&(z(he),Vc._currentValue=W)}var De,st;function He(r){if(De===void 0)try{throw Error()}catch(o){var s=o.stack.trim().match(/\n( *(at )?)/);De=s&&s[1]||"",st=-1<o.stack.indexOf(`
    at`)?" (<anonymous>)":-1<o.stack.indexOf("@")?"@unknown:0:0":""}return`
`+De+r+st}var Ft=!1;function In(r,s){if(!r||Ft)return"";Ft=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var u={DetermineComponentFrameRoot:function(){try{if(s){var be=function(){throw Error()};if(Object.defineProperty(be.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(be,[])}catch(pe){var de=pe}Reflect.construct(r,[],be)}else{try{be.call()}catch(pe){de=pe}r.call(be.prototype)}}else{try{throw Error()}catch(pe){de=pe}(be=r())&&typeof be.catch=="function"&&be.catch(function(){})}}catch(pe){if(pe&&de&&typeof pe.stack=="string")return[pe.stack,de.stack]}return[null,null]}};u.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var g=Object.getOwnPropertyDescriptor(u.DetermineComponentFrameRoot,"name");g&&g.configurable&&Object.defineProperty(u.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var y=u.DetermineComponentFrameRoot(),S=y[0],P=y[1];if(S&&P){var K=S.split(`
`),le=P.split(`
`);for(g=u=0;u<K.length&&!K[u].includes("DetermineComponentFrameRoot");)u++;for(;g<le.length&&!le[g].includes("DetermineComponentFrameRoot");)g++;if(u===K.length||g===le.length)for(u=K.length-1,g=le.length-1;1<=u&&0<=g&&K[u]!==le[g];)g--;for(;1<=u&&0<=g;u--,g--)if(K[u]!==le[g]){if(u!==1||g!==1)do if(u--,g--,0>g||K[u]!==le[g]){var ge=`
`+K[u].replace(" at new "," at ");return r.displayName&&ge.includes("<anonymous>")&&(ge=ge.replace("<anonymous>",r.displayName)),ge}while(1<=u&&0<=g);break}}}finally{Ft=!1,Error.prepareStackTrace=o}return(o=r?r.displayName||r.name:"")?He(o):""}function Ve(r,s){switch(r.tag){case 26:case 27:case 5:return He(r.type);case 16:return He("Lazy");case 13:return r.child!==s&&s!==null?He("Suspense Fallback"):He("Suspense");case 19:return He("SuspenseList");case 0:case 15:return In(r.type,!1);case 11:return In(r.type.render,!1);case 1:return In(r.type,!0);case 31:return He("Activity");default:return""}}function nt(r){try{var s="",o=null;do s+=Ve(r,o),o=r,r=r.return;while(r);return s}catch(u){return`
Error generating stack: `+u.message+`
`+u.stack}}var bt=Object.prototype.hasOwnProperty,kt=t.unstable_scheduleCallback,at=t.unstable_cancelCallback,Wn=t.unstable_shouldYield,jr=t.unstable_requestPaint,It=t.unstable_now,Kn=t.unstable_getCurrentPriorityLevel,qt=t.unstable_ImmediatePriority,Yn=t.unstable_UserBlockingPriority,rs=t.unstable_NormalPriority,Hf=t.unstable_LowPriority,Nu=t.unstable_IdlePriority,Pu=t.log,Lu=t.unstable_setDisableYieldValue,Ir=null,gn=null;function hr(r){if(typeof Pu=="function"&&Lu(r),gn&&typeof gn.setStrictMode=="function")try{gn.setStrictMode(Ir,r)}catch{}}var Nt=Math.clz32?Math.clz32:Vu,Bu=Math.log,ho=Math.LN2;function Vu(r){return r>>>=0,r===0?32:31-(Bu(r)/ho|0)|0}var Wr=256,ha=262144,Ht=4194304;function Kr(r){var s=r&42;if(s!==0)return s;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Yr(r,s,o){var u=r.pendingLanes;if(u===0)return 0;var g=0,y=r.suspendedLanes,S=r.pingedLanes;r=r.warmLanes;var P=u&134217727;return P!==0?(u=P&~y,u!==0?g=Kr(u):(S&=P,S!==0?g=Kr(S):o||(o=P&~r,o!==0&&(g=Kr(o))))):(P=u&~y,P!==0?g=Kr(P):S!==0?g=Kr(S):o||(o=u&~r,o!==0&&(g=Kr(o)))),g===0?0:s!==0&&s!==g&&(s&y)===0&&(y=g&-g,o=s&-s,y>=o||y===32&&(o&4194048)!==0)?s:g}function Mr(r,s){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&s)===0}function Gf(r,s){switch(r){case 1:case 2:case 4:case 8:case 64:return s+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Uu(){var r=Ht;return Ht<<=1,(Ht&62914560)===0&&(Ht=4194304),r}function Xr(r){for(var s=[],o=0;31>o;o++)s.push(r);return s}function fa(r,s){r.pendingLanes|=s,s!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function $f(r,s,o,u,g,y){var S=r.pendingLanes;r.pendingLanes=o,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=o,r.entangledLanes&=o,r.errorRecoveryDisabledLanes&=o,r.shellSuspendCounter=0;var P=r.entanglements,K=r.expirationTimes,le=r.hiddenUpdates;for(o=S&~o;0<o;){var ge=31-Nt(o),be=1<<ge;P[ge]=0,K[ge]=-1;var de=le[ge];if(de!==null)for(le[ge]=null,ge=0;ge<de.length;ge++){var pe=de[ge];pe!==null&&(pe.lane&=-536870913)}o&=~be}u!==0&&ma(r,u,0),y!==0&&g===0&&r.tag!==0&&(r.suspendedLanes|=y&~(S&~s))}function ma(r,s,o){r.pendingLanes|=s,r.suspendedLanes&=~s;var u=31-Nt(s);r.entangledLanes|=s,r.entanglements[u]=r.entanglements[u]|1073741824|o&261930}function Hl(r,s){var o=r.entangledLanes|=s;for(r=r.entanglements;o;){var u=31-Nt(o),g=1<<u;g&s|r[u]&s&&(r[u]|=s),o&=~g}}function Gl(r,s){var o=s&-s;return o=(o&42)!==0?1:pa(o),(o&(r.suspendedLanes|s))!==0?0:o}function pa(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Ti(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function zu(){var r=G.p;return r!==0?r:(r=window.event,r===void 0?32:wv(r.type))}function Or(r,s){var o=G.p;try{return G.p=r,s()}finally{G.p=o}}var kr=Math.random().toString(36).slice(2),Gt="__reactFiber$"+kr,un="__reactProps$"+kr,Jr="__reactContainer$"+kr,fo="__reactEvents$"+kr,Qf="__reactListeners$"+kr,Fu="__reactHandles$"+kr,qu="__reactResources$"+kr,Zr="__reactMarker$"+kr;function mo(r){delete r[Gt],delete r[un],delete r[fo],delete r[Qf],delete r[Fu]}function ei(r){var s=r[Gt];if(s)return s;for(var o=r.parentNode;o;){if(s=o[Jr]||o[Gt]){if(o=s.alternate,s.child!==null||o!==null&&o.child!==null)for(r=lv(r);r!==null;){if(o=r[Gt])return o;r=lv(r)}return s}r=o,o=r.parentNode}return null}function fr(r){if(r=r[Gt]||r[Jr]){var s=r.tag;if(s===5||s===6||s===13||s===31||s===26||s===27||s===3)return r}return null}function Xn(r){var s=r.tag;if(s===5||s===26||s===27||s===6)return r.stateNode;throw Error(i(33))}function ti(r){var s=r[qu];return s||(s=r[qu]={hoistableStyles:new Map,hoistableScripts:new Map}),s}function $t(r){r[Zr]=!0}var $l=new Set,Ql={};function ni(r,s){ri(r,s),ri(r+"Capture",s)}function ri(r,s){for(Ql[r]=s,r=0;r<s.length;r++)$l.add(s[r])}var Wl=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Kl={},Yl={};function Hu(r){return bt.call(Yl,r)?!0:bt.call(Kl,r)?!1:Wl.test(r)?Yl[r]=!0:(Kl[r]=!0,!1)}function po(r,s,o){if(Hu(s))if(o===null)r.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":r.removeAttribute(s);return;case"boolean":var u=s.toLowerCase().slice(0,5);if(u!=="data-"&&u!=="aria-"){r.removeAttribute(s);return}}r.setAttribute(s,""+o)}}function Jn(r,s,o){if(o===null)r.removeAttribute(s);else{switch(typeof o){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(s);return}r.setAttribute(s,""+o)}}function Qt(r,s,o,u){if(u===null)r.removeAttribute(o);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(o);return}r.setAttributeNS(s,o,""+u)}}function dn(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function is(r){var s=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function Xl(r,s,o){var u=Object.getOwnPropertyDescriptor(r.constructor.prototype,s);if(!r.hasOwnProperty(s)&&typeof u<"u"&&typeof u.get=="function"&&typeof u.set=="function"){var g=u.get,y=u.set;return Object.defineProperty(r,s,{configurable:!0,get:function(){return g.call(this)},set:function(S){o=""+S,y.call(this,S)}}),Object.defineProperty(r,s,{enumerable:u.enumerable}),{getValue:function(){return o},setValue:function(S){o=""+S},stopTracking:function(){r._valueTracker=null,delete r[s]}}}}function dt(r){if(!r._valueTracker){var s=is(r)?"checked":"value";r._valueTracker=Xl(r,s,""+r[s])}}function ga(r){if(!r)return!1;var s=r._valueTracker;if(!s)return!0;var o=s.getValue(),u="";return r&&(u=is(r)?r.checked?"true":"false":r.value),r=u,r!==o?(s.setValue(r),!0):!1}function ii(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var ya=/[\n"\\]/g;function Ln(r){return r.replace(ya,function(s){return"\\"+s.charCodeAt(0).toString(16)+" "})}function go(r,s,o,u,g,y,S,P){r.name="",S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"?r.type=S:r.removeAttribute("type"),s!=null?S==="number"?(s===0&&r.value===""||r.value!=s)&&(r.value=""+dn(s)):r.value!==""+dn(s)&&(r.value=""+dn(s)):S!=="submit"&&S!=="reset"||r.removeAttribute("value"),s!=null?Jl(r,S,dn(s)):o!=null?Jl(r,S,dn(o)):u!=null&&r.removeAttribute("value"),g==null&&y!=null&&(r.defaultChecked=!!y),g!=null&&(r.checked=g&&typeof g!="function"&&typeof g!="symbol"),P!=null&&typeof P!="function"&&typeof P!="symbol"&&typeof P!="boolean"?r.name=""+dn(P):r.removeAttribute("name")}function Gu(r,s,o,u,g,y,S,P){if(y!=null&&typeof y!="function"&&typeof y!="symbol"&&typeof y!="boolean"&&(r.type=y),s!=null||o!=null){if(!(y!=="submit"&&y!=="reset"||s!=null)){dt(r);return}o=o!=null?""+dn(o):"",s=s!=null?""+dn(s):o,P||s===r.value||(r.value=s),r.defaultValue=s}u=u??g,u=typeof u!="function"&&typeof u!="symbol"&&!!u,r.checked=P?r.checked:!!u,r.defaultChecked=!!u,S!=null&&typeof S!="function"&&typeof S!="symbol"&&typeof S!="boolean"&&(r.name=S),dt(r)}function Jl(r,s,o){s==="number"&&ii(r.ownerDocument)===r||r.defaultValue===""+o||(r.defaultValue=""+o)}function ss(r,s,o,u){if(r=r.options,s){s={};for(var g=0;g<o.length;g++)s["$"+o[g]]=!0;for(o=0;o<r.length;o++)g=s.hasOwnProperty("$"+r[o].value),r[o].selected!==g&&(r[o].selected=g),g&&u&&(r[o].defaultSelected=!0)}else{for(o=""+dn(o),s=null,g=0;g<r.length;g++){if(r[g].value===o){r[g].selected=!0,u&&(r[g].defaultSelected=!0);return}s!==null||r[g].disabled||(s=r[g])}s!==null&&(s.selected=!0)}}function $u(r,s,o){if(s!=null&&(s=""+dn(s),s!==r.value&&(r.value=s),o==null)){r.defaultValue!==s&&(r.defaultValue=s);return}r.defaultValue=o!=null?""+dn(o):""}function as(r,s,o,u){if(s==null){if(u!=null){if(o!=null)throw Error(i(92));if(H(u)){if(1<u.length)throw Error(i(93));u=u[0]}o=u}o==null&&(o=""),s=o}o=dn(s),r.defaultValue=o,u=r.textContent,u===o&&u!==""&&u!==null&&(r.value=u),dt(r)}function Bn(r,s){if(s){var o=r.firstChild;if(o&&o===r.lastChild&&o.nodeType===3){o.nodeValue=s;return}}r.textContent=s}var Qu=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Zl(r,s,o){var u=s.indexOf("--")===0;o==null||typeof o=="boolean"||o===""?u?r.setProperty(s,""):s==="float"?r.cssFloat="":r[s]="":u?r.setProperty(s,o):typeof o!="number"||o===0||Qu.has(s)?s==="float"?r.cssFloat=o:r[s]=(""+o).trim():r[s]=o+"px"}function ec(r,s,o){if(s!=null&&typeof s!="object")throw Error(i(62));if(r=r.style,o!=null){for(var u in o)!o.hasOwnProperty(u)||s!=null&&s.hasOwnProperty(u)||(u.indexOf("--")===0?r.setProperty(u,""):u==="float"?r.cssFloat="":r[u]="");for(var g in s)u=s[g],s.hasOwnProperty(g)&&o[g]!==u&&Zl(r,g,u)}else for(var y in s)s.hasOwnProperty(y)&&Zl(r,y,s[y])}function yo(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Wu=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),os=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function _o(r){return os.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Nr(){}var tc=null;function mr(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var ls=null,si=null;function _a(r){var s=fr(r);if(s&&(r=s.stateNode)){var o=r[un]||null;e:switch(r=s.stateNode,s.type){case"input":if(go(r,o.value,o.defaultValue,o.defaultValue,o.checked,o.defaultChecked,o.type,o.name),s=o.name,o.type==="radio"&&s!=null){for(o=r;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll('input[name="'+Ln(""+s)+'"][type="radio"]'),s=0;s<o.length;s++){var u=o[s];if(u!==r&&u.form===r.form){var g=u[un]||null;if(!g)throw Error(i(90));go(u,g.value,g.defaultValue,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name)}}for(s=0;s<o.length;s++)u=o[s],u.form===r.form&&ga(u)}break e;case"textarea":$u(r,o.value,o.defaultValue);break e;case"select":s=o.value,s!=null&&ss(r,!!o.multiple,s,!1)}}}var bo=!1;function cs(r,s,o){if(bo)return r(s,o);bo=!0;try{var u=r(s);return u}finally{if(bo=!1,(ls!==null||si!==null)&&(zd(),ls&&(s=ls,r=si,si=ls=null,_a(s),r)))for(s=0;s<r.length;s++)_a(r[s])}}function Pr(r,s){var o=r.stateNode;if(o===null)return null;var u=o[un]||null;if(u===null)return null;o=u[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(r=r.type,u=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!u;break e;default:r=!1}if(r)return null;if(o&&typeof o!="function")throw Error(i(231,s,typeof o));return o}var pr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ba=!1;if(pr)try{var mt={};Object.defineProperty(mt,"passive",{get:function(){ba=!0}}),window.addEventListener("test",mt,mt),window.removeEventListener("test",mt,mt)}catch{ba=!1}var ai=null,nc=null,va=null;function rc(){if(va)return va;var r,s=nc,o=s.length,u,g="value"in ai?ai.value:ai.textContent,y=g.length;for(r=0;r<o&&s[r]===g[r];r++);var S=o-r;for(u=1;u<=S&&s[o-u]===g[y-u];u++);return va=g.slice(r,1<u?1-u:void 0)}function xa(r){var s=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&s===13&&(r=13)):r=s,r===10&&(r=13),32<=r||r===13?r:0}function Ci(){return!0}function Lr(){return!1}function yn(r){function s(o,u,g,y,S){this._reactName=o,this._targetInst=g,this.type=u,this.nativeEvent=y,this.target=S,this.currentTarget=null;for(var P in r)r.hasOwnProperty(P)&&(o=r[P],this[P]=o?o(y):y[P]);return this.isDefaultPrevented=(y.defaultPrevented!=null?y.defaultPrevented:y.returnValue===!1)?Ci:Lr,this.isPropagationStopped=Lr,this}return b(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=Ci)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=Ci)},persist:function(){},isPersistent:Ci}),s}var Ai={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},oi=yn(Ai),us=b({},Ai,{view:0,detail:0}),ic=yn(us),ds,vo,li,xo=b({},us,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:hs,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==li&&(li&&r.type==="mousemove"?(ds=r.screenX-li.screenX,vo=r.screenY-li.screenY):vo=ds=0,li=r),ds)},movementY:function(r){return"movementY"in r?r.movementY:vo}}),sc=yn(xo),Sa=b({},xo,{dataTransfer:0}),Ku=yn(Sa),Yu=b({},us,{relatedTarget:0}),Ea=yn(Yu),ac=b({},Ai,{animationName:0,elapsedTime:0,pseudoElement:0}),Xu=yn(ac),So=b({},Ai,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),Ju=yn(So),Zu=b({},Ai,{data:0}),ci=yn(Zu),ed={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},td={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},nd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function rd(r){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(r):(r=nd[r])?!!s[r]:!1}function hs(){return rd}var Mn=b({},us,{key:function(r){if(r.key){var s=ed[r.key]||r.key;if(s!=="Unidentified")return s}return r.type==="keypress"?(r=xa(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?td[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:hs,charCode:function(r){return r.type==="keypress"?xa(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?xa(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),id=yn(Mn),sd=b({},xo,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ri=yn(sd),m=b({},us,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:hs}),x=yn(m),C=b({},Ai,{propertyName:0,elapsedTime:0,pseudoElement:0}),U=yn(C),ae=b({},xo,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),me=yn(ae),we=b({},Ai,{newState:0,oldState:0}),Fe=yn(we),Pt=[9,13,27,32],ot=pr&&"CompositionEvent"in window,Ct=null;pr&&"documentMode"in document&&(Ct=document.documentMode);var gr=pr&&"TextEvent"in window&&!Ct,ui=pr&&(!ot||Ct&&8<Ct&&11>=Ct),Br=" ",Vr=!1;function wa(r,s){switch(r){case"keyup":return Pt.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Eo(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var wo=!1;function sC(r,s){switch(r){case"compositionend":return Eo(s);case"keypress":return s.which!==32?null:(Vr=!0,Br);case"textInput":return r=s.data,r===Br&&Vr?null:r;default:return null}}function aC(r,s){if(wo)return r==="compositionend"||!ot&&wa(r,s)?(r=rc(),va=nc=ai=null,wo=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return ui&&s.locale!=="ko"?null:s.data;default:return null}}var oC={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function d_(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s==="input"?!!oC[r.type]:s==="textarea"}function h_(r,s,o,u){ls?si?si.push(u):si=[u]:ls=u,s=Wd(s,"onChange"),0<s.length&&(o=new oi("onChange","change",null,o,u),r.push({event:o,listeners:s}))}var oc=null,lc=null;function lC(r){Wb(r,0)}function ad(r){var s=Xn(r);if(ga(s))return r}function f_(r,s){if(r==="change")return s}var m_=!1;if(pr){var Wf;if(pr){var Kf="oninput"in document;if(!Kf){var p_=document.createElement("div");p_.setAttribute("oninput","return;"),Kf=typeof p_.oninput=="function"}Wf=Kf}else Wf=!1;m_=Wf&&(!document.documentMode||9<document.documentMode)}function g_(){oc&&(oc.detachEvent("onpropertychange",y_),lc=oc=null)}function y_(r){if(r.propertyName==="value"&&ad(lc)){var s=[];h_(s,lc,r,mr(r)),cs(lC,s)}}function cC(r,s,o){r==="focusin"?(g_(),oc=s,lc=o,oc.attachEvent("onpropertychange",y_)):r==="focusout"&&g_()}function uC(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return ad(lc)}function dC(r,s){if(r==="click")return ad(s)}function hC(r,s){if(r==="input"||r==="change")return ad(s)}function fC(r,s){return r===s&&(r!==0||1/r===1/s)||r!==r&&s!==s}var Zn=typeof Object.is=="function"?Object.is:fC;function cc(r,s){if(Zn(r,s))return!0;if(typeof r!="object"||r===null||typeof s!="object"||s===null)return!1;var o=Object.keys(r),u=Object.keys(s);if(o.length!==u.length)return!1;for(u=0;u<o.length;u++){var g=o[u];if(!bt.call(s,g)||!Zn(r[g],s[g]))return!1}return!0}function __(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function b_(r,s){var o=__(r);r=0;for(var u;o;){if(o.nodeType===3){if(u=r+o.textContent.length,r<=s&&u>=s)return{node:o,offset:s-r};r=u}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=__(o)}}function v_(r,s){return r&&s?r===s?!0:r&&r.nodeType===3?!1:s&&s.nodeType===3?v_(r,s.parentNode):"contains"in r?r.contains(s):r.compareDocumentPosition?!!(r.compareDocumentPosition(s)&16):!1:!1}function x_(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var s=ii(r.document);s instanceof r.HTMLIFrameElement;){try{var o=typeof s.contentWindow.location.href=="string"}catch{o=!1}if(o)r=s.contentWindow;else break;s=ii(r.document)}return s}function Yf(r){var s=r&&r.nodeName&&r.nodeName.toLowerCase();return s&&(s==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||s==="textarea"||r.contentEditable==="true")}var mC=pr&&"documentMode"in document&&11>=document.documentMode,To=null,Xf=null,uc=null,Jf=!1;function S_(r,s,o){var u=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;Jf||To==null||To!==ii(u)||(u=To,"selectionStart"in u&&Yf(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),uc&&cc(uc,u)||(uc=u,u=Wd(Xf,"onSelect"),0<u.length&&(s=new oi("onSelect","select",null,s,o),r.push({event:s,listeners:u}),s.target=To)))}function Ta(r,s){var o={};return o[r.toLowerCase()]=s.toLowerCase(),o["Webkit"+r]="webkit"+s,o["Moz"+r]="moz"+s,o}var Co={animationend:Ta("Animation","AnimationEnd"),animationiteration:Ta("Animation","AnimationIteration"),animationstart:Ta("Animation","AnimationStart"),transitionrun:Ta("Transition","TransitionRun"),transitionstart:Ta("Transition","TransitionStart"),transitioncancel:Ta("Transition","TransitionCancel"),transitionend:Ta("Transition","TransitionEnd")},Zf={},E_={};pr&&(E_=document.createElement("div").style,"AnimationEvent"in window||(delete Co.animationend.animation,delete Co.animationiteration.animation,delete Co.animationstart.animation),"TransitionEvent"in window||delete Co.transitionend.transition);function Ca(r){if(Zf[r])return Zf[r];if(!Co[r])return r;var s=Co[r],o;for(o in s)if(s.hasOwnProperty(o)&&o in E_)return Zf[r]=s[o];return r}var w_=Ca("animationend"),T_=Ca("animationiteration"),C_=Ca("animationstart"),pC=Ca("transitionrun"),gC=Ca("transitionstart"),yC=Ca("transitioncancel"),A_=Ca("transitionend"),R_=new Map,em="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");em.push("scrollEnd");function Ur(r,s){R_.set(r,s),ni(s,[r])}var od=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var s=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(s))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},yr=[],Ao=0,tm=0;function ld(){for(var r=Ao,s=tm=Ao=0;s<r;){var o=yr[s];yr[s++]=null;var u=yr[s];yr[s++]=null;var g=yr[s];yr[s++]=null;var y=yr[s];if(yr[s++]=null,u!==null&&g!==null){var S=u.pending;S===null?g.next=g:(g.next=S.next,S.next=g),u.pending=g}y!==0&&D_(o,g,y)}}function cd(r,s,o,u){yr[Ao++]=r,yr[Ao++]=s,yr[Ao++]=o,yr[Ao++]=u,tm|=u,r.lanes|=u,r=r.alternate,r!==null&&(r.lanes|=u)}function nm(r,s,o,u){return cd(r,s,o,u),ud(r)}function Aa(r,s){return cd(r,null,null,s),ud(r)}function D_(r,s,o){r.lanes|=o;var u=r.alternate;u!==null&&(u.lanes|=o);for(var g=!1,y=r.return;y!==null;)y.childLanes|=o,u=y.alternate,u!==null&&(u.childLanes|=o),y.tag===22&&(r=y.stateNode,r===null||r._visibility&1||(g=!0)),r=y,y=y.return;return r.tag===3?(y=r.stateNode,g&&s!==null&&(g=31-Nt(o),r=y.hiddenUpdates,u=r[g],u===null?r[g]=[s]:u.push(s),s.lane=o|536870912),y):null}function ud(r){if(50<Mc)throw Mc=0,dp=null,Error(i(185));for(var s=r.return;s!==null;)r=s,s=r.return;return r.tag===3?r.stateNode:null}var Ro={};function _C(r,s,o,u){this.tag=r,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function er(r,s,o,u){return new _C(r,s,o,u)}function rm(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Di(r,s){var o=r.alternate;return o===null?(o=er(r.tag,s,r.key,r.mode),o.elementType=r.elementType,o.type=r.type,o.stateNode=r.stateNode,o.alternate=r,r.alternate=o):(o.pendingProps=s,o.type=r.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=r.flags&65011712,o.childLanes=r.childLanes,o.lanes=r.lanes,o.child=r.child,o.memoizedProps=r.memoizedProps,o.memoizedState=r.memoizedState,o.updateQueue=r.updateQueue,s=r.dependencies,o.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},o.sibling=r.sibling,o.index=r.index,o.ref=r.ref,o.refCleanup=r.refCleanup,o}function j_(r,s){r.flags&=65011714;var o=r.alternate;return o===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=o.childLanes,r.lanes=o.lanes,r.child=o.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=o.memoizedProps,r.memoizedState=o.memoizedState,r.updateQueue=o.updateQueue,r.type=o.type,s=o.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),r}function dd(r,s,o,u,g,y){var S=0;if(u=r,typeof r=="function")rm(r)&&(S=1);else if(typeof r=="string")S=EA(r,o,X.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case j:return r=er(31,o,s,g),r.elementType=j,r.lanes=y,r;case w:return Ra(o.children,g,y,s);case D:S=8,g|=24;break;case L:return r=er(12,o,s,g|2),r.elementType=L,r.lanes=y,r;case Q:return r=er(13,o,s,g),r.elementType=Q,r.lanes=y,r;case J:return r=er(19,o,s,g),r.elementType=J,r.lanes=y,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case B:S=10;break e;case q:S=9;break e;case ee:S=11;break e;case O:S=14;break e;case R:S=16,u=null;break e}S=29,o=Error(i(130,r===null?"null":typeof r,"")),u=null}return s=er(S,o,s,g),s.elementType=r,s.type=u,s.lanes=y,s}function Ra(r,s,o,u){return r=er(7,r,u,s),r.lanes=o,r}function im(r,s,o){return r=er(6,r,null,s),r.lanes=o,r}function I_(r){var s=er(18,null,null,0);return s.stateNode=r,s}function sm(r,s,o){return s=er(4,r.children!==null?r.children:[],r.key,s),s.lanes=o,s.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},s}var M_=new WeakMap;function _r(r,s){if(typeof r=="object"&&r!==null){var o=M_.get(r);return o!==void 0?o:(s={value:r,source:s,stack:nt(s)},M_.set(r,s),s)}return{value:r,source:s,stack:nt(s)}}var Do=[],jo=0,hd=null,dc=0,br=[],vr=0,fs=null,di=1,hi="";function ji(r,s){Do[jo++]=dc,Do[jo++]=hd,hd=r,dc=s}function O_(r,s,o){br[vr++]=di,br[vr++]=hi,br[vr++]=fs,fs=r;var u=di;r=hi;var g=32-Nt(u)-1;u&=~(1<<g),o+=1;var y=32-Nt(s)+g;if(30<y){var S=g-g%5;y=(u&(1<<S)-1).toString(32),u>>=S,g-=S,di=1<<32-Nt(s)+g|o<<g|u,hi=y+r}else di=1<<y|o<<g|u,hi=r}function am(r){r.return!==null&&(ji(r,1),O_(r,1,0))}function om(r){for(;r===hd;)hd=Do[--jo],Do[jo]=null,dc=Do[--jo],Do[jo]=null;for(;r===fs;)fs=br[--vr],br[vr]=null,hi=br[--vr],br[vr]=null,di=br[--vr],br[vr]=null}function k_(r,s){br[vr++]=di,br[vr++]=hi,br[vr++]=fs,di=s.id,hi=s.overflow,fs=r}var _n=null,xt=null,et=!1,ms=null,xr=!1,lm=Error(i(519));function ps(r){var s=Error(i(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw hc(_r(s,r)),lm}function N_(r){var s=r.stateNode,o=r.type,u=r.memoizedProps;switch(s[Gt]=r,s[un]=u,o){case"dialog":We("cancel",s),We("close",s);break;case"iframe":case"object":case"embed":We("load",s);break;case"video":case"audio":for(o=0;o<kc.length;o++)We(kc[o],s);break;case"source":We("error",s);break;case"img":case"image":case"link":We("error",s),We("load",s);break;case"details":We("toggle",s);break;case"input":We("invalid",s),Gu(s,u.value,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name,!0);break;case"select":We("invalid",s);break;case"textarea":We("invalid",s),as(s,u.value,u.defaultValue,u.children)}o=u.children,typeof o!="string"&&typeof o!="number"&&typeof o!="bigint"||s.textContent===""+o||u.suppressHydrationWarning===!0||Jb(s.textContent,o)?(u.popover!=null&&(We("beforetoggle",s),We("toggle",s)),u.onScroll!=null&&We("scroll",s),u.onScrollEnd!=null&&We("scrollend",s),u.onClick!=null&&(s.onclick=Nr),s=!0):s=!1,s||ps(r,!0)}function P_(r){for(_n=r.return;_n;)switch(_n.tag){case 5:case 31:case 13:xr=!1;return;case 27:case 3:xr=!0;return;default:_n=_n.return}}function Io(r){if(r!==_n)return!1;if(!et)return P_(r),et=!0,!1;var s=r.tag,o;if((o=s!==3&&s!==27)&&((o=s===5)&&(o=r.type,o=!(o!=="form"&&o!=="button")||Cp(r.type,r.memoizedProps)),o=!o),o&&xt&&ps(r),P_(r),s===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));xt=ov(r)}else if(s===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(317));xt=ov(r)}else s===27?(s=xt,Ds(r.type)?(r=Ip,Ip=null,xt=r):xt=s):xt=_n?Er(r.stateNode.nextSibling):null;return!0}function Da(){xt=_n=null,et=!1}function cm(){var r=ms;return r!==null&&(Fn===null?Fn=r:Fn.push.apply(Fn,r),ms=null),r}function hc(r){ms===null?ms=[r]:ms.push(r)}var um=V(null),ja=null,Ii=null;function gs(r,s,o){$(um,s._currentValue),s._currentValue=o}function Mi(r){r._currentValue=um.current,z(um)}function dm(r,s,o){for(;r!==null;){var u=r.alternate;if((r.childLanes&s)!==s?(r.childLanes|=s,u!==null&&(u.childLanes|=s)):u!==null&&(u.childLanes&s)!==s&&(u.childLanes|=s),r===o)break;r=r.return}}function hm(r,s,o,u){var g=r.child;for(g!==null&&(g.return=r);g!==null;){var y=g.dependencies;if(y!==null){var S=g.child;y=y.firstContext;e:for(;y!==null;){var P=y;y=g;for(var K=0;K<s.length;K++)if(P.context===s[K]){y.lanes|=o,P=y.alternate,P!==null&&(P.lanes|=o),dm(y.return,o,r),u||(S=null);break e}y=P.next}}else if(g.tag===18){if(S=g.return,S===null)throw Error(i(341));S.lanes|=o,y=S.alternate,y!==null&&(y.lanes|=o),dm(S,o,r),S=null}else S=g.child;if(S!==null)S.return=g;else for(S=g;S!==null;){if(S===r){S=null;break}if(g=S.sibling,g!==null){g.return=S.return,S=g;break}S=S.return}g=S}}function Mo(r,s,o,u){r=null;for(var g=s,y=!1;g!==null;){if(!y){if((g.flags&524288)!==0)y=!0;else if((g.flags&262144)!==0)break}if(g.tag===10){var S=g.alternate;if(S===null)throw Error(i(387));if(S=S.memoizedProps,S!==null){var P=g.type;Zn(g.pendingProps.value,S.value)||(r!==null?r.push(P):r=[P])}}else if(g===he.current){if(S=g.alternate,S===null)throw Error(i(387));S.memoizedState.memoizedState!==g.memoizedState.memoizedState&&(r!==null?r.push(Vc):r=[Vc])}g=g.return}r!==null&&hm(s,r,o,u),s.flags|=262144}function fd(r){for(r=r.firstContext;r!==null;){if(!Zn(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Ia(r){ja=r,Ii=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function bn(r){return L_(ja,r)}function md(r,s){return ja===null&&Ia(r),L_(r,s)}function L_(r,s){var o=s._currentValue;if(s={context:s,memoizedValue:o,next:null},Ii===null){if(r===null)throw Error(i(308));Ii=s,r.dependencies={lanes:0,firstContext:s},r.flags|=524288}else Ii=Ii.next=s;return o}var bC=typeof AbortController<"u"?AbortController:function(){var r=[],s=this.signal={aborted:!1,addEventListener:function(o,u){r.push(u)}};this.abort=function(){s.aborted=!0,r.forEach(function(o){return o()})}},vC=t.unstable_scheduleCallback,xC=t.unstable_NormalPriority,Wt={$$typeof:B,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function fm(){return{controller:new bC,data:new Map,refCount:0}}function fc(r){r.refCount--,r.refCount===0&&vC(xC,function(){r.controller.abort()})}var mc=null,mm=0,Oo=0,ko=null;function SC(r,s){if(mc===null){var o=mc=[];mm=0,Oo=yp(),ko={status:"pending",value:void 0,then:function(u){o.push(u)}}}return mm++,s.then(B_,B_),s}function B_(){if(--mm===0&&mc!==null){ko!==null&&(ko.status="fulfilled");var r=mc;mc=null,Oo=0,ko=null;for(var s=0;s<r.length;s++)(0,r[s])()}}function EC(r,s){var o=[],u={status:"pending",value:null,reason:null,then:function(g){o.push(g)}};return r.then(function(){u.status="fulfilled",u.value=s;for(var g=0;g<o.length;g++)(0,o[g])(s)},function(g){for(u.status="rejected",u.reason=g,g=0;g<o.length;g++)(0,o[g])(void 0)}),u}var V_=N.S;N.S=function(r,s){Sb=It(),typeof s=="object"&&s!==null&&typeof s.then=="function"&&SC(r,s),V_!==null&&V_(r,s)};var Ma=V(null);function pm(){var r=Ma.current;return r!==null?r:_t.pooledCache}function pd(r,s){s===null?$(Ma,Ma.current):$(Ma,s.pool)}function U_(){var r=pm();return r===null?null:{parent:Wt._currentValue,pool:r}}var No=Error(i(460)),gm=Error(i(474)),gd=Error(i(542)),yd={then:function(){}};function z_(r){return r=r.status,r==="fulfilled"||r==="rejected"}function F_(r,s,o){switch(o=r[o],o===void 0?r.push(s):o!==s&&(s.then(Nr,Nr),s=o),s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,H_(r),r;default:if(typeof s.status=="string")s.then(Nr,Nr);else{if(r=_t,r!==null&&100<r.shellSuspendCounter)throw Error(i(482));r=s,r.status="pending",r.then(function(u){if(s.status==="pending"){var g=s;g.status="fulfilled",g.value=u}},function(u){if(s.status==="pending"){var g=s;g.status="rejected",g.reason=u}})}switch(s.status){case"fulfilled":return s.value;case"rejected":throw r=s.reason,H_(r),r}throw ka=s,No}}function Oa(r){try{var s=r._init;return s(r._payload)}catch(o){throw o!==null&&typeof o=="object"&&typeof o.then=="function"?(ka=o,No):o}}var ka=null;function q_(){if(ka===null)throw Error(i(459));var r=ka;return ka=null,r}function H_(r){if(r===No||r===gd)throw Error(i(483))}var Po=null,pc=0;function _d(r){var s=pc;return pc+=1,Po===null&&(Po=[]),F_(Po,r,s)}function gc(r,s){s=s.props.ref,r.ref=s!==void 0?s:null}function bd(r,s){throw s.$$typeof===v?Error(i(525)):(r=Object.prototype.toString.call(s),Error(i(31,r==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":r)))}function G_(r){function s(se,Z){if(r){var oe=se.deletions;oe===null?(se.deletions=[Z],se.flags|=16):oe.push(Z)}}function o(se,Z){if(!r)return null;for(;Z!==null;)s(se,Z),Z=Z.sibling;return null}function u(se){for(var Z=new Map;se!==null;)se.key!==null?Z.set(se.key,se):Z.set(se.index,se),se=se.sibling;return Z}function g(se,Z){return se=Di(se,Z),se.index=0,se.sibling=null,se}function y(se,Z,oe){return se.index=oe,r?(oe=se.alternate,oe!==null?(oe=oe.index,oe<Z?(se.flags|=67108866,Z):oe):(se.flags|=67108866,Z)):(se.flags|=1048576,Z)}function S(se){return r&&se.alternate===null&&(se.flags|=67108866),se}function P(se,Z,oe,ye){return Z===null||Z.tag!==6?(Z=im(oe,se.mode,ye),Z.return=se,Z):(Z=g(Z,oe),Z.return=se,Z)}function K(se,Z,oe,ye){var je=oe.type;return je===w?ge(se,Z,oe.props.children,ye,oe.key):Z!==null&&(Z.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===R&&Oa(je)===Z.type)?(Z=g(Z,oe.props),gc(Z,oe),Z.return=se,Z):(Z=dd(oe.type,oe.key,oe.props,null,se.mode,ye),gc(Z,oe),Z.return=se,Z)}function le(se,Z,oe,ye){return Z===null||Z.tag!==4||Z.stateNode.containerInfo!==oe.containerInfo||Z.stateNode.implementation!==oe.implementation?(Z=sm(oe,se.mode,ye),Z.return=se,Z):(Z=g(Z,oe.children||[]),Z.return=se,Z)}function ge(se,Z,oe,ye,je){return Z===null||Z.tag!==7?(Z=Ra(oe,se.mode,ye,je),Z.return=se,Z):(Z=g(Z,oe),Z.return=se,Z)}function be(se,Z,oe){if(typeof Z=="string"&&Z!==""||typeof Z=="number"||typeof Z=="bigint")return Z=im(""+Z,se.mode,oe),Z.return=se,Z;if(typeof Z=="object"&&Z!==null){switch(Z.$$typeof){case T:return oe=dd(Z.type,Z.key,Z.props,null,se.mode,oe),gc(oe,Z),oe.return=se,oe;case E:return Z=sm(Z,se.mode,oe),Z.return=se,Z;case R:return Z=Oa(Z),be(se,Z,oe)}if(H(Z)||F(Z))return Z=Ra(Z,se.mode,oe,null),Z.return=se,Z;if(typeof Z.then=="function")return be(se,_d(Z),oe);if(Z.$$typeof===B)return be(se,md(se,Z),oe);bd(se,Z)}return null}function de(se,Z,oe,ye){var je=Z!==null?Z.key:null;if(typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint")return je!==null?null:P(se,Z,""+oe,ye);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case T:return oe.key===je?K(se,Z,oe,ye):null;case E:return oe.key===je?le(se,Z,oe,ye):null;case R:return oe=Oa(oe),de(se,Z,oe,ye)}if(H(oe)||F(oe))return je!==null?null:ge(se,Z,oe,ye,null);if(typeof oe.then=="function")return de(se,Z,_d(oe),ye);if(oe.$$typeof===B)return de(se,Z,md(se,oe),ye);bd(se,oe)}return null}function pe(se,Z,oe,ye,je){if(typeof ye=="string"&&ye!==""||typeof ye=="number"||typeof ye=="bigint")return se=se.get(oe)||null,P(Z,se,""+ye,je);if(typeof ye=="object"&&ye!==null){switch(ye.$$typeof){case T:return se=se.get(ye.key===null?oe:ye.key)||null,K(Z,se,ye,je);case E:return se=se.get(ye.key===null?oe:ye.key)||null,le(Z,se,ye,je);case R:return ye=Oa(ye),pe(se,Z,oe,ye,je)}if(H(ye)||F(ye))return se=se.get(oe)||null,ge(Z,se,ye,je,null);if(typeof ye.then=="function")return pe(se,Z,oe,_d(ye),je);if(ye.$$typeof===B)return pe(se,Z,oe,md(Z,ye),je);bd(Z,ye)}return null}function Ae(se,Z,oe,ye){for(var je=null,rt=null,Re=Z,Ge=Z=0,Ye=null;Re!==null&&Ge<oe.length;Ge++){Re.index>Ge?(Ye=Re,Re=null):Ye=Re.sibling;var it=de(se,Re,oe[Ge],ye);if(it===null){Re===null&&(Re=Ye);break}r&&Re&&it.alternate===null&&s(se,Re),Z=y(it,Z,Ge),rt===null?je=it:rt.sibling=it,rt=it,Re=Ye}if(Ge===oe.length)return o(se,Re),et&&ji(se,Ge),je;if(Re===null){for(;Ge<oe.length;Ge++)Re=be(se,oe[Ge],ye),Re!==null&&(Z=y(Re,Z,Ge),rt===null?je=Re:rt.sibling=Re,rt=Re);return et&&ji(se,Ge),je}for(Re=u(Re);Ge<oe.length;Ge++)Ye=pe(Re,se,Ge,oe[Ge],ye),Ye!==null&&(r&&Ye.alternate!==null&&Re.delete(Ye.key===null?Ge:Ye.key),Z=y(Ye,Z,Ge),rt===null?je=Ye:rt.sibling=Ye,rt=Ye);return r&&Re.forEach(function(ks){return s(se,ks)}),et&&ji(se,Ge),je}function Oe(se,Z,oe,ye){if(oe==null)throw Error(i(151));for(var je=null,rt=null,Re=Z,Ge=Z=0,Ye=null,it=oe.next();Re!==null&&!it.done;Ge++,it=oe.next()){Re.index>Ge?(Ye=Re,Re=null):Ye=Re.sibling;var ks=de(se,Re,it.value,ye);if(ks===null){Re===null&&(Re=Ye);break}r&&Re&&ks.alternate===null&&s(se,Re),Z=y(ks,Z,Ge),rt===null?je=ks:rt.sibling=ks,rt=ks,Re=Ye}if(it.done)return o(se,Re),et&&ji(se,Ge),je;if(Re===null){for(;!it.done;Ge++,it=oe.next())it=be(se,it.value,ye),it!==null&&(Z=y(it,Z,Ge),rt===null?je=it:rt.sibling=it,rt=it);return et&&ji(se,Ge),je}for(Re=u(Re);!it.done;Ge++,it=oe.next())it=pe(Re,se,Ge,it.value,ye),it!==null&&(r&&it.alternate!==null&&Re.delete(it.key===null?Ge:it.key),Z=y(it,Z,Ge),rt===null?je=it:rt.sibling=it,rt=it);return r&&Re.forEach(function(kA){return s(se,kA)}),et&&ji(se,Ge),je}function yt(se,Z,oe,ye){if(typeof oe=="object"&&oe!==null&&oe.type===w&&oe.key===null&&(oe=oe.props.children),typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case T:e:{for(var je=oe.key;Z!==null;){if(Z.key===je){if(je=oe.type,je===w){if(Z.tag===7){o(se,Z.sibling),ye=g(Z,oe.props.children),ye.return=se,se=ye;break e}}else if(Z.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===R&&Oa(je)===Z.type){o(se,Z.sibling),ye=g(Z,oe.props),gc(ye,oe),ye.return=se,se=ye;break e}o(se,Z);break}else s(se,Z);Z=Z.sibling}oe.type===w?(ye=Ra(oe.props.children,se.mode,ye,oe.key),ye.return=se,se=ye):(ye=dd(oe.type,oe.key,oe.props,null,se.mode,ye),gc(ye,oe),ye.return=se,se=ye)}return S(se);case E:e:{for(je=oe.key;Z!==null;){if(Z.key===je)if(Z.tag===4&&Z.stateNode.containerInfo===oe.containerInfo&&Z.stateNode.implementation===oe.implementation){o(se,Z.sibling),ye=g(Z,oe.children||[]),ye.return=se,se=ye;break e}else{o(se,Z);break}else s(se,Z);Z=Z.sibling}ye=sm(oe,se.mode,ye),ye.return=se,se=ye}return S(se);case R:return oe=Oa(oe),yt(se,Z,oe,ye)}if(H(oe))return Ae(se,Z,oe,ye);if(F(oe)){if(je=F(oe),typeof je!="function")throw Error(i(150));return oe=je.call(oe),Oe(se,Z,oe,ye)}if(typeof oe.then=="function")return yt(se,Z,_d(oe),ye);if(oe.$$typeof===B)return yt(se,Z,md(se,oe),ye);bd(se,oe)}return typeof oe=="string"&&oe!==""||typeof oe=="number"||typeof oe=="bigint"?(oe=""+oe,Z!==null&&Z.tag===6?(o(se,Z.sibling),ye=g(Z,oe),ye.return=se,se=ye):(o(se,Z),ye=im(oe,se.mode,ye),ye.return=se,se=ye),S(se)):o(se,Z)}return function(se,Z,oe,ye){try{pc=0;var je=yt(se,Z,oe,ye);return Po=null,je}catch(Re){if(Re===No||Re===gd)throw Re;var rt=er(29,Re,null,se.mode);return rt.lanes=ye,rt.return=se,rt}}}var Na=G_(!0),$_=G_(!1),ys=!1;function ym(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function _m(r,s){r=r.updateQueue,s.updateQueue===r&&(s.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function _s(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function bs(r,s,o){var u=r.updateQueue;if(u===null)return null;if(u=u.shared,(lt&2)!==0){var g=u.pending;return g===null?s.next=s:(s.next=g.next,g.next=s),u.pending=s,s=ud(r),D_(r,null,o),s}return cd(r,u,s,o),ud(r)}function yc(r,s,o){if(s=s.updateQueue,s!==null&&(s=s.shared,(o&4194048)!==0)){var u=s.lanes;u&=r.pendingLanes,o|=u,s.lanes=o,Hl(r,o)}}function bm(r,s){var o=r.updateQueue,u=r.alternate;if(u!==null&&(u=u.updateQueue,o===u)){var g=null,y=null;if(o=o.firstBaseUpdate,o!==null){do{var S={lane:o.lane,tag:o.tag,payload:o.payload,callback:null,next:null};y===null?g=y=S:y=y.next=S,o=o.next}while(o!==null);y===null?g=y=s:y=y.next=s}else g=y=s;o={baseState:u.baseState,firstBaseUpdate:g,lastBaseUpdate:y,shared:u.shared,callbacks:u.callbacks},r.updateQueue=o;return}r=o.lastBaseUpdate,r===null?o.firstBaseUpdate=s:r.next=s,o.lastBaseUpdate=s}var vm=!1;function _c(){if(vm){var r=ko;if(r!==null)throw r}}function bc(r,s,o,u){vm=!1;var g=r.updateQueue;ys=!1;var y=g.firstBaseUpdate,S=g.lastBaseUpdate,P=g.shared.pending;if(P!==null){g.shared.pending=null;var K=P,le=K.next;K.next=null,S===null?y=le:S.next=le,S=K;var ge=r.alternate;ge!==null&&(ge=ge.updateQueue,P=ge.lastBaseUpdate,P!==S&&(P===null?ge.firstBaseUpdate=le:P.next=le,ge.lastBaseUpdate=K))}if(y!==null){var be=g.baseState;S=0,ge=le=K=null,P=y;do{var de=P.lane&-536870913,pe=de!==P.lane;if(pe?(Ke&de)===de:(u&de)===de){de!==0&&de===Oo&&(vm=!0),ge!==null&&(ge=ge.next={lane:0,tag:P.tag,payload:P.payload,callback:null,next:null});e:{var Ae=r,Oe=P;de=s;var yt=o;switch(Oe.tag){case 1:if(Ae=Oe.payload,typeof Ae=="function"){be=Ae.call(yt,be,de);break e}be=Ae;break e;case 3:Ae.flags=Ae.flags&-65537|128;case 0:if(Ae=Oe.payload,de=typeof Ae=="function"?Ae.call(yt,be,de):Ae,de==null)break e;be=b({},be,de);break e;case 2:ys=!0}}de=P.callback,de!==null&&(r.flags|=64,pe&&(r.flags|=8192),pe=g.callbacks,pe===null?g.callbacks=[de]:pe.push(de))}else pe={lane:de,tag:P.tag,payload:P.payload,callback:P.callback,next:null},ge===null?(le=ge=pe,K=be):ge=ge.next=pe,S|=de;if(P=P.next,P===null){if(P=g.shared.pending,P===null)break;pe=P,P=pe.next,pe.next=null,g.lastBaseUpdate=pe,g.shared.pending=null}}while(!0);ge===null&&(K=be),g.baseState=K,g.firstBaseUpdate=le,g.lastBaseUpdate=ge,y===null&&(g.shared.lanes=0),ws|=S,r.lanes=S,r.memoizedState=be}}function Q_(r,s){if(typeof r!="function")throw Error(i(191,r));r.call(s)}function W_(r,s){var o=r.callbacks;if(o!==null)for(r.callbacks=null,r=0;r<o.length;r++)Q_(o[r],s)}var Lo=V(null),vd=V(0);function K_(r,s){r=zi,$(vd,r),$(Lo,s),zi=r|s.baseLanes}function xm(){$(vd,zi),$(Lo,Lo.current)}function Sm(){zi=vd.current,z(Lo),z(vd)}var tr=V(null),Sr=null;function vs(r){var s=r.alternate;$(Lt,Lt.current&1),$(tr,r),Sr===null&&(s===null||Lo.current!==null||s.memoizedState!==null)&&(Sr=r)}function Em(r){$(Lt,Lt.current),$(tr,r),Sr===null&&(Sr=r)}function Y_(r){r.tag===22?($(Lt,Lt.current),$(tr,r),Sr===null&&(Sr=r)):xs()}function xs(){$(Lt,Lt.current),$(tr,tr.current)}function nr(r){z(tr),Sr===r&&(Sr=null),z(Lt)}var Lt=V(0);function xd(r){for(var s=r;s!==null;){if(s.tag===13){var o=s.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||Dp(o)||jp(o)))return s}else if(s.tag===19&&(s.memoizedProps.revealOrder==="forwards"||s.memoizedProps.revealOrder==="backwards"||s.memoizedProps.revealOrder==="unstable_legacy-backwards"||s.memoizedProps.revealOrder==="together")){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Oi=0,qe=null,pt=null,Kt=null,Sd=!1,Bo=!1,Pa=!1,Ed=0,vc=0,Vo=null,wC=0;function Mt(){throw Error(i(321))}function wm(r,s){if(s===null)return!1;for(var o=0;o<s.length&&o<r.length;o++)if(!Zn(r[o],s[o]))return!1;return!0}function Tm(r,s,o,u,g,y){return Oi=y,qe=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,N.H=r===null||r.memoizedState===null?O0:Um,Pa=!1,y=o(u,g),Pa=!1,Bo&&(y=J_(s,o,u,g)),X_(r),y}function X_(r){N.H=Ec;var s=pt!==null&&pt.next!==null;if(Oi=0,Kt=pt=qe=null,Sd=!1,vc=0,Vo=null,s)throw Error(i(300));r===null||Yt||(r=r.dependencies,r!==null&&fd(r)&&(Yt=!0))}function J_(r,s,o,u){qe=r;var g=0;do{if(Bo&&(Vo=null),vc=0,Bo=!1,25<=g)throw Error(i(301));if(g+=1,Kt=pt=null,r.updateQueue!=null){var y=r.updateQueue;y.lastEffect=null,y.events=null,y.stores=null,y.memoCache!=null&&(y.memoCache.index=0)}N.H=k0,y=s(o,u)}while(Bo);return y}function TC(){var r=N.H,s=r.useState()[0];return s=typeof s.then=="function"?xc(s):s,r=r.useState()[0],(pt!==null?pt.memoizedState:null)!==r&&(qe.flags|=1024),s}function Cm(){var r=Ed!==0;return Ed=0,r}function Am(r,s,o){s.updateQueue=r.updateQueue,s.flags&=-2053,r.lanes&=~o}function Rm(r){if(Sd){for(r=r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Sd=!1}Oi=0,Kt=pt=qe=null,Bo=!1,vc=Ed=0,Vo=null}function On(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Kt===null?qe.memoizedState=Kt=r:Kt=Kt.next=r,Kt}function Bt(){if(pt===null){var r=qe.alternate;r=r!==null?r.memoizedState:null}else r=pt.next;var s=Kt===null?qe.memoizedState:Kt.next;if(s!==null)Kt=s,pt=r;else{if(r===null)throw qe.alternate===null?Error(i(467)):Error(i(310));pt=r,r={memoizedState:pt.memoizedState,baseState:pt.baseState,baseQueue:pt.baseQueue,queue:pt.queue,next:null},Kt===null?qe.memoizedState=Kt=r:Kt=Kt.next=r}return Kt}function wd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function xc(r){var s=vc;return vc+=1,Vo===null&&(Vo=[]),r=F_(Vo,r,s),s=qe,(Kt===null?s.memoizedState:Kt.next)===null&&(s=s.alternate,N.H=s===null||s.memoizedState===null?O0:Um),r}function Td(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return xc(r);if(r.$$typeof===B)return bn(r)}throw Error(i(438,String(r)))}function Dm(r){var s=null,o=qe.updateQueue;if(o!==null&&(s=o.memoCache),s==null){var u=qe.alternate;u!==null&&(u=u.updateQueue,u!==null&&(u=u.memoCache,u!=null&&(s={data:u.data.map(function(g){return g.slice()}),index:0})))}if(s==null&&(s={data:[],index:0}),o===null&&(o=wd(),qe.updateQueue=o),o.memoCache=s,o=s.data[s.index],o===void 0)for(o=s.data[s.index]=Array(r),u=0;u<r;u++)o[u]=I;return s.index++,o}function ki(r,s){return typeof s=="function"?s(r):s}function Cd(r){var s=Bt();return jm(s,pt,r)}function jm(r,s,o){var u=r.queue;if(u===null)throw Error(i(311));u.lastRenderedReducer=o;var g=r.baseQueue,y=u.pending;if(y!==null){if(g!==null){var S=g.next;g.next=y.next,y.next=S}s.baseQueue=g=y,u.pending=null}if(y=r.baseState,g===null)r.memoizedState=y;else{s=g.next;var P=S=null,K=null,le=s,ge=!1;do{var be=le.lane&-536870913;if(be!==le.lane?(Ke&be)===be:(Oi&be)===be){var de=le.revertLane;if(de===0)K!==null&&(K=K.next={lane:0,revertLane:0,gesture:null,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null}),be===Oo&&(ge=!0);else if((Oi&de)===de){le=le.next,de===Oo&&(ge=!0);continue}else be={lane:0,revertLane:le.revertLane,gesture:null,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null},K===null?(P=K=be,S=y):K=K.next=be,qe.lanes|=de,ws|=de;be=le.action,Pa&&o(y,be),y=le.hasEagerState?le.eagerState:o(y,be)}else de={lane:be,revertLane:le.revertLane,gesture:le.gesture,action:le.action,hasEagerState:le.hasEagerState,eagerState:le.eagerState,next:null},K===null?(P=K=de,S=y):K=K.next=de,qe.lanes|=be,ws|=be;le=le.next}while(le!==null&&le!==s);if(K===null?S=y:K.next=P,!Zn(y,r.memoizedState)&&(Yt=!0,ge&&(o=ko,o!==null)))throw o;r.memoizedState=y,r.baseState=S,r.baseQueue=K,u.lastRenderedState=y}return g===null&&(u.lanes=0),[r.memoizedState,u.dispatch]}function Im(r){var s=Bt(),o=s.queue;if(o===null)throw Error(i(311));o.lastRenderedReducer=r;var u=o.dispatch,g=o.pending,y=s.memoizedState;if(g!==null){o.pending=null;var S=g=g.next;do y=r(y,S.action),S=S.next;while(S!==g);Zn(y,s.memoizedState)||(Yt=!0),s.memoizedState=y,s.baseQueue===null&&(s.baseState=y),o.lastRenderedState=y}return[y,u]}function Z_(r,s,o){var u=qe,g=Bt(),y=et;if(y){if(o===void 0)throw Error(i(407));o=o()}else o=s();var S=!Zn((pt||g).memoizedState,o);if(S&&(g.memoizedState=o,Yt=!0),g=g.queue,km(n0.bind(null,u,g,r),[r]),g.getSnapshot!==s||S||Kt!==null&&Kt.memoizedState.tag&1){if(u.flags|=2048,Uo(9,{destroy:void 0},t0.bind(null,u,g,o,s),null),_t===null)throw Error(i(349));y||(Oi&127)!==0||e0(u,s,o)}return o}function e0(r,s,o){r.flags|=16384,r={getSnapshot:s,value:o},s=qe.updateQueue,s===null?(s=wd(),qe.updateQueue=s,s.stores=[r]):(o=s.stores,o===null?s.stores=[r]:o.push(r))}function t0(r,s,o,u){s.value=o,s.getSnapshot=u,r0(s)&&i0(r)}function n0(r,s,o){return o(function(){r0(s)&&i0(r)})}function r0(r){var s=r.getSnapshot;r=r.value;try{var o=s();return!Zn(r,o)}catch{return!0}}function i0(r){var s=Aa(r,2);s!==null&&qn(s,r,2)}function Mm(r){var s=On();if(typeof r=="function"){var o=r;if(r=o(),Pa){hr(!0);try{o()}finally{hr(!1)}}}return s.memoizedState=s.baseState=r,s.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ki,lastRenderedState:r},s}function s0(r,s,o,u){return r.baseState=o,jm(r,pt,typeof u=="function"?u:ki)}function CC(r,s,o,u,g){if(Dd(r))throw Error(i(485));if(r=s.action,r!==null){var y={payload:g,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(S){y.listeners.push(S)}};N.T!==null?o(!0):y.isTransition=!1,u(y),o=s.pending,o===null?(y.next=s.pending=y,a0(s,y)):(y.next=o.next,s.pending=o.next=y)}}function a0(r,s){var o=s.action,u=s.payload,g=r.state;if(s.isTransition){var y=N.T,S={};N.T=S;try{var P=o(g,u),K=N.S;K!==null&&K(S,P),o0(r,s,P)}catch(le){Om(r,s,le)}finally{y!==null&&S.types!==null&&(y.types=S.types),N.T=y}}else try{y=o(g,u),o0(r,s,y)}catch(le){Om(r,s,le)}}function o0(r,s,o){o!==null&&typeof o=="object"&&typeof o.then=="function"?o.then(function(u){l0(r,s,u)},function(u){return Om(r,s,u)}):l0(r,s,o)}function l0(r,s,o){s.status="fulfilled",s.value=o,c0(s),r.state=o,s=r.pending,s!==null&&(o=s.next,o===s?r.pending=null:(o=o.next,s.next=o,a0(r,o)))}function Om(r,s,o){var u=r.pending;if(r.pending=null,u!==null){u=u.next;do s.status="rejected",s.reason=o,c0(s),s=s.next;while(s!==u)}r.action=null}function c0(r){r=r.listeners;for(var s=0;s<r.length;s++)(0,r[s])()}function u0(r,s){return s}function d0(r,s){if(et){var o=_t.formState;if(o!==null){e:{var u=qe;if(et){if(xt){t:{for(var g=xt,y=xr;g.nodeType!==8;){if(!y){g=null;break t}if(g=Er(g.nextSibling),g===null){g=null;break t}}y=g.data,g=y==="F!"||y==="F"?g:null}if(g){xt=Er(g.nextSibling),u=g.data==="F!";break e}}ps(u)}u=!1}u&&(s=o[0])}}return o=On(),o.memoizedState=o.baseState=s,u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:u0,lastRenderedState:s},o.queue=u,o=j0.bind(null,qe,u),u.dispatch=o,u=Mm(!1),y=Vm.bind(null,qe,!1,u.queue),u=On(),g={state:s,dispatch:null,action:r,pending:null},u.queue=g,o=CC.bind(null,qe,g,y,o),g.dispatch=o,u.memoizedState=r,[s,o,!1]}function h0(r){var s=Bt();return f0(s,pt,r)}function f0(r,s,o){if(s=jm(r,s,u0)[0],r=Cd(ki)[0],typeof s=="object"&&s!==null&&typeof s.then=="function")try{var u=xc(s)}catch(S){throw S===No?gd:S}else u=s;s=Bt();var g=s.queue,y=g.dispatch;return o!==s.memoizedState&&(qe.flags|=2048,Uo(9,{destroy:void 0},AC.bind(null,g,o),null)),[u,y,r]}function AC(r,s){r.action=s}function m0(r){var s=Bt(),o=pt;if(o!==null)return f0(s,o,r);Bt(),s=s.memoizedState,o=Bt();var u=o.queue.dispatch;return o.memoizedState=r,[s,u,!1]}function Uo(r,s,o,u){return r={tag:r,create:o,deps:u,inst:s,next:null},s=qe.updateQueue,s===null&&(s=wd(),qe.updateQueue=s),o=s.lastEffect,o===null?s.lastEffect=r.next=r:(u=o.next,o.next=r,r.next=u,s.lastEffect=r),r}function p0(){return Bt().memoizedState}function Ad(r,s,o,u){var g=On();qe.flags|=r,g.memoizedState=Uo(1|s,{destroy:void 0},o,u===void 0?null:u)}function Rd(r,s,o,u){var g=Bt();u=u===void 0?null:u;var y=g.memoizedState.inst;pt!==null&&u!==null&&wm(u,pt.memoizedState.deps)?g.memoizedState=Uo(s,y,o,u):(qe.flags|=r,g.memoizedState=Uo(1|s,y,o,u))}function g0(r,s){Ad(8390656,8,r,s)}function km(r,s){Rd(2048,8,r,s)}function RC(r){qe.flags|=4;var s=qe.updateQueue;if(s===null)s=wd(),qe.updateQueue=s,s.events=[r];else{var o=s.events;o===null?s.events=[r]:o.push(r)}}function y0(r){var s=Bt().memoizedState;return RC({ref:s,nextImpl:r}),function(){if((lt&2)!==0)throw Error(i(440));return s.impl.apply(void 0,arguments)}}function _0(r,s){return Rd(4,2,r,s)}function b0(r,s){return Rd(4,4,r,s)}function v0(r,s){if(typeof s=="function"){r=r();var o=s(r);return function(){typeof o=="function"?o():s(null)}}if(s!=null)return r=r(),s.current=r,function(){s.current=null}}function x0(r,s,o){o=o!=null?o.concat([r]):null,Rd(4,4,v0.bind(null,s,r),o)}function Nm(){}function S0(r,s){var o=Bt();s=s===void 0?null:s;var u=o.memoizedState;return s!==null&&wm(s,u[1])?u[0]:(o.memoizedState=[r,s],r)}function E0(r,s){var o=Bt();s=s===void 0?null:s;var u=o.memoizedState;if(s!==null&&wm(s,u[1]))return u[0];if(u=r(),Pa){hr(!0);try{r()}finally{hr(!1)}}return o.memoizedState=[u,s],u}function Pm(r,s,o){return o===void 0||(Oi&1073741824)!==0&&(Ke&261930)===0?r.memoizedState=s:(r.memoizedState=o,r=wb(),qe.lanes|=r,ws|=r,o)}function w0(r,s,o,u){return Zn(o,s)?o:Lo.current!==null?(r=Pm(r,o,u),Zn(r,s)||(Yt=!0),r):(Oi&42)===0||(Oi&1073741824)!==0&&(Ke&261930)===0?(Yt=!0,r.memoizedState=o):(r=wb(),qe.lanes|=r,ws|=r,s)}function T0(r,s,o,u,g){var y=G.p;G.p=y!==0&&8>y?y:8;var S=N.T,P={};N.T=P,Vm(r,!1,s,o);try{var K=g(),le=N.S;if(le!==null&&le(P,K),K!==null&&typeof K=="object"&&typeof K.then=="function"){var ge=EC(K,u);Sc(r,s,ge,sr(r))}else Sc(r,s,u,sr(r))}catch(be){Sc(r,s,{then:function(){},status:"rejected",reason:be},sr())}finally{G.p=y,S!==null&&P.types!==null&&(S.types=P.types),N.T=S}}function DC(){}function Lm(r,s,o,u){if(r.tag!==5)throw Error(i(476));var g=C0(r).queue;T0(r,g,s,W,o===null?DC:function(){return A0(r),o(u)})}function C0(r){var s=r.memoizedState;if(s!==null)return s;s={memoizedState:W,baseState:W,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ki,lastRenderedState:W},next:null};var o={};return s.next={memoizedState:o,baseState:o,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ki,lastRenderedState:o},next:null},r.memoizedState=s,r=r.alternate,r!==null&&(r.memoizedState=s),s}function A0(r){var s=C0(r);s.next===null&&(s=r.alternate.memoizedState),Sc(r,s.next.queue,{},sr())}function Bm(){return bn(Vc)}function R0(){return Bt().memoizedState}function D0(){return Bt().memoizedState}function jC(r){for(var s=r.return;s!==null;){switch(s.tag){case 24:case 3:var o=sr();r=_s(o);var u=bs(s,r,o);u!==null&&(qn(u,s,o),yc(u,s,o)),s={cache:fm()},r.payload=s;return}s=s.return}}function IC(r,s,o){var u=sr();o={lane:u,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null},Dd(r)?I0(s,o):(o=nm(r,s,o,u),o!==null&&(qn(o,r,u),M0(o,s,u)))}function j0(r,s,o){var u=sr();Sc(r,s,o,u)}function Sc(r,s,o,u){var g={lane:u,revertLane:0,gesture:null,action:o,hasEagerState:!1,eagerState:null,next:null};if(Dd(r))I0(s,g);else{var y=r.alternate;if(r.lanes===0&&(y===null||y.lanes===0)&&(y=s.lastRenderedReducer,y!==null))try{var S=s.lastRenderedState,P=y(S,o);if(g.hasEagerState=!0,g.eagerState=P,Zn(P,S))return cd(r,s,g,0),_t===null&&ld(),!1}catch{}if(o=nm(r,s,g,u),o!==null)return qn(o,r,u),M0(o,s,u),!0}return!1}function Vm(r,s,o,u){if(u={lane:2,revertLane:yp(),gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},Dd(r)){if(s)throw Error(i(479))}else s=nm(r,o,u,2),s!==null&&qn(s,r,2)}function Dd(r){var s=r.alternate;return r===qe||s!==null&&s===qe}function I0(r,s){Bo=Sd=!0;var o=r.pending;o===null?s.next=s:(s.next=o.next,o.next=s),r.pending=s}function M0(r,s,o){if((o&4194048)!==0){var u=s.lanes;u&=r.pendingLanes,o|=u,s.lanes=o,Hl(r,o)}}var Ec={readContext:bn,use:Td,useCallback:Mt,useContext:Mt,useEffect:Mt,useImperativeHandle:Mt,useLayoutEffect:Mt,useInsertionEffect:Mt,useMemo:Mt,useReducer:Mt,useRef:Mt,useState:Mt,useDebugValue:Mt,useDeferredValue:Mt,useTransition:Mt,useSyncExternalStore:Mt,useId:Mt,useHostTransitionStatus:Mt,useFormState:Mt,useActionState:Mt,useOptimistic:Mt,useMemoCache:Mt,useCacheRefresh:Mt};Ec.useEffectEvent=Mt;var O0={readContext:bn,use:Td,useCallback:function(r,s){return On().memoizedState=[r,s===void 0?null:s],r},useContext:bn,useEffect:g0,useImperativeHandle:function(r,s,o){o=o!=null?o.concat([r]):null,Ad(4194308,4,v0.bind(null,s,r),o)},useLayoutEffect:function(r,s){return Ad(4194308,4,r,s)},useInsertionEffect:function(r,s){Ad(4,2,r,s)},useMemo:function(r,s){var o=On();s=s===void 0?null:s;var u=r();if(Pa){hr(!0);try{r()}finally{hr(!1)}}return o.memoizedState=[u,s],u},useReducer:function(r,s,o){var u=On();if(o!==void 0){var g=o(s);if(Pa){hr(!0);try{o(s)}finally{hr(!1)}}}else g=s;return u.memoizedState=u.baseState=g,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:g},u.queue=r,r=r.dispatch=IC.bind(null,qe,r),[u.memoizedState,r]},useRef:function(r){var s=On();return r={current:r},s.memoizedState=r},useState:function(r){r=Mm(r);var s=r.queue,o=j0.bind(null,qe,s);return s.dispatch=o,[r.memoizedState,o]},useDebugValue:Nm,useDeferredValue:function(r,s){var o=On();return Pm(o,r,s)},useTransition:function(){var r=Mm(!1);return r=T0.bind(null,qe,r.queue,!0,!1),On().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,s,o){var u=qe,g=On();if(et){if(o===void 0)throw Error(i(407));o=o()}else{if(o=s(),_t===null)throw Error(i(349));(Ke&127)!==0||e0(u,s,o)}g.memoizedState=o;var y={value:o,getSnapshot:s};return g.queue=y,g0(n0.bind(null,u,y,r),[r]),u.flags|=2048,Uo(9,{destroy:void 0},t0.bind(null,u,y,o,s),null),o},useId:function(){var r=On(),s=_t.identifierPrefix;if(et){var o=hi,u=di;o=(u&~(1<<32-Nt(u)-1)).toString(32)+o,s="_"+s+"R_"+o,o=Ed++,0<o&&(s+="H"+o.toString(32)),s+="_"}else o=wC++,s="_"+s+"r_"+o.toString(32)+"_";return r.memoizedState=s},useHostTransitionStatus:Bm,useFormState:d0,useActionState:d0,useOptimistic:function(r){var s=On();s.memoizedState=s.baseState=r;var o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return s.queue=o,s=Vm.bind(null,qe,!0,o),o.dispatch=s,[r,s]},useMemoCache:Dm,useCacheRefresh:function(){return On().memoizedState=jC.bind(null,qe)},useEffectEvent:function(r){var s=On(),o={impl:r};return s.memoizedState=o,function(){if((lt&2)!==0)throw Error(i(440));return o.impl.apply(void 0,arguments)}}},Um={readContext:bn,use:Td,useCallback:S0,useContext:bn,useEffect:km,useImperativeHandle:x0,useInsertionEffect:_0,useLayoutEffect:b0,useMemo:E0,useReducer:Cd,useRef:p0,useState:function(){return Cd(ki)},useDebugValue:Nm,useDeferredValue:function(r,s){var o=Bt();return w0(o,pt.memoizedState,r,s)},useTransition:function(){var r=Cd(ki)[0],s=Bt().memoizedState;return[typeof r=="boolean"?r:xc(r),s]},useSyncExternalStore:Z_,useId:R0,useHostTransitionStatus:Bm,useFormState:h0,useActionState:h0,useOptimistic:function(r,s){var o=Bt();return s0(o,pt,r,s)},useMemoCache:Dm,useCacheRefresh:D0};Um.useEffectEvent=y0;var k0={readContext:bn,use:Td,useCallback:S0,useContext:bn,useEffect:km,useImperativeHandle:x0,useInsertionEffect:_0,useLayoutEffect:b0,useMemo:E0,useReducer:Im,useRef:p0,useState:function(){return Im(ki)},useDebugValue:Nm,useDeferredValue:function(r,s){var o=Bt();return pt===null?Pm(o,r,s):w0(o,pt.memoizedState,r,s)},useTransition:function(){var r=Im(ki)[0],s=Bt().memoizedState;return[typeof r=="boolean"?r:xc(r),s]},useSyncExternalStore:Z_,useId:R0,useHostTransitionStatus:Bm,useFormState:m0,useActionState:m0,useOptimistic:function(r,s){var o=Bt();return pt!==null?s0(o,pt,r,s):(o.baseState=r,[r,o.queue.dispatch])},useMemoCache:Dm,useCacheRefresh:D0};k0.useEffectEvent=y0;function zm(r,s,o,u){s=r.memoizedState,o=o(u,s),o=o==null?s:b({},s,o),r.memoizedState=o,r.lanes===0&&(r.updateQueue.baseState=o)}var Fm={enqueueSetState:function(r,s,o){r=r._reactInternals;var u=sr(),g=_s(u);g.payload=s,o!=null&&(g.callback=o),s=bs(r,g,u),s!==null&&(qn(s,r,u),yc(s,r,u))},enqueueReplaceState:function(r,s,o){r=r._reactInternals;var u=sr(),g=_s(u);g.tag=1,g.payload=s,o!=null&&(g.callback=o),s=bs(r,g,u),s!==null&&(qn(s,r,u),yc(s,r,u))},enqueueForceUpdate:function(r,s){r=r._reactInternals;var o=sr(),u=_s(o);u.tag=2,s!=null&&(u.callback=s),s=bs(r,u,o),s!==null&&(qn(s,r,o),yc(s,r,o))}};function N0(r,s,o,u,g,y,S){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(u,y,S):s.prototype&&s.prototype.isPureReactComponent?!cc(o,u)||!cc(g,y):!0}function P0(r,s,o,u){r=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(o,u),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(o,u),s.state!==r&&Fm.enqueueReplaceState(s,s.state,null)}function La(r,s){var o=s;if("ref"in s){o={};for(var u in s)u!=="ref"&&(o[u]=s[u])}if(r=r.defaultProps){o===s&&(o=b({},o));for(var g in r)o[g]===void 0&&(o[g]=r[g])}return o}function L0(r){od(r)}function B0(r){console.error(r)}function V0(r){od(r)}function jd(r,s){try{var o=r.onUncaughtError;o(s.value,{componentStack:s.stack})}catch(u){setTimeout(function(){throw u})}}function U0(r,s,o){try{var u=r.onCaughtError;u(o.value,{componentStack:o.stack,errorBoundary:s.tag===1?s.stateNode:null})}catch(g){setTimeout(function(){throw g})}}function qm(r,s,o){return o=_s(o),o.tag=3,o.payload={element:null},o.callback=function(){jd(r,s)},o}function z0(r){return r=_s(r),r.tag=3,r}function F0(r,s,o,u){var g=o.type.getDerivedStateFromError;if(typeof g=="function"){var y=u.value;r.payload=function(){return g(y)},r.callback=function(){U0(s,o,u)}}var S=o.stateNode;S!==null&&typeof S.componentDidCatch=="function"&&(r.callback=function(){U0(s,o,u),typeof g!="function"&&(Ts===null?Ts=new Set([this]):Ts.add(this));var P=u.stack;this.componentDidCatch(u.value,{componentStack:P!==null?P:""})})}function MC(r,s,o,u,g){if(o.flags|=32768,u!==null&&typeof u=="object"&&typeof u.then=="function"){if(s=o.alternate,s!==null&&Mo(s,o,g,!0),o=tr.current,o!==null){switch(o.tag){case 31:case 13:return Sr===null?Fd():o.alternate===null&&Ot===0&&(Ot=3),o.flags&=-257,o.flags|=65536,o.lanes=g,u===yd?o.flags|=16384:(s=o.updateQueue,s===null?o.updateQueue=new Set([u]):s.add(u),mp(r,u,g)),!1;case 22:return o.flags|=65536,u===yd?o.flags|=16384:(s=o.updateQueue,s===null?(s={transitions:null,markerInstances:null,retryQueue:new Set([u])},o.updateQueue=s):(o=s.retryQueue,o===null?s.retryQueue=new Set([u]):o.add(u)),mp(r,u,g)),!1}throw Error(i(435,o.tag))}return mp(r,u,g),Fd(),!1}if(et)return s=tr.current,s!==null?((s.flags&65536)===0&&(s.flags|=256),s.flags|=65536,s.lanes=g,u!==lm&&(r=Error(i(422),{cause:u}),hc(_r(r,o)))):(u!==lm&&(s=Error(i(423),{cause:u}),hc(_r(s,o))),r=r.current.alternate,r.flags|=65536,g&=-g,r.lanes|=g,u=_r(u,o),g=qm(r.stateNode,u,g),bm(r,g),Ot!==4&&(Ot=2)),!1;var y=Error(i(520),{cause:u});if(y=_r(y,o),Ic===null?Ic=[y]:Ic.push(y),Ot!==4&&(Ot=2),s===null)return!0;u=_r(u,o),o=s;do{switch(o.tag){case 3:return o.flags|=65536,r=g&-g,o.lanes|=r,r=qm(o.stateNode,u,r),bm(o,r),!1;case 1:if(s=o.type,y=o.stateNode,(o.flags&128)===0&&(typeof s.getDerivedStateFromError=="function"||y!==null&&typeof y.componentDidCatch=="function"&&(Ts===null||!Ts.has(y))))return o.flags|=65536,g&=-g,o.lanes|=g,g=z0(g),F0(g,r,o,u),bm(o,g),!1}o=o.return}while(o!==null);return!1}var Hm=Error(i(461)),Yt=!1;function vn(r,s,o,u){s.child=r===null?$_(s,null,o,u):Na(s,r.child,o,u)}function q0(r,s,o,u,g){o=o.render;var y=s.ref;if("ref"in u){var S={};for(var P in u)P!=="ref"&&(S[P]=u[P])}else S=u;return Ia(s),u=Tm(r,s,o,S,y,g),P=Cm(),r!==null&&!Yt?(Am(r,s,g),Ni(r,s,g)):(et&&P&&am(s),s.flags|=1,vn(r,s,u,g),s.child)}function H0(r,s,o,u,g){if(r===null){var y=o.type;return typeof y=="function"&&!rm(y)&&y.defaultProps===void 0&&o.compare===null?(s.tag=15,s.type=y,G0(r,s,y,u,g)):(r=dd(o.type,null,u,s,s.mode,g),r.ref=s.ref,r.return=s,s.child=r)}if(y=r.child,!Jm(r,g)){var S=y.memoizedProps;if(o=o.compare,o=o!==null?o:cc,o(S,u)&&r.ref===s.ref)return Ni(r,s,g)}return s.flags|=1,r=Di(y,u),r.ref=s.ref,r.return=s,s.child=r}function G0(r,s,o,u,g){if(r!==null){var y=r.memoizedProps;if(cc(y,u)&&r.ref===s.ref)if(Yt=!1,s.pendingProps=u=y,Jm(r,g))(r.flags&131072)!==0&&(Yt=!0);else return s.lanes=r.lanes,Ni(r,s,g)}return Gm(r,s,o,u,g)}function $0(r,s,o,u){var g=u.children,y=r!==null?r.memoizedState:null;if(r===null&&s.stateNode===null&&(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),u.mode==="hidden"){if((s.flags&128)!==0){if(y=y!==null?y.baseLanes|o:o,r!==null){for(u=s.child=r.child,g=0;u!==null;)g=g|u.lanes|u.childLanes,u=u.sibling;u=g&~y}else u=0,s.child=null;return Q0(r,s,y,o,u)}if((o&536870912)!==0)s.memoizedState={baseLanes:0,cachePool:null},r!==null&&pd(s,y!==null?y.cachePool:null),y!==null?K_(s,y):xm(),Y_(s);else return u=s.lanes=536870912,Q0(r,s,y!==null?y.baseLanes|o:o,o,u)}else y!==null?(pd(s,y.cachePool),K_(s,y),xs(),s.memoizedState=null):(r!==null&&pd(s,null),xm(),xs());return vn(r,s,g,o),s.child}function wc(r,s){return r!==null&&r.tag===22||s.stateNode!==null||(s.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),s.sibling}function Q0(r,s,o,u,g){var y=pm();return y=y===null?null:{parent:Wt._currentValue,pool:y},s.memoizedState={baseLanes:o,cachePool:y},r!==null&&pd(s,null),xm(),Y_(s),r!==null&&Mo(r,s,u,!0),s.childLanes=g,null}function Id(r,s){return s=Od({mode:s.mode,children:s.children},r.mode),s.ref=r.ref,r.child=s,s.return=r,s}function W0(r,s,o){return Na(s,r.child,null,o),r=Id(s,s.pendingProps),r.flags|=2,nr(s),s.memoizedState=null,r}function OC(r,s,o){var u=s.pendingProps,g=(s.flags&128)!==0;if(s.flags&=-129,r===null){if(et){if(u.mode==="hidden")return r=Id(s,u),s.lanes=536870912,wc(null,r);if(Em(s),(r=xt)?(r=av(r,xr),r=r!==null&&r.data==="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:fs!==null?{id:di,overflow:hi}:null,retryLane:536870912,hydrationErrors:null},o=I_(r),o.return=s,s.child=o,_n=s,xt=null)):r=null,r===null)throw ps(s);return s.lanes=536870912,null}return Id(s,u)}var y=r.memoizedState;if(y!==null){var S=y.dehydrated;if(Em(s),g)if(s.flags&256)s.flags&=-257,s=W0(r,s,o);else if(s.memoizedState!==null)s.child=r.child,s.flags|=128,s=null;else throw Error(i(558));else if(Yt||Mo(r,s,o,!1),g=(o&r.childLanes)!==0,Yt||g){if(u=_t,u!==null&&(S=Gl(u,o),S!==0&&S!==y.retryLane))throw y.retryLane=S,Aa(r,S),qn(u,r,S),Hm;Fd(),s=W0(r,s,o)}else r=y.treeContext,xt=Er(S.nextSibling),_n=s,et=!0,ms=null,xr=!1,r!==null&&k_(s,r),s=Id(s,u),s.flags|=4096;return s}return r=Di(r.child,{mode:u.mode,children:u.children}),r.ref=s.ref,s.child=r,r.return=s,r}function Md(r,s){var o=s.ref;if(o===null)r!==null&&r.ref!==null&&(s.flags|=4194816);else{if(typeof o!="function"&&typeof o!="object")throw Error(i(284));(r===null||r.ref!==o)&&(s.flags|=4194816)}}function Gm(r,s,o,u,g){return Ia(s),o=Tm(r,s,o,u,void 0,g),u=Cm(),r!==null&&!Yt?(Am(r,s,g),Ni(r,s,g)):(et&&u&&am(s),s.flags|=1,vn(r,s,o,g),s.child)}function K0(r,s,o,u,g,y){return Ia(s),s.updateQueue=null,o=J_(s,u,o,g),X_(r),u=Cm(),r!==null&&!Yt?(Am(r,s,y),Ni(r,s,y)):(et&&u&&am(s),s.flags|=1,vn(r,s,o,y),s.child)}function Y0(r,s,o,u,g){if(Ia(s),s.stateNode===null){var y=Ro,S=o.contextType;typeof S=="object"&&S!==null&&(y=bn(S)),y=new o(u,y),s.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,y.updater=Fm,s.stateNode=y,y._reactInternals=s,y=s.stateNode,y.props=u,y.state=s.memoizedState,y.refs={},ym(s),S=o.contextType,y.context=typeof S=="object"&&S!==null?bn(S):Ro,y.state=s.memoizedState,S=o.getDerivedStateFromProps,typeof S=="function"&&(zm(s,o,S,u),y.state=s.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(S=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),S!==y.state&&Fm.enqueueReplaceState(y,y.state,null),bc(s,u,y,g),_c(),y.state=s.memoizedState),typeof y.componentDidMount=="function"&&(s.flags|=4194308),u=!0}else if(r===null){y=s.stateNode;var P=s.memoizedProps,K=La(o,P);y.props=K;var le=y.context,ge=o.contextType;S=Ro,typeof ge=="object"&&ge!==null&&(S=bn(ge));var be=o.getDerivedStateFromProps;ge=typeof be=="function"||typeof y.getSnapshotBeforeUpdate=="function",P=s.pendingProps!==P,ge||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(P||le!==S)&&P0(s,y,u,S),ys=!1;var de=s.memoizedState;y.state=de,bc(s,u,y,g),_c(),le=s.memoizedState,P||de!==le||ys?(typeof be=="function"&&(zm(s,o,be,u),le=s.memoizedState),(K=ys||N0(s,o,K,u,de,le,S))?(ge||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(s.flags|=4194308)):(typeof y.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=u,s.memoizedState=le),y.props=u,y.state=le,y.context=S,u=K):(typeof y.componentDidMount=="function"&&(s.flags|=4194308),u=!1)}else{y=s.stateNode,_m(r,s),S=s.memoizedProps,ge=La(o,S),y.props=ge,be=s.pendingProps,de=y.context,le=o.contextType,K=Ro,typeof le=="object"&&le!==null&&(K=bn(le)),P=o.getDerivedStateFromProps,(le=typeof P=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(S!==be||de!==K)&&P0(s,y,u,K),ys=!1,de=s.memoizedState,y.state=de,bc(s,u,y,g),_c();var pe=s.memoizedState;S!==be||de!==pe||ys||r!==null&&r.dependencies!==null&&fd(r.dependencies)?(typeof P=="function"&&(zm(s,o,P,u),pe=s.memoizedState),(ge=ys||N0(s,o,ge,u,de,pe,K)||r!==null&&r.dependencies!==null&&fd(r.dependencies))?(le||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(u,pe,K),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(u,pe,K)),typeof y.componentDidUpdate=="function"&&(s.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof y.componentDidUpdate!="function"||S===r.memoizedProps&&de===r.memoizedState||(s.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||S===r.memoizedProps&&de===r.memoizedState||(s.flags|=1024),s.memoizedProps=u,s.memoizedState=pe),y.props=u,y.state=pe,y.context=K,u=ge):(typeof y.componentDidUpdate!="function"||S===r.memoizedProps&&de===r.memoizedState||(s.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||S===r.memoizedProps&&de===r.memoizedState||(s.flags|=1024),u=!1)}return y=u,Md(r,s),u=(s.flags&128)!==0,y||u?(y=s.stateNode,o=u&&typeof o.getDerivedStateFromError!="function"?null:y.render(),s.flags|=1,r!==null&&u?(s.child=Na(s,r.child,null,g),s.child=Na(s,null,o,g)):vn(r,s,o,g),s.memoizedState=y.state,r=s.child):r=Ni(r,s,g),r}function X0(r,s,o,u){return Da(),s.flags|=256,vn(r,s,o,u),s.child}var $m={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Qm(r){return{baseLanes:r,cachePool:U_()}}function Wm(r,s,o){return r=r!==null?r.childLanes&~o:0,s&&(r|=ir),r}function J0(r,s,o){var u=s.pendingProps,g=!1,y=(s.flags&128)!==0,S;if((S=y)||(S=r!==null&&r.memoizedState===null?!1:(Lt.current&2)!==0),S&&(g=!0,s.flags&=-129),S=(s.flags&32)!==0,s.flags&=-33,r===null){if(et){if(g?vs(s):xs(),(r=xt)?(r=av(r,xr),r=r!==null&&r.data!=="&"?r:null,r!==null&&(s.memoizedState={dehydrated:r,treeContext:fs!==null?{id:di,overflow:hi}:null,retryLane:536870912,hydrationErrors:null},o=I_(r),o.return=s,s.child=o,_n=s,xt=null)):r=null,r===null)throw ps(s);return jp(r)?s.lanes=32:s.lanes=536870912,null}var P=u.children;return u=u.fallback,g?(xs(),g=s.mode,P=Od({mode:"hidden",children:P},g),u=Ra(u,g,o,null),P.return=s,u.return=s,P.sibling=u,s.child=P,u=s.child,u.memoizedState=Qm(o),u.childLanes=Wm(r,S,o),s.memoizedState=$m,wc(null,u)):(vs(s),Km(s,P))}var K=r.memoizedState;if(K!==null&&(P=K.dehydrated,P!==null)){if(y)s.flags&256?(vs(s),s.flags&=-257,s=Ym(r,s,o)):s.memoizedState!==null?(xs(),s.child=r.child,s.flags|=128,s=null):(xs(),P=u.fallback,g=s.mode,u=Od({mode:"visible",children:u.children},g),P=Ra(P,g,o,null),P.flags|=2,u.return=s,P.return=s,u.sibling=P,s.child=u,Na(s,r.child,null,o),u=s.child,u.memoizedState=Qm(o),u.childLanes=Wm(r,S,o),s.memoizedState=$m,s=wc(null,u));else if(vs(s),jp(P)){if(S=P.nextSibling&&P.nextSibling.dataset,S)var le=S.dgst;S=le,u=Error(i(419)),u.stack="",u.digest=S,hc({value:u,source:null,stack:null}),s=Ym(r,s,o)}else if(Yt||Mo(r,s,o,!1),S=(o&r.childLanes)!==0,Yt||S){if(S=_t,S!==null&&(u=Gl(S,o),u!==0&&u!==K.retryLane))throw K.retryLane=u,Aa(r,u),qn(S,r,u),Hm;Dp(P)||Fd(),s=Ym(r,s,o)}else Dp(P)?(s.flags|=192,s.child=r.child,s=null):(r=K.treeContext,xt=Er(P.nextSibling),_n=s,et=!0,ms=null,xr=!1,r!==null&&k_(s,r),s=Km(s,u.children),s.flags|=4096);return s}return g?(xs(),P=u.fallback,g=s.mode,K=r.child,le=K.sibling,u=Di(K,{mode:"hidden",children:u.children}),u.subtreeFlags=K.subtreeFlags&65011712,le!==null?P=Di(le,P):(P=Ra(P,g,o,null),P.flags|=2),P.return=s,u.return=s,u.sibling=P,s.child=u,wc(null,u),u=s.child,P=r.child.memoizedState,P===null?P=Qm(o):(g=P.cachePool,g!==null?(K=Wt._currentValue,g=g.parent!==K?{parent:K,pool:K}:g):g=U_(),P={baseLanes:P.baseLanes|o,cachePool:g}),u.memoizedState=P,u.childLanes=Wm(r,S,o),s.memoizedState=$m,wc(r.child,u)):(vs(s),o=r.child,r=o.sibling,o=Di(o,{mode:"visible",children:u.children}),o.return=s,o.sibling=null,r!==null&&(S=s.deletions,S===null?(s.deletions=[r],s.flags|=16):S.push(r)),s.child=o,s.memoizedState=null,o)}function Km(r,s){return s=Od({mode:"visible",children:s},r.mode),s.return=r,r.child=s}function Od(r,s){return r=er(22,r,null,s),r.lanes=0,r}function Ym(r,s,o){return Na(s,r.child,null,o),r=Km(s,s.pendingProps.children),r.flags|=2,s.memoizedState=null,r}function Z0(r,s,o){r.lanes|=s;var u=r.alternate;u!==null&&(u.lanes|=s),dm(r.return,s,o)}function Xm(r,s,o,u,g,y){var S=r.memoizedState;S===null?r.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:u,tail:o,tailMode:g,treeForkCount:y}:(S.isBackwards=s,S.rendering=null,S.renderingStartTime=0,S.last=u,S.tail=o,S.tailMode=g,S.treeForkCount=y)}function eb(r,s,o){var u=s.pendingProps,g=u.revealOrder,y=u.tail;u=u.children;var S=Lt.current,P=(S&2)!==0;if(P?(S=S&1|2,s.flags|=128):S&=1,$(Lt,S),vn(r,s,u,o),u=et?dc:0,!P&&r!==null&&(r.flags&128)!==0)e:for(r=s.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&Z0(r,o,s);else if(r.tag===19)Z0(r,o,s);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===s)break e;for(;r.sibling===null;){if(r.return===null||r.return===s)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(g){case"forwards":for(o=s.child,g=null;o!==null;)r=o.alternate,r!==null&&xd(r)===null&&(g=o),o=o.sibling;o=g,o===null?(g=s.child,s.child=null):(g=o.sibling,o.sibling=null),Xm(s,!1,g,o,y,u);break;case"backwards":case"unstable_legacy-backwards":for(o=null,g=s.child,s.child=null;g!==null;){if(r=g.alternate,r!==null&&xd(r)===null){s.child=g;break}r=g.sibling,g.sibling=o,o=g,g=r}Xm(s,!0,o,null,y,u);break;case"together":Xm(s,!1,null,null,void 0,u);break;default:s.memoizedState=null}return s.child}function Ni(r,s,o){if(r!==null&&(s.dependencies=r.dependencies),ws|=s.lanes,(o&s.childLanes)===0)if(r!==null){if(Mo(r,s,o,!1),(o&s.childLanes)===0)return null}else return null;if(r!==null&&s.child!==r.child)throw Error(i(153));if(s.child!==null){for(r=s.child,o=Di(r,r.pendingProps),s.child=o,o.return=s;r.sibling!==null;)r=r.sibling,o=o.sibling=Di(r,r.pendingProps),o.return=s;o.sibling=null}return s.child}function Jm(r,s){return(r.lanes&s)!==0?!0:(r=r.dependencies,!!(r!==null&&fd(r)))}function kC(r,s,o){switch(s.tag){case 3:Se(s,s.stateNode.containerInfo),gs(s,Wt,r.memoizedState.cache),Da();break;case 27:case 5:te(s);break;case 4:Se(s,s.stateNode.containerInfo);break;case 10:gs(s,s.type,s.memoizedProps.value);break;case 31:if(s.memoizedState!==null)return s.flags|=128,Em(s),null;break;case 13:var u=s.memoizedState;if(u!==null)return u.dehydrated!==null?(vs(s),s.flags|=128,null):(o&s.child.childLanes)!==0?J0(r,s,o):(vs(s),r=Ni(r,s,o),r!==null?r.sibling:null);vs(s);break;case 19:var g=(r.flags&128)!==0;if(u=(o&s.childLanes)!==0,u||(Mo(r,s,o,!1),u=(o&s.childLanes)!==0),g){if(u)return eb(r,s,o);s.flags|=128}if(g=s.memoizedState,g!==null&&(g.rendering=null,g.tail=null,g.lastEffect=null),$(Lt,Lt.current),u)break;return null;case 22:return s.lanes=0,$0(r,s,o,s.pendingProps);case 24:gs(s,Wt,r.memoizedState.cache)}return Ni(r,s,o)}function tb(r,s,o){if(r!==null)if(r.memoizedProps!==s.pendingProps)Yt=!0;else{if(!Jm(r,o)&&(s.flags&128)===0)return Yt=!1,kC(r,s,o);Yt=(r.flags&131072)!==0}else Yt=!1,et&&(s.flags&1048576)!==0&&O_(s,dc,s.index);switch(s.lanes=0,s.tag){case 16:e:{var u=s.pendingProps;if(r=Oa(s.elementType),s.type=r,typeof r=="function")rm(r)?(u=La(r,u),s.tag=1,s=Y0(null,s,r,u,o)):(s.tag=0,s=Gm(null,s,r,u,o));else{if(r!=null){var g=r.$$typeof;if(g===ee){s.tag=11,s=q0(null,s,r,u,o);break e}else if(g===O){s.tag=14,s=H0(null,s,r,u,o);break e}}throw s=Y(r)||r,Error(i(306,s,""))}}return s;case 0:return Gm(r,s,s.type,s.pendingProps,o);case 1:return u=s.type,g=La(u,s.pendingProps),Y0(r,s,u,g,o);case 3:e:{if(Se(s,s.stateNode.containerInfo),r===null)throw Error(i(387));u=s.pendingProps;var y=s.memoizedState;g=y.element,_m(r,s),bc(s,u,null,o);var S=s.memoizedState;if(u=S.cache,gs(s,Wt,u),u!==y.cache&&hm(s,[Wt],o,!0),_c(),u=S.element,y.isDehydrated)if(y={element:u,isDehydrated:!1,cache:S.cache},s.updateQueue.baseState=y,s.memoizedState=y,s.flags&256){s=X0(r,s,u,o);break e}else if(u!==g){g=_r(Error(i(424)),s),hc(g),s=X0(r,s,u,o);break e}else for(r=s.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,xt=Er(r.firstChild),_n=s,et=!0,ms=null,xr=!0,o=$_(s,null,u,o),s.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(Da(),u===g){s=Ni(r,s,o);break e}vn(r,s,u,o)}s=s.child}return s;case 26:return Md(r,s),r===null?(o=hv(s.type,null,s.pendingProps,null))?s.memoizedState=o:et||(o=s.type,r=s.pendingProps,u=Kd(ue.current).createElement(o),u[Gt]=s,u[un]=r,xn(u,o,r),$t(u),s.stateNode=u):s.memoizedState=hv(s.type,r.memoizedProps,s.pendingProps,r.memoizedState),null;case 27:return te(s),r===null&&et&&(u=s.stateNode=cv(s.type,s.pendingProps,ue.current),_n=s,xr=!0,g=xt,Ds(s.type)?(Ip=g,xt=Er(u.firstChild)):xt=g),vn(r,s,s.pendingProps.children,o),Md(r,s),r===null&&(s.flags|=4194304),s.child;case 5:return r===null&&et&&((g=u=xt)&&(u=uA(u,s.type,s.pendingProps,xr),u!==null?(s.stateNode=u,_n=s,xt=Er(u.firstChild),xr=!1,g=!0):g=!1),g||ps(s)),te(s),g=s.type,y=s.pendingProps,S=r!==null?r.memoizedProps:null,u=y.children,Cp(g,y)?u=null:S!==null&&Cp(g,S)&&(s.flags|=32),s.memoizedState!==null&&(g=Tm(r,s,TC,null,null,o),Vc._currentValue=g),Md(r,s),vn(r,s,u,o),s.child;case 6:return r===null&&et&&((r=o=xt)&&(o=dA(o,s.pendingProps,xr),o!==null?(s.stateNode=o,_n=s,xt=null,r=!0):r=!1),r||ps(s)),null;case 13:return J0(r,s,o);case 4:return Se(s,s.stateNode.containerInfo),u=s.pendingProps,r===null?s.child=Na(s,null,u,o):vn(r,s,u,o),s.child;case 11:return q0(r,s,s.type,s.pendingProps,o);case 7:return vn(r,s,s.pendingProps,o),s.child;case 8:return vn(r,s,s.pendingProps.children,o),s.child;case 12:return vn(r,s,s.pendingProps.children,o),s.child;case 10:return u=s.pendingProps,gs(s,s.type,u.value),vn(r,s,u.children,o),s.child;case 9:return g=s.type._context,u=s.pendingProps.children,Ia(s),g=bn(g),u=u(g),s.flags|=1,vn(r,s,u,o),s.child;case 14:return H0(r,s,s.type,s.pendingProps,o);case 15:return G0(r,s,s.type,s.pendingProps,o);case 19:return eb(r,s,o);case 31:return OC(r,s,o);case 22:return $0(r,s,o,s.pendingProps);case 24:return Ia(s),u=bn(Wt),r===null?(g=pm(),g===null&&(g=_t,y=fm(),g.pooledCache=y,y.refCount++,y!==null&&(g.pooledCacheLanes|=o),g=y),s.memoizedState={parent:u,cache:g},ym(s),gs(s,Wt,g)):((r.lanes&o)!==0&&(_m(r,s),bc(s,null,null,o),_c()),g=r.memoizedState,y=s.memoizedState,g.parent!==u?(g={parent:u,cache:u},s.memoizedState=g,s.lanes===0&&(s.memoizedState=s.updateQueue.baseState=g),gs(s,Wt,u)):(u=y.cache,gs(s,Wt,u),u!==g.cache&&hm(s,[Wt],o,!0))),vn(r,s,s.pendingProps.children,o),s.child;case 29:throw s.pendingProps}throw Error(i(156,s.tag))}function Pi(r){r.flags|=4}function Zm(r,s,o,u,g){if((s=(r.mode&32)!==0)&&(s=!1),s){if(r.flags|=16777216,(g&335544128)===g)if(r.stateNode.complete)r.flags|=8192;else if(Rb())r.flags|=8192;else throw ka=yd,gm}else r.flags&=-16777217}function nb(r,s){if(s.type!=="stylesheet"||(s.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!yv(s))if(Rb())r.flags|=8192;else throw ka=yd,gm}function kd(r,s){s!==null&&(r.flags|=4),r.flags&16384&&(s=r.tag!==22?Uu():536870912,r.lanes|=s,Ho|=s)}function Tc(r,s){if(!et)switch(r.tailMode){case"hidden":s=r.tail;for(var o=null;s!==null;)s.alternate!==null&&(o=s),s=s.sibling;o===null?r.tail=null:o.sibling=null;break;case"collapsed":o=r.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?s||r.tail===null?r.tail=null:r.tail.sibling=null:u.sibling=null}}function St(r){var s=r.alternate!==null&&r.alternate.child===r.child,o=0,u=0;if(s)for(var g=r.child;g!==null;)o|=g.lanes|g.childLanes,u|=g.subtreeFlags&65011712,u|=g.flags&65011712,g.return=r,g=g.sibling;else for(g=r.child;g!==null;)o|=g.lanes|g.childLanes,u|=g.subtreeFlags,u|=g.flags,g.return=r,g=g.sibling;return r.subtreeFlags|=u,r.childLanes=o,s}function NC(r,s,o){var u=s.pendingProps;switch(om(s),s.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return St(s),null;case 1:return St(s),null;case 3:return o=s.stateNode,u=null,r!==null&&(u=r.memoizedState.cache),s.memoizedState.cache!==u&&(s.flags|=2048),Mi(Wt),fe(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(r===null||r.child===null)&&(Io(s)?Pi(s):r===null||r.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,cm())),St(s),null;case 26:var g=s.type,y=s.memoizedState;return r===null?(Pi(s),y!==null?(St(s),nb(s,y)):(St(s),Zm(s,g,null,u,o))):y?y!==r.memoizedState?(Pi(s),St(s),nb(s,y)):(St(s),s.flags&=-16777217):(r=r.memoizedProps,r!==u&&Pi(s),St(s),Zm(s,g,r,u,o)),null;case 27:if(Ee(s),o=ue.current,g=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==u&&Pi(s);else{if(!u){if(s.stateNode===null)throw Error(i(166));return St(s),null}r=X.current,Io(s)?N_(s):(r=cv(g,u,o),s.stateNode=r,Pi(s))}return St(s),null;case 5:if(Ee(s),g=s.type,r!==null&&s.stateNode!=null)r.memoizedProps!==u&&Pi(s);else{if(!u){if(s.stateNode===null)throw Error(i(166));return St(s),null}if(y=X.current,Io(s))N_(s);else{var S=Kd(ue.current);switch(y){case 1:y=S.createElementNS("http://www.w3.org/2000/svg",g);break;case 2:y=S.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;default:switch(g){case"svg":y=S.createElementNS("http://www.w3.org/2000/svg",g);break;case"math":y=S.createElementNS("http://www.w3.org/1998/Math/MathML",g);break;case"script":y=S.createElement("div"),y.innerHTML="<script><\/script>",y=y.removeChild(y.firstChild);break;case"select":y=typeof u.is=="string"?S.createElement("select",{is:u.is}):S.createElement("select"),u.multiple?y.multiple=!0:u.size&&(y.size=u.size);break;default:y=typeof u.is=="string"?S.createElement(g,{is:u.is}):S.createElement(g)}}y[Gt]=s,y[un]=u;e:for(S=s.child;S!==null;){if(S.tag===5||S.tag===6)y.appendChild(S.stateNode);else if(S.tag!==4&&S.tag!==27&&S.child!==null){S.child.return=S,S=S.child;continue}if(S===s)break e;for(;S.sibling===null;){if(S.return===null||S.return===s)break e;S=S.return}S.sibling.return=S.return,S=S.sibling}s.stateNode=y;e:switch(xn(y,g,u),g){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}u&&Pi(s)}}return St(s),Zm(s,s.type,r===null?null:r.memoizedProps,s.pendingProps,o),null;case 6:if(r&&s.stateNode!=null)r.memoizedProps!==u&&Pi(s);else{if(typeof u!="string"&&s.stateNode===null)throw Error(i(166));if(r=ue.current,Io(s)){if(r=s.stateNode,o=s.memoizedProps,u=null,g=_n,g!==null)switch(g.tag){case 27:case 5:u=g.memoizedProps}r[Gt]=s,r=!!(r.nodeValue===o||u!==null&&u.suppressHydrationWarning===!0||Jb(r.nodeValue,o)),r||ps(s,!0)}else r=Kd(r).createTextNode(u),r[Gt]=s,s.stateNode=r}return St(s),null;case 31:if(o=s.memoizedState,r===null||r.memoizedState!==null){if(u=Io(s),o!==null){if(r===null){if(!u)throw Error(i(318));if(r=s.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(i(557));r[Gt]=s}else Da(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;St(s),r=!1}else o=cm(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=o),r=!0;if(!r)return s.flags&256?(nr(s),s):(nr(s),null);if((s.flags&128)!==0)throw Error(i(558))}return St(s),null;case 13:if(u=s.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(g=Io(s),u!==null&&u.dehydrated!==null){if(r===null){if(!g)throw Error(i(318));if(g=s.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(i(317));g[Gt]=s}else Da(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;St(s),g=!1}else g=cm(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=g),g=!0;if(!g)return s.flags&256?(nr(s),s):(nr(s),null)}return nr(s),(s.flags&128)!==0?(s.lanes=o,s):(o=u!==null,r=r!==null&&r.memoizedState!==null,o&&(u=s.child,g=null,u.alternate!==null&&u.alternate.memoizedState!==null&&u.alternate.memoizedState.cachePool!==null&&(g=u.alternate.memoizedState.cachePool.pool),y=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(y=u.memoizedState.cachePool.pool),y!==g&&(u.flags|=2048)),o!==r&&o&&(s.child.flags|=8192),kd(s,s.updateQueue),St(s),null);case 4:return fe(),r===null&&xp(s.stateNode.containerInfo),St(s),null;case 10:return Mi(s.type),St(s),null;case 19:if(z(Lt),u=s.memoizedState,u===null)return St(s),null;if(g=(s.flags&128)!==0,y=u.rendering,y===null)if(g)Tc(u,!1);else{if(Ot!==0||r!==null&&(r.flags&128)!==0)for(r=s.child;r!==null;){if(y=xd(r),y!==null){for(s.flags|=128,Tc(u,!1),r=y.updateQueue,s.updateQueue=r,kd(s,r),s.subtreeFlags=0,r=o,o=s.child;o!==null;)j_(o,r),o=o.sibling;return $(Lt,Lt.current&1|2),et&&ji(s,u.treeForkCount),s.child}r=r.sibling}u.tail!==null&&It()>Vd&&(s.flags|=128,g=!0,Tc(u,!1),s.lanes=4194304)}else{if(!g)if(r=xd(y),r!==null){if(s.flags|=128,g=!0,r=r.updateQueue,s.updateQueue=r,kd(s,r),Tc(u,!0),u.tail===null&&u.tailMode==="hidden"&&!y.alternate&&!et)return St(s),null}else 2*It()-u.renderingStartTime>Vd&&o!==536870912&&(s.flags|=128,g=!0,Tc(u,!1),s.lanes=4194304);u.isBackwards?(y.sibling=s.child,s.child=y):(r=u.last,r!==null?r.sibling=y:s.child=y,u.last=y)}return u.tail!==null?(r=u.tail,u.rendering=r,u.tail=r.sibling,u.renderingStartTime=It(),r.sibling=null,o=Lt.current,$(Lt,g?o&1|2:o&1),et&&ji(s,u.treeForkCount),r):(St(s),null);case 22:case 23:return nr(s),Sm(),u=s.memoizedState!==null,r!==null?r.memoizedState!==null!==u&&(s.flags|=8192):u&&(s.flags|=8192),u?(o&536870912)!==0&&(s.flags&128)===0&&(St(s),s.subtreeFlags&6&&(s.flags|=8192)):St(s),o=s.updateQueue,o!==null&&kd(s,o.retryQueue),o=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(o=r.memoizedState.cachePool.pool),u=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(u=s.memoizedState.cachePool.pool),u!==o&&(s.flags|=2048),r!==null&&z(Ma),null;case 24:return o=null,r!==null&&(o=r.memoizedState.cache),s.memoizedState.cache!==o&&(s.flags|=2048),Mi(Wt),St(s),null;case 25:return null;case 30:return null}throw Error(i(156,s.tag))}function PC(r,s){switch(om(s),s.tag){case 1:return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 3:return Mi(Wt),fe(),r=s.flags,(r&65536)!==0&&(r&128)===0?(s.flags=r&-65537|128,s):null;case 26:case 27:case 5:return Ee(s),null;case 31:if(s.memoizedState!==null){if(nr(s),s.alternate===null)throw Error(i(340));Da()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 13:if(nr(s),r=s.memoizedState,r!==null&&r.dehydrated!==null){if(s.alternate===null)throw Error(i(340));Da()}return r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 19:return z(Lt),null;case 4:return fe(),null;case 10:return Mi(s.type),null;case 22:case 23:return nr(s),Sm(),r!==null&&z(Ma),r=s.flags,r&65536?(s.flags=r&-65537|128,s):null;case 24:return Mi(Wt),null;case 25:return null;default:return null}}function rb(r,s){switch(om(s),s.tag){case 3:Mi(Wt),fe();break;case 26:case 27:case 5:Ee(s);break;case 4:fe();break;case 31:s.memoizedState!==null&&nr(s);break;case 13:nr(s);break;case 19:z(Lt);break;case 10:Mi(s.type);break;case 22:case 23:nr(s),Sm(),r!==null&&z(Ma);break;case 24:Mi(Wt)}}function Cc(r,s){try{var o=s.updateQueue,u=o!==null?o.lastEffect:null;if(u!==null){var g=u.next;o=g;do{if((o.tag&r)===r){u=void 0;var y=o.create,S=o.inst;u=y(),S.destroy=u}o=o.next}while(o!==g)}}catch(P){ft(s,s.return,P)}}function Ss(r,s,o){try{var u=s.updateQueue,g=u!==null?u.lastEffect:null;if(g!==null){var y=g.next;u=y;do{if((u.tag&r)===r){var S=u.inst,P=S.destroy;if(P!==void 0){S.destroy=void 0,g=s;var K=o,le=P;try{le()}catch(ge){ft(g,K,ge)}}}u=u.next}while(u!==y)}}catch(ge){ft(s,s.return,ge)}}function ib(r){var s=r.updateQueue;if(s!==null){var o=r.stateNode;try{W_(s,o)}catch(u){ft(r,r.return,u)}}}function sb(r,s,o){o.props=La(r.type,r.memoizedProps),o.state=r.memoizedState;try{o.componentWillUnmount()}catch(u){ft(r,s,u)}}function Ac(r,s){try{var o=r.ref;if(o!==null){switch(r.tag){case 26:case 27:case 5:var u=r.stateNode;break;case 30:u=r.stateNode;break;default:u=r.stateNode}typeof o=="function"?r.refCleanup=o(u):o.current=u}}catch(g){ft(r,s,g)}}function fi(r,s){var o=r.ref,u=r.refCleanup;if(o!==null)if(typeof u=="function")try{u()}catch(g){ft(r,s,g)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof o=="function")try{o(null)}catch(g){ft(r,s,g)}else o.current=null}function ab(r){var s=r.type,o=r.memoizedProps,u=r.stateNode;try{e:switch(s){case"button":case"input":case"select":case"textarea":o.autoFocus&&u.focus();break e;case"img":o.src?u.src=o.src:o.srcSet&&(u.srcset=o.srcSet)}}catch(g){ft(r,r.return,g)}}function ep(r,s,o){try{var u=r.stateNode;iA(u,r.type,o,s),u[un]=s}catch(g){ft(r,r.return,g)}}function ob(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&Ds(r.type)||r.tag===4}function tp(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||ob(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&Ds(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function np(r,s,o){var u=r.tag;if(u===5||u===6)r=r.stateNode,s?(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o).insertBefore(r,s):(s=o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,s.appendChild(r),o=o._reactRootContainer,o!=null||s.onclick!==null||(s.onclick=Nr));else if(u!==4&&(u===27&&Ds(r.type)&&(o=r.stateNode,s=null),r=r.child,r!==null))for(np(r,s,o),r=r.sibling;r!==null;)np(r,s,o),r=r.sibling}function Nd(r,s,o){var u=r.tag;if(u===5||u===6)r=r.stateNode,s?o.insertBefore(r,s):o.appendChild(r);else if(u!==4&&(u===27&&Ds(r.type)&&(o=r.stateNode),r=r.child,r!==null))for(Nd(r,s,o),r=r.sibling;r!==null;)Nd(r,s,o),r=r.sibling}function lb(r){var s=r.stateNode,o=r.memoizedProps;try{for(var u=r.type,g=s.attributes;g.length;)s.removeAttributeNode(g[0]);xn(s,u,o),s[Gt]=r,s[un]=o}catch(y){ft(r,r.return,y)}}var Li=!1,Xt=!1,rp=!1,cb=typeof WeakSet=="function"?WeakSet:Set,hn=null;function LC(r,s){if(r=r.containerInfo,wp=nh,r=x_(r),Yf(r)){if("selectionStart"in r)var o={start:r.selectionStart,end:r.selectionEnd};else e:{o=(o=r.ownerDocument)&&o.defaultView||window;var u=o.getSelection&&o.getSelection();if(u&&u.rangeCount!==0){o=u.anchorNode;var g=u.anchorOffset,y=u.focusNode;u=u.focusOffset;try{o.nodeType,y.nodeType}catch{o=null;break e}var S=0,P=-1,K=-1,le=0,ge=0,be=r,de=null;t:for(;;){for(var pe;be!==o||g!==0&&be.nodeType!==3||(P=S+g),be!==y||u!==0&&be.nodeType!==3||(K=S+u),be.nodeType===3&&(S+=be.nodeValue.length),(pe=be.firstChild)!==null;)de=be,be=pe;for(;;){if(be===r)break t;if(de===o&&++le===g&&(P=S),de===y&&++ge===u&&(K=S),(pe=be.nextSibling)!==null)break;be=de,de=be.parentNode}be=pe}o=P===-1||K===-1?null:{start:P,end:K}}else o=null}o=o||{start:0,end:0}}else o=null;for(Tp={focusedElem:r,selectionRange:o},nh=!1,hn=s;hn!==null;)if(s=hn,r=s.child,(s.subtreeFlags&1028)!==0&&r!==null)r.return=s,hn=r;else for(;hn!==null;){switch(s=hn,y=s.alternate,r=s.flags,s.tag){case 0:if((r&4)!==0&&(r=s.updateQueue,r=r!==null?r.events:null,r!==null))for(o=0;o<r.length;o++)g=r[o],g.ref.impl=g.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&y!==null){r=void 0,o=s,g=y.memoizedProps,y=y.memoizedState,u=o.stateNode;try{var Ae=La(o.type,g);r=u.getSnapshotBeforeUpdate(Ae,y),u.__reactInternalSnapshotBeforeUpdate=r}catch(Oe){ft(o,o.return,Oe)}}break;case 3:if((r&1024)!==0){if(r=s.stateNode.containerInfo,o=r.nodeType,o===9)Rp(r);else if(o===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":Rp(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(i(163))}if(r=s.sibling,r!==null){r.return=s.return,hn=r;break}hn=s.return}}function ub(r,s,o){var u=o.flags;switch(o.tag){case 0:case 11:case 15:Vi(r,o),u&4&&Cc(5,o);break;case 1:if(Vi(r,o),u&4)if(r=o.stateNode,s===null)try{r.componentDidMount()}catch(S){ft(o,o.return,S)}else{var g=La(o.type,s.memoizedProps);s=s.memoizedState;try{r.componentDidUpdate(g,s,r.__reactInternalSnapshotBeforeUpdate)}catch(S){ft(o,o.return,S)}}u&64&&ib(o),u&512&&Ac(o,o.return);break;case 3:if(Vi(r,o),u&64&&(r=o.updateQueue,r!==null)){if(s=null,o.child!==null)switch(o.child.tag){case 27:case 5:s=o.child.stateNode;break;case 1:s=o.child.stateNode}try{W_(r,s)}catch(S){ft(o,o.return,S)}}break;case 27:s===null&&u&4&&lb(o);case 26:case 5:Vi(r,o),s===null&&u&4&&ab(o),u&512&&Ac(o,o.return);break;case 12:Vi(r,o);break;case 31:Vi(r,o),u&4&&fb(r,o);break;case 13:Vi(r,o),u&4&&mb(r,o),u&64&&(r=o.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(o=$C.bind(null,o),hA(r,o))));break;case 22:if(u=o.memoizedState!==null||Li,!u){s=s!==null&&s.memoizedState!==null||Xt,g=Li;var y=Xt;Li=u,(Xt=s)&&!y?Ui(r,o,(o.subtreeFlags&8772)!==0):Vi(r,o),Li=g,Xt=y}break;case 30:break;default:Vi(r,o)}}function db(r){var s=r.alternate;s!==null&&(r.alternate=null,db(s)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(s=r.stateNode,s!==null&&mo(s)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var At=null,Vn=!1;function Bi(r,s,o){for(o=o.child;o!==null;)hb(r,s,o),o=o.sibling}function hb(r,s,o){if(gn&&typeof gn.onCommitFiberUnmount=="function")try{gn.onCommitFiberUnmount(Ir,o)}catch{}switch(o.tag){case 26:Xt||fi(o,s),Bi(r,s,o),o.memoizedState?o.memoizedState.count--:o.stateNode&&(o=o.stateNode,o.parentNode.removeChild(o));break;case 27:Xt||fi(o,s);var u=At,g=Vn;Ds(o.type)&&(At=o.stateNode,Vn=!1),Bi(r,s,o),Pc(o.stateNode),At=u,Vn=g;break;case 5:Xt||fi(o,s);case 6:if(u=At,g=Vn,At=null,Bi(r,s,o),At=u,Vn=g,At!==null)if(Vn)try{(At.nodeType===9?At.body:At.nodeName==="HTML"?At.ownerDocument.body:At).removeChild(o.stateNode)}catch(y){ft(o,s,y)}else try{At.removeChild(o.stateNode)}catch(y){ft(o,s,y)}break;case 18:At!==null&&(Vn?(r=At,iv(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,o.stateNode),Jo(r)):iv(At,o.stateNode));break;case 4:u=At,g=Vn,At=o.stateNode.containerInfo,Vn=!0,Bi(r,s,o),At=u,Vn=g;break;case 0:case 11:case 14:case 15:Ss(2,o,s),Xt||Ss(4,o,s),Bi(r,s,o);break;case 1:Xt||(fi(o,s),u=o.stateNode,typeof u.componentWillUnmount=="function"&&sb(o,s,u)),Bi(r,s,o);break;case 21:Bi(r,s,o);break;case 22:Xt=(u=Xt)||o.memoizedState!==null,Bi(r,s,o),Xt=u;break;default:Bi(r,s,o)}}function fb(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Jo(r)}catch(o){ft(s,s.return,o)}}}function mb(r,s){if(s.memoizedState===null&&(r=s.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Jo(r)}catch(o){ft(s,s.return,o)}}function BC(r){switch(r.tag){case 31:case 13:case 19:var s=r.stateNode;return s===null&&(s=r.stateNode=new cb),s;case 22:return r=r.stateNode,s=r._retryCache,s===null&&(s=r._retryCache=new cb),s;default:throw Error(i(435,r.tag))}}function Pd(r,s){var o=BC(r);s.forEach(function(u){if(!o.has(u)){o.add(u);var g=QC.bind(null,r,u);u.then(g,g)}})}function Un(r,s){var o=s.deletions;if(o!==null)for(var u=0;u<o.length;u++){var g=o[u],y=r,S=s,P=S;e:for(;P!==null;){switch(P.tag){case 27:if(Ds(P.type)){At=P.stateNode,Vn=!1;break e}break;case 5:At=P.stateNode,Vn=!1;break e;case 3:case 4:At=P.stateNode.containerInfo,Vn=!0;break e}P=P.return}if(At===null)throw Error(i(160));hb(y,S,g),At=null,Vn=!1,y=g.alternate,y!==null&&(y.return=null),g.return=null}if(s.subtreeFlags&13886)for(s=s.child;s!==null;)pb(s,r),s=s.sibling}var zr=null;function pb(r,s){var o=r.alternate,u=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:Un(s,r),zn(r),u&4&&(Ss(3,r,r.return),Cc(3,r),Ss(5,r,r.return));break;case 1:Un(s,r),zn(r),u&512&&(Xt||o===null||fi(o,o.return)),u&64&&Li&&(r=r.updateQueue,r!==null&&(u=r.callbacks,u!==null&&(o=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=o===null?u:o.concat(u))));break;case 26:var g=zr;if(Un(s,r),zn(r),u&512&&(Xt||o===null||fi(o,o.return)),u&4){var y=o!==null?o.memoizedState:null;if(u=r.memoizedState,o===null)if(u===null)if(r.stateNode===null){e:{u=r.type,o=r.memoizedProps,g=g.ownerDocument||g;t:switch(u){case"title":y=g.getElementsByTagName("title")[0],(!y||y[Zr]||y[Gt]||y.namespaceURI==="http://www.w3.org/2000/svg"||y.hasAttribute("itemprop"))&&(y=g.createElement(u),g.head.insertBefore(y,g.querySelector("head > title"))),xn(y,u,o),y[Gt]=r,$t(y),u=y;break e;case"link":var S=pv("link","href",g).get(u+(o.href||""));if(S){for(var P=0;P<S.length;P++)if(y=S[P],y.getAttribute("href")===(o.href==null||o.href===""?null:o.href)&&y.getAttribute("rel")===(o.rel==null?null:o.rel)&&y.getAttribute("title")===(o.title==null?null:o.title)&&y.getAttribute("crossorigin")===(o.crossOrigin==null?null:o.crossOrigin)){S.splice(P,1);break t}}y=g.createElement(u),xn(y,u,o),g.head.appendChild(y);break;case"meta":if(S=pv("meta","content",g).get(u+(o.content||""))){for(P=0;P<S.length;P++)if(y=S[P],y.getAttribute("content")===(o.content==null?null:""+o.content)&&y.getAttribute("name")===(o.name==null?null:o.name)&&y.getAttribute("property")===(o.property==null?null:o.property)&&y.getAttribute("http-equiv")===(o.httpEquiv==null?null:o.httpEquiv)&&y.getAttribute("charset")===(o.charSet==null?null:o.charSet)){S.splice(P,1);break t}}y=g.createElement(u),xn(y,u,o),g.head.appendChild(y);break;default:throw Error(i(468,u))}y[Gt]=r,$t(y),u=y}r.stateNode=u}else gv(g,r.type,r.stateNode);else r.stateNode=mv(g,u,r.memoizedProps);else y!==u?(y===null?o.stateNode!==null&&(o=o.stateNode,o.parentNode.removeChild(o)):y.count--,u===null?gv(g,r.type,r.stateNode):mv(g,u,r.memoizedProps)):u===null&&r.stateNode!==null&&ep(r,r.memoizedProps,o.memoizedProps)}break;case 27:Un(s,r),zn(r),u&512&&(Xt||o===null||fi(o,o.return)),o!==null&&u&4&&ep(r,r.memoizedProps,o.memoizedProps);break;case 5:if(Un(s,r),zn(r),u&512&&(Xt||o===null||fi(o,o.return)),r.flags&32){g=r.stateNode;try{Bn(g,"")}catch(Ae){ft(r,r.return,Ae)}}u&4&&r.stateNode!=null&&(g=r.memoizedProps,ep(r,g,o!==null?o.memoizedProps:g)),u&1024&&(rp=!0);break;case 6:if(Un(s,r),zn(r),u&4){if(r.stateNode===null)throw Error(i(162));u=r.memoizedProps,o=r.stateNode;try{o.nodeValue=u}catch(Ae){ft(r,r.return,Ae)}}break;case 3:if(Jd=null,g=zr,zr=Yd(s.containerInfo),Un(s,r),zr=g,zn(r),u&4&&o!==null&&o.memoizedState.isDehydrated)try{Jo(s.containerInfo)}catch(Ae){ft(r,r.return,Ae)}rp&&(rp=!1,gb(r));break;case 4:u=zr,zr=Yd(r.stateNode.containerInfo),Un(s,r),zn(r),zr=u;break;case 12:Un(s,r),zn(r);break;case 31:Un(s,r),zn(r),u&4&&(u=r.updateQueue,u!==null&&(r.updateQueue=null,Pd(r,u)));break;case 13:Un(s,r),zn(r),r.child.flags&8192&&r.memoizedState!==null!=(o!==null&&o.memoizedState!==null)&&(Bd=It()),u&4&&(u=r.updateQueue,u!==null&&(r.updateQueue=null,Pd(r,u)));break;case 22:g=r.memoizedState!==null;var K=o!==null&&o.memoizedState!==null,le=Li,ge=Xt;if(Li=le||g,Xt=ge||K,Un(s,r),Xt=ge,Li=le,zn(r),u&8192)e:for(s=r.stateNode,s._visibility=g?s._visibility&-2:s._visibility|1,g&&(o===null||K||Li||Xt||Ba(r)),o=null,s=r;;){if(s.tag===5||s.tag===26){if(o===null){K=o=s;try{if(y=K.stateNode,g)S=y.style,typeof S.setProperty=="function"?S.setProperty("display","none","important"):S.display="none";else{P=K.stateNode;var be=K.memoizedProps.style,de=be!=null&&be.hasOwnProperty("display")?be.display:null;P.style.display=de==null||typeof de=="boolean"?"":(""+de).trim()}}catch(Ae){ft(K,K.return,Ae)}}}else if(s.tag===6){if(o===null){K=s;try{K.stateNode.nodeValue=g?"":K.memoizedProps}catch(Ae){ft(K,K.return,Ae)}}}else if(s.tag===18){if(o===null){K=s;try{var pe=K.stateNode;g?sv(pe,!0):sv(K.stateNode,!1)}catch(Ae){ft(K,K.return,Ae)}}}else if((s.tag!==22&&s.tag!==23||s.memoizedState===null||s===r)&&s.child!==null){s.child.return=s,s=s.child;continue}if(s===r)break e;for(;s.sibling===null;){if(s.return===null||s.return===r)break e;o===s&&(o=null),s=s.return}o===s&&(o=null),s.sibling.return=s.return,s=s.sibling}u&4&&(u=r.updateQueue,u!==null&&(o=u.retryQueue,o!==null&&(u.retryQueue=null,Pd(r,o))));break;case 19:Un(s,r),zn(r),u&4&&(u=r.updateQueue,u!==null&&(r.updateQueue=null,Pd(r,u)));break;case 30:break;case 21:break;default:Un(s,r),zn(r)}}function zn(r){var s=r.flags;if(s&2){try{for(var o,u=r.return;u!==null;){if(ob(u)){o=u;break}u=u.return}if(o==null)throw Error(i(160));switch(o.tag){case 27:var g=o.stateNode,y=tp(r);Nd(r,y,g);break;case 5:var S=o.stateNode;o.flags&32&&(Bn(S,""),o.flags&=-33);var P=tp(r);Nd(r,P,S);break;case 3:case 4:var K=o.stateNode.containerInfo,le=tp(r);np(r,le,K);break;default:throw Error(i(161))}}catch(ge){ft(r,r.return,ge)}r.flags&=-3}s&4096&&(r.flags&=-4097)}function gb(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var s=r;gb(s),s.tag===5&&s.flags&1024&&s.stateNode.reset(),r=r.sibling}}function Vi(r,s){if(s.subtreeFlags&8772)for(s=s.child;s!==null;)ub(r,s.alternate,s),s=s.sibling}function Ba(r){for(r=r.child;r!==null;){var s=r;switch(s.tag){case 0:case 11:case 14:case 15:Ss(4,s,s.return),Ba(s);break;case 1:fi(s,s.return);var o=s.stateNode;typeof o.componentWillUnmount=="function"&&sb(s,s.return,o),Ba(s);break;case 27:Pc(s.stateNode);case 26:case 5:fi(s,s.return),Ba(s);break;case 22:s.memoizedState===null&&Ba(s);break;case 30:Ba(s);break;default:Ba(s)}r=r.sibling}}function Ui(r,s,o){for(o=o&&(s.subtreeFlags&8772)!==0,s=s.child;s!==null;){var u=s.alternate,g=r,y=s,S=y.flags;switch(y.tag){case 0:case 11:case 15:Ui(g,y,o),Cc(4,y);break;case 1:if(Ui(g,y,o),u=y,g=u.stateNode,typeof g.componentDidMount=="function")try{g.componentDidMount()}catch(le){ft(u,u.return,le)}if(u=y,g=u.updateQueue,g!==null){var P=u.stateNode;try{var K=g.shared.hiddenCallbacks;if(K!==null)for(g.shared.hiddenCallbacks=null,g=0;g<K.length;g++)Q_(K[g],P)}catch(le){ft(u,u.return,le)}}o&&S&64&&ib(y),Ac(y,y.return);break;case 27:lb(y);case 26:case 5:Ui(g,y,o),o&&u===null&&S&4&&ab(y),Ac(y,y.return);break;case 12:Ui(g,y,o);break;case 31:Ui(g,y,o),o&&S&4&&fb(g,y);break;case 13:Ui(g,y,o),o&&S&4&&mb(g,y);break;case 22:y.memoizedState===null&&Ui(g,y,o),Ac(y,y.return);break;case 30:break;default:Ui(g,y,o)}s=s.sibling}}function ip(r,s){var o=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(o=r.memoizedState.cachePool.pool),r=null,s.memoizedState!==null&&s.memoizedState.cachePool!==null&&(r=s.memoizedState.cachePool.pool),r!==o&&(r!=null&&r.refCount++,o!=null&&fc(o))}function sp(r,s){r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&fc(r))}function Fr(r,s,o,u){if(s.subtreeFlags&10256)for(s=s.child;s!==null;)yb(r,s,o,u),s=s.sibling}function yb(r,s,o,u){var g=s.flags;switch(s.tag){case 0:case 11:case 15:Fr(r,s,o,u),g&2048&&Cc(9,s);break;case 1:Fr(r,s,o,u);break;case 3:Fr(r,s,o,u),g&2048&&(r=null,s.alternate!==null&&(r=s.alternate.memoizedState.cache),s=s.memoizedState.cache,s!==r&&(s.refCount++,r!=null&&fc(r)));break;case 12:if(g&2048){Fr(r,s,o,u),r=s.stateNode;try{var y=s.memoizedProps,S=y.id,P=y.onPostCommit;typeof P=="function"&&P(S,s.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(K){ft(s,s.return,K)}}else Fr(r,s,o,u);break;case 31:Fr(r,s,o,u);break;case 13:Fr(r,s,o,u);break;case 23:break;case 22:y=s.stateNode,S=s.alternate,s.memoizedState!==null?y._visibility&2?Fr(r,s,o,u):Rc(r,s):y._visibility&2?Fr(r,s,o,u):(y._visibility|=2,zo(r,s,o,u,(s.subtreeFlags&10256)!==0||!1)),g&2048&&ip(S,s);break;case 24:Fr(r,s,o,u),g&2048&&sp(s.alternate,s);break;default:Fr(r,s,o,u)}}function zo(r,s,o,u,g){for(g=g&&((s.subtreeFlags&10256)!==0||!1),s=s.child;s!==null;){var y=r,S=s,P=o,K=u,le=S.flags;switch(S.tag){case 0:case 11:case 15:zo(y,S,P,K,g),Cc(8,S);break;case 23:break;case 22:var ge=S.stateNode;S.memoizedState!==null?ge._visibility&2?zo(y,S,P,K,g):Rc(y,S):(ge._visibility|=2,zo(y,S,P,K,g)),g&&le&2048&&ip(S.alternate,S);break;case 24:zo(y,S,P,K,g),g&&le&2048&&sp(S.alternate,S);break;default:zo(y,S,P,K,g)}s=s.sibling}}function Rc(r,s){if(s.subtreeFlags&10256)for(s=s.child;s!==null;){var o=r,u=s,g=u.flags;switch(u.tag){case 22:Rc(o,u),g&2048&&ip(u.alternate,u);break;case 24:Rc(o,u),g&2048&&sp(u.alternate,u);break;default:Rc(o,u)}s=s.sibling}}var Dc=8192;function Fo(r,s,o){if(r.subtreeFlags&Dc)for(r=r.child;r!==null;)_b(r,s,o),r=r.sibling}function _b(r,s,o){switch(r.tag){case 26:Fo(r,s,o),r.flags&Dc&&r.memoizedState!==null&&wA(o,zr,r.memoizedState,r.memoizedProps);break;case 5:Fo(r,s,o);break;case 3:case 4:var u=zr;zr=Yd(r.stateNode.containerInfo),Fo(r,s,o),zr=u;break;case 22:r.memoizedState===null&&(u=r.alternate,u!==null&&u.memoizedState!==null?(u=Dc,Dc=16777216,Fo(r,s,o),Dc=u):Fo(r,s,o));break;default:Fo(r,s,o)}}function bb(r){var s=r.alternate;if(s!==null&&(r=s.child,r!==null)){s.child=null;do s=r.sibling,r.sibling=null,r=s;while(r!==null)}}function jc(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var u=s[o];hn=u,xb(u,r)}bb(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)vb(r),r=r.sibling}function vb(r){switch(r.tag){case 0:case 11:case 15:jc(r),r.flags&2048&&Ss(9,r,r.return);break;case 3:jc(r);break;case 12:jc(r);break;case 22:var s=r.stateNode;r.memoizedState!==null&&s._visibility&2&&(r.return===null||r.return.tag!==13)?(s._visibility&=-3,Ld(r)):jc(r);break;default:jc(r)}}function Ld(r){var s=r.deletions;if((r.flags&16)!==0){if(s!==null)for(var o=0;o<s.length;o++){var u=s[o];hn=u,xb(u,r)}bb(r)}for(r=r.child;r!==null;){switch(s=r,s.tag){case 0:case 11:case 15:Ss(8,s,s.return),Ld(s);break;case 22:o=s.stateNode,o._visibility&2&&(o._visibility&=-3,Ld(s));break;default:Ld(s)}r=r.sibling}}function xb(r,s){for(;hn!==null;){var o=hn;switch(o.tag){case 0:case 11:case 15:Ss(8,o,s);break;case 23:case 22:if(o.memoizedState!==null&&o.memoizedState.cachePool!==null){var u=o.memoizedState.cachePool.pool;u!=null&&u.refCount++}break;case 24:fc(o.memoizedState.cache)}if(u=o.child,u!==null)u.return=o,hn=u;else e:for(o=r;hn!==null;){u=hn;var g=u.sibling,y=u.return;if(db(u),u===o){hn=null;break e}if(g!==null){g.return=y,hn=g;break e}hn=y}}}var VC={getCacheForType:function(r){var s=bn(Wt),o=s.data.get(r);return o===void 0&&(o=r(),s.data.set(r,o)),o},cacheSignal:function(){return bn(Wt).controller.signal}},UC=typeof WeakMap=="function"?WeakMap:Map,lt=0,_t=null,Qe=null,Ke=0,ht=0,rr=null,Es=!1,qo=!1,ap=!1,zi=0,Ot=0,ws=0,Va=0,op=0,ir=0,Ho=0,Ic=null,Fn=null,lp=!1,Bd=0,Sb=0,Vd=1/0,Ud=null,Ts=null,sn=0,Cs=null,Go=null,Fi=0,cp=0,up=null,Eb=null,Mc=0,dp=null;function sr(){return(lt&2)!==0&&Ke!==0?Ke&-Ke:N.T!==null?yp():zu()}function wb(){if(ir===0)if((Ke&536870912)===0||et){var r=ha;ha<<=1,(ha&3932160)===0&&(ha=262144),ir=r}else ir=536870912;return r=tr.current,r!==null&&(r.flags|=32),ir}function qn(r,s,o){(r===_t&&(ht===2||ht===9)||r.cancelPendingCommit!==null)&&($o(r,0),As(r,Ke,ir,!1)),fa(r,o),((lt&2)===0||r!==_t)&&(r===_t&&((lt&2)===0&&(Va|=o),Ot===4&&As(r,Ke,ir,!1)),mi(r))}function Tb(r,s,o){if((lt&6)!==0)throw Error(i(327));var u=!o&&(s&127)===0&&(s&r.expiredLanes)===0||Mr(r,s),g=u?qC(r,s):fp(r,s,!0),y=u;do{if(g===0){qo&&!u&&As(r,s,0,!1);break}else{if(o=r.current.alternate,y&&!zC(o)){g=fp(r,s,!1),y=!1;continue}if(g===2){if(y=s,r.errorRecoveryDisabledLanes&y)var S=0;else S=r.pendingLanes&-536870913,S=S!==0?S:S&536870912?536870912:0;if(S!==0){s=S;e:{var P=r;g=Ic;var K=P.current.memoizedState.isDehydrated;if(K&&($o(P,S).flags|=256),S=fp(P,S,!1),S!==2){if(ap&&!K){P.errorRecoveryDisabledLanes|=y,Va|=y,g=4;break e}y=Fn,Fn=g,y!==null&&(Fn===null?Fn=y:Fn.push.apply(Fn,y))}g=S}if(y=!1,g!==2)continue}}if(g===1){$o(r,0),As(r,s,0,!0);break}e:{switch(u=r,y=g,y){case 0:case 1:throw Error(i(345));case 4:if((s&4194048)!==s)break;case 6:As(u,s,ir,!Es);break e;case 2:Fn=null;break;case 3:case 5:break;default:throw Error(i(329))}if((s&62914560)===s&&(g=Bd+300-It(),10<g)){if(As(u,s,ir,!Es),Yr(u,0,!0)!==0)break e;Fi=s,u.timeoutHandle=nv(Cb.bind(null,u,o,Fn,Ud,lp,s,ir,Va,Ho,Es,y,"Throttled",-0,0),g);break e}Cb(u,o,Fn,Ud,lp,s,ir,Va,Ho,Es,y,null,-0,0)}}break}while(!0);mi(r)}function Cb(r,s,o,u,g,y,S,P,K,le,ge,be,de,pe){if(r.timeoutHandle=-1,be=s.subtreeFlags,be&8192||(be&16785408)===16785408){be={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Nr},_b(s,y,be);var Ae=(y&62914560)===y?Bd-It():(y&4194048)===y?Sb-It():0;if(Ae=TA(be,Ae),Ae!==null){Fi=y,r.cancelPendingCommit=Ae(kb.bind(null,r,s,y,o,u,g,S,P,K,ge,be,null,de,pe)),As(r,y,S,!le);return}}kb(r,s,y,o,u,g,S,P,K)}function zC(r){for(var s=r;;){var o=s.tag;if((o===0||o===11||o===15)&&s.flags&16384&&(o=s.updateQueue,o!==null&&(o=o.stores,o!==null)))for(var u=0;u<o.length;u++){var g=o[u],y=g.getSnapshot;g=g.value;try{if(!Zn(y(),g))return!1}catch{return!1}}if(o=s.child,s.subtreeFlags&16384&&o!==null)o.return=s,s=o;else{if(s===r)break;for(;s.sibling===null;){if(s.return===null||s.return===r)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function As(r,s,o,u){s&=~op,s&=~Va,r.suspendedLanes|=s,r.pingedLanes&=~s,u&&(r.warmLanes|=s),u=r.expirationTimes;for(var g=s;0<g;){var y=31-Nt(g),S=1<<y;u[y]=-1,g&=~S}o!==0&&ma(r,o,s)}function zd(){return(lt&6)===0?(Oc(0),!1):!0}function hp(){if(Qe!==null){if(ht===0)var r=Qe.return;else r=Qe,Ii=ja=null,Rm(r),Po=null,pc=0,r=Qe;for(;r!==null;)rb(r.alternate,r),r=r.return;Qe=null}}function $o(r,s){var o=r.timeoutHandle;o!==-1&&(r.timeoutHandle=-1,oA(o)),o=r.cancelPendingCommit,o!==null&&(r.cancelPendingCommit=null,o()),Fi=0,hp(),_t=r,Qe=o=Di(r.current,null),Ke=s,ht=0,rr=null,Es=!1,qo=Mr(r,s),ap=!1,Ho=ir=op=Va=ws=Ot=0,Fn=Ic=null,lp=!1,(s&8)!==0&&(s|=s&32);var u=r.entangledLanes;if(u!==0)for(r=r.entanglements,u&=s;0<u;){var g=31-Nt(u),y=1<<g;s|=r[g],u&=~y}return zi=s,ld(),o}function Ab(r,s){qe=null,N.H=Ec,s===No||s===gd?(s=q_(),ht=3):s===gm?(s=q_(),ht=4):ht=s===Hm?8:s!==null&&typeof s=="object"&&typeof s.then=="function"?6:1,rr=s,Qe===null&&(Ot=1,jd(r,_r(s,r.current)))}function Rb(){var r=tr.current;return r===null?!0:(Ke&4194048)===Ke?Sr===null:(Ke&62914560)===Ke||(Ke&536870912)!==0?r===Sr:!1}function Db(){var r=N.H;return N.H=Ec,r===null?Ec:r}function jb(){var r=N.A;return N.A=VC,r}function Fd(){Ot=4,Es||(Ke&4194048)!==Ke&&tr.current!==null||(qo=!0),(ws&134217727)===0&&(Va&134217727)===0||_t===null||As(_t,Ke,ir,!1)}function fp(r,s,o){var u=lt;lt|=2;var g=Db(),y=jb();(_t!==r||Ke!==s)&&(Ud=null,$o(r,s)),s=!1;var S=Ot;e:do try{if(ht!==0&&Qe!==null){var P=Qe,K=rr;switch(ht){case 8:hp(),S=6;break e;case 3:case 2:case 9:case 6:tr.current===null&&(s=!0);var le=ht;if(ht=0,rr=null,Qo(r,P,K,le),o&&qo){S=0;break e}break;default:le=ht,ht=0,rr=null,Qo(r,P,K,le)}}FC(),S=Ot;break}catch(ge){Ab(r,ge)}while(!0);return s&&r.shellSuspendCounter++,Ii=ja=null,lt=u,N.H=g,N.A=y,Qe===null&&(_t=null,Ke=0,ld()),S}function FC(){for(;Qe!==null;)Ib(Qe)}function qC(r,s){var o=lt;lt|=2;var u=Db(),g=jb();_t!==r||Ke!==s?(Ud=null,Vd=It()+500,$o(r,s)):qo=Mr(r,s);e:do try{if(ht!==0&&Qe!==null){s=Qe;var y=rr;t:switch(ht){case 1:ht=0,rr=null,Qo(r,s,y,1);break;case 2:case 9:if(z_(y)){ht=0,rr=null,Mb(s);break}s=function(){ht!==2&&ht!==9||_t!==r||(ht=7),mi(r)},y.then(s,s);break e;case 3:ht=7;break e;case 4:ht=5;break e;case 7:z_(y)?(ht=0,rr=null,Mb(s)):(ht=0,rr=null,Qo(r,s,y,7));break;case 5:var S=null;switch(Qe.tag){case 26:S=Qe.memoizedState;case 5:case 27:var P=Qe;if(S?yv(S):P.stateNode.complete){ht=0,rr=null;var K=P.sibling;if(K!==null)Qe=K;else{var le=P.return;le!==null?(Qe=le,qd(le)):Qe=null}break t}}ht=0,rr=null,Qo(r,s,y,5);break;case 6:ht=0,rr=null,Qo(r,s,y,6);break;case 8:hp(),Ot=6;break e;default:throw Error(i(462))}}HC();break}catch(ge){Ab(r,ge)}while(!0);return Ii=ja=null,N.H=u,N.A=g,lt=o,Qe!==null?0:(_t=null,Ke=0,ld(),Ot)}function HC(){for(;Qe!==null&&!Wn();)Ib(Qe)}function Ib(r){var s=tb(r.alternate,r,zi);r.memoizedProps=r.pendingProps,s===null?qd(r):Qe=s}function Mb(r){var s=r,o=s.alternate;switch(s.tag){case 15:case 0:s=K0(o,s,s.pendingProps,s.type,void 0,Ke);break;case 11:s=K0(o,s,s.pendingProps,s.type.render,s.ref,Ke);break;case 5:Rm(s);default:rb(o,s),s=Qe=j_(s,zi),s=tb(o,s,zi)}r.memoizedProps=r.pendingProps,s===null?qd(r):Qe=s}function Qo(r,s,o,u){Ii=ja=null,Rm(s),Po=null,pc=0;var g=s.return;try{if(MC(r,g,s,o,Ke)){Ot=1,jd(r,_r(o,r.current)),Qe=null;return}}catch(y){if(g!==null)throw Qe=g,y;Ot=1,jd(r,_r(o,r.current)),Qe=null;return}s.flags&32768?(et||u===1?r=!0:qo||(Ke&536870912)!==0?r=!1:(Es=r=!0,(u===2||u===9||u===3||u===6)&&(u=tr.current,u!==null&&u.tag===13&&(u.flags|=16384))),Ob(s,r)):qd(s)}function qd(r){var s=r;do{if((s.flags&32768)!==0){Ob(s,Es);return}r=s.return;var o=NC(s.alternate,s,zi);if(o!==null){Qe=o;return}if(s=s.sibling,s!==null){Qe=s;return}Qe=s=r}while(s!==null);Ot===0&&(Ot=5)}function Ob(r,s){do{var o=PC(r.alternate,r);if(o!==null){o.flags&=32767,Qe=o;return}if(o=r.return,o!==null&&(o.flags|=32768,o.subtreeFlags=0,o.deletions=null),!s&&(r=r.sibling,r!==null)){Qe=r;return}Qe=r=o}while(r!==null);Ot=6,Qe=null}function kb(r,s,o,u,g,y,S,P,K){r.cancelPendingCommit=null;do Hd();while(sn!==0);if((lt&6)!==0)throw Error(i(327));if(s!==null){if(s===r.current)throw Error(i(177));if(y=s.lanes|s.childLanes,y|=tm,$f(r,o,y,S,P,K),r===_t&&(Qe=_t=null,Ke=0),Go=s,Cs=r,Fi=o,cp=y,up=g,Eb=u,(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,WC(rs,function(){return Vb(),null})):(r.callbackNode=null,r.callbackPriority=0),u=(s.flags&13878)!==0,(s.subtreeFlags&13878)!==0||u){u=N.T,N.T=null,g=G.p,G.p=2,S=lt,lt|=4;try{LC(r,s,o)}finally{lt=S,G.p=g,N.T=u}}sn=1,Nb(),Pb(),Lb()}}function Nb(){if(sn===1){sn=0;var r=Cs,s=Go,o=(s.flags&13878)!==0;if((s.subtreeFlags&13878)!==0||o){o=N.T,N.T=null;var u=G.p;G.p=2;var g=lt;lt|=4;try{pb(s,r);var y=Tp,S=x_(r.containerInfo),P=y.focusedElem,K=y.selectionRange;if(S!==P&&P&&P.ownerDocument&&v_(P.ownerDocument.documentElement,P)){if(K!==null&&Yf(P)){var le=K.start,ge=K.end;if(ge===void 0&&(ge=le),"selectionStart"in P)P.selectionStart=le,P.selectionEnd=Math.min(ge,P.value.length);else{var be=P.ownerDocument||document,de=be&&be.defaultView||window;if(de.getSelection){var pe=de.getSelection(),Ae=P.textContent.length,Oe=Math.min(K.start,Ae),yt=K.end===void 0?Oe:Math.min(K.end,Ae);!pe.extend&&Oe>yt&&(S=yt,yt=Oe,Oe=S);var se=b_(P,Oe),Z=b_(P,yt);if(se&&Z&&(pe.rangeCount!==1||pe.anchorNode!==se.node||pe.anchorOffset!==se.offset||pe.focusNode!==Z.node||pe.focusOffset!==Z.offset)){var oe=be.createRange();oe.setStart(se.node,se.offset),pe.removeAllRanges(),Oe>yt?(pe.addRange(oe),pe.extend(Z.node,Z.offset)):(oe.setEnd(Z.node,Z.offset),pe.addRange(oe))}}}}for(be=[],pe=P;pe=pe.parentNode;)pe.nodeType===1&&be.push({element:pe,left:pe.scrollLeft,top:pe.scrollTop});for(typeof P.focus=="function"&&P.focus(),P=0;P<be.length;P++){var ye=be[P];ye.element.scrollLeft=ye.left,ye.element.scrollTop=ye.top}}nh=!!wp,Tp=wp=null}finally{lt=g,G.p=u,N.T=o}}r.current=s,sn=2}}function Pb(){if(sn===2){sn=0;var r=Cs,s=Go,o=(s.flags&8772)!==0;if((s.subtreeFlags&8772)!==0||o){o=N.T,N.T=null;var u=G.p;G.p=2;var g=lt;lt|=4;try{ub(r,s.alternate,s)}finally{lt=g,G.p=u,N.T=o}}sn=3}}function Lb(){if(sn===4||sn===3){sn=0,jr();var r=Cs,s=Go,o=Fi,u=Eb;(s.subtreeFlags&10256)!==0||(s.flags&10256)!==0?sn=5:(sn=0,Go=Cs=null,Bb(r,r.pendingLanes));var g=r.pendingLanes;if(g===0&&(Ts=null),Ti(o),s=s.stateNode,gn&&typeof gn.onCommitFiberRoot=="function")try{gn.onCommitFiberRoot(Ir,s,void 0,(s.current.flags&128)===128)}catch{}if(u!==null){s=N.T,g=G.p,G.p=2,N.T=null;try{for(var y=r.onRecoverableError,S=0;S<u.length;S++){var P=u[S];y(P.value,{componentStack:P.stack})}}finally{N.T=s,G.p=g}}(Fi&3)!==0&&Hd(),mi(r),g=r.pendingLanes,(o&261930)!==0&&(g&42)!==0?r===dp?Mc++:(Mc=0,dp=r):Mc=0,Oc(0)}}function Bb(r,s){(r.pooledCacheLanes&=s)===0&&(s=r.pooledCache,s!=null&&(r.pooledCache=null,fc(s)))}function Hd(){return Nb(),Pb(),Lb(),Vb()}function Vb(){if(sn!==5)return!1;var r=Cs,s=cp;cp=0;var o=Ti(Fi),u=N.T,g=G.p;try{G.p=32>o?32:o,N.T=null,o=up,up=null;var y=Cs,S=Fi;if(sn=0,Go=Cs=null,Fi=0,(lt&6)!==0)throw Error(i(331));var P=lt;if(lt|=4,vb(y.current),yb(y,y.current,S,o),lt=P,Oc(0,!1),gn&&typeof gn.onPostCommitFiberRoot=="function")try{gn.onPostCommitFiberRoot(Ir,y)}catch{}return!0}finally{G.p=g,N.T=u,Bb(r,s)}}function Ub(r,s,o){s=_r(o,s),s=qm(r.stateNode,s,2),r=bs(r,s,2),r!==null&&(fa(r,2),mi(r))}function ft(r,s,o){if(r.tag===3)Ub(r,r,o);else for(;s!==null;){if(s.tag===3){Ub(s,r,o);break}else if(s.tag===1){var u=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Ts===null||!Ts.has(u))){r=_r(o,r),o=z0(2),u=bs(s,o,2),u!==null&&(F0(o,u,s,r),fa(u,2),mi(u));break}}s=s.return}}function mp(r,s,o){var u=r.pingCache;if(u===null){u=r.pingCache=new UC;var g=new Set;u.set(s,g)}else g=u.get(s),g===void 0&&(g=new Set,u.set(s,g));g.has(o)||(ap=!0,g.add(o),r=GC.bind(null,r,s,o),s.then(r,r))}function GC(r,s,o){var u=r.pingCache;u!==null&&u.delete(s),r.pingedLanes|=r.suspendedLanes&o,r.warmLanes&=~o,_t===r&&(Ke&o)===o&&(Ot===4||Ot===3&&(Ke&62914560)===Ke&&300>It()-Bd?(lt&2)===0&&$o(r,0):op|=o,Ho===Ke&&(Ho=0)),mi(r)}function zb(r,s){s===0&&(s=Uu()),r=Aa(r,s),r!==null&&(fa(r,s),mi(r))}function $C(r){var s=r.memoizedState,o=0;s!==null&&(o=s.retryLane),zb(r,o)}function QC(r,s){var o=0;switch(r.tag){case 31:case 13:var u=r.stateNode,g=r.memoizedState;g!==null&&(o=g.retryLane);break;case 19:u=r.stateNode;break;case 22:u=r.stateNode._retryCache;break;default:throw Error(i(314))}u!==null&&u.delete(s),zb(r,o)}function WC(r,s){return kt(r,s)}var Gd=null,Wo=null,pp=!1,$d=!1,gp=!1,Rs=0;function mi(r){r!==Wo&&r.next===null&&(Wo===null?Gd=Wo=r:Wo=Wo.next=r),$d=!0,pp||(pp=!0,YC())}function Oc(r,s){if(!gp&&$d){gp=!0;do for(var o=!1,u=Gd;u!==null;){if(r!==0){var g=u.pendingLanes;if(g===0)var y=0;else{var S=u.suspendedLanes,P=u.pingedLanes;y=(1<<31-Nt(42|r)+1)-1,y&=g&~(S&~P),y=y&201326741?y&201326741|1:y?y|2:0}y!==0&&(o=!0,Gb(u,y))}else y=Ke,y=Yr(u,u===_t?y:0,u.cancelPendingCommit!==null||u.timeoutHandle!==-1),(y&3)===0||Mr(u,y)||(o=!0,Gb(u,y));u=u.next}while(o);gp=!1}}function KC(){Fb()}function Fb(){$d=pp=!1;var r=0;Rs!==0&&aA()&&(r=Rs);for(var s=It(),o=null,u=Gd;u!==null;){var g=u.next,y=qb(u,s);y===0?(u.next=null,o===null?Gd=g:o.next=g,g===null&&(Wo=o)):(o=u,(r!==0||(y&3)!==0)&&($d=!0)),u=g}sn!==0&&sn!==5||Oc(r),Rs!==0&&(Rs=0)}function qb(r,s){for(var o=r.suspendedLanes,u=r.pingedLanes,g=r.expirationTimes,y=r.pendingLanes&-62914561;0<y;){var S=31-Nt(y),P=1<<S,K=g[S];K===-1?((P&o)===0||(P&u)!==0)&&(g[S]=Gf(P,s)):K<=s&&(r.expiredLanes|=P),y&=~P}if(s=_t,o=Ke,o=Yr(r,r===s?o:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),u=r.callbackNode,o===0||r===s&&(ht===2||ht===9)||r.cancelPendingCommit!==null)return u!==null&&u!==null&&at(u),r.callbackNode=null,r.callbackPriority=0;if((o&3)===0||Mr(r,o)){if(s=o&-o,s===r.callbackPriority)return s;switch(u!==null&&at(u),Ti(o)){case 2:case 8:o=Yn;break;case 32:o=rs;break;case 268435456:o=Nu;break;default:o=rs}return u=Hb.bind(null,r),o=kt(o,u),r.callbackPriority=s,r.callbackNode=o,s}return u!==null&&u!==null&&at(u),r.callbackPriority=2,r.callbackNode=null,2}function Hb(r,s){if(sn!==0&&sn!==5)return r.callbackNode=null,r.callbackPriority=0,null;var o=r.callbackNode;if(Hd()&&r.callbackNode!==o)return null;var u=Ke;return u=Yr(r,r===_t?u:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),u===0?null:(Tb(r,u,s),qb(r,It()),r.callbackNode!=null&&r.callbackNode===o?Hb.bind(null,r):null)}function Gb(r,s){if(Hd())return null;Tb(r,s,!0)}function YC(){lA(function(){(lt&6)!==0?kt(qt,KC):Fb()})}function yp(){if(Rs===0){var r=Oo;r===0&&(r=Wr,Wr<<=1,(Wr&261888)===0&&(Wr=256)),Rs=r}return Rs}function $b(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:_o(""+r)}function Qb(r,s){var o=s.ownerDocument.createElement("input");return o.name=s.name,o.value=s.value,r.id&&o.setAttribute("form",r.id),s.parentNode.insertBefore(o,s),r=new FormData(r),o.parentNode.removeChild(o),r}function XC(r,s,o,u,g){if(s==="submit"&&o&&o.stateNode===g){var y=$b((g[un]||null).action),S=u.submitter;S&&(s=(s=S[un]||null)?$b(s.formAction):S.getAttribute("formAction"),s!==null&&(y=s,S=null));var P=new oi("action","action",null,u,g);r.push({event:P,listeners:[{instance:null,listener:function(){if(u.defaultPrevented){if(Rs!==0){var K=S?Qb(g,S):new FormData(g);Lm(o,{pending:!0,data:K,method:g.method,action:y},null,K)}}else typeof y=="function"&&(P.preventDefault(),K=S?Qb(g,S):new FormData(g),Lm(o,{pending:!0,data:K,method:g.method,action:y},y,K))},currentTarget:g}]})}}for(var _p=0;_p<em.length;_p++){var bp=em[_p],JC=bp.toLowerCase(),ZC=bp[0].toUpperCase()+bp.slice(1);Ur(JC,"on"+ZC)}Ur(w_,"onAnimationEnd"),Ur(T_,"onAnimationIteration"),Ur(C_,"onAnimationStart"),Ur("dblclick","onDoubleClick"),Ur("focusin","onFocus"),Ur("focusout","onBlur"),Ur(pC,"onTransitionRun"),Ur(gC,"onTransitionStart"),Ur(yC,"onTransitionCancel"),Ur(A_,"onTransitionEnd"),ri("onMouseEnter",["mouseout","mouseover"]),ri("onMouseLeave",["mouseout","mouseover"]),ri("onPointerEnter",["pointerout","pointerover"]),ri("onPointerLeave",["pointerout","pointerover"]),ni("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),ni("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),ni("onBeforeInput",["compositionend","keypress","textInput","paste"]),ni("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),ni("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),ni("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var kc="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),eA=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(kc));function Wb(r,s){s=(s&4)!==0;for(var o=0;o<r.length;o++){var u=r[o],g=u.event;u=u.listeners;e:{var y=void 0;if(s)for(var S=u.length-1;0<=S;S--){var P=u[S],K=P.instance,le=P.currentTarget;if(P=P.listener,K!==y&&g.isPropagationStopped())break e;y=P,g.currentTarget=le;try{y(g)}catch(ge){od(ge)}g.currentTarget=null,y=K}else for(S=0;S<u.length;S++){if(P=u[S],K=P.instance,le=P.currentTarget,P=P.listener,K!==y&&g.isPropagationStopped())break e;y=P,g.currentTarget=le;try{y(g)}catch(ge){od(ge)}g.currentTarget=null,y=K}}}}function We(r,s){var o=s[fo];o===void 0&&(o=s[fo]=new Set);var u=r+"__bubble";o.has(u)||(Kb(s,r,2,!1),o.add(u))}function vp(r,s,o){var u=0;s&&(u|=4),Kb(o,r,u,s)}var Qd="_reactListening"+Math.random().toString(36).slice(2);function xp(r){if(!r[Qd]){r[Qd]=!0,$l.forEach(function(o){o!=="selectionchange"&&(eA.has(o)||vp(o,!1,r),vp(o,!0,r))});var s=r.nodeType===9?r:r.ownerDocument;s===null||s[Qd]||(s[Qd]=!0,vp("selectionchange",!1,s))}}function Kb(r,s,o,u){switch(wv(s)){case 2:var g=RA;break;case 8:g=DA;break;default:g=Pp}o=g.bind(null,s,o,r),g=void 0,!ba||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(g=!0),u?g!==void 0?r.addEventListener(s,o,{capture:!0,passive:g}):r.addEventListener(s,o,!0):g!==void 0?r.addEventListener(s,o,{passive:g}):r.addEventListener(s,o,!1)}function Sp(r,s,o,u,g){var y=u;if((s&1)===0&&(s&2)===0&&u!==null)e:for(;;){if(u===null)return;var S=u.tag;if(S===3||S===4){var P=u.stateNode.containerInfo;if(P===g)break;if(S===4)for(S=u.return;S!==null;){var K=S.tag;if((K===3||K===4)&&S.stateNode.containerInfo===g)return;S=S.return}for(;P!==null;){if(S=ei(P),S===null)return;if(K=S.tag,K===5||K===6||K===26||K===27){u=y=S;continue e}P=P.parentNode}}u=u.return}cs(function(){var le=y,ge=mr(o),be=[];e:{var de=R_.get(r);if(de!==void 0){var pe=oi,Ae=r;switch(r){case"keypress":if(xa(o)===0)break e;case"keydown":case"keyup":pe=id;break;case"focusin":Ae="focus",pe=Ea;break;case"focusout":Ae="blur",pe=Ea;break;case"beforeblur":case"afterblur":pe=Ea;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":pe=sc;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":pe=Ku;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":pe=x;break;case w_:case T_:case C_:pe=Xu;break;case A_:pe=U;break;case"scroll":case"scrollend":pe=ic;break;case"wheel":pe=me;break;case"copy":case"cut":case"paste":pe=Ju;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":pe=Ri;break;case"toggle":case"beforetoggle":pe=Fe}var Oe=(s&4)!==0,yt=!Oe&&(r==="scroll"||r==="scrollend"),se=Oe?de!==null?de+"Capture":null:de;Oe=[];for(var Z=le,oe;Z!==null;){var ye=Z;if(oe=ye.stateNode,ye=ye.tag,ye!==5&&ye!==26&&ye!==27||oe===null||se===null||(ye=Pr(Z,se),ye!=null&&Oe.push(Nc(Z,ye,oe))),yt)break;Z=Z.return}0<Oe.length&&(de=new pe(de,Ae,null,o,ge),be.push({event:de,listeners:Oe}))}}if((s&7)===0){e:{if(de=r==="mouseover"||r==="pointerover",pe=r==="mouseout"||r==="pointerout",de&&o!==tc&&(Ae=o.relatedTarget||o.fromElement)&&(ei(Ae)||Ae[Jr]))break e;if((pe||de)&&(de=ge.window===ge?ge:(de=ge.ownerDocument)?de.defaultView||de.parentWindow:window,pe?(Ae=o.relatedTarget||o.toElement,pe=le,Ae=Ae?ei(Ae):null,Ae!==null&&(yt=l(Ae),Oe=Ae.tag,Ae!==yt||Oe!==5&&Oe!==27&&Oe!==6)&&(Ae=null)):(pe=null,Ae=le),pe!==Ae)){if(Oe=sc,ye="onMouseLeave",se="onMouseEnter",Z="mouse",(r==="pointerout"||r==="pointerover")&&(Oe=Ri,ye="onPointerLeave",se="onPointerEnter",Z="pointer"),yt=pe==null?de:Xn(pe),oe=Ae==null?de:Xn(Ae),de=new Oe(ye,Z+"leave",pe,o,ge),de.target=yt,de.relatedTarget=oe,ye=null,ei(ge)===le&&(Oe=new Oe(se,Z+"enter",Ae,o,ge),Oe.target=oe,Oe.relatedTarget=yt,ye=Oe),yt=ye,pe&&Ae)t:{for(Oe=tA,se=pe,Z=Ae,oe=0,ye=se;ye;ye=Oe(ye))oe++;ye=0;for(var je=Z;je;je=Oe(je))ye++;for(;0<oe-ye;)se=Oe(se),oe--;for(;0<ye-oe;)Z=Oe(Z),ye--;for(;oe--;){if(se===Z||Z!==null&&se===Z.alternate){Oe=se;break t}se=Oe(se),Z=Oe(Z)}Oe=null}else Oe=null;pe!==null&&Yb(be,de,pe,Oe,!1),Ae!==null&&yt!==null&&Yb(be,yt,Ae,Oe,!0)}}e:{if(de=le?Xn(le):window,pe=de.nodeName&&de.nodeName.toLowerCase(),pe==="select"||pe==="input"&&de.type==="file")var rt=f_;else if(d_(de))if(m_)rt=hC;else{rt=uC;var Re=cC}else pe=de.nodeName,!pe||pe.toLowerCase()!=="input"||de.type!=="checkbox"&&de.type!=="radio"?le&&yo(le.elementType)&&(rt=f_):rt=dC;if(rt&&(rt=rt(r,le))){h_(be,rt,o,ge);break e}Re&&Re(r,de,le),r==="focusout"&&le&&de.type==="number"&&le.memoizedProps.value!=null&&Jl(de,"number",de.value)}switch(Re=le?Xn(le):window,r){case"focusin":(d_(Re)||Re.contentEditable==="true")&&(To=Re,Xf=le,uc=null);break;case"focusout":uc=Xf=To=null;break;case"mousedown":Jf=!0;break;case"contextmenu":case"mouseup":case"dragend":Jf=!1,S_(be,o,ge);break;case"selectionchange":if(mC)break;case"keydown":case"keyup":S_(be,o,ge)}var Ge;if(ot)e:{switch(r){case"compositionstart":var Ye="onCompositionStart";break e;case"compositionend":Ye="onCompositionEnd";break e;case"compositionupdate":Ye="onCompositionUpdate";break e}Ye=void 0}else wo?wa(r,o)&&(Ye="onCompositionEnd"):r==="keydown"&&o.keyCode===229&&(Ye="onCompositionStart");Ye&&(ui&&o.locale!=="ko"&&(wo||Ye!=="onCompositionStart"?Ye==="onCompositionEnd"&&wo&&(Ge=rc()):(ai=ge,nc="value"in ai?ai.value:ai.textContent,wo=!0)),Re=Wd(le,Ye),0<Re.length&&(Ye=new ci(Ye,r,null,o,ge),be.push({event:Ye,listeners:Re}),Ge?Ye.data=Ge:(Ge=Eo(o),Ge!==null&&(Ye.data=Ge)))),(Ge=gr?sC(r,o):aC(r,o))&&(Ye=Wd(le,"onBeforeInput"),0<Ye.length&&(Re=new ci("onBeforeInput","beforeinput",null,o,ge),be.push({event:Re,listeners:Ye}),Re.data=Ge)),XC(be,r,le,o,ge)}Wb(be,s)})}function Nc(r,s,o){return{instance:r,listener:s,currentTarget:o}}function Wd(r,s){for(var o=s+"Capture",u=[];r!==null;){var g=r,y=g.stateNode;if(g=g.tag,g!==5&&g!==26&&g!==27||y===null||(g=Pr(r,o),g!=null&&u.unshift(Nc(r,g,y)),g=Pr(r,s),g!=null&&u.push(Nc(r,g,y))),r.tag===3)return u;r=r.return}return[]}function tA(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Yb(r,s,o,u,g){for(var y=s._reactName,S=[];o!==null&&o!==u;){var P=o,K=P.alternate,le=P.stateNode;if(P=P.tag,K!==null&&K===u)break;P!==5&&P!==26&&P!==27||le===null||(K=le,g?(le=Pr(o,y),le!=null&&S.unshift(Nc(o,le,K))):g||(le=Pr(o,y),le!=null&&S.push(Nc(o,le,K)))),o=o.return}S.length!==0&&r.push({event:s,listeners:S})}var nA=/\r\n?/g,rA=/\u0000|\uFFFD/g;function Xb(r){return(typeof r=="string"?r:""+r).replace(nA,`
`).replace(rA,"")}function Jb(r,s){return s=Xb(s),Xb(r)===s}function gt(r,s,o,u,g,y){switch(o){case"children":typeof u=="string"?s==="body"||s==="textarea"&&u===""||Bn(r,u):(typeof u=="number"||typeof u=="bigint")&&s!=="body"&&Bn(r,""+u);break;case"className":Jn(r,"class",u);break;case"tabIndex":Jn(r,"tabindex",u);break;case"dir":case"role":case"viewBox":case"width":case"height":Jn(r,o,u);break;case"style":ec(r,u,y);break;case"data":if(s!=="object"){Jn(r,"data",u);break}case"src":case"href":if(u===""&&(s!=="a"||o!=="href")){r.removeAttribute(o);break}if(u==null||typeof u=="function"||typeof u=="symbol"||typeof u=="boolean"){r.removeAttribute(o);break}u=_o(""+u),r.setAttribute(o,u);break;case"action":case"formAction":if(typeof u=="function"){r.setAttribute(o,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof y=="function"&&(o==="formAction"?(s!=="input"&&gt(r,s,"name",g.name,g,null),gt(r,s,"formEncType",g.formEncType,g,null),gt(r,s,"formMethod",g.formMethod,g,null),gt(r,s,"formTarget",g.formTarget,g,null)):(gt(r,s,"encType",g.encType,g,null),gt(r,s,"method",g.method,g,null),gt(r,s,"target",g.target,g,null)));if(u==null||typeof u=="symbol"||typeof u=="boolean"){r.removeAttribute(o);break}u=_o(""+u),r.setAttribute(o,u);break;case"onClick":u!=null&&(r.onclick=Nr);break;case"onScroll":u!=null&&We("scroll",r);break;case"onScrollEnd":u!=null&&We("scrollend",r);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(i(61));if(o=u.__html,o!=null){if(g.children!=null)throw Error(i(60));r.innerHTML=o}}break;case"multiple":r.multiple=u&&typeof u!="function"&&typeof u!="symbol";break;case"muted":r.muted=u&&typeof u!="function"&&typeof u!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(u==null||typeof u=="function"||typeof u=="boolean"||typeof u=="symbol"){r.removeAttribute("xlink:href");break}o=_o(""+u),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",o);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":u!=null&&typeof u!="function"&&typeof u!="symbol"?r.setAttribute(o,""+u):r.removeAttribute(o);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":u&&typeof u!="function"&&typeof u!="symbol"?r.setAttribute(o,""):r.removeAttribute(o);break;case"capture":case"download":u===!0?r.setAttribute(o,""):u!==!1&&u!=null&&typeof u!="function"&&typeof u!="symbol"?r.setAttribute(o,u):r.removeAttribute(o);break;case"cols":case"rows":case"size":case"span":u!=null&&typeof u!="function"&&typeof u!="symbol"&&!isNaN(u)&&1<=u?r.setAttribute(o,u):r.removeAttribute(o);break;case"rowSpan":case"start":u==null||typeof u=="function"||typeof u=="symbol"||isNaN(u)?r.removeAttribute(o):r.setAttribute(o,u);break;case"popover":We("beforetoggle",r),We("toggle",r),po(r,"popover",u);break;case"xlinkActuate":Qt(r,"http://www.w3.org/1999/xlink","xlink:actuate",u);break;case"xlinkArcrole":Qt(r,"http://www.w3.org/1999/xlink","xlink:arcrole",u);break;case"xlinkRole":Qt(r,"http://www.w3.org/1999/xlink","xlink:role",u);break;case"xlinkShow":Qt(r,"http://www.w3.org/1999/xlink","xlink:show",u);break;case"xlinkTitle":Qt(r,"http://www.w3.org/1999/xlink","xlink:title",u);break;case"xlinkType":Qt(r,"http://www.w3.org/1999/xlink","xlink:type",u);break;case"xmlBase":Qt(r,"http://www.w3.org/XML/1998/namespace","xml:base",u);break;case"xmlLang":Qt(r,"http://www.w3.org/XML/1998/namespace","xml:lang",u);break;case"xmlSpace":Qt(r,"http://www.w3.org/XML/1998/namespace","xml:space",u);break;case"is":po(r,"is",u);break;case"innerText":case"textContent":break;default:(!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(o=Wu.get(o)||o,po(r,o,u))}}function Ep(r,s,o,u,g,y){switch(o){case"style":ec(r,u,y);break;case"dangerouslySetInnerHTML":if(u!=null){if(typeof u!="object"||!("__html"in u))throw Error(i(61));if(o=u.__html,o!=null){if(g.children!=null)throw Error(i(60));r.innerHTML=o}}break;case"children":typeof u=="string"?Bn(r,u):(typeof u=="number"||typeof u=="bigint")&&Bn(r,""+u);break;case"onScroll":u!=null&&We("scroll",r);break;case"onScrollEnd":u!=null&&We("scrollend",r);break;case"onClick":u!=null&&(r.onclick=Nr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Ql.hasOwnProperty(o))e:{if(o[0]==="o"&&o[1]==="n"&&(g=o.endsWith("Capture"),s=o.slice(2,g?o.length-7:void 0),y=r[un]||null,y=y!=null?y[o]:null,typeof y=="function"&&r.removeEventListener(s,y,g),typeof u=="function")){typeof y!="function"&&y!==null&&(o in r?r[o]=null:r.hasAttribute(o)&&r.removeAttribute(o)),r.addEventListener(s,u,g);break e}o in r?r[o]=u:u===!0?r.setAttribute(o,""):po(r,o,u)}}}function xn(r,s,o){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":We("error",r),We("load",r);var u=!1,g=!1,y;for(y in o)if(o.hasOwnProperty(y)){var S=o[y];if(S!=null)switch(y){case"src":u=!0;break;case"srcSet":g=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:gt(r,s,y,S,o,null)}}g&&gt(r,s,"srcSet",o.srcSet,o,null),u&&gt(r,s,"src",o.src,o,null);return;case"input":We("invalid",r);var P=y=S=g=null,K=null,le=null;for(u in o)if(o.hasOwnProperty(u)){var ge=o[u];if(ge!=null)switch(u){case"name":g=ge;break;case"type":S=ge;break;case"checked":K=ge;break;case"defaultChecked":le=ge;break;case"value":y=ge;break;case"defaultValue":P=ge;break;case"children":case"dangerouslySetInnerHTML":if(ge!=null)throw Error(i(137,s));break;default:gt(r,s,u,ge,o,null)}}Gu(r,y,P,K,le,S,g,!1);return;case"select":We("invalid",r),u=S=y=null;for(g in o)if(o.hasOwnProperty(g)&&(P=o[g],P!=null))switch(g){case"value":y=P;break;case"defaultValue":S=P;break;case"multiple":u=P;default:gt(r,s,g,P,o,null)}s=y,o=S,r.multiple=!!u,s!=null?ss(r,!!u,s,!1):o!=null&&ss(r,!!u,o,!0);return;case"textarea":We("invalid",r),y=g=u=null;for(S in o)if(o.hasOwnProperty(S)&&(P=o[S],P!=null))switch(S){case"value":u=P;break;case"defaultValue":g=P;break;case"children":y=P;break;case"dangerouslySetInnerHTML":if(P!=null)throw Error(i(91));break;default:gt(r,s,S,P,o,null)}as(r,u,g,y);return;case"option":for(K in o)o.hasOwnProperty(K)&&(u=o[K],u!=null)&&(K==="selected"?r.selected=u&&typeof u!="function"&&typeof u!="symbol":gt(r,s,K,u,o,null));return;case"dialog":We("beforetoggle",r),We("toggle",r),We("cancel",r),We("close",r);break;case"iframe":case"object":We("load",r);break;case"video":case"audio":for(u=0;u<kc.length;u++)We(kc[u],r);break;case"image":We("error",r),We("load",r);break;case"details":We("toggle",r);break;case"embed":case"source":case"link":We("error",r),We("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(le in o)if(o.hasOwnProperty(le)&&(u=o[le],u!=null))switch(le){case"children":case"dangerouslySetInnerHTML":throw Error(i(137,s));default:gt(r,s,le,u,o,null)}return;default:if(yo(s)){for(ge in o)o.hasOwnProperty(ge)&&(u=o[ge],u!==void 0&&Ep(r,s,ge,u,o,void 0));return}}for(P in o)o.hasOwnProperty(P)&&(u=o[P],u!=null&&gt(r,s,P,u,o,null))}function iA(r,s,o,u){switch(s){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var g=null,y=null,S=null,P=null,K=null,le=null,ge=null;for(pe in o){var be=o[pe];if(o.hasOwnProperty(pe)&&be!=null)switch(pe){case"checked":break;case"value":break;case"defaultValue":K=be;default:u.hasOwnProperty(pe)||gt(r,s,pe,null,u,be)}}for(var de in u){var pe=u[de];if(be=o[de],u.hasOwnProperty(de)&&(pe!=null||be!=null))switch(de){case"type":y=pe;break;case"name":g=pe;break;case"checked":le=pe;break;case"defaultChecked":ge=pe;break;case"value":S=pe;break;case"defaultValue":P=pe;break;case"children":case"dangerouslySetInnerHTML":if(pe!=null)throw Error(i(137,s));break;default:pe!==be&&gt(r,s,de,pe,u,be)}}go(r,S,P,K,le,ge,y,g);return;case"select":pe=S=P=de=null;for(y in o)if(K=o[y],o.hasOwnProperty(y)&&K!=null)switch(y){case"value":break;case"multiple":pe=K;default:u.hasOwnProperty(y)||gt(r,s,y,null,u,K)}for(g in u)if(y=u[g],K=o[g],u.hasOwnProperty(g)&&(y!=null||K!=null))switch(g){case"value":de=y;break;case"defaultValue":P=y;break;case"multiple":S=y;default:y!==K&&gt(r,s,g,y,u,K)}s=P,o=S,u=pe,de!=null?ss(r,!!o,de,!1):!!u!=!!o&&(s!=null?ss(r,!!o,s,!0):ss(r,!!o,o?[]:"",!1));return;case"textarea":pe=de=null;for(P in o)if(g=o[P],o.hasOwnProperty(P)&&g!=null&&!u.hasOwnProperty(P))switch(P){case"value":break;case"children":break;default:gt(r,s,P,null,u,g)}for(S in u)if(g=u[S],y=o[S],u.hasOwnProperty(S)&&(g!=null||y!=null))switch(S){case"value":de=g;break;case"defaultValue":pe=g;break;case"children":break;case"dangerouslySetInnerHTML":if(g!=null)throw Error(i(91));break;default:g!==y&&gt(r,s,S,g,u,y)}$u(r,de,pe);return;case"option":for(var Ae in o)de=o[Ae],o.hasOwnProperty(Ae)&&de!=null&&!u.hasOwnProperty(Ae)&&(Ae==="selected"?r.selected=!1:gt(r,s,Ae,null,u,de));for(K in u)de=u[K],pe=o[K],u.hasOwnProperty(K)&&de!==pe&&(de!=null||pe!=null)&&(K==="selected"?r.selected=de&&typeof de!="function"&&typeof de!="symbol":gt(r,s,K,de,u,pe));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Oe in o)de=o[Oe],o.hasOwnProperty(Oe)&&de!=null&&!u.hasOwnProperty(Oe)&&gt(r,s,Oe,null,u,de);for(le in u)if(de=u[le],pe=o[le],u.hasOwnProperty(le)&&de!==pe&&(de!=null||pe!=null))switch(le){case"children":case"dangerouslySetInnerHTML":if(de!=null)throw Error(i(137,s));break;default:gt(r,s,le,de,u,pe)}return;default:if(yo(s)){for(var yt in o)de=o[yt],o.hasOwnProperty(yt)&&de!==void 0&&!u.hasOwnProperty(yt)&&Ep(r,s,yt,void 0,u,de);for(ge in u)de=u[ge],pe=o[ge],!u.hasOwnProperty(ge)||de===pe||de===void 0&&pe===void 0||Ep(r,s,ge,de,u,pe);return}}for(var se in o)de=o[se],o.hasOwnProperty(se)&&de!=null&&!u.hasOwnProperty(se)&&gt(r,s,se,null,u,de);for(be in u)de=u[be],pe=o[be],!u.hasOwnProperty(be)||de===pe||de==null&&pe==null||gt(r,s,be,de,u,pe)}function Zb(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function sA(){if(typeof performance.getEntriesByType=="function"){for(var r=0,s=0,o=performance.getEntriesByType("resource"),u=0;u<o.length;u++){var g=o[u],y=g.transferSize,S=g.initiatorType,P=g.duration;if(y&&P&&Zb(S)){for(S=0,P=g.responseEnd,u+=1;u<o.length;u++){var K=o[u],le=K.startTime;if(le>P)break;var ge=K.transferSize,be=K.initiatorType;ge&&Zb(be)&&(K=K.responseEnd,S+=ge*(K<P?1:(P-le)/(K-le)))}if(--u,s+=8*(y+S)/(g.duration/1e3),r++,10<r)break}}if(0<r)return s/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var wp=null,Tp=null;function Kd(r){return r.nodeType===9?r:r.ownerDocument}function ev(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function tv(r,s){if(r===0)switch(s){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&s==="foreignObject"?0:r}function Cp(r,s){return r==="textarea"||r==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.children=="bigint"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Ap=null;function aA(){var r=window.event;return r&&r.type==="popstate"?r===Ap?!1:(Ap=r,!0):(Ap=null,!1)}var nv=typeof setTimeout=="function"?setTimeout:void 0,oA=typeof clearTimeout=="function"?clearTimeout:void 0,rv=typeof Promise=="function"?Promise:void 0,lA=typeof queueMicrotask=="function"?queueMicrotask:typeof rv<"u"?function(r){return rv.resolve(null).then(r).catch(cA)}:nv;function cA(r){setTimeout(function(){throw r})}function Ds(r){return r==="head"}function iv(r,s){var o=s,u=0;do{var g=o.nextSibling;if(r.removeChild(o),g&&g.nodeType===8)if(o=g.data,o==="/$"||o==="/&"){if(u===0){r.removeChild(g),Jo(s);return}u--}else if(o==="$"||o==="$?"||o==="$~"||o==="$!"||o==="&")u++;else if(o==="html")Pc(r.ownerDocument.documentElement);else if(o==="head"){o=r.ownerDocument.head,Pc(o);for(var y=o.firstChild;y;){var S=y.nextSibling,P=y.nodeName;y[Zr]||P==="SCRIPT"||P==="STYLE"||P==="LINK"&&y.rel.toLowerCase()==="stylesheet"||o.removeChild(y),y=S}}else o==="body"&&Pc(r.ownerDocument.body);o=g}while(o);Jo(s)}function sv(r,s){var o=r;r=0;do{var u=o.nextSibling;if(o.nodeType===1?s?(o._stashedDisplay=o.style.display,o.style.display="none"):(o.style.display=o._stashedDisplay||"",o.getAttribute("style")===""&&o.removeAttribute("style")):o.nodeType===3&&(s?(o._stashedText=o.nodeValue,o.nodeValue=""):o.nodeValue=o._stashedText||""),u&&u.nodeType===8)if(o=u.data,o==="/$"){if(r===0)break;r--}else o!=="$"&&o!=="$?"&&o!=="$~"&&o!=="$!"||r++;o=u}while(o)}function Rp(r){var s=r.firstChild;for(s&&s.nodeType===10&&(s=s.nextSibling);s;){var o=s;switch(s=s.nextSibling,o.nodeName){case"HTML":case"HEAD":case"BODY":Rp(o),mo(o);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(o.rel.toLowerCase()==="stylesheet")continue}r.removeChild(o)}}function uA(r,s,o,u){for(;r.nodeType===1;){var g=o;if(r.nodeName.toLowerCase()!==s.toLowerCase()){if(!u&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(u){if(!r[Zr])switch(s){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(y=r.getAttribute("rel"),y==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(y!==g.rel||r.getAttribute("href")!==(g.href==null||g.href===""?null:g.href)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin)||r.getAttribute("title")!==(g.title==null?null:g.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(y=r.getAttribute("src"),(y!==(g.src==null?null:g.src)||r.getAttribute("type")!==(g.type==null?null:g.type)||r.getAttribute("crossorigin")!==(g.crossOrigin==null?null:g.crossOrigin))&&y&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(s==="input"&&r.type==="hidden"){var y=g.name==null?null:""+g.name;if(g.type==="hidden"&&r.getAttribute("name")===y)return r}else return r;if(r=Er(r.nextSibling),r===null)break}return null}function dA(r,s,o){if(s==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!o||(r=Er(r.nextSibling),r===null))return null;return r}function av(r,s){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!s||(r=Er(r.nextSibling),r===null))return null;return r}function Dp(r){return r.data==="$?"||r.data==="$~"}function jp(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function hA(r,s){var o=r.ownerDocument;if(r.data==="$~")r._reactRetry=s;else if(r.data!=="$?"||o.readyState!=="loading")s();else{var u=function(){s(),o.removeEventListener("DOMContentLoaded",u)};o.addEventListener("DOMContentLoaded",u),r._reactRetry=u}}function Er(r){for(;r!=null;r=r.nextSibling){var s=r.nodeType;if(s===1||s===3)break;if(s===8){if(s=r.data,s==="$"||s==="$!"||s==="$?"||s==="$~"||s==="&"||s==="F!"||s==="F")break;if(s==="/$"||s==="/&")return null}}return r}var Ip=null;function ov(r){r=r.nextSibling;for(var s=0;r;){if(r.nodeType===8){var o=r.data;if(o==="/$"||o==="/&"){if(s===0)return Er(r.nextSibling);s--}else o!=="$"&&o!=="$!"&&o!=="$?"&&o!=="$~"&&o!=="&"||s++}r=r.nextSibling}return null}function lv(r){r=r.previousSibling;for(var s=0;r;){if(r.nodeType===8){var o=r.data;if(o==="$"||o==="$!"||o==="$?"||o==="$~"||o==="&"){if(s===0)return r;s--}else o!=="/$"&&o!=="/&"||s++}r=r.previousSibling}return null}function cv(r,s,o){switch(s=Kd(o),r){case"html":if(r=s.documentElement,!r)throw Error(i(452));return r;case"head":if(r=s.head,!r)throw Error(i(453));return r;case"body":if(r=s.body,!r)throw Error(i(454));return r;default:throw Error(i(451))}}function Pc(r){for(var s=r.attributes;s.length;)r.removeAttributeNode(s[0]);mo(r)}var wr=new Map,uv=new Set;function Yd(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var qi=G.d;G.d={f:fA,r:mA,D:pA,C:gA,L:yA,m:_A,X:vA,S:bA,M:xA};function fA(){var r=qi.f(),s=zd();return r||s}function mA(r){var s=fr(r);s!==null&&s.tag===5&&s.type==="form"?A0(s):qi.r(r)}var Ko=typeof document>"u"?null:document;function dv(r,s,o){var u=Ko;if(u&&typeof s=="string"&&s){var g=Ln(s);g='link[rel="'+r+'"][href="'+g+'"]',typeof o=="string"&&(g+='[crossorigin="'+o+'"]'),uv.has(g)||(uv.add(g),r={rel:r,crossOrigin:o,href:s},u.querySelector(g)===null&&(s=u.createElement("link"),xn(s,"link",r),$t(s),u.head.appendChild(s)))}}function pA(r){qi.D(r),dv("dns-prefetch",r,null)}function gA(r,s){qi.C(r,s),dv("preconnect",r,s)}function yA(r,s,o){qi.L(r,s,o);var u=Ko;if(u&&r&&s){var g='link[rel="preload"][as="'+Ln(s)+'"]';s==="image"&&o&&o.imageSrcSet?(g+='[imagesrcset="'+Ln(o.imageSrcSet)+'"]',typeof o.imageSizes=="string"&&(g+='[imagesizes="'+Ln(o.imageSizes)+'"]')):g+='[href="'+Ln(r)+'"]';var y=g;switch(s){case"style":y=Yo(r);break;case"script":y=Xo(r)}wr.has(y)||(r=b({rel:"preload",href:s==="image"&&o&&o.imageSrcSet?void 0:r,as:s},o),wr.set(y,r),u.querySelector(g)!==null||s==="style"&&u.querySelector(Lc(y))||s==="script"&&u.querySelector(Bc(y))||(s=u.createElement("link"),xn(s,"link",r),$t(s),u.head.appendChild(s)))}}function _A(r,s){qi.m(r,s);var o=Ko;if(o&&r){var u=s&&typeof s.as=="string"?s.as:"script",g='link[rel="modulepreload"][as="'+Ln(u)+'"][href="'+Ln(r)+'"]',y=g;switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":y=Xo(r)}if(!wr.has(y)&&(r=b({rel:"modulepreload",href:r},s),wr.set(y,r),o.querySelector(g)===null)){switch(u){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(o.querySelector(Bc(y)))return}u=o.createElement("link"),xn(u,"link",r),$t(u),o.head.appendChild(u)}}}function bA(r,s,o){qi.S(r,s,o);var u=Ko;if(u&&r){var g=ti(u).hoistableStyles,y=Yo(r);s=s||"default";var S=g.get(y);if(!S){var P={loading:0,preload:null};if(S=u.querySelector(Lc(y)))P.loading=5;else{r=b({rel:"stylesheet",href:r,"data-precedence":s},o),(o=wr.get(y))&&Mp(r,o);var K=S=u.createElement("link");$t(K),xn(K,"link",r),K._p=new Promise(function(le,ge){K.onload=le,K.onerror=ge}),K.addEventListener("load",function(){P.loading|=1}),K.addEventListener("error",function(){P.loading|=2}),P.loading|=4,Xd(S,s,u)}S={type:"stylesheet",instance:S,count:1,state:P},g.set(y,S)}}}function vA(r,s){qi.X(r,s);var o=Ko;if(o&&r){var u=ti(o).hoistableScripts,g=Xo(r),y=u.get(g);y||(y=o.querySelector(Bc(g)),y||(r=b({src:r,async:!0},s),(s=wr.get(g))&&Op(r,s),y=o.createElement("script"),$t(y),xn(y,"link",r),o.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},u.set(g,y))}}function xA(r,s){qi.M(r,s);var o=Ko;if(o&&r){var u=ti(o).hoistableScripts,g=Xo(r),y=u.get(g);y||(y=o.querySelector(Bc(g)),y||(r=b({src:r,async:!0,type:"module"},s),(s=wr.get(g))&&Op(r,s),y=o.createElement("script"),$t(y),xn(y,"link",r),o.head.appendChild(y)),y={type:"script",instance:y,count:1,state:null},u.set(g,y))}}function hv(r,s,o,u){var g=(g=ue.current)?Yd(g):null;if(!g)throw Error(i(446));switch(r){case"meta":case"title":return null;case"style":return typeof o.precedence=="string"&&typeof o.href=="string"?(s=Yo(o.href),o=ti(g).hoistableStyles,u=o.get(s),u||(u={type:"style",instance:null,count:0,state:null},o.set(s,u)),u):{type:"void",instance:null,count:0,state:null};case"link":if(o.rel==="stylesheet"&&typeof o.href=="string"&&typeof o.precedence=="string"){r=Yo(o.href);var y=ti(g).hoistableStyles,S=y.get(r);if(S||(g=g.ownerDocument||g,S={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},y.set(r,S),(y=g.querySelector(Lc(r)))&&!y._p&&(S.instance=y,S.state.loading=5),wr.has(r)||(o={rel:"preload",as:"style",href:o.href,crossOrigin:o.crossOrigin,integrity:o.integrity,media:o.media,hrefLang:o.hrefLang,referrerPolicy:o.referrerPolicy},wr.set(r,o),y||SA(g,r,o,S.state))),s&&u===null)throw Error(i(528,""));return S}if(s&&u!==null)throw Error(i(529,""));return null;case"script":return s=o.async,o=o.src,typeof o=="string"&&s&&typeof s!="function"&&typeof s!="symbol"?(s=Xo(o),o=ti(g).hoistableScripts,u=o.get(s),u||(u={type:"script",instance:null,count:0,state:null},o.set(s,u)),u):{type:"void",instance:null,count:0,state:null};default:throw Error(i(444,r))}}function Yo(r){return'href="'+Ln(r)+'"'}function Lc(r){return'link[rel="stylesheet"]['+r+"]"}function fv(r){return b({},r,{"data-precedence":r.precedence,precedence:null})}function SA(r,s,o,u){r.querySelector('link[rel="preload"][as="style"]['+s+"]")?u.loading=1:(s=r.createElement("link"),u.preload=s,s.addEventListener("load",function(){return u.loading|=1}),s.addEventListener("error",function(){return u.loading|=2}),xn(s,"link",o),$t(s),r.head.appendChild(s))}function Xo(r){return'[src="'+Ln(r)+'"]'}function Bc(r){return"script[async]"+r}function mv(r,s,o){if(s.count++,s.instance===null)switch(s.type){case"style":var u=r.querySelector('style[data-href~="'+Ln(o.href)+'"]');if(u)return s.instance=u,$t(u),u;var g=b({},o,{"data-href":o.href,"data-precedence":o.precedence,href:null,precedence:null});return u=(r.ownerDocument||r).createElement("style"),$t(u),xn(u,"style",g),Xd(u,o.precedence,r),s.instance=u;case"stylesheet":g=Yo(o.href);var y=r.querySelector(Lc(g));if(y)return s.state.loading|=4,s.instance=y,$t(y),y;u=fv(o),(g=wr.get(g))&&Mp(u,g),y=(r.ownerDocument||r).createElement("link"),$t(y);var S=y;return S._p=new Promise(function(P,K){S.onload=P,S.onerror=K}),xn(y,"link",u),s.state.loading|=4,Xd(y,o.precedence,r),s.instance=y;case"script":return y=Xo(o.src),(g=r.querySelector(Bc(y)))?(s.instance=g,$t(g),g):(u=o,(g=wr.get(y))&&(u=b({},o),Op(u,g)),r=r.ownerDocument||r,g=r.createElement("script"),$t(g),xn(g,"link",u),r.head.appendChild(g),s.instance=g);case"void":return null;default:throw Error(i(443,s.type))}else s.type==="stylesheet"&&(s.state.loading&4)===0&&(u=s.instance,s.state.loading|=4,Xd(u,o.precedence,r));return s.instance}function Xd(r,s,o){for(var u=o.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),g=u.length?u[u.length-1]:null,y=g,S=0;S<u.length;S++){var P=u[S];if(P.dataset.precedence===s)y=P;else if(y!==g)break}y?y.parentNode.insertBefore(r,y.nextSibling):(s=o.nodeType===9?o.head:o,s.insertBefore(r,s.firstChild))}function Mp(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.title==null&&(r.title=s.title)}function Op(r,s){r.crossOrigin==null&&(r.crossOrigin=s.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=s.referrerPolicy),r.integrity==null&&(r.integrity=s.integrity)}var Jd=null;function pv(r,s,o){if(Jd===null){var u=new Map,g=Jd=new Map;g.set(o,u)}else g=Jd,u=g.get(o),u||(u=new Map,g.set(o,u));if(u.has(r))return u;for(u.set(r,null),o=o.getElementsByTagName(r),g=0;g<o.length;g++){var y=o[g];if(!(y[Zr]||y[Gt]||r==="link"&&y.getAttribute("rel")==="stylesheet")&&y.namespaceURI!=="http://www.w3.org/2000/svg"){var S=y.getAttribute(s)||"";S=r+S;var P=u.get(S);P?P.push(y):u.set(S,[y])}}return u}function gv(r,s,o){r=r.ownerDocument||r,r.head.insertBefore(o,s==="title"?r.querySelector("head > title"):null)}function EA(r,s,o){if(o===1||s.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof s.precedence!="string"||typeof s.href!="string"||s.href==="")break;return!0;case"link":if(typeof s.rel!="string"||typeof s.href!="string"||s.href===""||s.onLoad||s.onError)break;return s.rel==="stylesheet"?(r=s.disabled,typeof s.precedence=="string"&&r==null):!0;case"script":if(s.async&&typeof s.async!="function"&&typeof s.async!="symbol"&&!s.onLoad&&!s.onError&&s.src&&typeof s.src=="string")return!0}return!1}function yv(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function wA(r,s,o,u){if(o.type==="stylesheet"&&(typeof u.media!="string"||matchMedia(u.media).matches!==!1)&&(o.state.loading&4)===0){if(o.instance===null){var g=Yo(u.href),y=s.querySelector(Lc(g));if(y){s=y._p,s!==null&&typeof s=="object"&&typeof s.then=="function"&&(r.count++,r=Zd.bind(r),s.then(r,r)),o.state.loading|=4,o.instance=y,$t(y);return}y=s.ownerDocument||s,u=fv(u),(g=wr.get(g))&&Mp(u,g),y=y.createElement("link"),$t(y);var S=y;S._p=new Promise(function(P,K){S.onload=P,S.onerror=K}),xn(y,"link",u),o.instance=y}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(o,s),(s=o.state.preload)&&(o.state.loading&3)===0&&(r.count++,o=Zd.bind(r),s.addEventListener("load",o),s.addEventListener("error",o))}}var kp=0;function TA(r,s){return r.stylesheets&&r.count===0&&th(r,r.stylesheets),0<r.count||0<r.imgCount?function(o){var u=setTimeout(function(){if(r.stylesheets&&th(r,r.stylesheets),r.unsuspend){var y=r.unsuspend;r.unsuspend=null,y()}},6e4+s);0<r.imgBytes&&kp===0&&(kp=62500*sA());var g=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&th(r,r.stylesheets),r.unsuspend)){var y=r.unsuspend;r.unsuspend=null,y()}},(r.imgBytes>kp?50:800)+s);return r.unsuspend=o,function(){r.unsuspend=null,clearTimeout(u),clearTimeout(g)}}:null}function Zd(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)th(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var eh=null;function th(r,s){r.stylesheets=null,r.unsuspend!==null&&(r.count++,eh=new Map,s.forEach(CA,r),eh=null,Zd.call(r))}function CA(r,s){if(!(s.state.loading&4)){var o=eh.get(r);if(o)var u=o.get(null);else{o=new Map,eh.set(r,o);for(var g=r.querySelectorAll("link[data-precedence],style[data-precedence]"),y=0;y<g.length;y++){var S=g[y];(S.nodeName==="LINK"||S.getAttribute("media")!=="not all")&&(o.set(S.dataset.precedence,S),u=S)}u&&o.set(null,u)}g=s.instance,S=g.getAttribute("data-precedence"),y=o.get(S)||u,y===u&&o.set(null,g),o.set(S,g),this.count++,u=Zd.bind(this),g.addEventListener("load",u),g.addEventListener("error",u),y?y.parentNode.insertBefore(g,y.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(g,r.firstChild)),s.state.loading|=4}}var Vc={$$typeof:B,Provider:null,Consumer:null,_currentValue:W,_currentValue2:W,_threadCount:0};function AA(r,s,o,u,g,y,S,P,K){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Xr(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Xr(0),this.hiddenUpdates=Xr(null),this.identifierPrefix=u,this.onUncaughtError=g,this.onCaughtError=y,this.onRecoverableError=S,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=K,this.incompleteTransitions=new Map}function _v(r,s,o,u,g,y,S,P,K,le,ge,be){return r=new AA(r,s,o,S,K,le,ge,be,P),s=1,y===!0&&(s|=24),y=er(3,null,null,s),r.current=y,y.stateNode=r,s=fm(),s.refCount++,r.pooledCache=s,s.refCount++,y.memoizedState={element:u,isDehydrated:o,cache:s},ym(y),r}function bv(r){return r?(r=Ro,r):Ro}function vv(r,s,o,u,g,y){g=bv(g),u.context===null?u.context=g:u.pendingContext=g,u=_s(s),u.payload={element:o},y=y===void 0?null:y,y!==null&&(u.callback=y),o=bs(r,u,s),o!==null&&(qn(o,r,s),yc(o,r,s))}function xv(r,s){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var o=r.retryLane;r.retryLane=o!==0&&o<s?o:s}}function Np(r,s){xv(r,s),(r=r.alternate)&&xv(r,s)}function Sv(r){if(r.tag===13||r.tag===31){var s=Aa(r,67108864);s!==null&&qn(s,r,67108864),Np(r,67108864)}}function Ev(r){if(r.tag===13||r.tag===31){var s=sr();s=pa(s);var o=Aa(r,s);o!==null&&qn(o,r,s),Np(r,s)}}var nh=!0;function RA(r,s,o,u){var g=N.T;N.T=null;var y=G.p;try{G.p=2,Pp(r,s,o,u)}finally{G.p=y,N.T=g}}function DA(r,s,o,u){var g=N.T;N.T=null;var y=G.p;try{G.p=8,Pp(r,s,o,u)}finally{G.p=y,N.T=g}}function Pp(r,s,o,u){if(nh){var g=Lp(u);if(g===null)Sp(r,s,u,rh,o),Tv(r,u);else if(IA(g,r,s,o,u))u.stopPropagation();else if(Tv(r,u),s&4&&-1<jA.indexOf(r)){for(;g!==null;){var y=fr(g);if(y!==null)switch(y.tag){case 3:if(y=y.stateNode,y.current.memoizedState.isDehydrated){var S=Kr(y.pendingLanes);if(S!==0){var P=y;for(P.pendingLanes|=2,P.entangledLanes|=2;S;){var K=1<<31-Nt(S);P.entanglements[1]|=K,S&=~K}mi(y),(lt&6)===0&&(Vd=It()+500,Oc(0))}}break;case 31:case 13:P=Aa(y,2),P!==null&&qn(P,y,2),zd(),Np(y,2)}if(y=Lp(u),y===null&&Sp(r,s,u,rh,o),y===g)break;g=y}g!==null&&u.stopPropagation()}else Sp(r,s,u,null,o)}}function Lp(r){return r=mr(r),Bp(r)}var rh=null;function Bp(r){if(rh=null,r=ei(r),r!==null){var s=l(r);if(s===null)r=null;else{var o=s.tag;if(o===13){if(r=c(s),r!==null)return r;r=null}else if(o===31){if(r=h(s),r!==null)return r;r=null}else if(o===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;r=null}else s!==r&&(r=null)}}return rh=r,null}function wv(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Kn()){case qt:return 2;case Yn:return 8;case rs:case Hf:return 32;case Nu:return 268435456;default:return 32}default:return 32}}var Vp=!1,js=null,Is=null,Ms=null,Uc=new Map,zc=new Map,Os=[],jA="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Tv(r,s){switch(r){case"focusin":case"focusout":js=null;break;case"dragenter":case"dragleave":Is=null;break;case"mouseover":case"mouseout":Ms=null;break;case"pointerover":case"pointerout":Uc.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":zc.delete(s.pointerId)}}function Fc(r,s,o,u,g,y){return r===null||r.nativeEvent!==y?(r={blockedOn:s,domEventName:o,eventSystemFlags:u,nativeEvent:y,targetContainers:[g]},s!==null&&(s=fr(s),s!==null&&Sv(s)),r):(r.eventSystemFlags|=u,s=r.targetContainers,g!==null&&s.indexOf(g)===-1&&s.push(g),r)}function IA(r,s,o,u,g){switch(s){case"focusin":return js=Fc(js,r,s,o,u,g),!0;case"dragenter":return Is=Fc(Is,r,s,o,u,g),!0;case"mouseover":return Ms=Fc(Ms,r,s,o,u,g),!0;case"pointerover":var y=g.pointerId;return Uc.set(y,Fc(Uc.get(y)||null,r,s,o,u,g)),!0;case"gotpointercapture":return y=g.pointerId,zc.set(y,Fc(zc.get(y)||null,r,s,o,u,g)),!0}return!1}function Cv(r){var s=ei(r.target);if(s!==null){var o=l(s);if(o!==null){if(s=o.tag,s===13){if(s=c(o),s!==null){r.blockedOn=s,Or(r.priority,function(){Ev(o)});return}}else if(s===31){if(s=h(o),s!==null){r.blockedOn=s,Or(r.priority,function(){Ev(o)});return}}else if(s===3&&o.stateNode.current.memoizedState.isDehydrated){r.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}r.blockedOn=null}function ih(r){if(r.blockedOn!==null)return!1;for(var s=r.targetContainers;0<s.length;){var o=Lp(r.nativeEvent);if(o===null){o=r.nativeEvent;var u=new o.constructor(o.type,o);tc=u,o.target.dispatchEvent(u),tc=null}else return s=fr(o),s!==null&&Sv(s),r.blockedOn=o,!1;s.shift()}return!0}function Av(r,s,o){ih(r)&&o.delete(s)}function MA(){Vp=!1,js!==null&&ih(js)&&(js=null),Is!==null&&ih(Is)&&(Is=null),Ms!==null&&ih(Ms)&&(Ms=null),Uc.forEach(Av),zc.forEach(Av)}function sh(r,s){r.blockedOn===s&&(r.blockedOn=null,Vp||(Vp=!0,t.unstable_scheduleCallback(t.unstable_NormalPriority,MA)))}var ah=null;function Rv(r){ah!==r&&(ah=r,t.unstable_scheduleCallback(t.unstable_NormalPriority,function(){ah===r&&(ah=null);for(var s=0;s<r.length;s+=3){var o=r[s],u=r[s+1],g=r[s+2];if(typeof u!="function"){if(Bp(u||o)===null)continue;break}var y=fr(o);y!==null&&(r.splice(s,3),s-=3,Lm(y,{pending:!0,data:g,method:o.method,action:u},u,g))}}))}function Jo(r){function s(K){return sh(K,r)}js!==null&&sh(js,r),Is!==null&&sh(Is,r),Ms!==null&&sh(Ms,r),Uc.forEach(s),zc.forEach(s);for(var o=0;o<Os.length;o++){var u=Os[o];u.blockedOn===r&&(u.blockedOn=null)}for(;0<Os.length&&(o=Os[0],o.blockedOn===null);)Cv(o),o.blockedOn===null&&Os.shift();if(o=(r.ownerDocument||r).$$reactFormReplay,o!=null)for(u=0;u<o.length;u+=3){var g=o[u],y=o[u+1],S=g[un]||null;if(typeof y=="function")S||Rv(o);else if(S){var P=null;if(y&&y.hasAttribute("formAction")){if(g=y,S=y[un]||null)P=S.formAction;else if(Bp(g)!==null)continue}else P=S.action;typeof P=="function"?o[u+1]=P:(o.splice(u,3),u-=3),Rv(o)}}}function Dv(){function r(y){y.canIntercept&&y.info==="react-transition"&&y.intercept({handler:function(){return new Promise(function(S){return g=S})},focusReset:"manual",scroll:"manual"})}function s(){g!==null&&(g(),g=null),u||setTimeout(o,20)}function o(){if(!u&&!navigation.transition){var y=navigation.currentEntry;y&&y.url!=null&&navigation.navigate(y.url,{state:y.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var u=!1,g=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",s),navigation.addEventListener("navigateerror",s),setTimeout(o,100),function(){u=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",s),navigation.removeEventListener("navigateerror",s),g!==null&&(g(),g=null)}}}function Up(r){this._internalRoot=r}oh.prototype.render=Up.prototype.render=function(r){var s=this._internalRoot;if(s===null)throw Error(i(409));var o=s.current,u=sr();vv(o,u,r,s,null,null)},oh.prototype.unmount=Up.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var s=r.containerInfo;vv(r.current,2,null,r,null,null),zd(),s[Jr]=null}};function oh(r){this._internalRoot=r}oh.prototype.unstable_scheduleHydration=function(r){if(r){var s=zu();r={blockedOn:null,target:r,priority:s};for(var o=0;o<Os.length&&s!==0&&s<Os[o].priority;o++);Os.splice(o,0,r),o===0&&Cv(r)}};var jv=e.version;if(jv!=="19.2.3")throw Error(i(527,jv,"19.2.3"));G.findDOMNode=function(r){var s=r._reactInternals;if(s===void 0)throw typeof r.render=="function"?Error(i(188)):(r=Object.keys(r).join(","),Error(i(268,r)));return r=p(s),r=r!==null?_(r):null,r=r===null?null:r.stateNode,r};var OA={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:N,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var lh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lh.isDisabled&&lh.supportsFiber)try{Ir=lh.inject(OA),gn=lh}catch{}}return Hc.createRoot=function(r,s){if(!a(r))throw Error(i(299));var o=!1,u="",g=L0,y=B0,S=V0;return s!=null&&(s.unstable_strictMode===!0&&(o=!0),s.identifierPrefix!==void 0&&(u=s.identifierPrefix),s.onUncaughtError!==void 0&&(g=s.onUncaughtError),s.onCaughtError!==void 0&&(y=s.onCaughtError),s.onRecoverableError!==void 0&&(S=s.onRecoverableError)),s=_v(r,1,!1,null,null,o,u,null,g,y,S,Dv),r[Jr]=s.current,xp(r),new Up(s)},Hc.hydrateRoot=function(r,s,o){if(!a(r))throw Error(i(299));var u=!1,g="",y=L0,S=B0,P=V0,K=null;return o!=null&&(o.unstable_strictMode===!0&&(u=!0),o.identifierPrefix!==void 0&&(g=o.identifierPrefix),o.onUncaughtError!==void 0&&(y=o.onUncaughtError),o.onCaughtError!==void 0&&(S=o.onCaughtError),o.onRecoverableError!==void 0&&(P=o.onRecoverableError),o.formState!==void 0&&(K=o.formState)),s=_v(r,1,!0,s,o??null,u,g,K,y,S,P,Dv),s.context=bv(null),o=s.current,u=sr(),u=pa(u),g=_s(u),g.callback=null,bs(o,g,u),o=u,s.current.lanes=o,fa(s,o),mi(s),r[Jr]=s.current,xp(r),new oh(s)},Hc.version="19.2.3",Hc}var Uv;function qA(){if(Uv)return qp.exports;Uv=1;function t(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(t)}catch(e){console.error(e)}}return t(),qp.exports=FA(),qp.exports}var HA=qA();var zv="popstate";function GA(t={}){function e(i,a){let{pathname:l,search:c,hash:h}=i.location;return fg("",{pathname:l,search:c,hash:h},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function n(i,a){return typeof a=="string"?a:iu(a)}return QA(e,n,null,t)}function Rt(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function lr(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function $A(){return Math.random().toString(36).substring(2,10)}function Fv(t,e){return{usr:t.state,key:t.key,idx:e}}function fg(t,e,n=null,i){return{pathname:typeof t=="string"?t:t.pathname,search:"",hash:"",...typeof e=="string"?Al(e):e,state:n,key:e&&e.key||i||$A()}}function iu({pathname:t="/",search:e="",hash:n=""}){return e&&e!=="?"&&(t+=e.charAt(0)==="?"?e:"?"+e),n&&n!=="#"&&(t+=n.charAt(0)==="#"?n:"#"+n),t}function Al(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substring(n),t=t.substring(0,n));let i=t.indexOf("?");i>=0&&(e.search=t.substring(i),t=t.substring(0,i)),t&&(e.pathname=t)}return e}function QA(t,e,n,i={}){let{window:a=document.defaultView,v5Compat:l=!1}=i,c=a.history,h="POP",f=null,p=_();p==null&&(p=0,c.replaceState({...c.state,idx:p},""));function _(){return(c.state||{idx:null}).idx}function b(){h="POP";let D=_(),L=D==null?null:D-p;p=D,f&&f({action:h,location:w.location,delta:L})}function v(D,L){h="PUSH";let q=fg(w.location,D,L);p=_()+1;let B=Fv(q,p),ee=w.createHref(q);try{c.pushState(B,"",ee)}catch(Q){if(Q instanceof DOMException&&Q.name==="DataCloneError")throw Q;a.location.assign(ee)}l&&f&&f({action:h,location:w.location,delta:1})}function T(D,L){h="REPLACE";let q=fg(w.location,D,L);p=_();let B=Fv(q,p),ee=w.createHref(q);c.replaceState(B,"",ee),l&&f&&f({action:h,location:w.location,delta:0})}function E(D){return WA(D)}let w={get action(){return h},get location(){return t(a,c)},listen(D){if(f)throw new Error("A history only accepts one active listener");return a.addEventListener(zv,b),f=D,()=>{a.removeEventListener(zv,b),f=null}},createHref(D){return e(a,D)},createURL:E,encodeLocation(D){let L=E(D);return{pathname:L.pathname,search:L.search,hash:L.hash}},push:v,replace:T,go(D){return c.go(D)}};return w}function WA(t,e=!1){let n="http://localhost";typeof window<"u"&&(n=window.location.origin!=="null"?window.location.origin:window.location.href),Rt(n,"No window.location.(origin|href) available to create URL");let i=typeof t=="string"?t:iu(t);return i=i.replace(/ $/,"%20"),!e&&i.startsWith("//")&&(i=n+i),new URL(i,n)}function sE(t,e,n="/"){return KA(t,e,n,!1)}function KA(t,e,n,i){let a=typeof e=="string"?Al(e):e,l=Yi(a.pathname||"/",n);if(l==null)return null;let c=aE(t);YA(c);let h=null;for(let f=0;h==null&&f<c.length;++f){let p=oR(l);h=sR(c[f],p,i)}return h}function aE(t,e=[],n=[],i="",a=!1){let l=(c,h,f=a,p)=>{let _={relativePath:p===void 0?c.path||"":p,caseSensitive:c.caseSensitive===!0,childrenIndex:h,route:c};if(_.relativePath.startsWith("/")){if(!_.relativePath.startsWith(i)&&f)return;Rt(_.relativePath.startsWith(i),`Absolute route path "${_.relativePath}" nested under path "${i}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),_.relativePath=_.relativePath.slice(i.length)}let b=Wi([i,_.relativePath]),v=n.concat(_);c.children&&c.children.length>0&&(Rt(c.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${b}".`),aE(c.children,e,v,b,f)),!(c.path==null&&!c.index)&&e.push({path:b,score:rR(b,c.index),routesMeta:v})};return t.forEach((c,h)=>{if(c.path===""||!c.path?.includes("?"))l(c,h);else for(let f of oE(c.path))l(c,h,!0,f)}),e}function oE(t){let e=t.split("/");if(e.length===0)return[];let[n,...i]=e,a=n.endsWith("?"),l=n.replace(/\?$/,"");if(i.length===0)return a?[l,""]:[l];let c=oE(i.join("/")),h=[];return h.push(...c.map(f=>f===""?l:[l,f].join("/"))),a&&h.push(...c),h.map(f=>t.startsWith("/")&&f===""?"/":f)}function YA(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:iR(e.routesMeta.map(i=>i.childrenIndex),n.routesMeta.map(i=>i.childrenIndex)))}var XA=/^:[\w-]+$/,JA=3,ZA=2,eR=1,tR=10,nR=-2,qv=t=>t==="*";function rR(t,e){let n=t.split("/"),i=n.length;return n.some(qv)&&(i+=nR),e&&(i+=ZA),n.filter(a=>!qv(a)).reduce((a,l)=>a+(XA.test(l)?JA:l===""?eR:tR),i)}function iR(t,e){return t.length===e.length&&t.slice(0,-1).every((i,a)=>i===e[a])?t[t.length-1]-e[e.length-1]:0}function sR(t,e,n=!1){let{routesMeta:i}=t,a={},l="/",c=[];for(let h=0;h<i.length;++h){let f=i[h],p=h===i.length-1,_=l==="/"?e:e.slice(l.length)||"/",b=Ih({path:f.relativePath,caseSensitive:f.caseSensitive,end:p},_),v=f.route;if(!b&&p&&n&&!i[i.length-1].route.index&&(b=Ih({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},_)),!b)return null;Object.assign(a,b.params),c.push({params:a,pathname:Wi([l,b.pathname]),pathnameBase:dR(Wi([l,b.pathnameBase])),route:v}),b.pathnameBase!=="/"&&(l=Wi([l,b.pathnameBase]))}return c}function Ih(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,i]=aR(t.path,t.caseSensitive,t.end),a=e.match(n);if(!a)return null;let l=a[0],c=l.replace(/(.)\/+$/,"$1"),h=a.slice(1);return{params:i.reduce((p,{paramName:_,isOptional:b},v)=>{if(_==="*"){let E=h[v]||"";c=l.slice(0,l.length-E.length).replace(/(.)\/+$/,"$1")}const T=h[v];return b&&!T?p[_]=void 0:p[_]=(T||"").replace(/%2F/g,"/"),p},{}),pathname:l,pathnameBase:c,pattern:t}}function aR(t,e=!1,n=!0){lr(t==="*"||!t.endsWith("*")||t.endsWith("/*"),`Route path "${t}" will be treated as if it were "${t.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${t.replace(/\*$/,"/*")}".`);let i=[],a="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(c,h,f)=>(i.push({paramName:h,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return t.endsWith("*")?(i.push({paramName:"*"}),a+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?a+="\\/*$":t!==""&&t!=="/"&&(a+="(?:(?=\\/|$))"),[new RegExp(a,e?void 0:"i"),i]}function oR(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return lr(!1,`The URL path "${t}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),t}}function Yi(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,i=t.charAt(n);return i&&i!=="/"?null:t.slice(n)||"/"}var lE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,lR=t=>lE.test(t);function cR(t,e="/"){let{pathname:n,search:i="",hash:a=""}=typeof t=="string"?Al(t):t,l;if(n)if(lR(n))l=n;else{if(n.includes("//")){let c=n;n=n.replace(/\/\/+/g,"/"),lr(!1,`Pathnames cannot have embedded double slashes - normalizing ${c} -> ${n}`)}n.startsWith("/")?l=Hv(n.substring(1),"/"):l=Hv(n,e)}else l=e;return{pathname:l,search:hR(i),hash:fR(a)}}function Hv(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(a=>{a===".."?n.length>1&&n.pop():a!=="."&&n.push(a)}),n.length>1?n.join("/"):"/"}function Qp(t,e,n,i){return`Cannot include a '${t}' character in a manually specified \`to.${e}\` field [${JSON.stringify(i)}].  Please separate it out to the \`to.${n}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function uR(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function ny(t){let e=uR(t);return e.map((n,i)=>i===e.length-1?n.pathname:n.pathnameBase)}function ry(t,e,n,i=!1){let a;typeof t=="string"?a=Al(t):(a={...t},Rt(!a.pathname||!a.pathname.includes("?"),Qp("?","pathname","search",a)),Rt(!a.pathname||!a.pathname.includes("#"),Qp("#","pathname","hash",a)),Rt(!a.search||!a.search.includes("#"),Qp("#","search","hash",a)));let l=t===""||a.pathname==="",c=l?"/":a.pathname,h;if(c==null)h=n;else{let b=e.length-1;if(!i&&c.startsWith("..")){let v=c.split("/");for(;v[0]==="..";)v.shift(),b-=1;a.pathname=v.join("/")}h=b>=0?e[b]:"/"}let f=cR(a,h),p=c&&c!=="/"&&c.endsWith("/"),_=(l||c===".")&&n.endsWith("/");return!f.pathname.endsWith("/")&&(p||_)&&(f.pathname+="/"),f}var Wi=t=>t.join("/").replace(/\/\/+/g,"/"),dR=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),hR=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,fR=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t,mR=class{constructor(t,e,n,i=!1){this.status=t,this.statusText=e||"",this.internal=i,n instanceof Error?(this.data=n.toString(),this.error=n):this.data=n}};function pR(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}function gR(t){return t.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var cE=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function uE(t,e){let n=t;if(typeof n!="string"||!lE.test(n))return{absoluteURL:void 0,isExternal:!1,to:n};let i=n,a=!1;if(cE)try{let l=new URL(window.location.href),c=n.startsWith("//")?new URL(l.protocol+n):new URL(n),h=Yi(c.pathname,e);c.origin===l.origin&&h!=null?n=h+c.search+c.hash:a=!0}catch{lr(!1,`<Link to="${n}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:i,isExternal:a,to:n}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var dE=["POST","PUT","PATCH","DELETE"];new Set(dE);var yR=["GET",...dE];new Set(yR);var Rl=A.createContext(null);Rl.displayName="DataRouter";var sf=A.createContext(null);sf.displayName="DataRouterState";var _R=A.createContext(!1),hE=A.createContext({isTransitioning:!1});hE.displayName="ViewTransition";var bR=A.createContext(new Map);bR.displayName="Fetchers";var vR=A.createContext(null);vR.displayName="Await";var ur=A.createContext(null);ur.displayName="Navigation";var gu=A.createContext(null);gu.displayName="Location";var Dr=A.createContext({outlet:null,matches:[],isDataRoute:!1});Dr.displayName="Route";var iy=A.createContext(null);iy.displayName="RouteError";var fE="REACT_ROUTER_ERROR",xR="REDIRECT",SR="ROUTE_ERROR_RESPONSE";function ER(t){if(t.startsWith(`${fE}:${xR}:{`))try{let e=JSON.parse(t.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function wR(t){if(t.startsWith(`${fE}:${SR}:{`))try{let e=JSON.parse(t.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new mR(e.status,e.statusText,e.data)}catch{}}function TR(t,{relative:e}={}){Rt(Dl(),"useHref() may be used only in the context of a <Router> component.");let{basename:n,navigator:i}=A.useContext(ur),{hash:a,pathname:l,search:c}=_u(t,{relative:e}),h=l;return n!=="/"&&(h=l==="/"?n:Wi([n,l])),i.createHref({pathname:h,search:c,hash:a})}function Dl(){return A.useContext(gu)!=null}function jn(){return Rt(Dl(),"useLocation() may be used only in the context of a <Router> component."),A.useContext(gu).location}var mE="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function pE(t){A.useContext(ur).static||A.useLayoutEffect(t)}function yu(){let{isDataRoute:t}=A.useContext(Dr);return t?zR():CR()}function CR(){Rt(Dl(),"useNavigate() may be used only in the context of a <Router> component.");let t=A.useContext(Rl),{basename:e,navigator:n}=A.useContext(ur),{matches:i}=A.useContext(Dr),{pathname:a}=jn(),l=JSON.stringify(ny(i)),c=A.useRef(!1);return pE(()=>{c.current=!0}),A.useCallback((f,p={})=>{if(lr(c.current,mE),!c.current)return;if(typeof f=="number"){n.go(f);return}let _=ry(f,JSON.parse(l),a,p.relative==="path");t==null&&e!=="/"&&(_.pathname=_.pathname==="/"?e:Wi([e,_.pathname])),(p.replace?n.replace:n.push)(_,p.state,p)},[e,n,l,a,t])}var AR=A.createContext(null);function RR(t){let e=A.useContext(Dr).outlet;return A.useMemo(()=>e&&A.createElement(AR.Provider,{value:t},e),[e,t])}function DR(){let{matches:t}=A.useContext(Dr),e=t[t.length-1];return e?e.params:{}}function _u(t,{relative:e}={}){let{matches:n}=A.useContext(Dr),{pathname:i}=jn(),a=JSON.stringify(ny(n));return A.useMemo(()=>ry(t,JSON.parse(a),i,e==="path"),[t,a,i,e])}function jR(t,e){return gE(t,e)}function gE(t,e,n,i,a){Rt(Dl(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:l}=A.useContext(ur),{matches:c}=A.useContext(Dr),h=c[c.length-1],f=h?h.params:{},p=h?h.pathname:"/",_=h?h.pathnameBase:"/",b=h&&h.route;{let q=b&&b.path||"";_E(p,!b||q.endsWith("*")||q.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${p}" (under <Route path="${q}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${q}"> to <Route path="${q==="/"?"*":`${q}/*`}">.`)}let v=jn(),T;if(e){let q=typeof e=="string"?Al(e):e;Rt(_==="/"||q.pathname?.startsWith(_),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${_}" but pathname "${q.pathname}" was given in the \`location\` prop.`),T=q}else T=v;let E=T.pathname||"/",w=E;if(_!=="/"){let q=_.replace(/^\//,"").split("/");w="/"+E.replace(/^\//,"").split("/").slice(q.length).join("/")}let D=sE(t,{pathname:w});lr(b||D!=null,`No routes matched location "${T.pathname}${T.search}${T.hash}" `),lr(D==null||D[D.length-1].route.element!==void 0||D[D.length-1].route.Component!==void 0||D[D.length-1].route.lazy!==void 0,`Matched leaf route at location "${T.pathname}${T.search}${T.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let L=NR(D&&D.map(q=>Object.assign({},q,{params:Object.assign({},f,q.params),pathname:Wi([_,l.encodeLocation?l.encodeLocation(q.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:q.pathname]),pathnameBase:q.pathnameBase==="/"?_:Wi([_,l.encodeLocation?l.encodeLocation(q.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:q.pathnameBase])})),c,n,i,a);return e&&L?A.createElement(gu.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...T},navigationType:"POP"}},L):L}function IR(){let t=UR(),e=pR(t)?`${t.status} ${t.statusText}`:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,i="rgba(200,200,200, 0.5)",a={padding:"0.5rem",backgroundColor:i},l={padding:"2px 4px",backgroundColor:i},c=null;return console.error("Error handled by React Router default ErrorBoundary:",t),c=A.createElement(A.Fragment,null,A.createElement("p",null," Hey developer "),A.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",A.createElement("code",{style:l},"ErrorBoundary")," or"," ",A.createElement("code",{style:l},"errorElement")," prop on your route.")),A.createElement(A.Fragment,null,A.createElement("h2",null,"Unexpected Application Error!"),A.createElement("h3",{style:{fontStyle:"italic"}},e),n?A.createElement("pre",{style:a},n):null,c)}var MR=A.createElement(IR,null),yE=class extends A.Component{constructor(t){super(t),this.state={location:t.location,revalidation:t.revalidation,error:t.error}}static getDerivedStateFromError(t){return{error:t}}static getDerivedStateFromProps(t,e){return e.location!==t.location||e.revalidation!=="idle"&&t.revalidation==="idle"?{error:t.error,location:t.location,revalidation:t.revalidation}:{error:t.error!==void 0?t.error:e.error,location:e.location,revalidation:t.revalidation||e.revalidation}}componentDidCatch(t,e){this.props.onError?this.props.onError(t,e):console.error("React Router caught the following error during render",t)}render(){let t=this.state.error;if(this.context&&typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){const n=wR(t.digest);n&&(t=n)}let e=t!==void 0?A.createElement(Dr.Provider,{value:this.props.routeContext},A.createElement(iy.Provider,{value:t,children:this.props.component})):this.props.children;return this.context?A.createElement(OR,{error:t},e):e}};yE.contextType=_R;var Wp=new WeakMap;function OR({children:t,error:e}){let{basename:n}=A.useContext(ur);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let i=ER(e.digest);if(i){let a=Wp.get(e);if(a)throw a;let l=uE(i.location,n);if(cE&&!Wp.get(e))if(l.isExternal||i.reloadDocument)window.location.href=l.absoluteURL||l.to;else{const c=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(l.to,{replace:i.replace}));throw Wp.set(e,c),c}return A.createElement("meta",{httpEquiv:"refresh",content:`0;url=${l.absoluteURL||l.to}`})}}return t}function kR({routeContext:t,match:e,children:n}){let i=A.useContext(Rl);return i&&i.static&&i.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=e.route.id),A.createElement(Dr.Provider,{value:t},n)}function NR(t,e=[],n=null,i=null,a=null){if(t==null){if(!n)return null;if(n.errors)t=n.matches;else if(e.length===0&&!n.initialized&&n.matches.length>0)t=n.matches;else return null}let l=t,c=n?.errors;if(c!=null){let _=l.findIndex(b=>b.route.id&&c?.[b.route.id]!==void 0);Rt(_>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(c).join(",")}`),l=l.slice(0,Math.min(l.length,_+1))}let h=!1,f=-1;if(n)for(let _=0;_<l.length;_++){let b=l[_];if((b.route.HydrateFallback||b.route.hydrateFallbackElement)&&(f=_),b.route.id){let{loaderData:v,errors:T}=n,E=b.route.loader&&!v.hasOwnProperty(b.route.id)&&(!T||T[b.route.id]===void 0);if(b.route.lazy||E){h=!0,f>=0?l=l.slice(0,f+1):l=[l[0]];break}}}let p=n&&i?(_,b)=>{i(_,{location:n.location,params:n.matches?.[0]?.params??{},unstable_pattern:gR(n.matches),errorInfo:b})}:void 0;return l.reduceRight((_,b,v)=>{let T,E=!1,w=null,D=null;n&&(T=c&&b.route.id?c[b.route.id]:void 0,w=b.route.errorElement||MR,h&&(f<0&&v===0?(_E("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),E=!0,D=null):f===v&&(E=!0,D=b.route.hydrateFallbackElement||null)));let L=e.concat(l.slice(0,v+1)),q=()=>{let B;return T?B=w:E?B=D:b.route.Component?B=A.createElement(b.route.Component,null):b.route.element?B=b.route.element:B=_,A.createElement(kR,{match:b,routeContext:{outlet:_,matches:L,isDataRoute:n!=null},children:B})};return n&&(b.route.ErrorBoundary||b.route.errorElement||v===0)?A.createElement(yE,{location:n.location,revalidation:n.revalidation,component:w,error:T,children:q(),routeContext:{outlet:null,matches:L,isDataRoute:!0},onError:p}):q()},null)}function sy(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function PR(t){let e=A.useContext(Rl);return Rt(e,sy(t)),e}function LR(t){let e=A.useContext(sf);return Rt(e,sy(t)),e}function BR(t){let e=A.useContext(Dr);return Rt(e,sy(t)),e}function ay(t){let e=BR(t),n=e.matches[e.matches.length-1];return Rt(n.route.id,`${t} can only be used on routes that contain a unique "id"`),n.route.id}function VR(){return ay("useRouteId")}function UR(){let t=A.useContext(iy),e=LR("useRouteError"),n=ay("useRouteError");return t!==void 0?t:e.errors?.[n]}function zR(){let{router:t}=PR("useNavigate"),e=ay("useNavigate"),n=A.useRef(!1);return pE(()=>{n.current=!0}),A.useCallback(async(a,l={})=>{lr(n.current,mE),n.current&&(typeof a=="number"?await t.navigate(a):await t.navigate(a,{fromRouteId:e,...l}))},[t,e])}var Gv={};function _E(t,e,n){!e&&!Gv[t]&&(Gv[t]=!0,lr(!1,n))}A.memo(FR);function FR({routes:t,future:e,state:n,onError:i}){return gE(t,void 0,n,i,e)}function af({to:t,replace:e,state:n,relative:i}){Rt(Dl(),"<Navigate> may be used only in the context of a <Router> component.");let{static:a}=A.useContext(ur);lr(!a,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:l}=A.useContext(Dr),{pathname:c}=jn(),h=yu(),f=ry(t,ny(l),c,i==="path"),p=JSON.stringify(f);return A.useEffect(()=>{h(JSON.parse(p),{replace:e,state:n,relative:i})},[h,p,i,e,n]),null}function of(t){return RR(t.context)}function Jt(t){Rt(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function qR({basename:t="/",children:e=null,location:n,navigationType:i="POP",navigator:a,static:l=!1,unstable_useTransitions:c}){Rt(!Dl(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let h=t.replace(/^\/*/,"/"),f=A.useMemo(()=>({basename:h,navigator:a,static:l,unstable_useTransitions:c,future:{}}),[h,a,l,c]);typeof n=="string"&&(n=Al(n));let{pathname:p="/",search:_="",hash:b="",state:v=null,key:T="default"}=n,E=A.useMemo(()=>{let w=Yi(p,h);return w==null?null:{location:{pathname:w,search:_,hash:b,state:v,key:T},navigationType:i}},[h,p,_,b,v,T,i]);return lr(E!=null,`<Router basename="${h}"> is not able to match the URL "${p}${_}${b}" because it does not start with the basename, so the <Router> won't render anything.`),E==null?null:A.createElement(ur.Provider,{value:f},A.createElement(gu.Provider,{children:e,value:E}))}function HR({children:t,location:e}){return jR(mg(t),e)}function mg(t,e=[]){let n=[];return A.Children.forEach(t,(i,a)=>{if(!A.isValidElement(i))return;let l=[...e,a];if(i.type===A.Fragment){n.push.apply(n,mg(i.props.children,l));return}Rt(i.type===Jt,`[${typeof i.type=="string"?i.type:i.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Rt(!i.props.index||!i.props.children,"An index route cannot have child routes.");let c={id:i.props.id||l.join("-"),caseSensitive:i.props.caseSensitive,element:i.props.element,Component:i.props.Component,index:i.props.index,path:i.props.path,middleware:i.props.middleware,loader:i.props.loader,action:i.props.action,hydrateFallbackElement:i.props.hydrateFallbackElement,HydrateFallback:i.props.HydrateFallback,errorElement:i.props.errorElement,ErrorBoundary:i.props.ErrorBoundary,hasErrorBoundary:i.props.hasErrorBoundary===!0||i.props.ErrorBoundary!=null||i.props.errorElement!=null,shouldRevalidate:i.props.shouldRevalidate,handle:i.props.handle,lazy:i.props.lazy};i.props.children&&(c.children=mg(i.props.children,l)),n.push(c)}),n}var _h="get",bh="application/x-www-form-urlencoded";function lf(t){return typeof HTMLElement<"u"&&t instanceof HTMLElement}function GR(t){return lf(t)&&t.tagName.toLowerCase()==="button"}function $R(t){return lf(t)&&t.tagName.toLowerCase()==="form"}function QR(t){return lf(t)&&t.tagName.toLowerCase()==="input"}function WR(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function KR(t,e){return t.button===0&&(!e||e==="_self")&&!WR(t)}function pg(t=""){return new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((e,n)=>{let i=t[n];return e.concat(Array.isArray(i)?i.map(a=>[n,a]):[[n,i]])},[]))}function YR(t,e){let n=pg(t);return e&&e.forEach((i,a)=>{n.has(a)||e.getAll(a).forEach(l=>{n.append(a,l)})}),n}var ch=null;function XR(){if(ch===null)try{new FormData(document.createElement("form"),0),ch=!1}catch{ch=!0}return ch}var JR=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Kp(t){return t!=null&&!JR.has(t)?(lr(!1,`"${t}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${bh}"`),null):t}function ZR(t,e){let n,i,a,l,c;if($R(t)){let h=t.getAttribute("action");i=h?Yi(h,e):null,n=t.getAttribute("method")||_h,a=Kp(t.getAttribute("enctype"))||bh,l=new FormData(t)}else if(GR(t)||QR(t)&&(t.type==="submit"||t.type==="image")){let h=t.form;if(h==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=t.getAttribute("formaction")||h.getAttribute("action");if(i=f?Yi(f,e):null,n=t.getAttribute("formmethod")||h.getAttribute("method")||_h,a=Kp(t.getAttribute("formenctype"))||Kp(h.getAttribute("enctype"))||bh,l=new FormData(h,t),!XR()){let{name:p,type:_,value:b}=t;if(_==="image"){let v=p?`${p}.`:"";l.append(`${v}x`,"0"),l.append(`${v}y`,"0")}else p&&l.append(p,b)}}else{if(lf(t))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');n=_h,i=null,a=bh,c=t}return l&&a==="text/plain"&&(c=l,l=void 0),{action:i,method:n.toLowerCase(),encType:a,formData:l,body:c}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function oy(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function eD(t,e,n){let i=typeof t=="string"?new URL(t,typeof window>"u"?"server://singlefetch/":window.location.origin):t;return i.pathname==="/"?i.pathname=`_root.${n}`:e&&Yi(i.pathname,e)==="/"?i.pathname=`${e.replace(/\/$/,"")}/_root.${n}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${n}`,i}async function tD(t,e){if(t.id in e)return e[t.id];try{let n=await import(t.module);return e[t.id]=n,n}catch(n){return console.error(`Error loading route module \`${t.module}\`, reloading page...`),console.error(n),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function nD(t){return t==null?!1:t.href==null?t.rel==="preload"&&typeof t.imageSrcSet=="string"&&typeof t.imageSizes=="string":typeof t.rel=="string"&&typeof t.href=="string"}async function rD(t,e,n){let i=await Promise.all(t.map(async a=>{let l=e.routes[a.route.id];if(l){let c=await tD(l,n);return c.links?c.links():[]}return[]}));return oD(i.flat(1).filter(nD).filter(a=>a.rel==="stylesheet"||a.rel==="preload").map(a=>a.rel==="stylesheet"?{...a,rel:"prefetch",as:"style"}:{...a,rel:"prefetch"}))}function $v(t,e,n,i,a,l){let c=(f,p)=>n[p]?f.route.id!==n[p].route.id:!0,h=(f,p)=>n[p].pathname!==f.pathname||n[p].route.path?.endsWith("*")&&n[p].params["*"]!==f.params["*"];return l==="assets"?e.filter((f,p)=>c(f,p)||h(f,p)):l==="data"?e.filter((f,p)=>{let _=i.routes[f.route.id];if(!_||!_.hasLoader)return!1;if(c(f,p)||h(f,p))return!0;if(f.route.shouldRevalidate){let b=f.route.shouldRevalidate({currentUrl:new URL(a.pathname+a.search+a.hash,window.origin),currentParams:n[0]?.params||{},nextUrl:new URL(t,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof b=="boolean")return b}return!0}):[]}function iD(t,e,{includeHydrateFallback:n}={}){return sD(t.map(i=>{let a=e.routes[i.route.id];if(!a)return[];let l=[a.module];return a.clientActionModule&&(l=l.concat(a.clientActionModule)),a.clientLoaderModule&&(l=l.concat(a.clientLoaderModule)),n&&a.hydrateFallbackModule&&(l=l.concat(a.hydrateFallbackModule)),a.imports&&(l=l.concat(a.imports)),l}).flat(1))}function sD(t){return[...new Set(t)]}function aD(t){let e={},n=Object.keys(t).sort();for(let i of n)e[i]=t[i];return e}function oD(t,e){let n=new Set;return new Set(e),t.reduce((i,a)=>{let l=JSON.stringify(aD(a));return n.has(l)||(n.add(l),i.push({key:l,link:a})),i},[])}function bE(){let t=A.useContext(Rl);return oy(t,"You must render this element inside a <DataRouterContext.Provider> element"),t}function lD(){let t=A.useContext(sf);return oy(t,"You must render this element inside a <DataRouterStateContext.Provider> element"),t}var ly=A.createContext(void 0);ly.displayName="FrameworkContext";function vE(){let t=A.useContext(ly);return oy(t,"You must render this element inside a <HydratedRouter> element"),t}function cD(t,e){let n=A.useContext(ly),[i,a]=A.useState(!1),[l,c]=A.useState(!1),{onFocus:h,onBlur:f,onMouseEnter:p,onMouseLeave:_,onTouchStart:b}=e,v=A.useRef(null);A.useEffect(()=>{if(t==="render"&&c(!0),t==="viewport"){let w=L=>{L.forEach(q=>{c(q.isIntersecting)})},D=new IntersectionObserver(w,{threshold:.5});return v.current&&D.observe(v.current),()=>{D.disconnect()}}},[t]),A.useEffect(()=>{if(i){let w=setTimeout(()=>{c(!0)},100);return()=>{clearTimeout(w)}}},[i]);let T=()=>{a(!0)},E=()=>{a(!1),c(!1)};return n?t!=="intent"?[l,v,{}]:[l,v,{onFocus:Gc(h,T),onBlur:Gc(f,E),onMouseEnter:Gc(p,T),onMouseLeave:Gc(_,E),onTouchStart:Gc(b,T)}]:[!1,v,{}]}function Gc(t,e){return n=>{t&&t(n),n.defaultPrevented||e(n)}}function uD({page:t,...e}){let{router:n}=bE(),i=A.useMemo(()=>sE(n.routes,t,n.basename),[n.routes,t,n.basename]);return i?A.createElement(hD,{page:t,matches:i,...e}):null}function dD(t){let{manifest:e,routeModules:n}=vE(),[i,a]=A.useState([]);return A.useEffect(()=>{let l=!1;return rD(t,e,n).then(c=>{l||a(c)}),()=>{l=!0}},[t,e,n]),i}function hD({page:t,matches:e,...n}){let i=jn(),{manifest:a,routeModules:l}=vE(),{basename:c}=bE(),{loaderData:h,matches:f}=lD(),p=A.useMemo(()=>$v(t,e,f,a,i,"data"),[t,e,f,a,i]),_=A.useMemo(()=>$v(t,e,f,a,i,"assets"),[t,e,f,a,i]),b=A.useMemo(()=>{if(t===i.pathname+i.search+i.hash)return[];let E=new Set,w=!1;if(e.forEach(L=>{let q=a.routes[L.route.id];!q||!q.hasLoader||(!p.some(B=>B.route.id===L.route.id)&&L.route.id in h&&l[L.route.id]?.shouldRevalidate||q.hasClientLoader?w=!0:E.add(L.route.id))}),E.size===0)return[];let D=eD(t,c,"data");return w&&E.size>0&&D.searchParams.set("_routes",e.filter(L=>E.has(L.route.id)).map(L=>L.route.id).join(",")),[D.pathname+D.search]},[c,h,i,a,p,e,t,l]),v=A.useMemo(()=>iD(_,a),[_,a]),T=dD(_);return A.createElement(A.Fragment,null,b.map(E=>A.createElement("link",{key:E,rel:"prefetch",as:"fetch",href:E,...n})),v.map(E=>A.createElement("link",{key:E,rel:"modulepreload",href:E,...n})),T.map(({key:E,link:w})=>A.createElement("link",{key:E,nonce:n.nonce,...w})))}function fD(...t){return e=>{t.forEach(n=>{typeof n=="function"?n(e):n!=null&&(n.current=e)})}}var mD=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{mD&&(window.__reactRouterVersion="7.11.0")}catch{}function pD({basename:t,children:e,unstable_useTransitions:n,window:i}){let a=A.useRef();a.current==null&&(a.current=GA({window:i,v5Compat:!0}));let l=a.current,[c,h]=A.useState({action:l.action,location:l.location}),f=A.useCallback(p=>{n===!1?h(p):A.startTransition(()=>h(p))},[n]);return A.useLayoutEffect(()=>l.listen(f),[l,f]),A.createElement(qR,{basename:t,children:e,location:c.location,navigationType:c.action,navigator:l,unstable_useTransitions:n})}var xE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Dt=A.forwardRef(function({onClick:e,discover:n="render",prefetch:i="none",relative:a,reloadDocument:l,replace:c,state:h,target:f,to:p,preventScrollReset:_,viewTransition:b,unstable_defaultShouldRevalidate:v,...T},E){let{basename:w,unstable_useTransitions:D}=A.useContext(ur),L=typeof p=="string"&&xE.test(p),q=uE(p,w);p=q.to;let B=TR(p,{relative:a}),[ee,Q,J]=cD(i,T),O=bD(p,{replace:c,state:h,target:f,preventScrollReset:_,relative:a,viewTransition:b,unstable_defaultShouldRevalidate:v,unstable_useTransitions:D});function R(I){e&&e(I),I.defaultPrevented||O(I)}let j=A.createElement("a",{...T,...J,href:q.absoluteURL||B,onClick:q.isExternal||l?e:R,ref:fD(E,Q),target:f,"data-discover":!L&&n==="render"?"true":void 0});return ee&&!L?A.createElement(A.Fragment,null,j,A.createElement(uD,{page:B})):j});Dt.displayName="Link";var gD=A.forwardRef(function({"aria-current":e="page",caseSensitive:n=!1,className:i="",end:a=!1,style:l,to:c,viewTransition:h,children:f,...p},_){let b=_u(c,{relative:p.relative}),v=jn(),T=A.useContext(sf),{navigator:E,basename:w}=A.useContext(ur),D=T!=null&&TD(b)&&h===!0,L=E.encodeLocation?E.encodeLocation(b).pathname:b.pathname,q=v.pathname,B=T&&T.navigation&&T.navigation.location?T.navigation.location.pathname:null;n||(q=q.toLowerCase(),B=B?B.toLowerCase():null,L=L.toLowerCase()),B&&w&&(B=Yi(B,w)||B);const ee=L!=="/"&&L.endsWith("/")?L.length-1:L.length;let Q=q===L||!a&&q.startsWith(L)&&q.charAt(ee)==="/",J=B!=null&&(B===L||!a&&B.startsWith(L)&&B.charAt(L.length)==="/"),O={isActive:Q,isPending:J,isTransitioning:D},R=Q?e:void 0,j;typeof i=="function"?j=i(O):j=[i,Q?"active":null,J?"pending":null,D?"transitioning":null].filter(Boolean).join(" ");let I=typeof l=="function"?l(O):l;return A.createElement(Dt,{...p,"aria-current":R,className:j,ref:_,style:I,to:c,viewTransition:h},typeof f=="function"?f(O):f)});gD.displayName="NavLink";var yD=A.forwardRef(({discover:t="render",fetcherKey:e,navigate:n,reloadDocument:i,replace:a,state:l,method:c=_h,action:h,onSubmit:f,relative:p,preventScrollReset:_,viewTransition:b,unstable_defaultShouldRevalidate:v,...T},E)=>{let{unstable_useTransitions:w}=A.useContext(ur),D=ED(),L=wD(h,{relative:p}),q=c.toLowerCase()==="get"?"get":"post",B=typeof h=="string"&&xE.test(h),ee=Q=>{if(f&&f(Q),Q.defaultPrevented)return;Q.preventDefault();let J=Q.nativeEvent.submitter,O=J?.getAttribute("formmethod")||c,R=()=>D(J||Q.currentTarget,{fetcherKey:e,method:O,navigate:n,replace:a,state:l,relative:p,preventScrollReset:_,viewTransition:b,unstable_defaultShouldRevalidate:v});w&&n!==!1?A.startTransition(()=>R()):R()};return A.createElement("form",{ref:E,method:q,action:L,onSubmit:i?f:ee,...T,"data-discover":!B&&t==="render"?"true":void 0})});yD.displayName="Form";function _D(t){return`${t} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function SE(t){let e=A.useContext(Rl);return Rt(e,_D(t)),e}function bD(t,{target:e,replace:n,state:i,preventScrollReset:a,relative:l,viewTransition:c,unstable_defaultShouldRevalidate:h,unstable_useTransitions:f}={}){let p=yu(),_=jn(),b=_u(t,{relative:l});return A.useCallback(v=>{if(KR(v,e)){v.preventDefault();let T=n!==void 0?n:iu(_)===iu(b),E=()=>p(t,{replace:T,state:i,preventScrollReset:a,relative:l,viewTransition:c,unstable_defaultShouldRevalidate:h});f?A.startTransition(()=>E()):E()}},[_,p,b,n,i,e,t,a,l,c,h,f])}function vD(t){lr(typeof URLSearchParams<"u","You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let e=A.useRef(pg(t)),n=A.useRef(!1),i=jn(),a=A.useMemo(()=>YR(i.search,n.current?null:e.current),[i.search]),l=yu(),c=A.useCallback((h,f)=>{const p=pg(typeof h=="function"?h(new URLSearchParams(a)):h);n.current=!0,l("?"+p,f)},[l,a]);return[a,c]}var xD=0,SD=()=>`__${String(++xD)}__`;function ED(){let{router:t}=SE("useSubmit"),{basename:e}=A.useContext(ur),n=VR(),i=t.fetch,a=t.navigate;return A.useCallback(async(l,c={})=>{let{action:h,method:f,encType:p,formData:_,body:b}=ZR(l,e);if(c.navigate===!1){let v=c.fetcherKey||SD();await i(v,n,c.action||h,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:_,body:b,formMethod:c.method||f,formEncType:c.encType||p,flushSync:c.flushSync})}else await a(c.action||h,{unstable_defaultShouldRevalidate:c.unstable_defaultShouldRevalidate,preventScrollReset:c.preventScrollReset,formData:_,body:b,formMethod:c.method||f,formEncType:c.encType||p,replace:c.replace,state:c.state,fromRouteId:n,flushSync:c.flushSync,viewTransition:c.viewTransition})},[i,a,e,n])}function wD(t,{relative:e}={}){let{basename:n}=A.useContext(ur),i=A.useContext(Dr);Rt(i,"useFormAction must be used inside a RouteContext");let[a]=i.matches.slice(-1),l={..._u(t||".",{relative:e})},c=jn();if(t==null){l.search=c.search;let h=new URLSearchParams(l.search),f=h.getAll("index");if(f.some(_=>_==="")){h.delete("index"),f.filter(b=>b).forEach(b=>h.append("index",b));let _=h.toString();l.search=_?`?${_}`:""}}return(!t||t===".")&&a.route.index&&(l.search=l.search?l.search.replace(/^\?/,"?index&"):"?index"),n!=="/"&&(l.pathname=l.pathname==="/"?n:Wi([n,l.pathname])),iu(l)}function TD(t,{relative:e}={}){let n=A.useContext(hE);Rt(n!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:i}=SE("useViewTransitionState"),a=_u(t,{relative:e});if(!n.isTransitioning)return!1;let l=Yi(n.currentLocation.pathname,i)||n.currentLocation.pathname,c=Yi(n.nextLocation.pathname,i)||n.nextLocation.pathname;return Ih(a.pathname,c)!=null||Ih(a.pathname,l)!=null}const CD={isLoading:!1,loadingMessage:"Loading...",addLoadingHold:()=>{},removeLoadingHold:()=>{}},EE=A.createContext(CD);function AD({children:t}){const[e,n]=A.useState(new Map),i=A.useCallback((f,p)=>{n(_=>new Map(_).set(f,p))},[]),a=A.useCallback(f=>{n(p=>{const _=new Map(p);return _.delete(f),_})},[]),l=e.size>0,c=e.size>0&&Array.from(e.values()).pop()||"Loading...",h={isLoading:l,loadingMessage:c,addLoadingHold:i,removeLoadingHold:a};return d.jsx(EE.Provider,{value:h,children:t})}function Qn(){const t=A.useContext(EE);if(!t)throw new Error("useApp must be used within an AppProvider");return t}const RD=function(){},DD={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:RD},bu=A.createContext(DD);var jl=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(t){return this.listeners.add(t),this.onSubscribe(),()=>{this.listeners.delete(t),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},jD={setTimeout:(t,e)=>setTimeout(t,e),clearTimeout:t=>clearTimeout(t),setInterval:(t,e)=>setInterval(t,e),clearInterval:t=>clearInterval(t)},ID=class{#e=jD;#t=!1;setTimeoutProvider(t){this.#e=t}setTimeout(t,e){return this.#e.setTimeout(t,e)}clearTimeout(t){this.#e.clearTimeout(t)}setInterval(t,e){return this.#e.setInterval(t,e)}clearInterval(t){this.#e.clearInterval(t)}},Hi=new ID;function MD(t){setTimeout(t,0)}var $a=typeof window>"u"||"Deno"in globalThis;function an(){}function OD(t,e){return typeof t=="function"?t(e):t}function gg(t){return typeof t=="number"&&t>=0&&t!==1/0}function wE(t,e){return Math.max(t+(e||0)-Date.now(),0)}function Gs(t,e){return typeof t=="function"?t(e):t}function Tr(t,e){return typeof t=="function"?t(e):t}function Qv(t,e){const{type:n="all",exact:i,fetchStatus:a,predicate:l,queryKey:c,stale:h}=t;if(c){if(i){if(e.queryHash!==cy(c,e.options))return!1}else if(!su(e.queryKey,c))return!1}if(n!=="all"){const f=e.isActive();if(n==="active"&&!f||n==="inactive"&&f)return!1}return!(typeof h=="boolean"&&e.isStale()!==h||a&&a!==e.state.fetchStatus||l&&!l(e))}function Wv(t,e){const{exact:n,status:i,predicate:a,mutationKey:l}=t;if(l){if(!e.options.mutationKey)return!1;if(n){if(Qa(e.options.mutationKey)!==Qa(l))return!1}else if(!su(e.options.mutationKey,l))return!1}return!(i&&e.state.status!==i||a&&!a(e))}function cy(t,e){return(e?.queryKeyHashFn||Qa)(t)}function Qa(t){return JSON.stringify(t,(e,n)=>yg(n)?Object.keys(n).sort().reduce((i,a)=>(i[a]=n[a],i),{}):n)}function su(t,e){return t===e?!0:typeof t!=typeof e?!1:t&&e&&typeof t=="object"&&typeof e=="object"?Object.keys(e).every(n=>su(t[n],e[n])):!1}var kD=Object.prototype.hasOwnProperty;function TE(t,e){if(t===e)return t;const n=Kv(t)&&Kv(e);if(!n&&!(yg(t)&&yg(e)))return e;const a=(n?t:Object.keys(t)).length,l=n?e:Object.keys(e),c=l.length,h=n?new Array(c):{};let f=0;for(let p=0;p<c;p++){const _=n?p:l[p],b=t[_],v=e[_];if(b===v){h[_]=b,(n?p<a:kD.call(t,_))&&f++;continue}if(b===null||v===null||typeof b!="object"||typeof v!="object"){h[_]=v;continue}const T=TE(b,v);h[_]=T,T===b&&f++}return a===c&&f===a?t:h}function Mh(t,e){if(!e||Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(t[n]!==e[n])return!1;return!0}function Kv(t){return Array.isArray(t)&&t.length===Object.keys(t).length}function yg(t){if(!Yv(t))return!1;const e=t.constructor;if(e===void 0)return!0;const n=e.prototype;return!(!Yv(n)||!n.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(t)!==Object.prototype)}function Yv(t){return Object.prototype.toString.call(t)==="[object Object]"}function ND(t){return new Promise(e=>{Hi.setTimeout(e,t)})}function _g(t,e,n){return typeof n.structuralSharing=="function"?n.structuralSharing(t,e):n.structuralSharing!==!1?TE(t,e):e}function PD(t,e,n=0){const i=[...t,e];return n&&i.length>n?i.slice(1):i}function LD(t,e,n=0){const i=[e,...t];return n&&i.length>n?i.slice(0,-1):i}var uy=Symbol();function CE(t,e){return!t.queryFn&&e?.initialPromise?()=>e.initialPromise:!t.queryFn||t.queryFn===uy?()=>Promise.reject(new Error(`Missing queryFn: '${t.queryHash}'`)):t.queryFn}function AE(t,e){return typeof t=="function"?t(...e):!!t}var BD=class extends jl{#e;#t;#n;constructor(){super(),this.#n=t=>{if(!$a&&window.addEventListener){const e=()=>t();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(t){this.#e!==t&&(this.#e=t,this.onFocus())}onFocus(){const t=this.isFocused();this.listeners.forEach(e=>{e(t)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},dy=new BD;function bg(){let t,e;const n=new Promise((a,l)=>{t=a,e=l});n.status="pending",n.catch(()=>{});function i(a){Object.assign(n,a),delete n.resolve,delete n.reject}return n.resolve=a=>{i({status:"fulfilled",value:a}),t(a)},n.reject=a=>{i({status:"rejected",reason:a}),e(a)},n}function VD(t){let e;if(t.then(n=>(e=n,n),an)?.catch(an),e!==void 0)return{data:e}}function RE(t){return t}function UD(t){return{mutationKey:t.options.mutationKey,state:t.state,...t.options.scope&&{scope:t.options.scope},...t.meta&&{meta:t.meta}}}function zD(t,e,n){const i=()=>{const a=t.promise?.then(e).catch(l=>n(l)?Promise.reject(new Error("redacted")):Promise.reject(l));return a?.catch(an),a};return{dehydratedAt:Date.now(),state:{...t.state,...t.state.data!==void 0&&{data:e(t.state.data)}},queryKey:t.queryKey,queryHash:t.queryHash,...t.state.status==="pending"&&{promise:i()},...t.meta&&{meta:t.meta}}}function FD(t){return t.state.isPaused}function qD(t){return t.state.status==="success"}function HD(t){return!0}function GD(t,e={}){const n=e.shouldDehydrateMutation??t.getDefaultOptions().dehydrate?.shouldDehydrateMutation??FD,i=t.getMutationCache().getAll().flatMap(f=>n(f)?[UD(f)]:[]),a=e.shouldDehydrateQuery??t.getDefaultOptions().dehydrate?.shouldDehydrateQuery??qD,l=e.shouldRedactErrors??t.getDefaultOptions().dehydrate?.shouldRedactErrors??HD,c=e.serializeData??t.getDefaultOptions().dehydrate?.serializeData??RE,h=t.getQueryCache().getAll().flatMap(f=>a(f)?[zD(f,c,l)]:[]);return{mutations:i,queries:h}}function $D(t,e,n){if(typeof e!="object"||e===null)return;const i=t.getMutationCache(),a=t.getQueryCache(),l=n?.defaultOptions?.deserializeData??t.getDefaultOptions().hydrate?.deserializeData??RE,c=e.mutations||[],h=e.queries||[];c.forEach(({state:f,...p})=>{i.build(t,{...t.getDefaultOptions().hydrate?.mutations,...n?.defaultOptions?.mutations,...p},f)}),h.forEach(({queryKey:f,state:p,queryHash:_,meta:b,promise:v,dehydratedAt:T})=>{const E=v?VD(v):void 0,w=p.data===void 0?E?.data:p.data,D=w===void 0?w:l(w);let L=a.get(_);const q=L?.state.status==="pending",B=L?.state.fetchStatus==="fetching";if(L){const ee=E&&T!==void 0&&T>L.state.dataUpdatedAt;if(p.dataUpdatedAt>L.state.dataUpdatedAt||ee){const{fetchStatus:Q,...J}=p;L.setState({...J,data:D})}}else L=a.build(t,{...t.getDefaultOptions().hydrate?.queries,...n?.defaultOptions?.queries,queryKey:f,queryHash:_,meta:b},{...p,data:D,fetchStatus:"idle",status:D!==void 0?"success":p.status});v&&!q&&!B&&(T===void 0||T>L.state.dataUpdatedAt)&&L.fetch(void 0,{initialPromise:Promise.resolve(v).then(l)}).catch(an)})}var QD=MD;function WD(){let t=[],e=0,n=h=>{h()},i=h=>{h()},a=QD;const l=h=>{e?t.push(h):a(()=>{n(h)})},c=()=>{const h=t;t=[],h.length&&a(()=>{i(()=>{h.forEach(f=>{n(f)})})})};return{batch:h=>{let f;e++;try{f=h()}finally{e--,e||c()}return f},batchCalls:h=>(...f)=>{l(()=>{h(...f)})},schedule:l,setNotifyFunction:h=>{n=h},setBatchNotifyFunction:h=>{i=h},setScheduler:h=>{a=h}}}var on=WD(),KD=class extends jl{#e=!0;#t;#n;constructor(){super(),this.#n=t=>{if(!$a&&window.addEventListener){const e=()=>t(!0),n=()=>t(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",n,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",n)}}}}onSubscribe(){this.#t||this.setEventListener(this.#n)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(t){this.#n=t,this.#t?.(),this.#t=t(this.setOnline.bind(this))}setOnline(t){this.#e!==t&&(this.#e=t,this.listeners.forEach(n=>{n(t)}))}isOnline(){return this.#e}},Oh=new KD;function YD(t){return Math.min(1e3*2**t,3e4)}function DE(t){return(t??"online")==="online"?Oh.isOnline():!0}var vg=class extends Error{constructor(t){super("CancelledError"),this.revert=t?.revert,this.silent=t?.silent}};function jE(t){let e=!1,n=0,i;const a=bg(),l=()=>a.status!=="pending",c=w=>{if(!l()){const D=new vg(w);v(D),t.onCancel?.(D)}},h=()=>{e=!0},f=()=>{e=!1},p=()=>dy.isFocused()&&(t.networkMode==="always"||Oh.isOnline())&&t.canRun(),_=()=>DE(t.networkMode)&&t.canRun(),b=w=>{l()||(i?.(),a.resolve(w))},v=w=>{l()||(i?.(),a.reject(w))},T=()=>new Promise(w=>{i=D=>{(l()||p())&&w(D)},t.onPause?.()}).then(()=>{i=void 0,l()||t.onContinue?.()}),E=()=>{if(l())return;let w;const D=n===0?t.initialPromise:void 0;try{w=D??t.fn()}catch(L){w=Promise.reject(L)}Promise.resolve(w).then(b).catch(L=>{if(l())return;const q=t.retry??($a?0:3),B=t.retryDelay??YD,ee=typeof B=="function"?B(n,L):B,Q=q===!0||typeof q=="number"&&n<q||typeof q=="function"&&q(n,L);if(e||!Q){v(L);return}n++,t.onFail?.(n,L),ND(ee).then(()=>p()?void 0:T()).then(()=>{e?v(L):E()})})};return{promise:a,status:()=>a.status,cancel:c,continue:()=>(i?.(),a),cancelRetry:h,continueRetry:f,canStart:_,start:()=>(_()?E():T().then(E),a)}}var IE=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),gg(this.gcTime)&&(this.#e=Hi.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(t){this.gcTime=Math.max(this.gcTime||0,t??($a?1/0:300*1e3))}clearGcTimeout(){this.#e&&(Hi.clearTimeout(this.#e),this.#e=void 0)}},XD=class extends IE{#e;#t;#n;#i;#r;#a;#o;constructor(e){super(),this.#o=!1,this.#a=e.defaultOptions,this.setOptions(e.options),this.observers=[],this.#i=e.client,this.#n=this.#i.getQueryCache(),this.queryKey=e.queryKey,this.queryHash=e.queryHash,this.#e=Jv(this.options),this.state=e.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#r?.promise}setOptions(e){if(this.options={...this.#a,...e},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const n=Jv(this.options);n.data!==void 0&&(this.setState(Xv(n.data,n.dataUpdatedAt)),this.#e=n)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#n.remove(this)}setData(e,n){const i=_g(this.state.data,e,this.options);return this.#s({data:i,type:"success",dataUpdatedAt:n?.updatedAt,manual:n?.manual}),i}setState(e,n){this.#s({type:"setState",state:e,setStateOptions:n})}cancel(e){const n=this.#r?.promise;return this.#r?.cancel(e),n?n.then(an).catch(an):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(e=>Tr(e.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===uy||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(e=>Gs(e.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(e=>e.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(e=0){return this.state.data===void 0?!0:e==="static"?!1:this.state.isInvalidated?!0:!wE(this.state.dataUpdatedAt,e)}onFocus(){this.observers.find(n=>n.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#r?.continue()}onOnline(){this.observers.find(n=>n.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#r?.continue()}addObserver(e){this.observers.includes(e)||(this.observers.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",query:this,observer:e}))}removeObserver(e){this.observers.includes(e)&&(this.observers=this.observers.filter(n=>n!==e),this.observers.length||(this.#r&&(this.#o?this.#r.cancel({revert:!0}):this.#r.cancelRetry()),this.scheduleGc()),this.#n.notify({type:"observerRemoved",query:this,observer:e}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#s({type:"invalidate"})}async fetch(e,n){if(this.state.fetchStatus!=="idle"&&this.#r?.status()!=="rejected"){if(this.state.data!==void 0&&n?.cancelRefetch)this.cancel({silent:!0});else if(this.#r)return this.#r.continueRetry(),this.#r.promise}if(e&&this.setOptions(e),!this.options.queryFn){const f=this.observers.find(p=>p.options.queryFn);f&&this.setOptions(f.options)}const i=new AbortController,a=f=>{Object.defineProperty(f,"signal",{enumerable:!0,get:()=>(this.#o=!0,i.signal)})},l=()=>{const f=CE(this.options,n),_=(()=>{const b={client:this.#i,queryKey:this.queryKey,meta:this.meta};return a(b),b})();return this.#o=!1,this.options.persister?this.options.persister(f,_,this):f(_)},h=(()=>{const f={fetchOptions:n,options:this.options,queryKey:this.queryKey,client:this.#i,state:this.state,fetchFn:l};return a(f),f})();this.options.behavior?.onFetch(h,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==h.fetchOptions?.meta)&&this.#s({type:"fetch",meta:h.fetchOptions?.meta}),this.#r=jE({initialPromise:n?.initialPromise,fn:h.fetchFn,onCancel:f=>{f instanceof vg&&f.revert&&this.setState({...this.#t,fetchStatus:"idle"}),i.abort()},onFail:(f,p)=>{this.#s({type:"failed",failureCount:f,error:p})},onPause:()=>{this.#s({type:"pause"})},onContinue:()=>{this.#s({type:"continue"})},retry:h.options.retry,retryDelay:h.options.retryDelay,networkMode:h.options.networkMode,canRun:()=>!0});try{const f=await this.#r.start();if(f===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(f),this.#n.config.onSuccess?.(f,this),this.#n.config.onSettled?.(f,this.state.error,this),f}catch(f){if(f instanceof vg){if(f.silent)return this.#r.promise;if(f.revert){if(this.state.data===void 0)throw f;return this.state.data}}throw this.#s({type:"error",error:f}),this.#n.config.onError?.(f,this),this.#n.config.onSettled?.(this.state.data,f,this),f}finally{this.scheduleGc()}}#s(e){const n=i=>{switch(e.type){case"failed":return{...i,fetchFailureCount:e.failureCount,fetchFailureReason:e.error};case"pause":return{...i,fetchStatus:"paused"};case"continue":return{...i,fetchStatus:"fetching"};case"fetch":return{...i,...ME(i.data,this.options),fetchMeta:e.meta??null};case"success":const a={...i,...Xv(e.data,e.dataUpdatedAt),dataUpdateCount:i.dataUpdateCount+1,...!e.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=e.manual?a:void 0,a;case"error":const l=e.error;return{...i,error:l,errorUpdateCount:i.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:i.fetchFailureCount+1,fetchFailureReason:l,fetchStatus:"idle",status:"error"};case"invalidate":return{...i,isInvalidated:!0};case"setState":return{...i,...e.state}}};this.state=n(this.state),on.batch(()=>{this.observers.forEach(i=>{i.onQueryUpdate()}),this.#n.notify({query:this,type:"updated",action:e})})}};function ME(t,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:DE(e.networkMode)?"fetching":"paused",...t===void 0&&{error:null,status:"pending"}}}function Xv(t,e){return{data:t,dataUpdatedAt:e??Date.now(),error:null,isInvalidated:!1,status:"success"}}function Jv(t){const e=typeof t.initialData=="function"?t.initialData():t.initialData,n=e!==void 0,i=n?typeof t.initialDataUpdatedAt=="function"?t.initialDataUpdatedAt():t.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:n?i??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:n?"success":"pending",fetchStatus:"idle"}}var JD=class extends jl{constructor(t,e){super(),this.options=e,this.#e=t,this.#s=null,this.#o=bg(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#n=void 0;#i=void 0;#r;#a;#o;#s;#p;#h;#f;#c;#u;#l;#m=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),Zv(this.#t,this.options)?this.#d():this.updateResult(),this.#b())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return xg(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return xg(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#v(),this.#x(),this.#t.removeObserver(this)}setOptions(t){const e=this.options,n=this.#t;if(this.options=this.#e.defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Tr(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#S(),this.#t.setOptions(this.options),e._defaulted&&!Mh(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const i=this.hasListeners();i&&ex(this.#t,n,this.options,e)&&this.#d(),this.updateResult(),i&&(this.#t!==n||Tr(this.options.enabled,this.#t)!==Tr(e.enabled,this.#t)||Gs(this.options.staleTime,this.#t)!==Gs(e.staleTime,this.#t))&&this.#g();const a=this.#y();i&&(this.#t!==n||Tr(this.options.enabled,this.#t)!==Tr(e.enabled,this.#t)||a!==this.#l)&&this.#_(a)}getOptimisticResult(t){const e=this.#e.getQueryCache().build(this.#e,t),n=this.createResult(e,t);return ej(this,n)&&(this.#i=n,this.#a=this.options,this.#r=this.#t.state),n}getCurrentResult(){return this.#i}trackResult(t,e){return new Proxy(t,{get:(n,i)=>(this.trackProp(i),e?.(i),i==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&this.#o.status==="pending"&&this.#o.reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,i))})}trackProp(t){this.#m.add(t)}getCurrentQuery(){return this.#t}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#e.defaultQueryOptions(t),n=this.#e.getQueryCache().build(this.#e,e);return n.fetch().then(()=>this.createResult(n,e))}fetch(t){return this.#d({...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#i))}#d(t){this.#S();let e=this.#t.fetch(this.options,t);return t?.throwOnError||(e=e.catch(an)),e}#g(){this.#v();const t=Gs(this.options.staleTime,this.#t);if($a||this.#i.isStale||!gg(t))return;const n=wE(this.#i.dataUpdatedAt,t)+1;this.#c=Hi.setTimeout(()=>{this.#i.isStale||this.updateResult()},n)}#y(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#_(t){this.#x(),this.#l=t,!($a||Tr(this.options.enabled,this.#t)===!1||!gg(this.#l)||this.#l===0)&&(this.#u=Hi.setInterval(()=>{(this.options.refetchIntervalInBackground||dy.isFocused())&&this.#d()},this.#l))}#b(){this.#g(),this.#_(this.#y())}#v(){this.#c&&(Hi.clearTimeout(this.#c),this.#c=void 0)}#x(){this.#u&&(Hi.clearInterval(this.#u),this.#u=void 0)}createResult(t,e){const n=this.#t,i=this.options,a=this.#i,l=this.#r,c=this.#a,f=t!==n?t.state:this.#n,{state:p}=t;let _={...p},b=!1,v;if(e._optimisticResults){const R=this.hasListeners(),j=!R&&Zv(t,e),I=R&&ex(t,n,e,i);(j||I)&&(_={..._,...ME(p.data,t.options)}),e._optimisticResults==="isRestoring"&&(_.fetchStatus="idle")}let{error:T,errorUpdatedAt:E,status:w}=_;v=_.data;let D=!1;if(e.placeholderData!==void 0&&v===void 0&&w==="pending"){let R;a?.isPlaceholderData&&e.placeholderData===c?.placeholderData?(R=a.data,D=!0):R=typeof e.placeholderData=="function"?e.placeholderData(this.#f?.state.data,this.#f):e.placeholderData,R!==void 0&&(w="success",v=_g(a?.data,R,e),b=!0)}if(e.select&&v!==void 0&&!D)if(a&&v===l?.data&&e.select===this.#p)v=this.#h;else try{this.#p=e.select,v=e.select(v),v=_g(a?.data,v,e),this.#h=v,this.#s=null}catch(R){this.#s=R}this.#s&&(T=this.#s,v=this.#h,E=Date.now(),w="error");const L=_.fetchStatus==="fetching",q=w==="pending",B=w==="error",ee=q&&L,Q=v!==void 0,O={status:w,fetchStatus:_.fetchStatus,isPending:q,isSuccess:w==="success",isError:B,isInitialLoading:ee,isLoading:ee,data:v,dataUpdatedAt:_.dataUpdatedAt,error:T,errorUpdatedAt:E,failureCount:_.fetchFailureCount,failureReason:_.fetchFailureReason,errorUpdateCount:_.errorUpdateCount,isFetched:_.dataUpdateCount>0||_.errorUpdateCount>0,isFetchedAfterMount:_.dataUpdateCount>f.dataUpdateCount||_.errorUpdateCount>f.errorUpdateCount,isFetching:L,isRefetching:L&&!q,isLoadingError:B&&!Q,isPaused:_.fetchStatus==="paused",isPlaceholderData:b,isRefetchError:B&&Q,isStale:hy(t,e),refetch:this.refetch,promise:this.#o,isEnabled:Tr(e.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const R=M=>{O.status==="error"?M.reject(O.error):O.data!==void 0&&M.resolve(O.data)},j=()=>{const M=this.#o=O.promise=bg();R(M)},I=this.#o;switch(I.status){case"pending":t.queryHash===n.queryHash&&R(I);break;case"fulfilled":(O.status==="error"||O.data!==I.value)&&j();break;case"rejected":(O.status!=="error"||O.error!==I.reason)&&j();break}}return O}updateResult(){const t=this.#i,e=this.createResult(this.#t,this.options);if(this.#r=this.#t.state,this.#a=this.options,this.#r.data!==void 0&&(this.#f=this.#t),Mh(e,t))return;this.#i=e;const n=()=>{if(!t)return!0;const{notifyOnChangeProps:i}=this.options,a=typeof i=="function"?i():i;if(a==="all"||!a&&!this.#m.size)return!0;const l=new Set(a??this.#m);return this.options.throwOnError&&l.add("error"),Object.keys(this.#i).some(c=>{const h=c;return this.#i[h]!==t[h]&&l.has(h)})};this.#E({listeners:n()})}#S(){const t=this.#e.getQueryCache().build(this.#e,this.options);if(t===this.#t)return;const e=this.#t;this.#t=t,this.#n=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#b()}#E(t){on.batch(()=>{t.listeners&&this.listeners.forEach(e=>{e(this.#i)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function ZD(t,e){return Tr(e.enabled,t)!==!1&&t.state.data===void 0&&!(t.state.status==="error"&&e.retryOnMount===!1)}function Zv(t,e){return ZD(t,e)||t.state.data!==void 0&&xg(t,e,e.refetchOnMount)}function xg(t,e,n){if(Tr(e.enabled,t)!==!1&&Gs(e.staleTime,t)!=="static"){const i=typeof n=="function"?n(t):n;return i==="always"||i!==!1&&hy(t,e)}return!1}function ex(t,e,n,i){return(t!==e||Tr(i.enabled,t)===!1)&&(!n.suspense||t.state.status!=="error")&&hy(t,n)}function hy(t,e){return Tr(e.enabled,t)!==!1&&t.isStaleByTime(Gs(e.staleTime,t))}function ej(t,e){return!Mh(t.getCurrentResult(),e)}function tx(t){return{onFetch:(e,n)=>{const i=e.options,a=e.fetchOptions?.meta?.fetchMore?.direction,l=e.state.data?.pages||[],c=e.state.data?.pageParams||[];let h={pages:[],pageParams:[]},f=0;const p=async()=>{let _=!1;const b=E=>{Object.defineProperty(E,"signal",{enumerable:!0,get:()=>(e.signal.aborted?_=!0:e.signal.addEventListener("abort",()=>{_=!0}),e.signal)})},v=CE(e.options,e.fetchOptions),T=async(E,w,D)=>{if(_)return Promise.reject();if(w==null&&E.pages.length)return Promise.resolve(E);const q=(()=>{const J={client:e.client,queryKey:e.queryKey,pageParam:w,direction:D?"backward":"forward",meta:e.options.meta};return b(J),J})(),B=await v(q),{maxPages:ee}=e.options,Q=D?LD:PD;return{pages:Q(E.pages,B,ee),pageParams:Q(E.pageParams,w,ee)}};if(a&&l.length){const E=a==="backward",w=E?tj:nx,D={pages:l,pageParams:c},L=w(i,D);h=await T(D,L,E)}else{const E=t??l.length;do{const w=f===0?c[0]??i.initialPageParam:nx(i,h);if(f>0&&w==null)break;h=await T(h,w),f++}while(f<E)}return h};e.options.persister?e.fetchFn=()=>e.options.persister?.(p,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},n):e.fetchFn=p}}}function nx(t,{pages:e,pageParams:n}){const i=e.length-1;return e.length>0?t.getNextPageParam(e[i],e,n[i],n):void 0}function tj(t,{pages:e,pageParams:n}){return e.length>0?t.getPreviousPageParam?.(e[0],e,n[0],n):void 0}var nj=class extends IE{#e;#t;#n;#i;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#n=e.mutationCache,this.#t=[],this.state=e.state||OE(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#n.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(n=>n!==e),this.scheduleGc(),this.#n.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#n.remove(this))}continue(){return this.#i?.continue()??this.execute(this.state.variables)}async execute(e){const n=()=>{this.#r({type:"continue"})},i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#i=jE({fn:()=>this.options.mutationFn?this.options.mutationFn(e,i):Promise.reject(new Error("No mutationFn found")),onFail:(c,h)=>{this.#r({type:"failed",failureCount:c,error:h})},onPause:()=>{this.#r({type:"pause"})},onContinue:n,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#n.canRun(this)});const a=this.state.status==="pending",l=!this.#i.canStart();try{if(a)n();else{this.#r({type:"pending",variables:e,isPaused:l}),await this.#n.config.onMutate?.(e,this,i);const h=await this.options.onMutate?.(e,i);h!==this.state.context&&this.#r({type:"pending",context:h,variables:e,isPaused:l})}const c=await this.#i.start();return await this.#n.config.onSuccess?.(c,e,this.state.context,this,i),await this.options.onSuccess?.(c,e,this.state.context,i),await this.#n.config.onSettled?.(c,null,this.state.variables,this.state.context,this,i),await this.options.onSettled?.(c,null,e,this.state.context,i),this.#r({type:"success",data:c}),c}catch(c){try{throw await this.#n.config.onError?.(c,e,this.state.context,this,i),await this.options.onError?.(c,e,this.state.context,i),await this.#n.config.onSettled?.(void 0,c,this.state.variables,this.state.context,this,i),await this.options.onSettled?.(void 0,c,e,this.state.context,i),c}finally{this.#r({type:"error",error:c})}}finally{this.#n.runNext(this)}}#r(e){const n=i=>{switch(e.type){case"failed":return{...i,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...i,isPaused:!0};case"continue":return{...i,isPaused:!1};case"pending":return{...i,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...i,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...i,data:void 0,error:e.error,failureCount:i.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}};this.state=n(this.state),on.batch(()=>{this.#t.forEach(i=>{i.onMutationUpdate(e)}),this.#n.notify({mutation:this,type:"updated",action:e})})}};function OE(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var rj=class extends jl{constructor(t={}){super(),this.config=t,this.#e=new Set,this.#t=new Map,this.#n=0}#e;#t;#n;build(t,e,n){const i=new nj({client:t,mutationCache:this,mutationId:++this.#n,options:t.defaultMutationOptions(e),state:n});return this.add(i),i}add(t){this.#e.add(t);const e=uh(t);if(typeof e=="string"){const n=this.#t.get(e);n?n.push(t):this.#t.set(e,[t])}this.notify({type:"added",mutation:t})}remove(t){if(this.#e.delete(t)){const e=uh(t);if(typeof e=="string"){const n=this.#t.get(e);if(n)if(n.length>1){const i=n.indexOf(t);i!==-1&&n.splice(i,1)}else n[0]===t&&this.#t.delete(e)}}this.notify({type:"removed",mutation:t})}canRun(t){const e=uh(t);if(typeof e=="string"){const i=this.#t.get(e)?.find(a=>a.state.status==="pending");return!i||i===t}else return!0}runNext(t){const e=uh(t);return typeof e=="string"?this.#t.get(e)?.find(i=>i!==t&&i.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){on.batch(()=>{this.#e.forEach(t=>{this.notify({type:"removed",mutation:t})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Wv(e,n))}findAll(t={}){return this.getAll().filter(e=>Wv(t,e))}notify(t){on.batch(()=>{this.listeners.forEach(e=>{e(t)})})}resumePausedMutations(){const t=this.getAll().filter(e=>e.state.isPaused);return on.batch(()=>Promise.all(t.map(e=>e.continue().catch(an))))}};function uh(t){return t.options.scope?.id}var ij=class extends jl{#e;#t=void 0;#n;#i;constructor(e,n){super(),this.#e=e,this.setOptions(n),this.bindMethods(),this.#r()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const n=this.options;this.options=this.#e.defaultMutationOptions(e),Mh(this.options,n)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),n?.mutationKey&&this.options.mutationKey&&Qa(n.mutationKey)!==Qa(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#r(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#r(),this.#a()}mutate(e,n){return this.#i=n,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#r(){const e=this.#n?.state??OE();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){on.batch(()=>{if(this.#i&&this.hasListeners()){const n=this.#t.variables,i=this.#t.context,a={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#i.onSuccess?.(e.data,n,i,a),this.#i.onSettled?.(e.data,null,n,i,a)):e?.type==="error"&&(this.#i.onError?.(e.error,n,i,a),this.#i.onSettled?.(void 0,e.error,n,i,a))}this.listeners.forEach(n=>{n(this.#t)})})}},sj=class extends jl{constructor(t={}){super(),this.config=t,this.#e=new Map}#e;build(t,e,n){const i=e.queryKey,a=e.queryHash??cy(i,e);let l=this.get(a);return l||(l=new XD({client:t,queryKey:i,queryHash:a,options:t.defaultQueryOptions(e),state:n,defaultOptions:t.getQueryDefaults(i)}),this.add(l)),l}add(t){this.#e.has(t.queryHash)||(this.#e.set(t.queryHash,t),this.notify({type:"added",query:t}))}remove(t){const e=this.#e.get(t.queryHash);e&&(t.destroy(),e===t&&this.#e.delete(t.queryHash),this.notify({type:"removed",query:t}))}clear(){on.batch(()=>{this.getAll().forEach(t=>{this.remove(t)})})}get(t){return this.#e.get(t)}getAll(){return[...this.#e.values()]}find(t){const e={exact:!0,...t};return this.getAll().find(n=>Qv(e,n))}findAll(t={}){const e=this.getAll();return Object.keys(t).length>0?e.filter(n=>Qv(t,n)):e}notify(t){on.batch(()=>{this.listeners.forEach(e=>{e(t)})})}onFocus(){on.batch(()=>{this.getAll().forEach(t=>{t.onFocus()})})}onOnline(){on.batch(()=>{this.getAll().forEach(t=>{t.onOnline()})})}},aj=class{#e;#t;#n;#i;#r;#a;#o;#s;constructor(t={}){this.#e=t.queryCache||new sj,this.#t=t.mutationCache||new rj,this.#n=t.defaultOptions||{},this.#i=new Map,this.#r=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#o=dy.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#s=Oh.subscribe(async t=>{t&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#o?.(),this.#o=void 0,this.#s?.(),this.#s=void 0)}isFetching(t){return this.#e.findAll({...t,fetchStatus:"fetching"}).length}isMutating(t){return this.#t.findAll({...t,status:"pending"}).length}getQueryData(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(t){const e=this.defaultQueryOptions(t),n=this.#e.build(this,e),i=n.state.data;return i===void 0?this.fetchQuery(t):(t.revalidateIfStale&&n.isStaleByTime(Gs(e.staleTime,n))&&this.prefetchQuery(e),Promise.resolve(i))}getQueriesData(t){return this.#e.findAll(t).map(({queryKey:e,state:n})=>{const i=n.data;return[e,i]})}setQueryData(t,e,n){const i=this.defaultQueryOptions({queryKey:t}),l=this.#e.get(i.queryHash)?.state.data,c=OD(e,l);if(c!==void 0)return this.#e.build(this,i).setData(c,{...n,manual:!0})}setQueriesData(t,e,n){return on.batch(()=>this.#e.findAll(t).map(({queryKey:i})=>[i,this.setQueryData(i,e,n)]))}getQueryState(t){const e=this.defaultQueryOptions({queryKey:t});return this.#e.get(e.queryHash)?.state}removeQueries(t){const e=this.#e;on.batch(()=>{e.findAll(t).forEach(n=>{e.remove(n)})})}resetQueries(t,e){const n=this.#e;return on.batch(()=>(n.findAll(t).forEach(i=>{i.reset()}),this.refetchQueries({type:"active",...t},e)))}cancelQueries(t,e={}){const n={revert:!0,...e},i=on.batch(()=>this.#e.findAll(t).map(a=>a.cancel(n)));return Promise.all(i).then(an).catch(an)}invalidateQueries(t,e={}){return on.batch(()=>(this.#e.findAll(t).forEach(n=>{n.invalidate()}),t?.refetchType==="none"?Promise.resolve():this.refetchQueries({...t,type:t?.refetchType??t?.type??"active"},e)))}refetchQueries(t,e={}){const n={...e,cancelRefetch:e.cancelRefetch??!0},i=on.batch(()=>this.#e.findAll(t).filter(a=>!a.isDisabled()&&!a.isStatic()).map(a=>{let l=a.fetch(void 0,n);return n.throwOnError||(l=l.catch(an)),a.state.fetchStatus==="paused"?Promise.resolve():l}));return Promise.all(i).then(an)}fetchQuery(t){const e=this.defaultQueryOptions(t);e.retry===void 0&&(e.retry=!1);const n=this.#e.build(this,e);return n.isStaleByTime(Gs(e.staleTime,n))?n.fetch(e):Promise.resolve(n.state.data)}prefetchQuery(t){return this.fetchQuery(t).then(an).catch(an)}fetchInfiniteQuery(t){return t.behavior=tx(t.pages),this.fetchQuery(t)}prefetchInfiniteQuery(t){return this.fetchInfiniteQuery(t).then(an).catch(an)}ensureInfiniteQueryData(t){return t.behavior=tx(t.pages),this.ensureQueryData(t)}resumePausedMutations(){return Oh.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#n}setDefaultOptions(t){this.#n=t}setQueryDefaults(t,e){this.#i.set(Qa(t),{queryKey:t,defaultOptions:e})}getQueryDefaults(t){const e=[...this.#i.values()],n={};return e.forEach(i=>{su(t,i.queryKey)&&Object.assign(n,i.defaultOptions)}),n}setMutationDefaults(t,e){this.#r.set(Qa(t),{mutationKey:t,defaultOptions:e})}getMutationDefaults(t){const e=[...this.#r.values()],n={};return e.forEach(i=>{su(t,i.mutationKey)&&Object.assign(n,i.defaultOptions)}),n}defaultQueryOptions(t){if(t._defaulted)return t;const e={...this.#n.queries,...this.getQueryDefaults(t.queryKey),...t,_defaulted:!0};return e.queryHash||(e.queryHash=cy(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===uy&&(e.enabled=!1),e}defaultMutationOptions(t){return t?._defaulted?t:{...this.#n.mutations,...t?.mutationKey&&this.getMutationDefaults(t.mutationKey),...t,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},kE=A.createContext(void 0),cn=t=>{const e=A.useContext(kE);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},oj=({client:t,children:e})=>(A.useEffect(()=>(t.mount(),()=>{t.unmount()}),[t]),d.jsx(kE.Provider,{value:t,children:e})),NE=A.createContext(!1),lj=()=>A.useContext(NE),cj=NE.Provider;function uj(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}var dj=A.createContext(uj()),hj=()=>A.useContext(dj),fj=(t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))},mj=t=>{A.useEffect(()=>{t.clearReset()},[t])},pj=({result:t,errorResetBoundary:e,throwOnError:n,query:i,suspense:a})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(a&&t.data===void 0||AE(n,[t.error,i])),gj=t=>{if(t.suspense){const n=a=>a==="static"?a:Math.max(a??1e3,1e3),i=t.staleTime;t.staleTime=typeof i=="function"?(...a)=>n(i(...a)):n(i),typeof t.gcTime=="number"&&(t.gcTime=Math.max(t.gcTime,1e3))}},yj=(t,e)=>t.isLoading&&t.isFetching&&!e,_j=(t,e)=>t?.suspense&&e.isPending,rx=(t,e,n)=>e.fetchOptimistic(t).catch(()=>{n.clearReset()});function bj(t,e,n){const i=lj(),a=hj(),l=cn(),c=l.defaultQueryOptions(t);l.getDefaultOptions().queries?._experimental_beforeQuery?.(c),c._optimisticResults=i?"isRestoring":"optimistic",gj(c),fj(c,a),mj(a);const h=!l.getQueryCache().get(c.queryHash),[f]=A.useState(()=>new e(l,c)),p=f.getOptimisticResult(c),_=!i&&t.subscribed!==!1;if(A.useSyncExternalStore(A.useCallback(b=>{const v=_?f.subscribe(on.batchCalls(b)):an;return f.updateResult(),v},[f,_]),()=>f.getCurrentResult(),()=>f.getCurrentResult()),A.useEffect(()=>{f.setOptions(c)},[c,f]),_j(c,p))throw rx(c,f,a);if(pj({result:p,errorResetBoundary:a,throwOnError:c.throwOnError,query:l.getQueryCache().get(c.queryHash),suspense:c.suspense}))throw p.error;return l.getDefaultOptions().queries?._experimental_afterQuery?.(c,p),c.experimental_prefetchInRender&&!$a&&yj(p,i)&&(h?rx(c,f,a):l.getQueryCache().get(c.queryHash)?.promise)?.catch(an).finally(()=>{f.updateResult()}),c.notifyOnChangeProps?p:f.trackResult(p)}function Il(t,e){return bj(t,JD)}function dr(t,e){const n=cn(),[i]=A.useState(()=>new ij(n,t));A.useEffect(()=>{i.setOptions(t)},[i,t]);const a=A.useSyncExternalStore(A.useCallback(c=>i.subscribe(on.batchCalls(c)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),l=A.useCallback((c,h)=>{i.mutate(c,h).catch(an)},[i]);if(a.error&&AE(i.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:l,mutateAsync:a.mutate}}function Sg(){}function vj(t,{interval:e=1e3,onError:n=Sg}={}){if(typeof t!="function")throw new Error("argument is not function.");let i=0,a=null,l=!1,c=!1;return async(...h)=>{if(a=h,!c){for(c=!0;l;)await new Promise(f=>Hi.setTimeout(f,e));for(;Date.now()<i;)await new Promise(f=>Hi.setTimeout(f,i-Date.now()));c=!1,l=!0;try{await t(...a)}catch(f){try{n(f)}catch{}}i=Date.now()+e,l=!1}}}var xj=({storage:t,key:e="REACT_QUERY_OFFLINE_CACHE",throttleTime:n=1e3,serialize:i=JSON.stringify,deserialize:a=JSON.parse,retry:l})=>{if(t){const c=async h=>{try{const f=await i(h);await t.setItem(e,f);return}catch(f){return f}};return{persistClient:vj(async h=>{let f=h,p=await c(f),_=0;for(;p&&f;)_++,f=await l?.({persistedClient:f,error:p,errorCount:_}),f&&(p=await c(f))},{interval:n}),restoreClient:async()=>{const h=await t.getItem(e);if(h)return await a(h)},removeClient:()=>t.removeItem(e)}}return{persistClient:Sg,restoreClient:()=>Promise.resolve(void 0),removeClient:Sg}};const PE=300*1e3,Sj=1440*60*1e3,$e=new aj({defaultOptions:{queries:{staleTime:PE,gcTime:Sj,refetchOnWindowFocus:!1,refetchOnReconnect:!0,retry:1,refetchOnMount:!1},mutations:{retry:1}}});$e.getQueryCache().subscribe(t=>{const e=t?.query;if(e&&t.type==="updated"){const{state:n}=e;n.status==="error"&&n.error&&console.error("[RQ] Query FAILED:",e.queryKey,n.error)}});const Ej=xj({storage:typeof window<"u"?{getItem:t=>Promise.resolve(localStorage.getItem(t)),setItem:(t,e)=>Promise.resolve(localStorage.setItem(t,e)),removeItem:t=>Promise.resolve(localStorage.removeItem(t))}:void 0,key:"BUDGET_APP_QUERY_CACHE"}),xe={user:t=>["user",t],budget:t=>["budget",t],month:(t,e,n)=>["month",t,e,n],payees:t=>["payees",t],accessibleBudgets:t=>["accessibleBudgets",t],feedback:()=>["feedback"]};var wj=["added","removed","updated"];function ix(t){return wj.includes(t)}async function Tj({queryClient:t,persister:e,maxAge:n=1e3*60*60*24,buster:i="",hydrateOptions:a}){try{const l=await e.restoreClient();if(l)if(l.timestamp){const c=Date.now()-l.timestamp>n,h=l.buster!==i;if(c||h)return e.removeClient();$D(t,l.clientState,a)}else return e.removeClient()}catch(l){throw await e.removeClient(),l}}async function sx({queryClient:t,persister:e,buster:n="",dehydrateOptions:i}){const a={buster:n,timestamp:Date.now(),clientState:GD(t,i)};await e.persistClient(a)}function Cj(t){const e=t.queryClient.getQueryCache().subscribe(i=>{ix(i.type)&&sx(t)}),n=t.queryClient.getMutationCache().subscribe(i=>{ix(i.type)&&sx(t)});return()=>{e(),n()}}var Aj=({children:t,persistOptions:e,onSuccess:n,onError:i,...a})=>{const[l,c]=A.useState(!0),h=A.useRef({persistOptions:e,onSuccess:n,onError:i}),f=A.useRef(!1);return A.useEffect(()=>{h.current={persistOptions:e,onSuccess:n,onError:i}}),A.useEffect(()=>{const p={...h.current.persistOptions,queryClient:a.client};return f.current||(f.current=!0,Tj(p).then(()=>h.current.onSuccess?.()).catch(()=>h.current.onError?.()).finally(()=>{c(!1)})),l?void 0:Cj(p)},[a.client,l]),d.jsx(oj,{...a,children:d.jsx(cj,{value:l,children:t})})};function Rj({children:t}){return d.jsx(Aj,{client:$e,persistOptions:{persister:Ej,maxAge:1440*60*1e3,buster:"v1"},children:t})}const Dj=()=>{};var ax={};const LE=function(t){const e=[];let n=0;for(let i=0;i<t.length;i++){let a=t.charCodeAt(i);a<128?e[n++]=a:a<2048?(e[n++]=a>>6|192,e[n++]=a&63|128):(a&64512)===55296&&i+1<t.length&&(t.charCodeAt(i+1)&64512)===56320?(a=65536+((a&1023)<<10)+(t.charCodeAt(++i)&1023),e[n++]=a>>18|240,e[n++]=a>>12&63|128,e[n++]=a>>6&63|128,e[n++]=a&63|128):(e[n++]=a>>12|224,e[n++]=a>>6&63|128,e[n++]=a&63|128)}return e},jj=function(t){const e=[];let n=0,i=0;for(;n<t.length;){const a=t[n++];if(a<128)e[i++]=String.fromCharCode(a);else if(a>191&&a<224){const l=t[n++];e[i++]=String.fromCharCode((a&31)<<6|l&63)}else if(a>239&&a<365){const l=t[n++],c=t[n++],h=t[n++],f=((a&7)<<18|(l&63)<<12|(c&63)<<6|h&63)-65536;e[i++]=String.fromCharCode(55296+(f>>10)),e[i++]=String.fromCharCode(56320+(f&1023))}else{const l=t[n++],c=t[n++];e[i++]=String.fromCharCode((a&15)<<12|(l&63)<<6|c&63)}}return e.join("")},BE={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let a=0;a<t.length;a+=3){const l=t[a],c=a+1<t.length,h=c?t[a+1]:0,f=a+2<t.length,p=f?t[a+2]:0,_=l>>2,b=(l&3)<<4|h>>4;let v=(h&15)<<2|p>>6,T=p&63;f||(T=64,c||(v=64)),i.push(n[_],n[b],n[v],n[T])}return i.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(LE(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):jj(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let a=0;a<t.length;){const l=n[t.charAt(a++)],h=a<t.length?n[t.charAt(a)]:0;++a;const p=a<t.length?n[t.charAt(a)]:64;++a;const b=a<t.length?n[t.charAt(a)]:64;if(++a,l==null||h==null||p==null||b==null)throw new Ij;const v=l<<2|h>>4;if(i.push(v),p!==64){const T=h<<4&240|p>>2;if(i.push(T),b!==64){const E=p<<6&192|b;i.push(E)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class Ij extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Mj=function(t){const e=LE(t);return BE.encodeByteArray(e,!0)},kh=function(t){return Mj(t).replace(/\./g,"")},VE=function(t){try{return BE.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function Oj(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const kj=()=>Oj().__FIREBASE_DEFAULTS__,Nj=()=>{if(typeof process>"u"||typeof ax>"u")return;const t=ax.__FIREBASE_DEFAULTS__;if(t)return JSON.parse(t)},Pj=()=>{if(typeof document>"u")return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=t&&VE(t[1]);return e&&JSON.parse(e)},cf=()=>{try{return Dj()||kj()||Nj()||Pj()}catch(t){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`);return}},UE=t=>cf()?.emulatorHosts?.[t],Lj=t=>{const e=UE(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(n+1),10);return e[0]==="["?[e.substring(1,n-1),i]:[e.substring(0,n),i]},zE=()=>cf()?.config,FE=t=>cf()?.[`_${t}`];class Bj{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,n)=>{this.resolve=e,this.reject=n})}wrapCallback(e){return(n,i)=>{n?this.reject(n):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(n):e(n,i))}}}function Ml(t){try{return(t.startsWith("http://")||t.startsWith("https://")?new URL(t).hostname:t).endsWith(".cloudworkstations.dev")}catch{return!1}}async function qE(t){return(await fetch(t,{credentials:"include"})).ok}function Vj(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n={alg:"none",type:"JWT"},i=e||"demo-project",a=t.iat||0,l=t.sub||t.user_id;if(!l)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const c={iss:`https://securetoken.google.com/${i}`,aud:i,iat:a,exp:a+3600,auth_time:a,sub:l,user_id:l,firebase:{sign_in_provider:"custom",identities:{}},...t};return[kh(JSON.stringify(n)),kh(JSON.stringify(c)),""].join(".")}const Jc={};function Uj(){const t={prod:[],emulator:[]};for(const e of Object.keys(Jc))Jc[e]?t.emulator.push(e):t.prod.push(e);return t}function zj(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}let ox=!1;function HE(t,e){if(typeof window>"u"||typeof document>"u"||!Ml(window.location.host)||Jc[t]===e||Jc[t]||ox)return;Jc[t]=e;function n(v){return`__firebase__banner__${v}`}const i="__firebase__banner",l=Uj().prod.length>0;function c(){const v=document.getElementById(i);v&&v.remove()}function h(v){v.style.display="flex",v.style.background="#7faaf0",v.style.position="fixed",v.style.bottom="5px",v.style.left="5px",v.style.padding=".5em",v.style.borderRadius="5px",v.style.alignItems="center"}function f(v,T){v.setAttribute("width","24"),v.setAttribute("id",T),v.setAttribute("height","24"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.style.marginLeft="-6px"}function p(){const v=document.createElement("span");return v.style.cursor="pointer",v.style.marginLeft="16px",v.style.fontSize="24px",v.innerHTML=" &times;",v.onclick=()=>{ox=!0,c()},v}function _(v,T){v.setAttribute("id",T),v.innerText="Learn more",v.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",v.setAttribute("target","__blank"),v.style.paddingLeft="5px",v.style.textDecoration="underline"}function b(){const v=zj(i),T=n("text"),E=document.getElementById(T)||document.createElement("span"),w=n("learnmore"),D=document.getElementById(w)||document.createElement("a"),L=n("preprendIcon"),q=document.getElementById(L)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(v.created){const B=v.element;h(B),_(D,w);const ee=p();f(q,L),B.append(q,E,D,ee),document.body.appendChild(B)}l?(E.innerText="Preview backend disconnected.",q.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(q.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,E.innerText="Preview backend running in this workspace."),E.setAttribute("id",T)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",b):b()}function Dn(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Fj(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Dn())}function qj(){const t=cf()?.forceEnvironment;if(t==="node")return!0;if(t==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Hj(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Gj(){const t=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof t=="object"&&t.id!==void 0}function $j(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Qj(){const t=Dn();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function Wj(){return!qj()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Kj(){try{return typeof indexedDB=="object"}catch{return!1}}function Yj(){return new Promise((t,e)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(i);a.onsuccess=()=>{a.result.close(),n||self.indexedDB.deleteDatabase(i),t(!0)},a.onupgradeneeded=()=>{n=!1},a.onerror=()=>{e(a.error?.message||"")}}catch(n){e(n)}})}const Xj="FirebaseError";class ts extends Error{constructor(e,n,i){super(n),this.code=e,this.customData=i,this.name=Xj,Object.setPrototypeOf(this,ts.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,vu.prototype.create)}}class vu{constructor(e,n,i){this.service=e,this.serviceName=n,this.errors=i}create(e,...n){const i=n[0]||{},a=`${this.service}/${e}`,l=this.errors[e],c=l?Jj(l,i):"Error",h=`${this.serviceName}: ${c} (${a}).`;return new ts(a,h,i)}}function Jj(t,e){return t.replace(Zj,(n,i)=>{const a=e[i];return a!=null?String(a):`<${i}?>`})}const Zj=/\{\$([^}]+)}/g;function eI(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Js(t,e){if(t===e)return!0;const n=Object.keys(t),i=Object.keys(e);for(const a of n){if(!i.includes(a))return!1;const l=t[a],c=e[a];if(lx(l)&&lx(c)){if(!Js(l,c))return!1}else if(l!==c)return!1}for(const a of i)if(!n.includes(a))return!1;return!0}function lx(t){return t!==null&&typeof t=="object"}function xu(t){const e=[];for(const[n,i]of Object.entries(t))Array.isArray(i)?i.forEach(a=>{e.push(encodeURIComponent(n)+"="+encodeURIComponent(a))}):e.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}function $c(t){const e={};return t.replace(/^\?/,"").split("&").forEach(i=>{if(i){const[a,l]=i.split("=");e[decodeURIComponent(a)]=decodeURIComponent(l)}}),e}function Qc(t){const e=t.indexOf("?");if(!e)return"";const n=t.indexOf("#",e);return t.substring(e,n>0?n:void 0)}function tI(t,e){const n=new nI(t,e);return n.subscribe.bind(n)}class nI{constructor(e,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(n=>{n.next(e)})}error(e){this.forEachObserver(n=>{n.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,n,i){let a;if(e===void 0&&n===void 0&&i===void 0)throw new Error("Missing Observer.");rI(e,["next","error","complete"])?a=e:a={next:e,error:n,complete:i},a.next===void 0&&(a.next=Yp),a.error===void 0&&(a.error=Yp),a.complete===void 0&&(a.complete=Yp);const l=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch{}}),this.observers.push(a),l}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,e)}sendOne(e,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{n(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function rI(t,e){if(typeof t!="object"||t===null)return!1;for(const n of e)if(n in t&&typeof t[n]=="function")return!0;return!1}function Yp(){}function rn(t){return t&&t._delegate?t._delegate:t}class Wa{constructor(e,n,i){this.name=e,this.instanceFactory=n,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const za="[DEFAULT]";class iI{constructor(e,n){this.name=e,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const n=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(n)){const i=new Bj;if(this.instancesDeferred.set(n,i),this.isInitialized(n)||this.shouldAutoInitialize())try{const a=this.getOrInitializeService({instanceIdentifier:n});a&&i.resolve(a)}catch{}}return this.instancesDeferred.get(n).promise}getImmediate(e){const n=this.normalizeInstanceIdentifier(e?.identifier),i=e?.optional??!1;if(this.isInitialized(n)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(i)return null;throw a}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(aI(e))try{this.getOrInitializeService({instanceIdentifier:za})}catch{}for(const[n,i]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(n);try{const l=this.getOrInitializeService({instanceIdentifier:a});i.resolve(l)}catch{}}}}clearInstance(e=za){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(n=>"INTERNAL"in n).map(n=>n.INTERNAL.delete()),...e.filter(n=>"_delete"in n).map(n=>n._delete())])}isComponentSet(){return this.component!=null}isInitialized(e=za){return this.instances.has(e)}getOptions(e=za){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:n={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const a=this.getOrInitializeService({instanceIdentifier:i,options:n});for(const[l,c]of this.instancesDeferred.entries()){const h=this.normalizeInstanceIdentifier(l);i===h&&c.resolve(a)}return a}onInit(e,n){const i=this.normalizeInstanceIdentifier(n),a=this.onInitCallbacks.get(i)??new Set;a.add(e),this.onInitCallbacks.set(i,a);const l=this.instances.get(i);return l&&e(l,i),()=>{a.delete(e)}}invokeOnInitCallbacks(e,n){const i=this.onInitCallbacks.get(n);if(i)for(const a of i)try{a(e,n)}catch{}}getOrInitializeService({instanceIdentifier:e,options:n={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:sI(e),options:n}),this.instances.set(e,i),this.instancesOptions.set(e,n),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=za){return this.component?this.component.multipleInstances?e:za:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function sI(t){return t===za?void 0:t}function aI(t){return t.instantiationMode==="EAGER"}class oI{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const n=this.getProvider(e.name);if(n.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);n.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const n=new iI(e,this);return this.providers.set(e,n),n}getProviders(){return Array.from(this.providers.values())}}var Xe;(function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"})(Xe||(Xe={}));const lI={debug:Xe.DEBUG,verbose:Xe.VERBOSE,info:Xe.INFO,warn:Xe.WARN,error:Xe.ERROR,silent:Xe.SILENT},cI=Xe.INFO,uI={[Xe.DEBUG]:"log",[Xe.VERBOSE]:"log",[Xe.INFO]:"info",[Xe.WARN]:"warn",[Xe.ERROR]:"error"},dI=(t,e,...n)=>{if(e<t.logLevel)return;const i=new Date().toISOString(),a=uI[e];if(a)console[a](`[${i}]  ${t.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)};class fy{constructor(e){this.name=e,this._logLevel=cI,this._logHandler=dI,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Xe))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?lI[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Xe.DEBUG,...e),this._logHandler(this,Xe.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Xe.VERBOSE,...e),this._logHandler(this,Xe.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Xe.INFO,...e),this._logHandler(this,Xe.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Xe.WARN,...e),this._logHandler(this,Xe.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Xe.ERROR,...e),this._logHandler(this,Xe.ERROR,...e)}}const hI=(t,e)=>e.some(n=>t instanceof n);let cx,ux;function fI(){return cx||(cx=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function mI(){return ux||(ux=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const GE=new WeakMap,Eg=new WeakMap,$E=new WeakMap,Xp=new WeakMap,my=new WeakMap;function pI(t){const e=new Promise((n,i)=>{const a=()=>{t.removeEventListener("success",l),t.removeEventListener("error",c)},l=()=>{n($s(t.result)),a()},c=()=>{i(t.error),a()};t.addEventListener("success",l),t.addEventListener("error",c)});return e.then(n=>{n instanceof IDBCursor&&GE.set(n,t)}).catch(()=>{}),my.set(e,t),e}function gI(t){if(Eg.has(t))return;const e=new Promise((n,i)=>{const a=()=>{t.removeEventListener("complete",l),t.removeEventListener("error",c),t.removeEventListener("abort",c)},l=()=>{n(),a()},c=()=>{i(t.error||new DOMException("AbortError","AbortError")),a()};t.addEventListener("complete",l),t.addEventListener("error",c),t.addEventListener("abort",c)});Eg.set(t,e)}let wg={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Eg.get(t);if(e==="objectStoreNames")return t.objectStoreNames||$E.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return $s(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function yI(t){wg=t(wg)}function _I(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const i=t.call(Jp(this),e,...n);return $E.set(i,e.sort?e.sort():[e]),$s(i)}:mI().includes(t)?function(...e){return t.apply(Jp(this),e),$s(GE.get(this))}:function(...e){return $s(t.apply(Jp(this),e))}}function bI(t){return typeof t=="function"?_I(t):(t instanceof IDBTransaction&&gI(t),hI(t,fI())?new Proxy(t,wg):t)}function $s(t){if(t instanceof IDBRequest)return pI(t);if(Xp.has(t))return Xp.get(t);const e=bI(t);return e!==t&&(Xp.set(t,e),my.set(e,t)),e}const Jp=t=>my.get(t);function vI(t,e,{blocked:n,upgrade:i,blocking:a,terminated:l}={}){const c=indexedDB.open(t,e),h=$s(c);return i&&c.addEventListener("upgradeneeded",f=>{i($s(c.result),f.oldVersion,f.newVersion,$s(c.transaction),f)}),n&&c.addEventListener("blocked",f=>n(f.oldVersion,f.newVersion,f)),h.then(f=>{l&&f.addEventListener("close",()=>l()),a&&f.addEventListener("versionchange",p=>a(p.oldVersion,p.newVersion,p))}).catch(()=>{}),h}const xI=["get","getKey","getAll","getAllKeys","count"],SI=["put","add","delete","clear"],Zp=new Map;function dx(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(Zp.get(e))return Zp.get(e);const n=e.replace(/FromIndex$/,""),i=e!==n,a=SI.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(a||xI.includes(n)))return;const l=async function(c,...h){const f=this.transaction(c,a?"readwrite":"readonly");let p=f.store;return i&&(p=p.index(h.shift())),(await Promise.all([p[n](...h),a&&f.done]))[0]};return Zp.set(e,l),l}yI(t=>({...t,get:(e,n,i)=>dx(e,n)||t.get(e,n,i),has:(e,n)=>!!dx(e,n)||t.has(e,n)}));class EI{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(wI(n)){const i=n.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(n=>n).join(" ")}}function wI(t){return t.getComponent()?.type==="VERSION"}const Tg="@firebase/app",hx="0.14.6";const Xi=new fy("@firebase/app"),TI="@firebase/app-compat",CI="@firebase/analytics-compat",AI="@firebase/analytics",RI="@firebase/app-check-compat",DI="@firebase/app-check",jI="@firebase/auth",II="@firebase/auth-compat",MI="@firebase/database",OI="@firebase/data-connect",kI="@firebase/database-compat",NI="@firebase/functions",PI="@firebase/functions-compat",LI="@firebase/installations",BI="@firebase/installations-compat",VI="@firebase/messaging",UI="@firebase/messaging-compat",zI="@firebase/performance",FI="@firebase/performance-compat",qI="@firebase/remote-config",HI="@firebase/remote-config-compat",GI="@firebase/storage",$I="@firebase/storage-compat",QI="@firebase/firestore",WI="@firebase/ai",KI="@firebase/firestore-compat",YI="firebase",XI="12.6.0";const Cg="[DEFAULT]",JI={[Tg]:"fire-core",[TI]:"fire-core-compat",[AI]:"fire-analytics",[CI]:"fire-analytics-compat",[DI]:"fire-app-check",[RI]:"fire-app-check-compat",[jI]:"fire-auth",[II]:"fire-auth-compat",[MI]:"fire-rtdb",[OI]:"fire-data-connect",[kI]:"fire-rtdb-compat",[NI]:"fire-fn",[PI]:"fire-fn-compat",[LI]:"fire-iid",[BI]:"fire-iid-compat",[VI]:"fire-fcm",[UI]:"fire-fcm-compat",[zI]:"fire-perf",[FI]:"fire-perf-compat",[qI]:"fire-rc",[HI]:"fire-rc-compat",[GI]:"fire-gcs",[$I]:"fire-gcs-compat",[QI]:"fire-fst",[KI]:"fire-fst-compat",[WI]:"fire-vertex","fire-js":"fire-js",[YI]:"fire-js-all"};const Nh=new Map,ZI=new Map,Ag=new Map;function fx(t,e){try{t.container.addComponent(e)}catch(n){Xi.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function gl(t){const e=t.name;if(Ag.has(e))return Xi.debug(`There were multiple attempts to register component ${e}.`),!1;Ag.set(e,t);for(const n of Nh.values())fx(n,t);for(const n of ZI.values())fx(n,t);return!0}function py(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}function qr(t){return t==null?!1:t.settings!==void 0}const e2={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Qs=new vu("app","Firebase",e2);class t2{constructor(e,n,i){this._isDeleted=!1,this._options={...e},this._config={...n},this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Wa("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Qs.create("app-deleted",{appName:this._name})}}const Ol=XI;function QE(t,e={}){let n=t;typeof e!="object"&&(e={name:e});const i={name:Cg,automaticDataCollectionEnabled:!0,...e},a=i.name;if(typeof a!="string"||!a)throw Qs.create("bad-app-name",{appName:String(a)});if(n||(n=zE()),!n)throw Qs.create("no-options");const l=Nh.get(a);if(l){if(Js(n,l.options)&&Js(i,l.config))return l;throw Qs.create("duplicate-app",{appName:a})}const c=new oI(a);for(const f of Ag.values())c.addComponent(f);const h=new t2(n,i,c);return Nh.set(a,h),h}function WE(t=Cg){const e=Nh.get(t);if(!e&&t===Cg&&zE())return QE();if(!e)throw Qs.create("no-app",{appName:t});return e}function Ws(t,e,n){let i=JI[t]??t;n&&(i+=`-${n}`);const a=i.match(/\s|\//),l=e.match(/\s|\//);if(a||l){const c=[`Unable to register library "${i}" with version "${e}":`];a&&c.push(`library name "${i}" contains illegal characters (whitespace or "/")`),a&&l&&c.push("and"),l&&c.push(`version name "${e}" contains illegal characters (whitespace or "/")`),Xi.warn(c.join(" "));return}gl(new Wa(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const n2="firebase-heartbeat-database",r2=1,au="firebase-heartbeat-store";let eg=null;function KE(){return eg||(eg=vI(n2,r2,{upgrade:(t,e)=>{switch(e){case 0:try{t.createObjectStore(au)}catch(n){console.warn(n)}}}}).catch(t=>{throw Qs.create("idb-open",{originalErrorMessage:t.message})})),eg}async function i2(t){try{const n=(await KE()).transaction(au),i=await n.objectStore(au).get(YE(t));return await n.done,i}catch(e){if(e instanceof ts)Xi.warn(e.message);else{const n=Qs.create("idb-get",{originalErrorMessage:e?.message});Xi.warn(n.message)}}}async function mx(t,e){try{const i=(await KE()).transaction(au,"readwrite");await i.objectStore(au).put(e,YE(t)),await i.done}catch(n){if(n instanceof ts)Xi.warn(n.message);else{const i=Qs.create("idb-set",{originalErrorMessage:n?.message});Xi.warn(i.message)}}}function YE(t){return`${t.name}!${t.options.appId}`}const s2=1024,a2=30;class o2{constructor(e){this.container=e,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new c2(n),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=px();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(a=>a.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>a2){const a=u2(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(a,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){Xi.warn(e)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=px(),{heartbeatsToSend:n,unsentEntries:i}=l2(this._heartbeatsCache.heartbeats),a=kh(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),a}catch(e){return Xi.warn(e),""}}}function px(){return new Date().toISOString().substring(0,10)}function l2(t,e=s2){const n=[];let i=t.slice();for(const a of t){const l=n.find(c=>c.agent===a.agent);if(l){if(l.dates.push(a.date),gx(n)>e){l.dates.pop();break}}else if(n.push({agent:a.agent,dates:[a.date]}),gx(n)>e){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}class c2{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Kj()?Yj().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await i2(this.app);return n?.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return mx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return}async add(e){if(await this._canUseIndexedDBPromise){const i=await this.read();return mx(this.app,{lastSentHeartbeatDate:e.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...e.heartbeats]})}else return}}function gx(t){return kh(JSON.stringify({version:2,heartbeats:t})).length}function u2(t){if(t.length===0)return-1;let e=0,n=t[0].date;for(let i=1;i<t.length;i++)t[i].date<n&&(n=t[i].date,e=i);return e}function d2(t){gl(new Wa("platform-logger",e=>new EI(e),"PRIVATE")),gl(new Wa("heartbeat",e=>new o2(e),"PRIVATE")),Ws(Tg,hx,t),Ws(Tg,hx,"esm2020"),Ws("fire-js","")}d2("");var h2="firebase",f2="12.7.0";Ws(h2,f2,"app");const m2={apiKey:"AIzaSyCfvR8bEeW2CXdD31Ec34doRNThnbryXJo",authDomain:"budget-tkl.firebaseapp.com",projectId:"budget-tkl",storageBucket:"budget-tkl.firebasestorage.app",messagingSenderId:"631248313026",appId:"1:631248313026:web:36574d789a42b2d102f95b"},XE=QE(m2);var yx=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Ks,JE;(function(){var t;function e(O,R){function j(){}j.prototype=R.prototype,O.F=R.prototype,O.prototype=new j,O.prototype.constructor=O,O.D=function(I,M,F){for(var k=Array(arguments.length-2),Y=2;Y<arguments.length;Y++)k[Y-2]=arguments[Y];return R.prototype[M].apply(I,k)}}function n(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}e(i,n),i.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function a(O,R,j){j||(j=0);const I=Array(16);if(typeof R=="string")for(var M=0;M<16;++M)I[M]=R.charCodeAt(j++)|R.charCodeAt(j++)<<8|R.charCodeAt(j++)<<16|R.charCodeAt(j++)<<24;else for(M=0;M<16;++M)I[M]=R[j++]|R[j++]<<8|R[j++]<<16|R[j++]<<24;R=O.g[0],j=O.g[1],M=O.g[2];let F=O.g[3],k;k=R+(F^j&(M^F))+I[0]+3614090360&4294967295,R=j+(k<<7&4294967295|k>>>25),k=F+(M^R&(j^M))+I[1]+3905402710&4294967295,F=R+(k<<12&4294967295|k>>>20),k=M+(j^F&(R^j))+I[2]+606105819&4294967295,M=F+(k<<17&4294967295|k>>>15),k=j+(R^M&(F^R))+I[3]+3250441966&4294967295,j=M+(k<<22&4294967295|k>>>10),k=R+(F^j&(M^F))+I[4]+4118548399&4294967295,R=j+(k<<7&4294967295|k>>>25),k=F+(M^R&(j^M))+I[5]+1200080426&4294967295,F=R+(k<<12&4294967295|k>>>20),k=M+(j^F&(R^j))+I[6]+2821735955&4294967295,M=F+(k<<17&4294967295|k>>>15),k=j+(R^M&(F^R))+I[7]+4249261313&4294967295,j=M+(k<<22&4294967295|k>>>10),k=R+(F^j&(M^F))+I[8]+1770035416&4294967295,R=j+(k<<7&4294967295|k>>>25),k=F+(M^R&(j^M))+I[9]+2336552879&4294967295,F=R+(k<<12&4294967295|k>>>20),k=M+(j^F&(R^j))+I[10]+4294925233&4294967295,M=F+(k<<17&4294967295|k>>>15),k=j+(R^M&(F^R))+I[11]+2304563134&4294967295,j=M+(k<<22&4294967295|k>>>10),k=R+(F^j&(M^F))+I[12]+1804603682&4294967295,R=j+(k<<7&4294967295|k>>>25),k=F+(M^R&(j^M))+I[13]+4254626195&4294967295,F=R+(k<<12&4294967295|k>>>20),k=M+(j^F&(R^j))+I[14]+2792965006&4294967295,M=F+(k<<17&4294967295|k>>>15),k=j+(R^M&(F^R))+I[15]+1236535329&4294967295,j=M+(k<<22&4294967295|k>>>10),k=R+(M^F&(j^M))+I[1]+4129170786&4294967295,R=j+(k<<5&4294967295|k>>>27),k=F+(j^M&(R^j))+I[6]+3225465664&4294967295,F=R+(k<<9&4294967295|k>>>23),k=M+(R^j&(F^R))+I[11]+643717713&4294967295,M=F+(k<<14&4294967295|k>>>18),k=j+(F^R&(M^F))+I[0]+3921069994&4294967295,j=M+(k<<20&4294967295|k>>>12),k=R+(M^F&(j^M))+I[5]+3593408605&4294967295,R=j+(k<<5&4294967295|k>>>27),k=F+(j^M&(R^j))+I[10]+38016083&4294967295,F=R+(k<<9&4294967295|k>>>23),k=M+(R^j&(F^R))+I[15]+3634488961&4294967295,M=F+(k<<14&4294967295|k>>>18),k=j+(F^R&(M^F))+I[4]+3889429448&4294967295,j=M+(k<<20&4294967295|k>>>12),k=R+(M^F&(j^M))+I[9]+568446438&4294967295,R=j+(k<<5&4294967295|k>>>27),k=F+(j^M&(R^j))+I[14]+3275163606&4294967295,F=R+(k<<9&4294967295|k>>>23),k=M+(R^j&(F^R))+I[3]+4107603335&4294967295,M=F+(k<<14&4294967295|k>>>18),k=j+(F^R&(M^F))+I[8]+1163531501&4294967295,j=M+(k<<20&4294967295|k>>>12),k=R+(M^F&(j^M))+I[13]+2850285829&4294967295,R=j+(k<<5&4294967295|k>>>27),k=F+(j^M&(R^j))+I[2]+4243563512&4294967295,F=R+(k<<9&4294967295|k>>>23),k=M+(R^j&(F^R))+I[7]+1735328473&4294967295,M=F+(k<<14&4294967295|k>>>18),k=j+(F^R&(M^F))+I[12]+2368359562&4294967295,j=M+(k<<20&4294967295|k>>>12),k=R+(j^M^F)+I[5]+4294588738&4294967295,R=j+(k<<4&4294967295|k>>>28),k=F+(R^j^M)+I[8]+2272392833&4294967295,F=R+(k<<11&4294967295|k>>>21),k=M+(F^R^j)+I[11]+1839030562&4294967295,M=F+(k<<16&4294967295|k>>>16),k=j+(M^F^R)+I[14]+4259657740&4294967295,j=M+(k<<23&4294967295|k>>>9),k=R+(j^M^F)+I[1]+2763975236&4294967295,R=j+(k<<4&4294967295|k>>>28),k=F+(R^j^M)+I[4]+1272893353&4294967295,F=R+(k<<11&4294967295|k>>>21),k=M+(F^R^j)+I[7]+4139469664&4294967295,M=F+(k<<16&4294967295|k>>>16),k=j+(M^F^R)+I[10]+3200236656&4294967295,j=M+(k<<23&4294967295|k>>>9),k=R+(j^M^F)+I[13]+681279174&4294967295,R=j+(k<<4&4294967295|k>>>28),k=F+(R^j^M)+I[0]+3936430074&4294967295,F=R+(k<<11&4294967295|k>>>21),k=M+(F^R^j)+I[3]+3572445317&4294967295,M=F+(k<<16&4294967295|k>>>16),k=j+(M^F^R)+I[6]+76029189&4294967295,j=M+(k<<23&4294967295|k>>>9),k=R+(j^M^F)+I[9]+3654602809&4294967295,R=j+(k<<4&4294967295|k>>>28),k=F+(R^j^M)+I[12]+3873151461&4294967295,F=R+(k<<11&4294967295|k>>>21),k=M+(F^R^j)+I[15]+530742520&4294967295,M=F+(k<<16&4294967295|k>>>16),k=j+(M^F^R)+I[2]+3299628645&4294967295,j=M+(k<<23&4294967295|k>>>9),k=R+(M^(j|~F))+I[0]+4096336452&4294967295,R=j+(k<<6&4294967295|k>>>26),k=F+(j^(R|~M))+I[7]+1126891415&4294967295,F=R+(k<<10&4294967295|k>>>22),k=M+(R^(F|~j))+I[14]+2878612391&4294967295,M=F+(k<<15&4294967295|k>>>17),k=j+(F^(M|~R))+I[5]+4237533241&4294967295,j=M+(k<<21&4294967295|k>>>11),k=R+(M^(j|~F))+I[12]+1700485571&4294967295,R=j+(k<<6&4294967295|k>>>26),k=F+(j^(R|~M))+I[3]+2399980690&4294967295,F=R+(k<<10&4294967295|k>>>22),k=M+(R^(F|~j))+I[10]+4293915773&4294967295,M=F+(k<<15&4294967295|k>>>17),k=j+(F^(M|~R))+I[1]+2240044497&4294967295,j=M+(k<<21&4294967295|k>>>11),k=R+(M^(j|~F))+I[8]+1873313359&4294967295,R=j+(k<<6&4294967295|k>>>26),k=F+(j^(R|~M))+I[15]+4264355552&4294967295,F=R+(k<<10&4294967295|k>>>22),k=M+(R^(F|~j))+I[6]+2734768916&4294967295,M=F+(k<<15&4294967295|k>>>17),k=j+(F^(M|~R))+I[13]+1309151649&4294967295,j=M+(k<<21&4294967295|k>>>11),k=R+(M^(j|~F))+I[4]+4149444226&4294967295,R=j+(k<<6&4294967295|k>>>26),k=F+(j^(R|~M))+I[11]+3174756917&4294967295,F=R+(k<<10&4294967295|k>>>22),k=M+(R^(F|~j))+I[2]+718787259&4294967295,M=F+(k<<15&4294967295|k>>>17),k=j+(F^(M|~R))+I[9]+3951481745&4294967295,O.g[0]=O.g[0]+R&4294967295,O.g[1]=O.g[1]+(M+(k<<21&4294967295|k>>>11))&4294967295,O.g[2]=O.g[2]+M&4294967295,O.g[3]=O.g[3]+F&4294967295}i.prototype.v=function(O,R){R===void 0&&(R=O.length);const j=R-this.blockSize,I=this.C;let M=this.h,F=0;for(;F<R;){if(M==0)for(;F<=j;)a(this,O,F),F+=this.blockSize;if(typeof O=="string"){for(;F<R;)if(I[M++]=O.charCodeAt(F++),M==this.blockSize){a(this,I),M=0;break}}else for(;F<R;)if(I[M++]=O[F++],M==this.blockSize){a(this,I),M=0;break}}this.h=M,this.o+=R},i.prototype.A=function(){var O=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);O[0]=128;for(var R=1;R<O.length-8;++R)O[R]=0;R=this.o*8;for(var j=O.length-8;j<O.length;++j)O[j]=R&255,R/=256;for(this.v(O),O=Array(16),R=0,j=0;j<4;++j)for(let I=0;I<32;I+=8)O[R++]=this.g[j]>>>I&255;return O};function l(O,R){var j=h;return Object.prototype.hasOwnProperty.call(j,O)?j[O]:j[O]=R(O)}function c(O,R){this.h=R;const j=[];let I=!0;for(let M=O.length-1;M>=0;M--){const F=O[M]|0;I&&F==R||(j[M]=F,I=!1)}this.g=j}var h={};function f(O){return-128<=O&&O<128?l(O,function(R){return new c([R|0],R<0?-1:0)}):new c([O|0],O<0?-1:0)}function p(O){if(isNaN(O)||!isFinite(O))return b;if(O<0)return D(p(-O));const R=[];let j=1;for(let I=0;O>=j;I++)R[I]=O/j|0,j*=4294967296;return new c(R,0)}function _(O,R){if(O.length==0)throw Error("number format error: empty string");if(R=R||10,R<2||36<R)throw Error("radix out of range: "+R);if(O.charAt(0)=="-")return D(_(O.substring(1),R));if(O.indexOf("-")>=0)throw Error('number format error: interior "-" character');const j=p(Math.pow(R,8));let I=b;for(let F=0;F<O.length;F+=8){var M=Math.min(8,O.length-F);const k=parseInt(O.substring(F,F+M),R);M<8?(M=p(Math.pow(R,M)),I=I.j(M).add(p(k))):(I=I.j(j),I=I.add(p(k)))}return I}var b=f(0),v=f(1),T=f(16777216);t=c.prototype,t.m=function(){if(w(this))return-D(this).m();let O=0,R=1;for(let j=0;j<this.g.length;j++){const I=this.i(j);O+=(I>=0?I:4294967296+I)*R,R*=4294967296}return O},t.toString=function(O){if(O=O||10,O<2||36<O)throw Error("radix out of range: "+O);if(E(this))return"0";if(w(this))return"-"+D(this).toString(O);const R=p(Math.pow(O,6));var j=this;let I="";for(;;){const M=ee(j,R).g;j=L(j,M.j(R));let F=((j.g.length>0?j.g[0]:j.h)>>>0).toString(O);if(j=M,E(j))return F+I;for(;F.length<6;)F="0"+F;I=F+I}},t.i=function(O){return O<0?0:O<this.g.length?this.g[O]:this.h};function E(O){if(O.h!=0)return!1;for(let R=0;R<O.g.length;R++)if(O.g[R]!=0)return!1;return!0}function w(O){return O.h==-1}t.l=function(O){return O=L(this,O),w(O)?-1:E(O)?0:1};function D(O){const R=O.g.length,j=[];for(let I=0;I<R;I++)j[I]=~O.g[I];return new c(j,~O.h).add(v)}t.abs=function(){return w(this)?D(this):this},t.add=function(O){const R=Math.max(this.g.length,O.g.length),j=[];let I=0;for(let M=0;M<=R;M++){let F=I+(this.i(M)&65535)+(O.i(M)&65535),k=(F>>>16)+(this.i(M)>>>16)+(O.i(M)>>>16);I=k>>>16,F&=65535,k&=65535,j[M]=k<<16|F}return new c(j,j[j.length-1]&-2147483648?-1:0)};function L(O,R){return O.add(D(R))}t.j=function(O){if(E(this)||E(O))return b;if(w(this))return w(O)?D(this).j(D(O)):D(D(this).j(O));if(w(O))return D(this.j(D(O)));if(this.l(T)<0&&O.l(T)<0)return p(this.m()*O.m());const R=this.g.length+O.g.length,j=[];for(var I=0;I<2*R;I++)j[I]=0;for(I=0;I<this.g.length;I++)for(let M=0;M<O.g.length;M++){const F=this.i(I)>>>16,k=this.i(I)&65535,Y=O.i(M)>>>16,H=O.i(M)&65535;j[2*I+2*M]+=k*H,q(j,2*I+2*M),j[2*I+2*M+1]+=F*H,q(j,2*I+2*M+1),j[2*I+2*M+1]+=k*Y,q(j,2*I+2*M+1),j[2*I+2*M+2]+=F*Y,q(j,2*I+2*M+2)}for(O=0;O<R;O++)j[O]=j[2*O+1]<<16|j[2*O];for(O=R;O<2*R;O++)j[O]=0;return new c(j,0)};function q(O,R){for(;(O[R]&65535)!=O[R];)O[R+1]+=O[R]>>>16,O[R]&=65535,R++}function B(O,R){this.g=O,this.h=R}function ee(O,R){if(E(R))throw Error("division by zero");if(E(O))return new B(b,b);if(w(O))return R=ee(D(O),R),new B(D(R.g),D(R.h));if(w(R))return R=ee(O,D(R)),new B(D(R.g),R.h);if(O.g.length>30){if(w(O)||w(R))throw Error("slowDivide_ only works with positive integers.");for(var j=v,I=R;I.l(O)<=0;)j=Q(j),I=Q(I);var M=J(j,1),F=J(I,1);for(I=J(I,2),j=J(j,2);!E(I);){var k=F.add(I);k.l(O)<=0&&(M=M.add(j),F=k),I=J(I,1),j=J(j,1)}return R=L(O,M.j(R)),new B(M,R)}for(M=b;O.l(R)>=0;){for(j=Math.max(1,Math.floor(O.m()/R.m())),I=Math.ceil(Math.log(j)/Math.LN2),I=I<=48?1:Math.pow(2,I-48),F=p(j),k=F.j(R);w(k)||k.l(O)>0;)j-=I,F=p(j),k=F.j(R);E(F)&&(F=v),M=M.add(F),O=L(O,k)}return new B(M,O)}t.B=function(O){return ee(this,O).h},t.and=function(O){const R=Math.max(this.g.length,O.g.length),j=[];for(let I=0;I<R;I++)j[I]=this.i(I)&O.i(I);return new c(j,this.h&O.h)},t.or=function(O){const R=Math.max(this.g.length,O.g.length),j=[];for(let I=0;I<R;I++)j[I]=this.i(I)|O.i(I);return new c(j,this.h|O.h)},t.xor=function(O){const R=Math.max(this.g.length,O.g.length),j=[];for(let I=0;I<R;I++)j[I]=this.i(I)^O.i(I);return new c(j,this.h^O.h)};function Q(O){const R=O.g.length+1,j=[];for(let I=0;I<R;I++)j[I]=O.i(I)<<1|O.i(I-1)>>>31;return new c(j,O.h)}function J(O,R){const j=R>>5;R%=32;const I=O.g.length-j,M=[];for(let F=0;F<I;F++)M[F]=R>0?O.i(F+j)>>>R|O.i(F+j+1)<<32-R:O.i(F+j);return new c(M,O.h)}i.prototype.digest=i.prototype.A,i.prototype.reset=i.prototype.u,i.prototype.update=i.prototype.v,JE=i,c.prototype.add=c.prototype.add,c.prototype.multiply=c.prototype.j,c.prototype.modulo=c.prototype.B,c.prototype.compare=c.prototype.l,c.prototype.toNumber=c.prototype.m,c.prototype.toString=c.prototype.toString,c.prototype.getBits=c.prototype.i,c.fromNumber=p,c.fromString=_,Ks=c}).apply(typeof yx<"u"?yx:typeof self<"u"?self:typeof window<"u"?window:{});var dh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var ZE,Wc,ew,vh,Rg,tw,nw,rw;(function(){var t,e=Object.defineProperty;function n(m){m=[typeof globalThis=="object"&&globalThis,m,typeof window=="object"&&window,typeof self=="object"&&self,typeof dh=="object"&&dh];for(var x=0;x<m.length;++x){var C=m[x];if(C&&C.Math==Math)return C}throw Error("Cannot find global object")}var i=n(this);function a(m,x){if(x)e:{var C=i;m=m.split(".");for(var U=0;U<m.length-1;U++){var ae=m[U];if(!(ae in C))break e;C=C[ae]}m=m[m.length-1],U=C[m],x=x(U),x!=U&&x!=null&&e(C,m,{configurable:!0,writable:!0,value:x})}}a("Symbol.dispose",function(m){return m||Symbol("Symbol.dispose")}),a("Array.prototype.values",function(m){return m||function(){return this[Symbol.iterator]()}}),a("Object.entries",function(m){return m||function(x){var C=[],U;for(U in x)Object.prototype.hasOwnProperty.call(x,U)&&C.push([U,x[U]]);return C}});var l=l||{},c=this||self;function h(m){var x=typeof m;return x=="object"&&m!=null||x=="function"}function f(m,x,C){return m.call.apply(m.bind,arguments)}function p(m,x,C){return p=f,p.apply(null,arguments)}function _(m,x){var C=Array.prototype.slice.call(arguments,1);return function(){var U=C.slice();return U.push.apply(U,arguments),m.apply(this,U)}}function b(m,x){function C(){}C.prototype=x.prototype,m.Z=x.prototype,m.prototype=new C,m.prototype.constructor=m,m.Ob=function(U,ae,me){for(var we=Array(arguments.length-2),Fe=2;Fe<arguments.length;Fe++)we[Fe-2]=arguments[Fe];return x.prototype[ae].apply(U,we)}}var v=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?m=>m&&AsyncContext.Snapshot.wrap(m):m=>m;function T(m){const x=m.length;if(x>0){const C=Array(x);for(let U=0;U<x;U++)C[U]=m[U];return C}return[]}function E(m,x){for(let U=1;U<arguments.length;U++){const ae=arguments[U];var C=typeof ae;if(C=C!="object"?C:ae?Array.isArray(ae)?"array":C:"null",C=="array"||C=="object"&&typeof ae.length=="number"){C=m.length||0;const me=ae.length||0;m.length=C+me;for(let we=0;we<me;we++)m[C+we]=ae[we]}else m.push(ae)}}class w{constructor(x,C){this.i=x,this.j=C,this.h=0,this.g=null}get(){let x;return this.h>0?(this.h--,x=this.g,this.g=x.next,x.next=null):x=this.i(),x}}function D(m){c.setTimeout(()=>{throw m},0)}function L(){var m=O;let x=null;return m.g&&(x=m.g,m.g=m.g.next,m.g||(m.h=null),x.next=null),x}class q{constructor(){this.h=this.g=null}add(x,C){const U=B.get();U.set(x,C),this.h?this.h.next=U:this.g=U,this.h=U}}var B=new w(()=>new ee,m=>m.reset());class ee{constructor(){this.next=this.g=this.h=null}set(x,C){this.h=x,this.g=C,this.next=null}reset(){this.next=this.g=this.h=null}}let Q,J=!1,O=new q,R=()=>{const m=Promise.resolve(void 0);Q=()=>{m.then(j)}};function j(){for(var m;m=L();){try{m.h.call(m.g)}catch(C){D(C)}var x=B;x.j(m),x.h<100&&(x.h++,m.next=x.g,x.g=m)}J=!1}function I(){this.u=this.u,this.C=this.C}I.prototype.u=!1,I.prototype.dispose=function(){this.u||(this.u=!0,this.N())},I.prototype[Symbol.dispose]=function(){this.dispose()},I.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function M(m,x){this.type=m,this.g=this.target=x,this.defaultPrevented=!1}M.prototype.h=function(){this.defaultPrevented=!0};var F=(function(){if(!c.addEventListener||!Object.defineProperty)return!1;var m=!1,x=Object.defineProperty({},"passive",{get:function(){m=!0}});try{const C=()=>{};c.addEventListener("test",C,x),c.removeEventListener("test",C,x)}catch{}return m})();function k(m){return/^[\s\xa0]*$/.test(m)}function Y(m,x){M.call(this,m?m.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,m&&this.init(m,x)}b(Y,M),Y.prototype.init=function(m,x){const C=this.type=m.type,U=m.changedTouches&&m.changedTouches.length?m.changedTouches[0]:null;this.target=m.target||m.srcElement,this.g=x,x=m.relatedTarget,x||(C=="mouseover"?x=m.fromElement:C=="mouseout"&&(x=m.toElement)),this.relatedTarget=x,U?(this.clientX=U.clientX!==void 0?U.clientX:U.pageX,this.clientY=U.clientY!==void 0?U.clientY:U.pageY,this.screenX=U.screenX||0,this.screenY=U.screenY||0):(this.clientX=m.clientX!==void 0?m.clientX:m.pageX,this.clientY=m.clientY!==void 0?m.clientY:m.pageY,this.screenX=m.screenX||0,this.screenY=m.screenY||0),this.button=m.button,this.key=m.key||"",this.ctrlKey=m.ctrlKey,this.altKey=m.altKey,this.shiftKey=m.shiftKey,this.metaKey=m.metaKey,this.pointerId=m.pointerId||0,this.pointerType=m.pointerType,this.state=m.state,this.i=m,m.defaultPrevented&&Y.Z.h.call(this)},Y.prototype.h=function(){Y.Z.h.call(this);const m=this.i;m.preventDefault?m.preventDefault():m.returnValue=!1};var H="closure_listenable_"+(Math.random()*1e6|0),N=0;function G(m,x,C,U,ae){this.listener=m,this.proxy=null,this.src=x,this.type=C,this.capture=!!U,this.ha=ae,this.key=++N,this.da=this.fa=!1}function W(m){m.da=!0,m.listener=null,m.proxy=null,m.src=null,m.ha=null}function ne(m,x,C){for(const U in m)x.call(C,m[U],U,m)}function ie(m,x){for(const C in m)x.call(void 0,m[C],C,m)}function V(m){const x={};for(const C in m)x[C]=m[C];return x}const z="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $(m,x){let C,U;for(let ae=1;ae<arguments.length;ae++){U=arguments[ae];for(C in U)m[C]=U[C];for(let me=0;me<z.length;me++)C=z[me],Object.prototype.hasOwnProperty.call(U,C)&&(m[C]=U[C])}}function X(m){this.src=m,this.g={},this.h=0}X.prototype.add=function(m,x,C,U,ae){const me=m.toString();m=this.g[me],m||(m=this.g[me]=[],this.h++);const we=ue(m,x,U,ae);return we>-1?(x=m[we],C||(x.fa=!1)):(x=new G(x,this.src,me,!!U,ae),x.fa=C,m.push(x)),x};function re(m,x){const C=x.type;if(C in m.g){var U=m.g[C],ae=Array.prototype.indexOf.call(U,x,void 0),me;(me=ae>=0)&&Array.prototype.splice.call(U,ae,1),me&&(W(x),m.g[C].length==0&&(delete m.g[C],m.h--))}}function ue(m,x,C,U){for(let ae=0;ae<m.length;++ae){const me=m[ae];if(!me.da&&me.listener==x&&me.capture==!!C&&me.ha==U)return ae}return-1}var he="closure_lm_"+(Math.random()*1e6|0),Se={};function fe(m,x,C,U,ae){if(Array.isArray(x)){for(let me=0;me<x.length;me++)fe(m,x[me],C,U,ae);return null}return C=nt(C),m&&m[H]?m.J(x,C,h(U)?!!U.capture:!1,ae):te(m,x,C,!1,U,ae)}function te(m,x,C,U,ae,me){if(!x)throw Error("Invalid event type");const we=h(ae)?!!ae.capture:!!ae;let Fe=In(m);if(Fe||(m[he]=Fe=new X(m)),C=Fe.add(x,C,U,we,me),C.proxy)return C;if(U=Ee(),C.proxy=U,U.src=m,U.listener=C,m.addEventListener)F||(ae=we),ae===void 0&&(ae=!1),m.addEventListener(x.toString(),U,ae);else if(m.attachEvent)m.attachEvent(He(x.toString()),U);else if(m.addListener&&m.removeListener)m.addListener(U);else throw Error("addEventListener and attachEvent are unavailable.");return C}function Ee(){function m(C){return x.call(m.src,m.listener,C)}const x=Ft;return m}function De(m,x,C,U,ae){if(Array.isArray(x))for(var me=0;me<x.length;me++)De(m,x[me],C,U,ae);else U=h(U)?!!U.capture:!!U,C=nt(C),m&&m[H]?(m=m.i,me=String(x).toString(),me in m.g&&(x=m.g[me],C=ue(x,C,U,ae),C>-1&&(W(x[C]),Array.prototype.splice.call(x,C,1),x.length==0&&(delete m.g[me],m.h--)))):m&&(m=In(m))&&(x=m.g[x.toString()],m=-1,x&&(m=ue(x,C,U,ae)),(C=m>-1?x[m]:null)&&st(C))}function st(m){if(typeof m!="number"&&m&&!m.da){var x=m.src;if(x&&x[H])re(x.i,m);else{var C=m.type,U=m.proxy;x.removeEventListener?x.removeEventListener(C,U,m.capture):x.detachEvent?x.detachEvent(He(C),U):x.addListener&&x.removeListener&&x.removeListener(U),(C=In(x))?(re(C,m),C.h==0&&(C.src=null,x[he]=null)):W(m)}}}function He(m){return m in Se?Se[m]:Se[m]="on"+m}function Ft(m,x){if(m.da)m=!0;else{x=new Y(x,this);const C=m.listener,U=m.ha||m.src;m.fa&&st(m),m=C.call(U,x)}return m}function In(m){return m=m[he],m instanceof X?m:null}var Ve="__closure_events_fn_"+(Math.random()*1e9>>>0);function nt(m){return typeof m=="function"?m:(m[Ve]||(m[Ve]=function(x){return m.handleEvent(x)}),m[Ve])}function bt(){I.call(this),this.i=new X(this),this.M=this,this.G=null}b(bt,I),bt.prototype[H]=!0,bt.prototype.removeEventListener=function(m,x,C,U){De(this,m,x,C,U)};function kt(m,x){var C,U=m.G;if(U)for(C=[];U;U=U.G)C.push(U);if(m=m.M,U=x.type||x,typeof x=="string")x=new M(x,m);else if(x instanceof M)x.target=x.target||m;else{var ae=x;x=new M(U,m),$(x,ae)}ae=!0;let me,we;if(C)for(we=C.length-1;we>=0;we--)me=x.g=C[we],ae=at(me,U,!0,x)&&ae;if(me=x.g=m,ae=at(me,U,!0,x)&&ae,ae=at(me,U,!1,x)&&ae,C)for(we=0;we<C.length;we++)me=x.g=C[we],ae=at(me,U,!1,x)&&ae}bt.prototype.N=function(){if(bt.Z.N.call(this),this.i){var m=this.i;for(const x in m.g){const C=m.g[x];for(let U=0;U<C.length;U++)W(C[U]);delete m.g[x],m.h--}}this.G=null},bt.prototype.J=function(m,x,C,U){return this.i.add(String(m),x,!1,C,U)},bt.prototype.K=function(m,x,C,U){return this.i.add(String(m),x,!0,C,U)};function at(m,x,C,U){if(x=m.i.g[String(x)],!x)return!0;x=x.concat();let ae=!0;for(let me=0;me<x.length;++me){const we=x[me];if(we&&!we.da&&we.capture==C){const Fe=we.listener,Pt=we.ha||we.src;we.fa&&re(m.i,we),ae=Fe.call(Pt,U)!==!1&&ae}}return ae&&!U.defaultPrevented}function Wn(m,x){if(typeof m!="function")if(m&&typeof m.handleEvent=="function")m=p(m.handleEvent,m);else throw Error("Invalid listener argument");return Number(x)>2147483647?-1:c.setTimeout(m,x||0)}function jr(m){m.g=Wn(()=>{m.g=null,m.i&&(m.i=!1,jr(m))},m.l);const x=m.h;m.h=null,m.m.apply(null,x)}class It extends I{constructor(x,C){super(),this.m=x,this.l=C,this.h=null,this.i=!1,this.g=null}j(x){this.h=arguments,this.g?this.i=!0:jr(this)}N(){super.N(),this.g&&(c.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Kn(m){I.call(this),this.h=m,this.g={}}b(Kn,I);var qt=[];function Yn(m){ne(m.g,function(x,C){this.g.hasOwnProperty(C)&&st(x)},m),m.g={}}Kn.prototype.N=function(){Kn.Z.N.call(this),Yn(this)},Kn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var rs=c.JSON.stringify,Hf=c.JSON.parse,Nu=class{stringify(m){return c.JSON.stringify(m,void 0)}parse(m){return c.JSON.parse(m,void 0)}};function Pu(){}function Lu(){}var Ir={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function gn(){M.call(this,"d")}b(gn,M);function hr(){M.call(this,"c")}b(hr,M);var Nt={},Bu=null;function ho(){return Bu=Bu||new bt}Nt.Ia="serverreachability";function Vu(m){M.call(this,Nt.Ia,m)}b(Vu,M);function Wr(m){const x=ho();kt(x,new Vu(x))}Nt.STAT_EVENT="statevent";function ha(m,x){M.call(this,Nt.STAT_EVENT,m),this.stat=x}b(ha,M);function Ht(m){const x=ho();kt(x,new ha(x,m))}Nt.Ja="timingevent";function Kr(m,x){M.call(this,Nt.Ja,m),this.size=x}b(Kr,M);function Yr(m,x){if(typeof m!="function")throw Error("Fn must not be null and must be a function");return c.setTimeout(function(){m()},x)}function Mr(){this.g=!0}Mr.prototype.ua=function(){this.g=!1};function Gf(m,x,C,U,ae,me){m.info(function(){if(m.g)if(me){var we="",Fe=me.split("&");for(let ot=0;ot<Fe.length;ot++){var Pt=Fe[ot].split("=");if(Pt.length>1){const Ct=Pt[0];Pt=Pt[1];const gr=Ct.split("_");we=gr.length>=2&&gr[1]=="type"?we+(Ct+"="+Pt+"&"):we+(Ct+"=redacted&")}}}else we=null;else we=me;return"XMLHTTP REQ ("+U+") [attempt "+ae+"]: "+x+`
`+C+`
`+we})}function Uu(m,x,C,U,ae,me,we){m.info(function(){return"XMLHTTP RESP ("+U+") [ attempt "+ae+"]: "+x+`
`+C+`
`+me+" "+we})}function Xr(m,x,C,U){m.info(function(){return"XMLHTTP TEXT ("+x+"): "+$f(m,C)+(U?" "+U:"")})}function fa(m,x){m.info(function(){return"TIMEOUT: "+x})}Mr.prototype.info=function(){};function $f(m,x){if(!m.g)return x;if(!x)return null;try{const me=JSON.parse(x);if(me){for(m=0;m<me.length;m++)if(Array.isArray(me[m])){var C=me[m];if(!(C.length<2)){var U=C[1];if(Array.isArray(U)&&!(U.length<1)){var ae=U[0];if(ae!="noop"&&ae!="stop"&&ae!="close")for(let we=1;we<U.length;we++)U[we]=""}}}}return rs(me)}catch{return x}}var ma={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Hl={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Gl;function pa(){}b(pa,Pu),pa.prototype.g=function(){return new XMLHttpRequest},Gl=new pa;function Ti(m){return encodeURIComponent(String(m))}function zu(m){var x=1;m=m.split(":");const C=[];for(;x>0&&m.length;)C.push(m.shift()),x--;return m.length&&C.push(m.join(":")),C}function Or(m,x,C,U){this.j=m,this.i=x,this.l=C,this.S=U||1,this.V=new Kn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new kr}function kr(){this.i=null,this.g="",this.h=!1}var Gt={},un={};function Jr(m,x,C){m.M=1,m.A=ga(Qt(x)),m.u=C,m.R=!0,fo(m,null)}function fo(m,x){m.F=Date.now(),Zr(m),m.B=Qt(m.A);var C=m.B,U=m.S;Array.isArray(U)||(U=[String(U)]),yo(C.i,"t",U),m.C=0,C=m.j.L,m.h=new kr,m.g=nd(m.j,C?x:null,!m.u),m.P>0&&(m.O=new It(p(m.Y,m,m.g),m.P)),x=m.V,C=m.g,U=m.ba;var ae="readystatechange";Array.isArray(ae)||(ae&&(qt[0]=ae.toString()),ae=qt);for(let me=0;me<ae.length;me++){const we=fe(C,ae[me],U||x.handleEvent,!1,x.h||x);if(!we)break;x.g[we.key]=we}x=m.J?V(m.J):{},m.u?(m.v||(m.v="POST"),x["Content-Type"]="application/x-www-form-urlencoded",m.g.ea(m.B,m.v,m.u,x)):(m.v="GET",m.g.ea(m.B,m.v,null,x)),Wr(),Gf(m.i,m.v,m.B,m.l,m.S,m.u)}Or.prototype.ba=function(m){m=m.target;const x=this.O;x&&Lr(m)==3?x.j():this.Y(m)},Or.prototype.Y=function(m){try{if(m==this.g)e:{const Fe=Lr(this.g),Pt=this.g.ya(),ot=this.g.ca();if(!(Fe<3)&&(Fe!=3||this.g&&(this.h.h||this.g.la()||yn(this.g)))){this.K||Fe!=4||Pt==7||(Pt==8||ot<=0?Wr(3):Wr(2)),ei(this);var x=this.g.ca();this.X=x;var C=Qf(this);if(this.o=x==200,Uu(this.i,this.v,this.B,this.l,this.S,Fe,x),this.o){if(this.U&&!this.L){t:{if(this.g){var U,ae=this.g;if((U=ae.g?ae.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(U)){var me=U;break t}}me=null}if(m=me)Xr(this.i,this.l,m,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ti(this,m);else{this.o=!1,this.m=3,Ht(12),Xn(this),fr(this);break e}}if(this.R){m=!0;let Ct;for(;!this.K&&this.C<C.length;)if(Ct=qu(this,C),Ct==un){Fe==4&&(this.m=4,Ht(14),m=!1),Xr(this.i,this.l,null,"[Incomplete Response]");break}else if(Ct==Gt){this.m=4,Ht(15),Xr(this.i,this.l,C,"[Invalid Chunk]"),m=!1;break}else Xr(this.i,this.l,Ct,null),ti(this,Ct);if(Fu(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),Fe!=4||C.length!=0||this.h.h||(this.m=1,Ht(16),m=!1),this.o=this.o&&m,!m)Xr(this.i,this.l,C,"[Invalid Chunked Response]"),Xn(this),fr(this);else if(C.length>0&&!this.W){this.W=!0;var we=this.j;we.g==this&&we.aa&&!we.P&&(we.j.info("Great, no buffering proxy detected. Bytes received: "+C.length),ac(we),we.P=!0,Ht(11))}}else Xr(this.i,this.l,C,null),ti(this,C);Fe==4&&Xn(this),this.o&&!this.K&&(Fe==4?Ju(this.j,this):(this.o=!1,Zr(this)))}else Ai(this.g),x==400&&C.indexOf("Unknown SID")>0?(this.m=3,Ht(12)):(this.m=0,Ht(13)),Xn(this),fr(this)}}}catch{}};function Qf(m){if(!Fu(m))return m.g.la();const x=yn(m.g);if(x==="")return"";let C="";const U=x.length,ae=Lr(m.g)==4;if(!m.h.i){if(typeof TextDecoder>"u")return Xn(m),fr(m),"";m.h.i=new c.TextDecoder}for(let me=0;me<U;me++)m.h.h=!0,C+=m.h.i.decode(x[me],{stream:!(ae&&me==U-1)});return x.length=0,m.h.g+=C,m.C=0,m.h.g}function Fu(m){return m.g?m.v=="GET"&&m.M!=2&&m.j.Aa:!1}function qu(m,x){var C=m.C,U=x.indexOf(`
`,C);return U==-1?un:(C=Number(x.substring(C,U)),isNaN(C)?Gt:(U+=1,U+C>x.length?un:(x=x.slice(U,U+C),m.C=U+C,x)))}Or.prototype.cancel=function(){this.K=!0,Xn(this)};function Zr(m){m.T=Date.now()+m.H,mo(m,m.H)}function mo(m,x){if(m.D!=null)throw Error("WatchDog timer not null");m.D=Yr(p(m.aa,m),x)}function ei(m){m.D&&(c.clearTimeout(m.D),m.D=null)}Or.prototype.aa=function(){this.D=null;const m=Date.now();m-this.T>=0?(fa(this.i,this.B),this.M!=2&&(Wr(),Ht(17)),Xn(this),this.m=2,fr(this)):mo(this,this.T-m)};function fr(m){m.j.I==0||m.K||Ju(m.j,m)}function Xn(m){ei(m);var x=m.O;x&&typeof x.dispose=="function"&&x.dispose(),m.O=null,Yn(m.V),m.g&&(x=m.g,m.g=null,x.abort(),x.dispose())}function ti(m,x){try{var C=m.j;if(C.I!=0&&(C.g==m||ri(C.h,m))){if(!m.L&&ri(C.h,m)&&C.I==3){try{var U=C.Ba.g.parse(x)}catch{U=null}if(Array.isArray(U)&&U.length==3){var ae=U;if(ae[0]==0){e:if(!C.v){if(C.g)if(C.g.F+3e3<m.F)So(C),ds(C);else break e;Ea(C),Ht(18)}}else C.xa=ae[1],0<C.xa-C.K&&ae[2]<37500&&C.F&&C.A==0&&!C.C&&(C.C=Yr(p(C.Va,C),6e3));ni(C.h)<=1&&C.ta&&(C.ta=void 0)}else ci(C,11)}else if((m.L||C.g==m)&&So(C),!k(x))for(ae=C.Ba.g.parse(x),x=0;x<ae.length;x++){let ot=ae[x];const Ct=ot[0];if(!(Ct<=C.K))if(C.K=Ct,ot=ot[1],C.I==2)if(ot[0]=="c"){C.M=ot[1],C.ba=ot[2];const gr=ot[3];gr!=null&&(C.ka=gr,C.j.info("VER="+C.ka));const ui=ot[4];ui!=null&&(C.za=ui,C.j.info("SVER="+C.za));const Br=ot[5];Br!=null&&typeof Br=="number"&&Br>0&&(U=1.5*Br,C.O=U,C.j.info("backChannelRequestTimeoutMs_="+U)),U=C;const Vr=m.g;if(Vr){const wa=Vr.g?Vr.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(wa){var me=U.h;me.g||wa.indexOf("spdy")==-1&&wa.indexOf("quic")==-1&&wa.indexOf("h2")==-1||(me.j=me.l,me.g=new Set,me.h&&(Wl(me,me.h),me.h=null))}if(U.G){const Eo=Vr.g?Vr.g.getResponseHeader("X-HTTP-Session-Id"):null;Eo&&(U.wa=Eo,dt(U.J,U.G,Eo))}}C.I=3,C.l&&C.l.ra(),C.aa&&(C.T=Date.now()-m.F,C.j.info("Handshake RTT: "+C.T+"ms")),U=C;var we=m;if(U.na=td(U,U.L?U.ba:null,U.W),we.L){Kl(U.h,we);var Fe=we,Pt=U.O;Pt&&(Fe.H=Pt),Fe.D&&(ei(Fe),Zr(Fe)),U.g=we}else Yu(U);C.i.length>0&&li(C)}else ot[0]!="stop"&&ot[0]!="close"||ci(C,7);else C.I==3&&(ot[0]=="stop"||ot[0]=="close"?ot[0]=="stop"?ci(C,7):ic(C):ot[0]!="noop"&&C.l&&C.l.qa(ot),C.A=0)}}Wr(4)}catch{}}var $t=class{constructor(m,x){this.g=m,this.map=x}};function $l(m){this.l=m||10,c.PerformanceNavigationTiming?(m=c.performance.getEntriesByType("navigation"),m=m.length>0&&(m[0].nextHopProtocol=="hq"||m[0].nextHopProtocol=="h2")):m=!!(c.chrome&&c.chrome.loadTimes&&c.chrome.loadTimes()&&c.chrome.loadTimes().wasFetchedViaSpdy),this.j=m?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ql(m){return m.h?!0:m.g?m.g.size>=m.j:!1}function ni(m){return m.h?1:m.g?m.g.size:0}function ri(m,x){return m.h?m.h==x:m.g?m.g.has(x):!1}function Wl(m,x){m.g?m.g.add(x):m.h=x}function Kl(m,x){m.h&&m.h==x?m.h=null:m.g&&m.g.has(x)&&m.g.delete(x)}$l.prototype.cancel=function(){if(this.i=Yl(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const m of this.g.values())m.cancel();this.g.clear()}};function Yl(m){if(m.h!=null)return m.i.concat(m.h.G);if(m.g!=null&&m.g.size!==0){let x=m.i;for(const C of m.g.values())x=x.concat(C.G);return x}return T(m.i)}var Hu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function po(m,x){if(m){m=m.split("&");for(let C=0;C<m.length;C++){const U=m[C].indexOf("=");let ae,me=null;U>=0?(ae=m[C].substring(0,U),me=m[C].substring(U+1)):ae=m[C],x(ae,me?decodeURIComponent(me.replace(/\+/g," ")):"")}}}function Jn(m){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let x;m instanceof Jn?(this.l=m.l,dn(this,m.j),this.o=m.o,this.g=m.g,is(this,m.u),this.h=m.h,Xl(this,Wu(m.i)),this.m=m.m):m&&(x=String(m).match(Hu))?(this.l=!1,dn(this,x[1]||"",!0),this.o=ii(x[2]||""),this.g=ii(x[3]||"",!0),is(this,x[4]),this.h=ii(x[5]||"",!0),Xl(this,x[6]||"",!0),this.m=ii(x[7]||"")):(this.l=!1,this.i=new as(null,this.l))}Jn.prototype.toString=function(){const m=[];var x=this.j;x&&m.push(ya(x,go,!0),":");var C=this.g;return(C||x=="file")&&(m.push("//"),(x=this.o)&&m.push(ya(x,go,!0),"@"),m.push(Ti(C).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),C=this.u,C!=null&&m.push(":",String(C))),(C=this.h)&&(this.g&&C.charAt(0)!="/"&&m.push("/"),m.push(ya(C,C.charAt(0)=="/"?Jl:Gu,!0))),(C=this.i.toString())&&m.push("?",C),(C=this.m)&&m.push("#",ya(C,$u)),m.join("")},Jn.prototype.resolve=function(m){const x=Qt(this);let C=!!m.j;C?dn(x,m.j):C=!!m.o,C?x.o=m.o:C=!!m.g,C?x.g=m.g:C=m.u!=null;var U=m.h;if(C)is(x,m.u);else if(C=!!m.h){if(U.charAt(0)!="/")if(this.g&&!this.h)U="/"+U;else{var ae=x.h.lastIndexOf("/");ae!=-1&&(U=x.h.slice(0,ae+1)+U)}if(ae=U,ae==".."||ae==".")U="";else if(ae.indexOf("./")!=-1||ae.indexOf("/.")!=-1){U=ae.lastIndexOf("/",0)==0,ae=ae.split("/");const me=[];for(let we=0;we<ae.length;){const Fe=ae[we++];Fe=="."?U&&we==ae.length&&me.push(""):Fe==".."?((me.length>1||me.length==1&&me[0]!="")&&me.pop(),U&&we==ae.length&&me.push("")):(me.push(Fe),U=!0)}U=me.join("/")}else U=ae}return C?x.h=U:C=m.i.toString()!=="",C?Xl(x,Wu(m.i)):C=!!m.m,C&&(x.m=m.m),x};function Qt(m){return new Jn(m)}function dn(m,x,C){m.j=C?ii(x,!0):x,m.j&&(m.j=m.j.replace(/:$/,""))}function is(m,x){if(x){if(x=Number(x),isNaN(x)||x<0)throw Error("Bad port number "+x);m.u=x}else m.u=null}function Xl(m,x,C){x instanceof as?(m.i=x,_o(m.i,m.l)):(C||(x=ya(x,ss)),m.i=new as(x,m.l))}function dt(m,x,C){m.i.set(x,C)}function ga(m){return dt(m,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),m}function ii(m,x){return m?x?decodeURI(m.replace(/%25/g,"%2525")):decodeURIComponent(m):""}function ya(m,x,C){return typeof m=="string"?(m=encodeURI(m).replace(x,Ln),C&&(m=m.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),m):null}function Ln(m){return m=m.charCodeAt(0),"%"+(m>>4&15).toString(16)+(m&15).toString(16)}var go=/[#\/\?@]/g,Gu=/[#\?:]/g,Jl=/[#\?]/g,ss=/[#\?@]/g,$u=/#/g;function as(m,x){this.h=this.g=null,this.i=m||null,this.j=!!x}function Bn(m){m.g||(m.g=new Map,m.h=0,m.i&&po(m.i,function(x,C){m.add(decodeURIComponent(x.replace(/\+/g," ")),C)}))}t=as.prototype,t.add=function(m,x){Bn(this),this.i=null,m=os(this,m);let C=this.g.get(m);return C||this.g.set(m,C=[]),C.push(x),this.h+=1,this};function Qu(m,x){Bn(m),x=os(m,x),m.g.has(x)&&(m.i=null,m.h-=m.g.get(x).length,m.g.delete(x))}function Zl(m,x){return Bn(m),x=os(m,x),m.g.has(x)}t.forEach=function(m,x){Bn(this),this.g.forEach(function(C,U){C.forEach(function(ae){m.call(x,ae,U,this)},this)},this)};function ec(m,x){Bn(m);let C=[];if(typeof x=="string")Zl(m,x)&&(C=C.concat(m.g.get(os(m,x))));else for(m=Array.from(m.g.values()),x=0;x<m.length;x++)C=C.concat(m[x]);return C}t.set=function(m,x){return Bn(this),this.i=null,m=os(this,m),Zl(this,m)&&(this.h-=this.g.get(m).length),this.g.set(m,[x]),this.h+=1,this},t.get=function(m,x){return m?(m=ec(this,m),m.length>0?String(m[0]):x):x};function yo(m,x,C){Qu(m,x),C.length>0&&(m.i=null,m.g.set(os(m,x),T(C)),m.h+=C.length)}t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const m=[],x=Array.from(this.g.keys());for(let U=0;U<x.length;U++){var C=x[U];const ae=Ti(C);C=ec(this,C);for(let me=0;me<C.length;me++){let we=ae;C[me]!==""&&(we+="="+Ti(C[me])),m.push(we)}}return this.i=m.join("&")};function Wu(m){const x=new as;return x.i=m.i,m.g&&(x.g=new Map(m.g),x.h=m.h),x}function os(m,x){return x=String(x),m.j&&(x=x.toLowerCase()),x}function _o(m,x){x&&!m.j&&(Bn(m),m.i=null,m.g.forEach(function(C,U){const ae=U.toLowerCase();U!=ae&&(Qu(this,U),yo(this,ae,C))},m)),m.j=x}function Nr(m,x){const C=new Mr;if(c.Image){const U=new Image;U.onload=_(mr,C,"TestLoadImage: loaded",!0,x,U),U.onerror=_(mr,C,"TestLoadImage: error",!1,x,U),U.onabort=_(mr,C,"TestLoadImage: abort",!1,x,U),U.ontimeout=_(mr,C,"TestLoadImage: timeout",!1,x,U),c.setTimeout(function(){U.ontimeout&&U.ontimeout()},1e4),U.src=m}else x(!1)}function tc(m,x){const C=new Mr,U=new AbortController,ae=setTimeout(()=>{U.abort(),mr(C,"TestPingServer: timeout",!1,x)},1e4);fetch(m,{signal:U.signal}).then(me=>{clearTimeout(ae),me.ok?mr(C,"TestPingServer: ok",!0,x):mr(C,"TestPingServer: server error",!1,x)}).catch(()=>{clearTimeout(ae),mr(C,"TestPingServer: error",!1,x)})}function mr(m,x,C,U,ae){try{ae&&(ae.onload=null,ae.onerror=null,ae.onabort=null,ae.ontimeout=null),U(C)}catch{}}function ls(){this.g=new Nu}function si(m){this.i=m.Sb||null,this.h=m.ab||!1}b(si,Pu),si.prototype.g=function(){return new _a(this.i,this.h)};function _a(m,x){bt.call(this),this.H=m,this.o=x,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}b(_a,bt),t=_a.prototype,t.open=function(m,x){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=m,this.D=x,this.readyState=1,Pr(this)},t.send=function(m){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const x={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};m&&(x.body=m),(this.H||c).fetch(new Request(this.D,x)).then(this.Pa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,cs(this)),this.readyState=0},t.Pa=function(m){if(this.g&&(this.l=m,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=m.headers,this.readyState=2,Pr(this)),this.g&&(this.readyState=3,Pr(this),this.g)))if(this.responseType==="arraybuffer")m.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof c.ReadableStream<"u"&&"body"in m){if(this.j=m.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;bo(this)}else m.text().then(this.Oa.bind(this),this.ga.bind(this))};function bo(m){m.j.read().then(m.Ma.bind(m)).catch(m.ga.bind(m))}t.Ma=function(m){if(this.g){if(this.o&&m.value)this.response.push(m.value);else if(!this.o){var x=m.value?m.value:new Uint8Array(0);(x=this.B.decode(x,{stream:!m.done}))&&(this.response=this.responseText+=x)}m.done?cs(this):Pr(this),this.readyState==3&&bo(this)}},t.Oa=function(m){this.g&&(this.response=this.responseText=m,cs(this))},t.Na=function(m){this.g&&(this.response=m,cs(this))},t.ga=function(){this.g&&cs(this)};function cs(m){m.readyState=4,m.l=null,m.j=null,m.B=null,Pr(m)}t.setRequestHeader=function(m,x){this.A.append(m,x)},t.getResponseHeader=function(m){return this.h&&this.h.get(m.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const m=[],x=this.h.entries();for(var C=x.next();!C.done;)C=C.value,m.push(C[0]+": "+C[1]),C=x.next();return m.join(`\r
`)};function Pr(m){m.onreadystatechange&&m.onreadystatechange.call(m)}Object.defineProperty(_a.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(m){this.m=m?"include":"same-origin"}});function pr(m){let x="";return ne(m,function(C,U){x+=U,x+=":",x+=C,x+=`\r
`}),x}function ba(m,x,C){e:{for(U in C){var U=!1;break e}U=!0}U||(C=pr(C),typeof m=="string"?C!=null&&Ti(C):dt(m,x,C))}function mt(m){bt.call(this),this.headers=new Map,this.L=m||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}b(mt,bt);var ai=/^https?$/i,nc=["POST","PUT"];t=mt.prototype,t.Fa=function(m){this.H=m},t.ea=function(m,x,C,U){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+m);x=x?x.toUpperCase():"GET",this.D=m,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Gl.g(),this.g.onreadystatechange=v(p(this.Ca,this));try{this.B=!0,this.g.open(x,String(m),!0),this.B=!1}catch(me){va(this,me);return}if(m=C||"",C=new Map(this.headers),U)if(Object.getPrototypeOf(U)===Object.prototype)for(var ae in U)C.set(ae,U[ae]);else if(typeof U.keys=="function"&&typeof U.get=="function")for(const me of U.keys())C.set(me,U.get(me));else throw Error("Unknown input type for opt_headers: "+String(U));U=Array.from(C.keys()).find(me=>me.toLowerCase()=="content-type"),ae=c.FormData&&m instanceof c.FormData,!(Array.prototype.indexOf.call(nc,x,void 0)>=0)||U||ae||C.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[me,we]of C)this.g.setRequestHeader(me,we);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(m),this.v=!1}catch(me){va(this,me)}};function va(m,x){m.h=!1,m.g&&(m.j=!0,m.g.abort(),m.j=!1),m.l=x,m.o=5,rc(m),Ci(m)}function rc(m){m.A||(m.A=!0,kt(m,"complete"),kt(m,"error"))}t.abort=function(m){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=m||7,kt(this,"complete"),kt(this,"abort"),Ci(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ci(this,!0)),mt.Z.N.call(this)},t.Ca=function(){this.u||(this.B||this.v||this.j?xa(this):this.Xa())},t.Xa=function(){xa(this)};function xa(m){if(m.h&&typeof l<"u"){if(m.v&&Lr(m)==4)setTimeout(m.Ca.bind(m),0);else if(kt(m,"readystatechange"),Lr(m)==4){m.h=!1;try{const me=m.ca();e:switch(me){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var x=!0;break e;default:x=!1}var C;if(!(C=x)){var U;if(U=me===0){let we=String(m.D).match(Hu)[1]||null;!we&&c.self&&c.self.location&&(we=c.self.location.protocol.slice(0,-1)),U=!ai.test(we?we.toLowerCase():"")}C=U}if(C)kt(m,"complete"),kt(m,"success");else{m.o=6;try{var ae=Lr(m)>2?m.g.statusText:""}catch{ae=""}m.l=ae+" ["+m.ca()+"]",rc(m)}}finally{Ci(m)}}}}function Ci(m,x){if(m.g){m.m&&(clearTimeout(m.m),m.m=null);const C=m.g;m.g=null,x||kt(m,"ready");try{C.onreadystatechange=null}catch{}}}t.isActive=function(){return!!this.g};function Lr(m){return m.g?m.g.readyState:0}t.ca=function(){try{return Lr(this)>2?this.g.status:-1}catch{return-1}},t.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},t.La=function(m){if(this.g){var x=this.g.responseText;return m&&x.indexOf(m)==0&&(x=x.substring(m.length)),Hf(x)}};function yn(m){try{if(!m.g)return null;if("response"in m.g)return m.g.response;switch(m.F){case"":case"text":return m.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in m.g)return m.g.mozResponseArrayBuffer}return null}catch{return null}}function Ai(m){const x={};m=(m.g&&Lr(m)>=2&&m.g.getAllResponseHeaders()||"").split(`\r
`);for(let U=0;U<m.length;U++){if(k(m[U]))continue;var C=zu(m[U]);const ae=C[0];if(C=C[1],typeof C!="string")continue;C=C.trim();const me=x[ae]||[];x[ae]=me,me.push(C)}ie(x,function(U){return U.join(", ")})}t.ya=function(){return this.o},t.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function oi(m,x,C){return C&&C.internalChannelParams&&C.internalChannelParams[m]||x}function us(m){this.za=0,this.i=[],this.j=new Mr,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=oi("failFast",!1,m),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=oi("baseRetryDelayMs",5e3,m),this.Za=oi("retryDelaySeedMs",1e4,m),this.Ta=oi("forwardChannelMaxRetries",2,m),this.va=oi("forwardChannelRequestTimeoutMs",2e4,m),this.ma=m&&m.xmlHttpFactory||void 0,this.Ua=m&&m.Rb||void 0,this.Aa=m&&m.useFetchStreams||!1,this.O=void 0,this.L=m&&m.supportsCrossDomainXhr||!1,this.M="",this.h=new $l(m&&m.concurrentRequestLimit),this.Ba=new ls,this.S=m&&m.fastHandshake||!1,this.R=m&&m.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=m&&m.Pb||!1,m&&m.ua&&this.j.ua(),m&&m.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&m&&m.detectBufferingProxy||!1,this.ia=void 0,m&&m.longPollingTimeout&&m.longPollingTimeout>0&&(this.ia=m.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}t=us.prototype,t.ka=8,t.I=1,t.connect=function(m,x,C,U){Ht(0),this.W=m,this.H=x||{},C&&U!==void 0&&(this.H.OSID=C,this.H.OAID=U),this.F=this.X,this.J=td(this,null,this.W),li(this)};function ic(m){if(vo(m),m.I==3){var x=m.V++,C=Qt(m.J);if(dt(C,"SID",m.M),dt(C,"RID",x),dt(C,"TYPE","terminate"),Sa(m,C),x=new Or(m,m.j,x),x.M=2,x.A=ga(Qt(C)),C=!1,c.navigator&&c.navigator.sendBeacon)try{C=c.navigator.sendBeacon(x.A.toString(),"")}catch{}!C&&c.Image&&(new Image().src=x.A,C=!0),C||(x.g=nd(x.j,null),x.g.ea(x.A)),x.F=Date.now(),Zr(x)}ed(m)}function ds(m){m.g&&(ac(m),m.g.cancel(),m.g=null)}function vo(m){ds(m),m.v&&(c.clearTimeout(m.v),m.v=null),So(m),m.h.cancel(),m.m&&(typeof m.m=="number"&&c.clearTimeout(m.m),m.m=null)}function li(m){if(!Ql(m.h)&&!m.m){m.m=!0;var x=m.Ea;Q||R(),J||(Q(),J=!0),O.add(x,m),m.D=0}}function xo(m,x){return ni(m.h)>=m.h.j-(m.m?1:0)?!1:m.m?(m.i=x.G.concat(m.i),!0):m.I==1||m.I==2||m.D>=(m.Sa?0:m.Ta)?!1:(m.m=Yr(p(m.Ea,m,x),Zu(m,m.D)),m.D++,!0)}t.Ea=function(m){if(this.m)if(this.m=null,this.I==1){if(!m){this.V=Math.floor(Math.random()*1e5),m=this.V++;const ae=new Or(this,this.j,m);let me=this.o;if(this.U&&(me?(me=V(me),$(me,this.U)):me=this.U),this.u!==null||this.R||(ae.J=me,me=null),this.S)e:{for(var x=0,C=0;C<this.i.length;C++){t:{var U=this.i[C];if("__data__"in U.map&&(U=U.map.__data__,typeof U=="string")){U=U.length;break t}U=void 0}if(U===void 0)break;if(x+=U,x>4096){x=C;break e}if(x===4096||C===this.i.length-1){x=C+1;break e}}x=1e3}else x=1e3;x=Ku(this,ae,x),C=Qt(this.J),dt(C,"RID",m),dt(C,"CVER",22),this.G&&dt(C,"X-HTTP-Session-Id",this.G),Sa(this,C),me&&(this.R?x="headers="+Ti(pr(me))+"&"+x:this.u&&ba(C,this.u,me)),Wl(this.h,ae),this.Ra&&dt(C,"TYPE","init"),this.S?(dt(C,"$req",x),dt(C,"SID","null"),ae.U=!0,Jr(ae,C,null)):Jr(ae,C,x),this.I=2}}else this.I==3&&(m?sc(this,m):this.i.length==0||Ql(this.h)||sc(this))};function sc(m,x){var C;x?C=x.l:C=m.V++;const U=Qt(m.J);dt(U,"SID",m.M),dt(U,"RID",C),dt(U,"AID",m.K),Sa(m,U),m.u&&m.o&&ba(U,m.u,m.o),C=new Or(m,m.j,C,m.D+1),m.u===null&&(C.J=m.o),x&&(m.i=x.G.concat(m.i)),x=Ku(m,C,1e3),C.H=Math.round(m.va*.5)+Math.round(m.va*.5*Math.random()),Wl(m.h,C),Jr(C,U,x)}function Sa(m,x){m.H&&ne(m.H,function(C,U){dt(x,U,C)}),m.l&&ne({},function(C,U){dt(x,U,C)})}function Ku(m,x,C){C=Math.min(m.i.length,C);const U=m.l?p(m.l.Ka,m.l,m):null;e:{var ae=m.i;let Fe=-1;for(;;){const Pt=["count="+C];Fe==-1?C>0?(Fe=ae[0].g,Pt.push("ofs="+Fe)):Fe=0:Pt.push("ofs="+Fe);let ot=!0;for(let Ct=0;Ct<C;Ct++){var me=ae[Ct].g;const gr=ae[Ct].map;if(me-=Fe,me<0)Fe=Math.max(0,ae[Ct].g-100),ot=!1;else try{me="req"+me+"_"||"";try{var we=gr instanceof Map?gr:Object.entries(gr);for(const[ui,Br]of we){let Vr=Br;h(Br)&&(Vr=rs(Br)),Pt.push(me+ui+"="+encodeURIComponent(Vr))}}catch(ui){throw Pt.push(me+"type="+encodeURIComponent("_badmap")),ui}}catch{U&&U(gr)}}if(ot){we=Pt.join("&");break e}}we=void 0}return m=m.i.splice(0,C),x.G=m,we}function Yu(m){if(!m.g&&!m.v){m.Y=1;var x=m.Da;Q||R(),J||(Q(),J=!0),O.add(x,m),m.A=0}}function Ea(m){return m.g||m.v||m.A>=3?!1:(m.Y++,m.v=Yr(p(m.Da,m),Zu(m,m.A)),m.A++,!0)}t.Da=function(){if(this.v=null,Xu(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var m=4*this.T;this.j.info("BP detection timer enabled: "+m),this.B=Yr(p(this.Wa,this),m)}},t.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Ht(10),ds(this),Xu(this))};function ac(m){m.B!=null&&(c.clearTimeout(m.B),m.B=null)}function Xu(m){m.g=new Or(m,m.j,"rpc",m.Y),m.u===null&&(m.g.J=m.o),m.g.P=0;var x=Qt(m.na);dt(x,"RID","rpc"),dt(x,"SID",m.M),dt(x,"AID",m.K),dt(x,"CI",m.F?"0":"1"),!m.F&&m.ia&&dt(x,"TO",m.ia),dt(x,"TYPE","xmlhttp"),Sa(m,x),m.u&&m.o&&ba(x,m.u,m.o),m.O&&(m.g.H=m.O);var C=m.g;m=m.ba,C.M=1,C.A=ga(Qt(x)),C.u=null,C.R=!0,fo(C,m)}t.Va=function(){this.C!=null&&(this.C=null,ds(this),Ea(this),Ht(19))};function So(m){m.C!=null&&(c.clearTimeout(m.C),m.C=null)}function Ju(m,x){var C=null;if(m.g==x){So(m),ac(m),m.g=null;var U=2}else if(ri(m.h,x))C=x.G,Kl(m.h,x),U=1;else return;if(m.I!=0){if(x.o)if(U==1){C=x.u?x.u.length:0,x=Date.now()-x.F;var ae=m.D;U=ho(),kt(U,new Kr(U,C)),li(m)}else Yu(m);else if(ae=x.m,ae==3||ae==0&&x.X>0||!(U==1&&xo(m,x)||U==2&&Ea(m)))switch(C&&C.length>0&&(x=m.h,x.i=x.i.concat(C)),ae){case 1:ci(m,5);break;case 4:ci(m,10);break;case 3:ci(m,6);break;default:ci(m,2)}}}function Zu(m,x){let C=m.Qa+Math.floor(Math.random()*m.Za);return m.isActive()||(C*=2),C*x}function ci(m,x){if(m.j.info("Error code "+x),x==2){var C=p(m.bb,m),U=m.Ua;const ae=!U;U=new Jn(U||"//www.google.com/images/cleardot.gif"),c.location&&c.location.protocol=="http"||dn(U,"https"),ga(U),ae?Nr(U.toString(),C):tc(U.toString(),C)}else Ht(2);m.I=0,m.l&&m.l.pa(x),ed(m),vo(m)}t.bb=function(m){m?(this.j.info("Successfully pinged google.com"),Ht(2)):(this.j.info("Failed to ping google.com"),Ht(1))};function ed(m){if(m.I=0,m.ja=[],m.l){const x=Yl(m.h);(x.length!=0||m.i.length!=0)&&(E(m.ja,x),E(m.ja,m.i),m.h.i.length=0,T(m.i),m.i.length=0),m.l.oa()}}function td(m,x,C){var U=C instanceof Jn?Qt(C):new Jn(C);if(U.g!="")x&&(U.g=x+"."+U.g),is(U,U.u);else{var ae=c.location;U=ae.protocol,x=x?x+"."+ae.hostname:ae.hostname,ae=+ae.port;const me=new Jn(null);U&&dn(me,U),x&&(me.g=x),ae&&is(me,ae),C&&(me.h=C),U=me}return C=m.G,x=m.wa,C&&x&&dt(U,C,x),dt(U,"VER",m.ka),Sa(m,U),U}function nd(m,x,C){if(x&&!m.L)throw Error("Can't create secondary domain capable XhrIo object.");return x=m.Aa&&!m.ma?new mt(new si({ab:C})):new mt(m.ma),x.Fa(m.L),x}t.isActive=function(){return!!this.l&&this.l.isActive(this)};function rd(){}t=rd.prototype,t.ra=function(){},t.qa=function(){},t.pa=function(){},t.oa=function(){},t.isActive=function(){return!0},t.Ka=function(){};function hs(){}hs.prototype.g=function(m,x){return new Mn(m,x)};function Mn(m,x){bt.call(this),this.g=new us(x),this.l=m,this.h=x&&x.messageUrlParams||null,m=x&&x.messageHeaders||null,x&&x.clientProtocolHeaderRequired&&(m?m["X-Client-Protocol"]="webchannel":m={"X-Client-Protocol":"webchannel"}),this.g.o=m,m=x&&x.initMessageHeaders||null,x&&x.messageContentType&&(m?m["X-WebChannel-Content-Type"]=x.messageContentType:m={"X-WebChannel-Content-Type":x.messageContentType}),x&&x.sa&&(m?m["X-WebChannel-Client-Profile"]=x.sa:m={"X-WebChannel-Client-Profile":x.sa}),this.g.U=m,(m=x&&x.Qb)&&!k(m)&&(this.g.u=m),this.A=x&&x.supportsCrossDomainXhr||!1,this.v=x&&x.sendRawJson||!1,(x=x&&x.httpSessionIdParam)&&!k(x)&&(this.g.G=x,m=this.h,m!==null&&x in m&&(m=this.h,x in m&&delete m[x])),this.j=new Ri(this)}b(Mn,bt),Mn.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Mn.prototype.close=function(){ic(this.g)},Mn.prototype.o=function(m){var x=this.g;if(typeof m=="string"){var C={};C.__data__=m,m=C}else this.v&&(C={},C.__data__=rs(m),m=C);x.i.push(new $t(x.Ya++,m)),x.I==3&&li(x)},Mn.prototype.N=function(){this.g.l=null,delete this.j,ic(this.g),delete this.g,Mn.Z.N.call(this)};function id(m){gn.call(this),m.__headers__&&(this.headers=m.__headers__,this.statusCode=m.__status__,delete m.__headers__,delete m.__status__);var x=m.__sm__;if(x){e:{for(const C in x){m=C;break e}m=void 0}(this.i=m)&&(m=this.i,x=x!==null&&m in x?x[m]:void 0),this.data=x}else this.data=m}b(id,gn);function sd(){hr.call(this),this.status=1}b(sd,hr);function Ri(m){this.g=m}b(Ri,rd),Ri.prototype.ra=function(){kt(this.g,"a")},Ri.prototype.qa=function(m){kt(this.g,new id(m))},Ri.prototype.pa=function(m){kt(this.g,new sd)},Ri.prototype.oa=function(){kt(this.g,"b")},hs.prototype.createWebChannel=hs.prototype.g,Mn.prototype.send=Mn.prototype.o,Mn.prototype.open=Mn.prototype.m,Mn.prototype.close=Mn.prototype.close,rw=function(){return new hs},nw=function(){return ho()},tw=Nt,Rg={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},ma.NO_ERROR=0,ma.TIMEOUT=8,ma.HTTP_ERROR=6,vh=ma,Hl.COMPLETE="complete",ew=Hl,Lu.EventType=Ir,Ir.OPEN="a",Ir.CLOSE="b",Ir.ERROR="c",Ir.MESSAGE="d",bt.prototype.listen=bt.prototype.J,Wc=Lu,mt.prototype.listenOnce=mt.prototype.K,mt.prototype.getLastError=mt.prototype.Ha,mt.prototype.getLastErrorCode=mt.prototype.ya,mt.prototype.getStatus=mt.prototype.ca,mt.prototype.getResponseJson=mt.prototype.La,mt.prototype.getResponseText=mt.prototype.la,mt.prototype.send=mt.prototype.ea,mt.prototype.setWithCredentials=mt.prototype.Fa,ZE=mt}).apply(typeof dh<"u"?dh:typeof self<"u"?self:typeof window<"u"?window:{});const _x="@firebase/firestore",bx="4.9.3";class An{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}An.UNAUTHENTICATED=new An(null),An.GOOGLE_CREDENTIALS=new An("google-credentials-uid"),An.FIRST_PARTY=new An("first-party-uid"),An.MOCK_USER=new An("mock-user");let kl="12.7.0";const Ka=new fy("@firebase/firestore");function il(){return Ka.logLevel}function Ce(t,...e){if(Ka.logLevel<=Xe.DEBUG){const n=e.map(gy);Ka.debug(`Firestore (${kl}): ${t}`,...n)}}function Ji(t,...e){if(Ka.logLevel<=Xe.ERROR){const n=e.map(gy);Ka.error(`Firestore (${kl}): ${t}`,...n)}}function yl(t,...e){if(Ka.logLevel<=Xe.WARN){const n=e.map(gy);Ka.warn(`Firestore (${kl}): ${t}`,...n)}}function gy(t){if(typeof t=="string")return t;try{return(function(n){return JSON.stringify(n)})(t)}catch{return t}}function Pe(t,e,n){let i="Unexpected state";typeof e=="string"?i=e:n=e,iw(t,i,n)}function iw(t,e,n){let i=`FIRESTORE (${kl}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(n!==void 0)try{i+=" CONTEXT: "+JSON.stringify(n)}catch{i+=" CONTEXT: "+n}throw Ji(i),new Error(i)}function ct(t,e,n,i){let a="Unexpected state";typeof n=="string"?a=n:i=n,t||iw(e,a,i)}function ze(t,e){return t}const _e={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Te extends ts{constructor(e,n){super(e,n),this.code=e,this.message=n,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Ki{constructor(){this.promise=new Promise(((e,n)=>{this.resolve=e,this.reject=n}))}}class sw{constructor(e,n){this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class p2{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,n){e.enqueueRetryable((()=>n(An.UNAUTHENTICATED)))}shutdown(){}}class g2{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,n){this.changeListener=n,e.enqueueRetryable((()=>n(this.token.user)))}shutdown(){this.changeListener=null}}class y2{constructor(e){this.t=e,this.currentUser=An.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,n){ct(this.o===void 0,42304);let i=this.i;const a=f=>this.i!==i?(i=this.i,n(f)):Promise.resolve();let l=new Ki;this.o=()=>{this.i++,this.currentUser=this.u(),l.resolve(),l=new Ki,e.enqueueRetryable((()=>a(this.currentUser)))};const c=()=>{const f=l;e.enqueueRetryable((async()=>{await f.promise,await a(this.currentUser)}))},h=f=>{Ce("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=f,this.o&&(this.auth.addAuthTokenListener(this.o),c())};this.t.onInit((f=>h(f))),setTimeout((()=>{if(!this.auth){const f=this.t.getImmediate({optional:!0});f?h(f):(Ce("FirebaseAuthCredentialsProvider","Auth not yet detected"),l.resolve(),l=new Ki)}}),0),c()}getToken(){const e=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((i=>this.i!==e?(Ce("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(ct(typeof i.accessToken=="string",31837,{l:i}),new sw(i.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return ct(e===null||typeof e=="string",2055,{h:e}),new An(e)}}class _2{constructor(e,n,i){this.P=e,this.T=n,this.I=i,this.type="FirstParty",this.user=An.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class b2{constructor(e,n,i){this.P=e,this.T=n,this.I=i}getToken(){return Promise.resolve(new _2(this.P,this.T,this.I))}start(e,n){e.enqueueRetryable((()=>n(An.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class vx{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class v2{constructor(e,n){this.V=n,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,qr(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,n){ct(this.o===void 0,3512);const i=l=>{l.error!=null&&Ce("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${l.error.message}`);const c=l.token!==this.m;return this.m=l.token,Ce("FirebaseAppCheckTokenProvider",`Received ${c?"new":"existing"} token.`),c?n(l.token):Promise.resolve()};this.o=l=>{e.enqueueRetryable((()=>i(l)))};const a=l=>{Ce("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=l,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((l=>a(l))),setTimeout((()=>{if(!this.appCheck){const l=this.V.getImmediate({optional:!0});l?a(l):Ce("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new vx(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((n=>n?(ct(typeof n.token=="string",44558,{tokenResult:n}),this.m=n.token,new vx(n.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function x2(t){const e=typeof self<"u"&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&typeof e.getRandomValues=="function")e.getRandomValues(n);else for(let i=0;i<t;i++)n[i]=Math.floor(256*Math.random());return n}class yy{static newId(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const a=x2(40);for(let l=0;l<a.length;++l)i.length<20&&a[l]<n&&(i+=e.charAt(a[l]%62))}return i}}function Je(t,e){return t<e?-1:t>e?1:0}function Dg(t,e){const n=Math.min(t.length,e.length);for(let i=0;i<n;i++){const a=t.charAt(i),l=e.charAt(i);if(a!==l)return tg(a)===tg(l)?Je(a,l):tg(a)?1:-1}return Je(t.length,e.length)}const S2=55296,E2=57343;function tg(t){const e=t.charCodeAt(0);return e>=S2&&e<=E2}function _l(t,e,n){return t.length===e.length&&t.every(((i,a)=>n(i,e[a])))}const xx="__name__";class pi{constructor(e,n,i){n===void 0?n=0:n>e.length&&Pe(637,{offset:n,range:e.length}),i===void 0?i=e.length-n:i>e.length-n&&Pe(1746,{length:i,range:e.length-n}),this.segments=e,this.offset=n,this.len=i}get length(){return this.len}isEqual(e){return pi.comparator(this,e)===0}child(e){const n=this.segments.slice(this.offset,this.limit());return e instanceof pi?e.forEach((i=>{n.push(i)})):n.push(e),this.construct(n)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let n=0;n<this.length;n++)if(this.get(n)!==e.get(n))return!1;return!0}forEach(e){for(let n=this.offset,i=this.limit();n<i;n++)e(this.segments[n])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,n){const i=Math.min(e.length,n.length);for(let a=0;a<i;a++){const l=pi.compareSegments(e.get(a),n.get(a));if(l!==0)return l}return Je(e.length,n.length)}static compareSegments(e,n){const i=pi.isNumericId(e),a=pi.isNumericId(n);return i&&!a?-1:!i&&a?1:i&&a?pi.extractNumericId(e).compare(pi.extractNumericId(n)):Dg(e,n)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return Ks.fromString(e.substring(4,e.length-2))}}class vt extends pi{construct(e,n,i){return new vt(e,n,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const n=[];for(const i of e){if(i.indexOf("//")>=0)throw new Te(_e.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);n.push(...i.split("/").filter((a=>a.length>0)))}return new vt(n)}static emptyPath(){return new vt([])}}const w2=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class En extends pi{construct(e,n,i){return new En(e,n,i)}static isValidIdentifier(e){return w2.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),En.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===xx}static keyField(){return new En([xx])}static fromServerFormat(e){const n=[];let i="",a=0;const l=()=>{if(i.length===0)throw new Te(_e.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);n.push(i),i=""};let c=!1;for(;a<e.length;){const h=e[a];if(h==="\\"){if(a+1===e.length)throw new Te(_e.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const f=e[a+1];if(f!=="\\"&&f!=="."&&f!=="`")throw new Te(_e.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);i+=f,a+=2}else h==="`"?(c=!c,a++):h!=="."||c?(i+=h,a++):(l(),a++)}if(l(),c)throw new Te(_e.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new En(n)}static emptyPath(){return new En([])}}class Me{constructor(e){this.path=e}static fromPath(e){return new Me(vt.fromString(e))}static fromName(e){return new Me(vt.fromString(e).popFirst(5))}static empty(){return new Me(vt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&vt.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,n){return vt.comparator(e.path,n.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new Me(new vt(e.slice()))}}function aw(t,e,n){if(!n)throw new Te(_e.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}function T2(t,e,n,i){if(e===!0&&i===!0)throw new Te(_e.INVALID_ARGUMENT,`${t} and ${n} cannot be used together.`)}function Sx(t){if(!Me.isDocumentKey(t))throw new Te(_e.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Ex(t){if(Me.isDocumentKey(t))throw new Te(_e.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${t} has ${t.length}.`)}function ow(t){return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Object.prototype||Object.getPrototypeOf(t)===null)}function uf(t){if(t===void 0)return"undefined";if(t===null)return"null";if(typeof t=="string")return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if(typeof t=="number"||typeof t=="boolean")return""+t;if(typeof t=="object"){if(t instanceof Array)return"an array";{const e=(function(i){return i.constructor?i.constructor.name:null})(t);return e?`a custom ${e} object`:"an object"}}return typeof t=="function"?"a function":Pe(12329,{type:typeof t})}function Gr(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Te(_e.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=uf(t);throw new Te(_e.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}function nn(t,e){const n={typeString:t};return e&&(n.value=e),n}function Su(t,e){if(!ow(t))throw new Te(_e.INVALID_ARGUMENT,"JSON must be an object");let n;for(const i in e)if(e[i]){const a=e[i].typeString,l="value"in e[i]?{value:e[i].value}:void 0;if(!(i in t)){n=`JSON missing required field: '${i}'`;break}const c=t[i];if(a&&typeof c!==a){n=`JSON field '${i}' must be a ${a}.`;break}if(l!==void 0&&c!==l.value){n=`Expected '${i}' field to equal '${l.value}'`;break}}if(n)throw new Te(_e.INVALID_ARGUMENT,n);return!0}const wx=-62135596800,Tx=1e6;class Et{static now(){return Et.fromMillis(Date.now())}static fromDate(e){return Et.fromMillis(e.getTime())}static fromMillis(e){const n=Math.floor(e/1e3),i=Math.floor((e-1e3*n)*Tx);return new Et(n,i)}constructor(e,n){if(this.seconds=e,this.nanoseconds=n,n<0)throw new Te(_e.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Te(_e.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(e<wx)throw new Te(_e.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Te(_e.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Tx}_compareTo(e){return this.seconds===e.seconds?Je(this.nanoseconds,e.nanoseconds):Je(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Et._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(Su(e,Et._jsonSchema))return new Et(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-wx;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Et._jsonSchemaVersion="firestore/timestamp/1.0",Et._jsonSchema={type:nn("string",Et._jsonSchemaVersion),seconds:nn("number"),nanoseconds:nn("number")};class Be{static fromTimestamp(e){return new Be(e)}static min(){return new Be(new Et(0,0))}static max(){return new Be(new Et(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const ou=-1;function C2(t,e){const n=t.toTimestamp().seconds,i=t.toTimestamp().nanoseconds+1,a=Be.fromTimestamp(i===1e9?new Et(n+1,0):new Et(n,i));return new Zs(a,Me.empty(),e)}function A2(t){return new Zs(t.readTime,t.key,ou)}class Zs{constructor(e,n,i){this.readTime=e,this.documentKey=n,this.largestBatchId=i}static min(){return new Zs(Be.min(),Me.empty(),ou)}static max(){return new Zs(Be.max(),Me.empty(),ou)}}function R2(t,e){let n=t.readTime.compareTo(e.readTime);return n!==0?n:(n=Me.comparator(t.documentKey,e.documentKey),n!==0?n:Je(t.largestBatchId,e.largestBatchId))}const D2="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class j2{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Nl(t){if(t.code!==_e.FAILED_PRECONDITION||t.message!==D2)throw t;Ce("LocalStore","Unexpectedly lost primary lease")}class ve{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((n=>{this.isDone=!0,this.result=n,this.nextCallback&&this.nextCallback(n)}),(n=>{this.isDone=!0,this.error=n,this.catchCallback&&this.catchCallback(n)}))}catch(e){return this.next(void 0,e)}next(e,n){return this.callbackAttached&&Pe(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new ve(((i,a)=>{this.nextCallback=l=>{this.wrapSuccess(e,l).next(i,a)},this.catchCallback=l=>{this.wrapFailure(n,l).next(i,a)}}))}toPromise(){return new Promise(((e,n)=>{this.next(e,n)}))}wrapUserFunction(e){try{const n=e();return n instanceof ve?n:ve.resolve(n)}catch(n){return ve.reject(n)}}wrapSuccess(e,n){return e?this.wrapUserFunction((()=>e(n))):ve.resolve(n)}wrapFailure(e,n){return e?this.wrapUserFunction((()=>e(n))):ve.reject(n)}static resolve(e){return new ve(((n,i)=>{n(e)}))}static reject(e){return new ve(((n,i)=>{i(e)}))}static waitFor(e){return new ve(((n,i)=>{let a=0,l=0,c=!1;e.forEach((h=>{++a,h.next((()=>{++l,c&&l===a&&n()}),(f=>i(f)))})),c=!0,l===a&&n()}))}static or(e){let n=ve.resolve(!1);for(const i of e)n=n.next((a=>a?ve.resolve(a):i()));return n}static forEach(e,n){const i=[];return e.forEach(((a,l)=>{i.push(n.call(this,a,l))})),this.waitFor(i)}static mapArray(e,n){return new ve(((i,a)=>{const l=e.length,c=new Array(l);let h=0;for(let f=0;f<l;f++){const p=f;n(e[p]).next((_=>{c[p]=_,++h,h===l&&i(c)}),(_=>a(_)))}}))}static doWhile(e,n){return new ve(((i,a)=>{const l=()=>{e()===!0?n().next((()=>{l()}),a):i()};l()}))}}function I2(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}function Pl(t){return t.name==="IndexedDbTransactionError"}class df{constructor(e,n){this.previousValue=e,n&&(n.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>n.writeSequenceNumber(i))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}df.ce=-1;const _y=-1;function hf(t){return t==null}function Ph(t){return t===0&&1/t==-1/0}function M2(t){return typeof t=="number"&&Number.isInteger(t)&&!Ph(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}const lw="";function O2(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=Cx(e)),e=k2(t.get(n),e);return Cx(e)}function k2(t,e){let n=e;const i=t.length;for(let a=0;a<i;a++){const l=t.charAt(a);switch(l){case"\0":n+="";break;case lw:n+="";break;default:n+=l}}return n}function Cx(t){return t+lw+""}function Ax(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function oa(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function cw(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class jt{constructor(e,n){this.comparator=e,this.root=n||Sn.EMPTY}insert(e,n){return new jt(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,Sn.BLACK,null,null))}remove(e){return new jt(this.comparator,this.root.remove(e,this.comparator).copy(null,null,Sn.BLACK,null,null))}get(e){let n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(i===0)return n.value;i<0?n=n.left:i>0&&(n=n.right)}return null}indexOf(e){let n=0,i=this.root;for(;!i.isEmpty();){const a=this.comparator(e,i.key);if(a===0)return n+i.left.size;a<0?i=i.left:(n+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((n,i)=>(e(n,i),!1)))}toString(){const e=[];return this.inorderTraversal(((n,i)=>(e.push(`${n}:${i}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new hh(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new hh(this.root,e,this.comparator,!1)}getReverseIterator(){return new hh(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new hh(this.root,e,this.comparator,!0)}}class hh{constructor(e,n,i,a){this.isReverse=a,this.nodeStack=[];let l=1;for(;!e.isEmpty();)if(l=n?i(e.key,n):1,n&&a&&(l*=-1),l<0)e=this.isReverse?e.left:e.right;else{if(l===0){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const n={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return n}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class Sn{constructor(e,n,i,a,l){this.key=e,this.value=n,this.color=i??Sn.RED,this.left=a??Sn.EMPTY,this.right=l??Sn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,n,i,a,l){return new Sn(e??this.key,n??this.value,i??this.color,a??this.left,l??this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,n,i){let a=this;const l=i(e,a.key);return a=l<0?a.copy(null,null,null,a.left.insert(e,n,i),null):l===0?a.copy(null,n,null,null,null):a.copy(null,null,null,null,a.right.insert(e,n,i)),a.fixUp()}removeMin(){if(this.left.isEmpty())return Sn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,n){let i,a=this;if(n(e,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(e,n),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),n(e,a.key)===0){if(a.right.isEmpty())return Sn.EMPTY;i=a.right.min(),a=a.copy(i.key,i.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(e,n))}return a.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,Sn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,Sn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),n=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,n)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Pe(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Pe(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Pe(27949);return e+(this.isRed()?0:1)}}Sn.EMPTY=null,Sn.RED=!0,Sn.BLACK=!1;Sn.EMPTY=new class{constructor(){this.size=0}get key(){throw Pe(57766)}get value(){throw Pe(16141)}get color(){throw Pe(16727)}get left(){throw Pe(29726)}get right(){throw Pe(36894)}copy(e,n,i,a,l){return this}insert(e,n,i){return new Sn(e,n)}remove(e,n){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ln{constructor(e){this.comparator=e,this.data=new jt(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((n,i)=>(e(n),!1)))}forEachInRange(e,n){const i=this.data.getIteratorFrom(e[0]);for(;i.hasNext();){const a=i.getNext();if(this.comparator(a.key,e[1])>=0)return;n(a.key)}}forEachWhile(e,n){let i;for(i=n!==void 0?this.data.getIteratorFrom(n):this.data.getIterator();i.hasNext();)if(!e(i.getNext().key))return}firstAfterOrEqual(e){const n=this.data.getIteratorFrom(e);return n.hasNext()?n.getNext().key:null}getIterator(){return new Rx(this.data.getIterator())}getIteratorFrom(e){return new Rx(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let n=this;return n.size<e.size&&(n=e,e=this),e.forEach((i=>{n=n.add(i)})),n}isEqual(e){if(!(e instanceof ln)||this.size!==e.size)return!1;const n=this.data.getIterator(),i=e.data.getIterator();for(;n.hasNext();){const a=n.getNext().key,l=i.getNext().key;if(this.comparator(a,l)!==0)return!1}return!0}toArray(){const e=[];return this.forEach((n=>{e.push(n)})),e}toString(){const e=[];return this.forEach((n=>e.push(n))),"SortedSet("+e.toString()+")"}copy(e){const n=new ln(this.comparator);return n.data=e,n}}class Rx{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class ar{constructor(e){this.fields=e,e.sort(En.comparator)}static empty(){return new ar([])}unionWith(e){let n=new ln(En.comparator);for(const i of this.fields)n=n.add(i);for(const i of e)n=n.add(i);return new ar(n.toArray())}covers(e){for(const n of this.fields)if(n.isPrefixOf(e))return!0;return!1}isEqual(e){return _l(this.fields,e.fields,((n,i)=>n.isEqual(i)))}}class uw extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class wn{constructor(e){this.binaryString=e}static fromBase64String(e){const n=(function(a){try{return atob(a)}catch(l){throw typeof DOMException<"u"&&l instanceof DOMException?new uw("Invalid base64 string: "+l):l}})(e);return new wn(n)}static fromUint8Array(e){const n=(function(a){let l="";for(let c=0;c<a.length;++c)l+=String.fromCharCode(a[c]);return l})(e);return new wn(n)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(n){return btoa(n)})(this.binaryString)}toUint8Array(){return(function(n){const i=new Uint8Array(n.length);for(let a=0;a<n.length;a++)i[a]=n.charCodeAt(a);return i})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Je(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}wn.EMPTY_BYTE_STRING=new wn("");const N2=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ea(t){if(ct(!!t,39018),typeof t=="string"){let e=0;const n=N2.exec(t);if(ct(!!n,46558,{timestamp:t}),n[1]){let a=n[1];a=(a+"000000000").substr(0,9),e=Number(a)}const i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:Vt(t.seconds),nanos:Vt(t.nanos)}}function Vt(t){return typeof t=="number"?t:typeof t=="string"?Number(t):0}function ta(t){return typeof t=="string"?wn.fromBase64String(t):wn.fromUint8Array(t)}const dw="server_timestamp",hw="__type__",fw="__previous_value__",mw="__local_write_time__";function by(t){return(t?.mapValue?.fields||{})[hw]?.stringValue===dw}function ff(t){const e=t.mapValue.fields[fw];return by(e)?ff(e):e}function lu(t){const e=ea(t.mapValue.fields[mw].timestampValue);return new Et(e.seconds,e.nanos)}class P2{constructor(e,n,i,a,l,c,h,f,p,_){this.databaseId=e,this.appId=n,this.persistenceKey=i,this.host=a,this.ssl=l,this.forceLongPolling=c,this.autoDetectLongPolling=h,this.longPollingOptions=f,this.useFetchStreams=p,this.isUsingEmulator=_}}const Lh="(default)";class cu{constructor(e,n){this.projectId=e,this.database=n||Lh}static empty(){return new cu("","")}get isDefaultDatabase(){return this.database===Lh}isEqual(e){return e instanceof cu&&e.projectId===this.projectId&&e.database===this.database}}const pw="__type__",L2="__max__",fh={mapValue:{}},gw="__vector__",Bh="value";function na(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?by(t)?4:V2(t)?9007199254740991:B2(t)?10:11:Pe(28295,{value:t})}function Si(t,e){if(t===e)return!0;const n=na(t);if(n!==na(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return lu(t).isEqual(lu(e));case 3:return(function(a,l){if(typeof a.timestampValue=="string"&&typeof l.timestampValue=="string"&&a.timestampValue.length===l.timestampValue.length)return a.timestampValue===l.timestampValue;const c=ea(a.timestampValue),h=ea(l.timestampValue);return c.seconds===h.seconds&&c.nanos===h.nanos})(t,e);case 5:return t.stringValue===e.stringValue;case 6:return(function(a,l){return ta(a.bytesValue).isEqual(ta(l.bytesValue))})(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return(function(a,l){return Vt(a.geoPointValue.latitude)===Vt(l.geoPointValue.latitude)&&Vt(a.geoPointValue.longitude)===Vt(l.geoPointValue.longitude)})(t,e);case 2:return(function(a,l){if("integerValue"in a&&"integerValue"in l)return Vt(a.integerValue)===Vt(l.integerValue);if("doubleValue"in a&&"doubleValue"in l){const c=Vt(a.doubleValue),h=Vt(l.doubleValue);return c===h?Ph(c)===Ph(h):isNaN(c)&&isNaN(h)}return!1})(t,e);case 9:return _l(t.arrayValue.values||[],e.arrayValue.values||[],Si);case 10:case 11:return(function(a,l){const c=a.mapValue.fields||{},h=l.mapValue.fields||{};if(Ax(c)!==Ax(h))return!1;for(const f in c)if(c.hasOwnProperty(f)&&(h[f]===void 0||!Si(c[f],h[f])))return!1;return!0})(t,e);default:return Pe(52216,{left:t})}}function uu(t,e){return(t.values||[]).find((n=>Si(n,e)))!==void 0}function bl(t,e){if(t===e)return 0;const n=na(t),i=na(e);if(n!==i)return Je(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return Je(t.booleanValue,e.booleanValue);case 2:return(function(l,c){const h=Vt(l.integerValue||l.doubleValue),f=Vt(c.integerValue||c.doubleValue);return h<f?-1:h>f?1:h===f?0:isNaN(h)?isNaN(f)?0:-1:1})(t,e);case 3:return Dx(t.timestampValue,e.timestampValue);case 4:return Dx(lu(t),lu(e));case 5:return Dg(t.stringValue,e.stringValue);case 6:return(function(l,c){const h=ta(l),f=ta(c);return h.compareTo(f)})(t.bytesValue,e.bytesValue);case 7:return(function(l,c){const h=l.split("/"),f=c.split("/");for(let p=0;p<h.length&&p<f.length;p++){const _=Je(h[p],f[p]);if(_!==0)return _}return Je(h.length,f.length)})(t.referenceValue,e.referenceValue);case 8:return(function(l,c){const h=Je(Vt(l.latitude),Vt(c.latitude));return h!==0?h:Je(Vt(l.longitude),Vt(c.longitude))})(t.geoPointValue,e.geoPointValue);case 9:return jx(t.arrayValue,e.arrayValue);case 10:return(function(l,c){const h=l.fields||{},f=c.fields||{},p=h[Bh]?.arrayValue,_=f[Bh]?.arrayValue,b=Je(p?.values?.length||0,_?.values?.length||0);return b!==0?b:jx(p,_)})(t.mapValue,e.mapValue);case 11:return(function(l,c){if(l===fh.mapValue&&c===fh.mapValue)return 0;if(l===fh.mapValue)return 1;if(c===fh.mapValue)return-1;const h=l.fields||{},f=Object.keys(h),p=c.fields||{},_=Object.keys(p);f.sort(),_.sort();for(let b=0;b<f.length&&b<_.length;++b){const v=Dg(f[b],_[b]);if(v!==0)return v;const T=bl(h[f[b]],p[_[b]]);if(T!==0)return T}return Je(f.length,_.length)})(t.mapValue,e.mapValue);default:throw Pe(23264,{he:n})}}function Dx(t,e){if(typeof t=="string"&&typeof e=="string"&&t.length===e.length)return Je(t,e);const n=ea(t),i=ea(e),a=Je(n.seconds,i.seconds);return a!==0?a:Je(n.nanos,i.nanos)}function jx(t,e){const n=t.values||[],i=e.values||[];for(let a=0;a<n.length&&a<i.length;++a){const l=bl(n[a],i[a]);if(l)return l}return Je(n.length,i.length)}function vl(t){return jg(t)}function jg(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?(function(n){const i=ea(n);return`time(${i.seconds},${i.nanos})`})(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?(function(n){return ta(n).toBase64()})(t.bytesValue):"referenceValue"in t?(function(n){return Me.fromName(n).toString()})(t.referenceValue):"geoPointValue"in t?(function(n){return`geo(${n.latitude},${n.longitude})`})(t.geoPointValue):"arrayValue"in t?(function(n){let i="[",a=!0;for(const l of n.values||[])a?a=!1:i+=",",i+=jg(l);return i+"]"})(t.arrayValue):"mapValue"in t?(function(n){const i=Object.keys(n.fields||{}).sort();let a="{",l=!0;for(const c of i)l?l=!1:a+=",",a+=`${c}:${jg(n.fields[c])}`;return a+"}"})(t.mapValue):Pe(61005,{value:t})}function xh(t){switch(na(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=ff(t);return e?16+xh(e):16;case 5:return 2*t.stringValue.length;case 6:return ta(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return(function(i){return(i.values||[]).reduce(((a,l)=>a+xh(l)),0)})(t.arrayValue);case 10:case 11:return(function(i){let a=0;return oa(i.fields,((l,c)=>{a+=l.length+xh(c)})),a})(t.mapValue);default:throw Pe(13486,{value:t})}}function Ix(t,e){return{referenceValue:`projects/${t.projectId}/databases/${t.database}/documents/${e.path.canonicalString()}`}}function Ig(t){return!!t&&"integerValue"in t}function vy(t){return!!t&&"arrayValue"in t}function Mx(t){return!!t&&"nullValue"in t}function Ox(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Sh(t){return!!t&&"mapValue"in t}function B2(t){return(t?.mapValue?.fields||{})[pw]?.stringValue===gw}function Zc(t){if(t.geoPointValue)return{geoPointValue:{...t.geoPointValue}};if(t.timestampValue&&typeof t.timestampValue=="object")return{timestampValue:{...t.timestampValue}};if(t.mapValue){const e={mapValue:{fields:{}}};return oa(t.mapValue.fields,((n,i)=>e.mapValue.fields[n]=Zc(i))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=Zc(t.arrayValue.values[n]);return e}return{...t}}function V2(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===L2}class Gn{constructor(e){this.value=e}static empty(){return new Gn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let n=this.value;for(let i=0;i<e.length-1;++i)if(n=(n.mapValue.fields||{})[e.get(i)],!Sh(n))return null;return n=(n.mapValue.fields||{})[e.lastSegment()],n||null}}set(e,n){this.getFieldsMap(e.popLast())[e.lastSegment()]=Zc(n)}setAll(e){let n=En.emptyPath(),i={},a=[];e.forEach(((c,h)=>{if(!n.isImmediateParentOf(h)){const f=this.getFieldsMap(n);this.applyChanges(f,i,a),i={},a=[],n=h.popLast()}c?i[h.lastSegment()]=Zc(c):a.push(h.lastSegment())}));const l=this.getFieldsMap(n);this.applyChanges(l,i,a)}delete(e){const n=this.field(e.popLast());Sh(n)&&n.mapValue.fields&&delete n.mapValue.fields[e.lastSegment()]}isEqual(e){return Si(this.value,e.value)}getFieldsMap(e){let n=this.value;n.mapValue.fields||(n.mapValue={fields:{}});for(let i=0;i<e.length;++i){let a=n.mapValue.fields[e.get(i)];Sh(a)&&a.mapValue.fields||(a={mapValue:{fields:{}}},n.mapValue.fields[e.get(i)]=a),n=a}return n.mapValue.fields}applyChanges(e,n,i){oa(n,((a,l)=>e[a]=l));for(const a of i)delete e[a]}clone(){return new Gn(Zc(this.value))}}function yw(t){const e=[];return oa(t.fields,((n,i)=>{const a=new En([n]);if(Sh(i)){const l=yw(i.mapValue).fields;if(l.length===0)e.push(a);else for(const c of l)e.push(a.child(c))}else e.push(a)})),new ar(e)}class Rn{constructor(e,n,i,a,l,c,h){this.key=e,this.documentType=n,this.version=i,this.readTime=a,this.createTime=l,this.data=c,this.documentState=h}static newInvalidDocument(e){return new Rn(e,0,Be.min(),Be.min(),Be.min(),Gn.empty(),0)}static newFoundDocument(e,n,i,a){return new Rn(e,1,n,Be.min(),i,a,0)}static newNoDocument(e,n){return new Rn(e,2,n,Be.min(),Be.min(),Gn.empty(),0)}static newUnknownDocument(e,n){return new Rn(e,3,n,Be.min(),Be.min(),Gn.empty(),2)}convertToFoundDocument(e,n){return!this.createTime.isEqual(Be.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=e),this.version=e,this.documentType=1,this.data=n,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Gn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Gn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Be.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof Rn&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Rn(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Vh{constructor(e,n){this.position=e,this.inclusive=n}}function kx(t,e,n){let i=0;for(let a=0;a<t.position.length;a++){const l=e[a],c=t.position[a];if(l.field.isKeyField()?i=Me.comparator(Me.fromName(c.referenceValue),n.key):i=bl(c,n.data.field(l.field)),l.dir==="desc"&&(i*=-1),i!==0)break}return i}function Nx(t,e){if(t===null)return e===null;if(e===null||t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Si(t.position[n],e.position[n]))return!1;return!0}class Uh{constructor(e,n="asc"){this.field=e,this.dir=n}}function U2(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class _w{}class tn extends _w{constructor(e,n,i){super(),this.field=e,this.op=n,this.value=i}static create(e,n,i){return e.isKeyField()?n==="in"||n==="not-in"?this.createKeyFieldInFilter(e,n,i):new F2(e,n,i):n==="array-contains"?new G2(e,i):n==="in"?new $2(e,i):n==="not-in"?new Q2(e,i):n==="array-contains-any"?new W2(e,i):new tn(e,n,i)}static createKeyFieldInFilter(e,n,i){return n==="in"?new q2(e,i):new H2(e,i)}matches(e){const n=e.data.field(this.field);return this.op==="!="?n!==null&&n.nullValue===void 0&&this.matchesComparison(bl(n,this.value)):n!==null&&na(this.value)===na(n)&&this.matchesComparison(bl(n,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return Pe(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class $r extends _w{constructor(e,n){super(),this.filters=e,this.op=n,this.Pe=null}static create(e,n){return new $r(e,n)}matches(e){return bw(this)?this.filters.find((n=>!n.matches(e)))===void 0:this.filters.find((n=>n.matches(e)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((e,n)=>e.concat(n.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function bw(t){return t.op==="and"}function vw(t){return z2(t)&&bw(t)}function z2(t){for(const e of t.filters)if(e instanceof $r)return!1;return!0}function Mg(t){if(t instanceof tn)return t.field.canonicalString()+t.op.toString()+vl(t.value);if(vw(t))return t.filters.map((e=>Mg(e))).join(",");{const e=t.filters.map((n=>Mg(n))).join(",");return`${t.op}(${e})`}}function xw(t,e){return t instanceof tn?(function(i,a){return a instanceof tn&&i.op===a.op&&i.field.isEqual(a.field)&&Si(i.value,a.value)})(t,e):t instanceof $r?(function(i,a){return a instanceof $r&&i.op===a.op&&i.filters.length===a.filters.length?i.filters.reduce(((l,c,h)=>l&&xw(c,a.filters[h])),!0):!1})(t,e):void Pe(19439)}function Sw(t){return t instanceof tn?(function(n){return`${n.field.canonicalString()} ${n.op} ${vl(n.value)}`})(t):t instanceof $r?(function(n){return n.op.toString()+" {"+n.getFilters().map(Sw).join(" ,")+"}"})(t):"Filter"}class F2 extends tn{constructor(e,n,i){super(e,n,i),this.key=Me.fromName(i.referenceValue)}matches(e){const n=Me.comparator(e.key,this.key);return this.matchesComparison(n)}}class q2 extends tn{constructor(e,n){super(e,"in",n),this.keys=Ew("in",n)}matches(e){return this.keys.some((n=>n.isEqual(e.key)))}}class H2 extends tn{constructor(e,n){super(e,"not-in",n),this.keys=Ew("not-in",n)}matches(e){return!this.keys.some((n=>n.isEqual(e.key)))}}function Ew(t,e){return(e.arrayValue?.values||[]).map((n=>Me.fromName(n.referenceValue)))}class G2 extends tn{constructor(e,n){super(e,"array-contains",n)}matches(e){const n=e.data.field(this.field);return vy(n)&&uu(n.arrayValue,this.value)}}class $2 extends tn{constructor(e,n){super(e,"in",n)}matches(e){const n=e.data.field(this.field);return n!==null&&uu(this.value.arrayValue,n)}}class Q2 extends tn{constructor(e,n){super(e,"not-in",n)}matches(e){if(uu(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const n=e.data.field(this.field);return n!==null&&n.nullValue===void 0&&!uu(this.value.arrayValue,n)}}class W2 extends tn{constructor(e,n){super(e,"array-contains-any",n)}matches(e){const n=e.data.field(this.field);return!(!vy(n)||!n.arrayValue.values)&&n.arrayValue.values.some((i=>uu(this.value.arrayValue,i)))}}class K2{constructor(e,n=null,i=[],a=[],l=null,c=null,h=null){this.path=e,this.collectionGroup=n,this.orderBy=i,this.filters=a,this.limit=l,this.startAt=c,this.endAt=h,this.Te=null}}function Px(t,e=null,n=[],i=[],a=null,l=null,c=null){return new K2(t,e,n,i,a,l,c)}function xy(t){const e=ze(t);if(e.Te===null){let n=e.path.canonicalString();e.collectionGroup!==null&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map((i=>Mg(i))).join(","),n+="|ob:",n+=e.orderBy.map((i=>(function(l){return l.field.canonicalString()+l.dir})(i))).join(","),hf(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=e.startAt.inclusive?"b:":"a:",n+=e.startAt.position.map((i=>vl(i))).join(",")),e.endAt&&(n+="|ub:",n+=e.endAt.inclusive?"a:":"b:",n+=e.endAt.position.map((i=>vl(i))).join(",")),e.Te=n}return e.Te}function Sy(t,e){if(t.limit!==e.limit||t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!U2(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!xw(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Nx(t.startAt,e.startAt)&&Nx(t.endAt,e.endAt)}function Og(t){return Me.isDocumentKey(t.path)&&t.collectionGroup===null&&t.filters.length===0}class Eu{constructor(e,n=null,i=[],a=[],l=null,c="F",h=null,f=null){this.path=e,this.collectionGroup=n,this.explicitOrderBy=i,this.filters=a,this.limit=l,this.limitType=c,this.startAt=h,this.endAt=f,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Y2(t,e,n,i,a,l,c,h){return new Eu(t,e,n,i,a,l,c,h)}function Ey(t){return new Eu(t)}function Lx(t){return t.filters.length===0&&t.limit===null&&t.startAt==null&&t.endAt==null&&(t.explicitOrderBy.length===0||t.explicitOrderBy.length===1&&t.explicitOrderBy[0].field.isKeyField())}function ww(t){return t.collectionGroup!==null}function eu(t){const e=ze(t);if(e.Ie===null){e.Ie=[];const n=new Set;for(const l of e.explicitOrderBy)e.Ie.push(l),n.add(l.field.canonicalString());const i=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";(function(c){let h=new ln(En.comparator);return c.filters.forEach((f=>{f.getFlattenedFilters().forEach((p=>{p.isInequality()&&(h=h.add(p.field))}))})),h})(e).forEach((l=>{n.has(l.canonicalString())||l.isKeyField()||e.Ie.push(new Uh(l,i))})),n.has(En.keyField().canonicalString())||e.Ie.push(new Uh(En.keyField(),i))}return e.Ie}function gi(t){const e=ze(t);return e.Ee||(e.Ee=X2(e,eu(t))),e.Ee}function X2(t,e){if(t.limitType==="F")return Px(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((a=>{const l=a.dir==="desc"?"asc":"desc";return new Uh(a.field,l)}));const n=t.endAt?new Vh(t.endAt.position,t.endAt.inclusive):null,i=t.startAt?new Vh(t.startAt.position,t.startAt.inclusive):null;return Px(t.path,t.collectionGroup,e,t.filters,t.limit,n,i)}}function kg(t,e){const n=t.filters.concat([e]);return new Eu(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}function Ng(t,e,n){return new Eu(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function mf(t,e){return Sy(gi(t),gi(e))&&t.limitType===e.limitType}function Tw(t){return`${xy(gi(t))}|lt:${t.limitType}`}function sl(t){return`Query(target=${(function(n){let i=n.path.canonicalString();return n.collectionGroup!==null&&(i+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(i+=`, filters: [${n.filters.map((a=>Sw(a))).join(", ")}]`),hf(n.limit)||(i+=", limit: "+n.limit),n.orderBy.length>0&&(i+=`, orderBy: [${n.orderBy.map((a=>(function(c){return`${c.field.canonicalString()} (${c.dir})`})(a))).join(", ")}]`),n.startAt&&(i+=", startAt: ",i+=n.startAt.inclusive?"b:":"a:",i+=n.startAt.position.map((a=>vl(a))).join(",")),n.endAt&&(i+=", endAt: ",i+=n.endAt.inclusive?"a:":"b:",i+=n.endAt.position.map((a=>vl(a))).join(",")),`Target(${i})`})(gi(t))}; limitType=${t.limitType})`}function pf(t,e){return e.isFoundDocument()&&(function(i,a){const l=a.key.path;return i.collectionGroup!==null?a.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(l):Me.isDocumentKey(i.path)?i.path.isEqual(l):i.path.isImmediateParentOf(l)})(t,e)&&(function(i,a){for(const l of eu(i))if(!l.field.isKeyField()&&a.data.field(l.field)===null)return!1;return!0})(t,e)&&(function(i,a){for(const l of i.filters)if(!l.matches(a))return!1;return!0})(t,e)&&(function(i,a){return!(i.startAt&&!(function(c,h,f){const p=kx(c,h,f);return c.inclusive?p<=0:p<0})(i.startAt,eu(i),a)||i.endAt&&!(function(c,h,f){const p=kx(c,h,f);return c.inclusive?p>=0:p>0})(i.endAt,eu(i),a))})(t,e)}function J2(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}function Cw(t){return(e,n)=>{let i=!1;for(const a of eu(t)){const l=Z2(a,e,n);if(l!==0)return l;i=i||a.field.isKeyField()}return 0}}function Z2(t,e,n){const i=t.field.isKeyField()?Me.comparator(e.key,n.key):(function(l,c,h){const f=c.data.field(l),p=h.data.field(l);return f!==null&&p!==null?bl(f,p):Pe(42886)})(t.field,e,n);switch(t.dir){case"asc":return i;case"desc":return-1*i;default:return Pe(19790,{direction:t.dir})}}class eo{constructor(e,n){this.mapKeyFn=e,this.equalsFn=n,this.inner={},this.innerSize=0}get(e){const n=this.mapKeyFn(e),i=this.inner[n];if(i!==void 0){for(const[a,l]of i)if(this.equalsFn(a,e))return l}}has(e){return this.get(e)!==void 0}set(e,n){const i=this.mapKeyFn(e),a=this.inner[i];if(a===void 0)return this.inner[i]=[[e,n]],void this.innerSize++;for(let l=0;l<a.length;l++)if(this.equalsFn(a[l][0],e))return void(a[l]=[e,n]);a.push([e,n]),this.innerSize++}delete(e){const n=this.mapKeyFn(e),i=this.inner[n];if(i===void 0)return!1;for(let a=0;a<i.length;a++)if(this.equalsFn(i[a][0],e))return i.length===1?delete this.inner[n]:i.splice(a,1),this.innerSize--,!0;return!1}forEach(e){oa(this.inner,((n,i)=>{for(const[a,l]of i)e(a,l)}))}isEmpty(){return cw(this.inner)}size(){return this.innerSize}}const e5=new jt(Me.comparator);function Zi(){return e5}const Aw=new jt(Me.comparator);function Kc(...t){let e=Aw;for(const n of t)e=e.insert(n.key,n);return e}function Rw(t){let e=Aw;return t.forEach(((n,i)=>e=e.insert(n,i.overlayedDocument))),e}function Ha(){return tu()}function Dw(){return tu()}function tu(){return new eo((t=>t.toString()),((t,e)=>t.isEqual(e)))}const t5=new jt(Me.comparator),n5=new ln(Me.comparator);function Ze(...t){let e=n5;for(const n of t)e=e.add(n);return e}const r5=new ln(Je);function i5(){return r5}function wy(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Ph(e)?"-0":e}}function jw(t){return{integerValue:""+t}}function s5(t,e){return M2(e)?jw(e):wy(t,e)}class gf{constructor(){this._=void 0}}function a5(t,e,n){return t instanceof zh?(function(a,l){const c={fields:{[hw]:{stringValue:dw},[mw]:{timestampValue:{seconds:a.seconds,nanos:a.nanoseconds}}}};return l&&by(l)&&(l=ff(l)),l&&(c.fields[fw]=l),{mapValue:c}})(n,e):t instanceof xl?Mw(t,e):t instanceof du?Ow(t,e):(function(a,l){const c=Iw(a,l),h=Bx(c)+Bx(a.Ae);return Ig(c)&&Ig(a.Ae)?jw(h):wy(a.serializer,h)})(t,e)}function o5(t,e,n){return t instanceof xl?Mw(t,e):t instanceof du?Ow(t,e):n}function Iw(t,e){return t instanceof Fh?(function(i){return Ig(i)||(function(l){return!!l&&"doubleValue"in l})(i)})(e)?e:{integerValue:0}:null}class zh extends gf{}class xl extends gf{constructor(e){super(),this.elements=e}}function Mw(t,e){const n=kw(e);for(const i of t.elements)n.some((a=>Si(a,i)))||n.push(i);return{arrayValue:{values:n}}}class du extends gf{constructor(e){super(),this.elements=e}}function Ow(t,e){let n=kw(e);for(const i of t.elements)n=n.filter((a=>!Si(a,i)));return{arrayValue:{values:n}}}class Fh extends gf{constructor(e,n){super(),this.serializer=e,this.Ae=n}}function Bx(t){return Vt(t.integerValue||t.doubleValue)}function kw(t){return vy(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class l5{constructor(e,n){this.field=e,this.transform=n}}function c5(t,e){return t.field.isEqual(e.field)&&(function(i,a){return i instanceof xl&&a instanceof xl||i instanceof du&&a instanceof du?_l(i.elements,a.elements,Si):i instanceof Fh&&a instanceof Fh?Si(i.Ae,a.Ae):i instanceof zh&&a instanceof zh})(t.transform,e.transform)}class u5{constructor(e,n){this.version=e,this.transformResults=n}}class $n{constructor(e,n){this.updateTime=e,this.exists=n}static none(){return new $n}static exists(e){return new $n(void 0,e)}static updateTime(e){return new $n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function Eh(t,e){return t.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(t.updateTime):t.exists===void 0||t.exists===e.isFoundDocument()}class yf{}function Nw(t,e){if(!t.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return t.isNoDocument()?new _f(t.key,$n.none()):new wu(t.key,t.data,$n.none());{const n=t.data,i=Gn.empty();let a=new ln(En.comparator);for(let l of e.fields)if(!a.has(l)){let c=n.field(l);c===null&&l.length>1&&(l=l.popLast(),c=n.field(l)),c===null?i.delete(l):i.set(l,c),a=a.add(l)}return new la(t.key,i,new ar(a.toArray()),$n.none())}}function d5(t,e,n){t instanceof wu?(function(a,l,c){const h=a.value.clone(),f=Ux(a.fieldTransforms,l,c.transformResults);h.setAll(f),l.convertToFoundDocument(c.version,h).setHasCommittedMutations()})(t,e,n):t instanceof la?(function(a,l,c){if(!Eh(a.precondition,l))return void l.convertToUnknownDocument(c.version);const h=Ux(a.fieldTransforms,l,c.transformResults),f=l.data;f.setAll(Pw(a)),f.setAll(h),l.convertToFoundDocument(c.version,f).setHasCommittedMutations()})(t,e,n):(function(a,l,c){l.convertToNoDocument(c.version).setHasCommittedMutations()})(0,e,n)}function nu(t,e,n,i){return t instanceof wu?(function(l,c,h,f){if(!Eh(l.precondition,c))return h;const p=l.value.clone(),_=zx(l.fieldTransforms,f,c);return p.setAll(_),c.convertToFoundDocument(c.version,p).setHasLocalMutations(),null})(t,e,n,i):t instanceof la?(function(l,c,h,f){if(!Eh(l.precondition,c))return h;const p=zx(l.fieldTransforms,f,c),_=c.data;return _.setAll(Pw(l)),_.setAll(p),c.convertToFoundDocument(c.version,_).setHasLocalMutations(),h===null?null:h.unionWith(l.fieldMask.fields).unionWith(l.fieldTransforms.map((b=>b.field)))})(t,e,n,i):(function(l,c,h){return Eh(l.precondition,c)?(c.convertToNoDocument(c.version).setHasLocalMutations(),null):h})(t,e,n)}function h5(t,e){let n=null;for(const i of t.fieldTransforms){const a=e.data.field(i.field),l=Iw(i.transform,a||null);l!=null&&(n===null&&(n=Gn.empty()),n.set(i.field,l))}return n||null}function Vx(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!(function(i,a){return i===void 0&&a===void 0||!(!i||!a)&&_l(i,a,((l,c)=>c5(l,c)))})(t.fieldTransforms,e.fieldTransforms)&&(t.type===0?t.value.isEqual(e.value):t.type!==1||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class wu extends yf{constructor(e,n,i,a=[]){super(),this.key=e,this.value=n,this.precondition=i,this.fieldTransforms=a,this.type=0}getFieldMask(){return null}}class la extends yf{constructor(e,n,i,a,l=[]){super(),this.key=e,this.data=n,this.fieldMask=i,this.precondition=a,this.fieldTransforms=l,this.type=1}getFieldMask(){return this.fieldMask}}function Pw(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=t.data.field(n);e.set(n,i)}})),e}function Ux(t,e,n){const i=new Map;ct(t.length===n.length,32656,{Re:n.length,Ve:t.length});for(let a=0;a<n.length;a++){const l=t[a],c=l.transform,h=e.data.field(l.field);i.set(l.field,o5(c,h,n[a]))}return i}function zx(t,e,n){const i=new Map;for(const a of t){const l=a.transform,c=n.data.field(a.field);i.set(a.field,a5(l,c,e))}return i}class _f extends yf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class f5 extends yf{constructor(e,n){super(),this.key=e,this.precondition=n,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class m5{constructor(e,n,i,a){this.batchId=e,this.localWriteTime=n,this.baseMutations=i,this.mutations=a}applyToRemoteDocument(e,n){const i=n.mutationResults;for(let a=0;a<this.mutations.length;a++){const l=this.mutations[a];l.key.isEqual(e.key)&&d5(l,e,i[a])}}applyToLocalView(e,n){for(const i of this.baseMutations)i.key.isEqual(e.key)&&(n=nu(i,e,n,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(e.key)&&(n=nu(i,e,n,this.localWriteTime));return n}applyToLocalDocumentSet(e,n){const i=Dw();return this.mutations.forEach((a=>{const l=e.get(a.key),c=l.overlayedDocument;let h=this.applyToLocalView(c,l.mutatedFields);h=n.has(a.key)?null:h;const f=Nw(c,h);f!==null&&i.set(a.key,f),c.isValidDocument()||c.convertToNoDocument(Be.min())})),i}keys(){return this.mutations.reduce(((e,n)=>e.add(n.key)),Ze())}isEqual(e){return this.batchId===e.batchId&&_l(this.mutations,e.mutations,((n,i)=>Vx(n,i)))&&_l(this.baseMutations,e.baseMutations,((n,i)=>Vx(n,i)))}}class Ty{constructor(e,n,i,a){this.batch=e,this.commitVersion=n,this.mutationResults=i,this.docVersions=a}static from(e,n,i){ct(e.mutations.length===i.length,58842,{me:e.mutations.length,fe:i.length});let a=(function(){return t5})();const l=e.mutations;for(let c=0;c<l.length;c++)a=a.insert(l[c].key,i[c].version);return new Ty(e,n,i,a)}}class p5{constructor(e,n){this.largestBatchId=e,this.mutation=n}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class g5{constructor(e,n){this.count=e,this.unchangedNames=n}}var Zt,tt;function y5(t){switch(t){case _e.OK:return Pe(64938);case _e.CANCELLED:case _e.UNKNOWN:case _e.DEADLINE_EXCEEDED:case _e.RESOURCE_EXHAUSTED:case _e.INTERNAL:case _e.UNAVAILABLE:case _e.UNAUTHENTICATED:return!1;case _e.INVALID_ARGUMENT:case _e.NOT_FOUND:case _e.ALREADY_EXISTS:case _e.PERMISSION_DENIED:case _e.FAILED_PRECONDITION:case _e.ABORTED:case _e.OUT_OF_RANGE:case _e.UNIMPLEMENTED:case _e.DATA_LOSS:return!0;default:return Pe(15467,{code:t})}}function Lw(t){if(t===void 0)return Ji("GRPC error has no .code"),_e.UNKNOWN;switch(t){case Zt.OK:return _e.OK;case Zt.CANCELLED:return _e.CANCELLED;case Zt.UNKNOWN:return _e.UNKNOWN;case Zt.DEADLINE_EXCEEDED:return _e.DEADLINE_EXCEEDED;case Zt.RESOURCE_EXHAUSTED:return _e.RESOURCE_EXHAUSTED;case Zt.INTERNAL:return _e.INTERNAL;case Zt.UNAVAILABLE:return _e.UNAVAILABLE;case Zt.UNAUTHENTICATED:return _e.UNAUTHENTICATED;case Zt.INVALID_ARGUMENT:return _e.INVALID_ARGUMENT;case Zt.NOT_FOUND:return _e.NOT_FOUND;case Zt.ALREADY_EXISTS:return _e.ALREADY_EXISTS;case Zt.PERMISSION_DENIED:return _e.PERMISSION_DENIED;case Zt.FAILED_PRECONDITION:return _e.FAILED_PRECONDITION;case Zt.ABORTED:return _e.ABORTED;case Zt.OUT_OF_RANGE:return _e.OUT_OF_RANGE;case Zt.UNIMPLEMENTED:return _e.UNIMPLEMENTED;case Zt.DATA_LOSS:return _e.DATA_LOSS;default:return Pe(39323,{code:t})}}(tt=Zt||(Zt={}))[tt.OK=0]="OK",tt[tt.CANCELLED=1]="CANCELLED",tt[tt.UNKNOWN=2]="UNKNOWN",tt[tt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",tt[tt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",tt[tt.NOT_FOUND=5]="NOT_FOUND",tt[tt.ALREADY_EXISTS=6]="ALREADY_EXISTS",tt[tt.PERMISSION_DENIED=7]="PERMISSION_DENIED",tt[tt.UNAUTHENTICATED=16]="UNAUTHENTICATED",tt[tt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",tt[tt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",tt[tt.ABORTED=10]="ABORTED",tt[tt.OUT_OF_RANGE=11]="OUT_OF_RANGE",tt[tt.UNIMPLEMENTED=12]="UNIMPLEMENTED",tt[tt.INTERNAL=13]="INTERNAL",tt[tt.UNAVAILABLE=14]="UNAVAILABLE",tt[tt.DATA_LOSS=15]="DATA_LOSS";function _5(){return new TextEncoder}const b5=new Ks([4294967295,4294967295],0);function Fx(t){const e=_5().encode(t),n=new JE;return n.update(e),new Uint8Array(n.digest())}function qx(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),i=e.getUint32(4,!0),a=e.getUint32(8,!0),l=e.getUint32(12,!0);return[new Ks([n,i],0),new Ks([a,l],0)]}class Cy{constructor(e,n,i){if(this.bitmap=e,this.padding=n,this.hashCount=i,n<0||n>=8)throw new Yc(`Invalid padding: ${n}`);if(i<0)throw new Yc(`Invalid hash count: ${i}`);if(e.length>0&&this.hashCount===0)throw new Yc(`Invalid hash count: ${i}`);if(e.length===0&&n!==0)throw new Yc(`Invalid padding when bitmap length is 0: ${n}`);this.ge=8*e.length-n,this.pe=Ks.fromNumber(this.ge)}ye(e,n,i){let a=e.add(n.multiply(Ks.fromNumber(i)));return a.compare(b5)===1&&(a=new Ks([a.getBits(0),a.getBits(1)],0)),a.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(this.ge===0)return!1;const n=Fx(e),[i,a]=qx(n);for(let l=0;l<this.hashCount;l++){const c=this.ye(i,a,l);if(!this.we(c))return!1}return!0}static create(e,n,i){const a=e%8==0?0:8-e%8,l=new Uint8Array(Math.ceil(e/8)),c=new Cy(l,a,n);return i.forEach((h=>c.insert(h))),c}insert(e){if(this.ge===0)return;const n=Fx(e),[i,a]=qx(n);for(let l=0;l<this.hashCount;l++){const c=this.ye(i,a,l);this.Se(c)}}Se(e){const n=Math.floor(e/8),i=e%8;this.bitmap[n]|=1<<i}}class Yc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class bf{constructor(e,n,i,a,l){this.snapshotVersion=e,this.targetChanges=n,this.targetMismatches=i,this.documentUpdates=a,this.resolvedLimboDocuments=l}static createSynthesizedRemoteEventForCurrentChange(e,n,i){const a=new Map;return a.set(e,Tu.createSynthesizedTargetChangeForCurrentChange(e,n,i)),new bf(Be.min(),a,new jt(Je),Zi(),Ze())}}class Tu{constructor(e,n,i,a,l){this.resumeToken=e,this.current=n,this.addedDocuments=i,this.modifiedDocuments=a,this.removedDocuments=l}static createSynthesizedTargetChangeForCurrentChange(e,n,i){return new Tu(i,n,Ze(),Ze(),Ze())}}class wh{constructor(e,n,i,a){this.be=e,this.removedTargetIds=n,this.key=i,this.De=a}}class Bw{constructor(e,n){this.targetId=e,this.Ce=n}}class Vw{constructor(e,n,i=wn.EMPTY_BYTE_STRING,a=null){this.state=e,this.targetIds=n,this.resumeToken=i,this.cause=a}}class Hx{constructor(){this.ve=0,this.Fe=Gx(),this.Me=wn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=Ze(),n=Ze(),i=Ze();return this.Fe.forEach(((a,l)=>{switch(l){case 0:e=e.add(a);break;case 2:n=n.add(a);break;case 1:i=i.add(a);break;default:Pe(38017,{changeType:l})}})),new Tu(this.Me,this.xe,e,n,i)}qe(){this.Oe=!1,this.Fe=Gx()}Qe(e,n){this.Oe=!0,this.Fe=this.Fe.insert(e,n)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,ct(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class v5{constructor(e){this.Ge=e,this.ze=new Map,this.je=Zi(),this.Je=mh(),this.He=mh(),this.Ye=new jt(Je)}Ze(e){for(const n of e.be)e.De&&e.De.isFoundDocument()?this.Xe(n,e.De):this.et(n,e.key,e.De);for(const n of e.removedTargetIds)this.et(n,e.key,e.De)}tt(e){this.forEachTarget(e,(n=>{const i=this.nt(n);switch(e.state){case 0:this.rt(n)&&i.Le(e.resumeToken);break;case 1:i.Ke(),i.Ne||i.qe(),i.Le(e.resumeToken);break;case 2:i.Ke(),i.Ne||this.removeTarget(n);break;case 3:this.rt(n)&&(i.We(),i.Le(e.resumeToken));break;case 4:this.rt(n)&&(this.it(n),i.Le(e.resumeToken));break;default:Pe(56790,{state:e.state})}}))}forEachTarget(e,n){e.targetIds.length>0?e.targetIds.forEach(n):this.ze.forEach(((i,a)=>{this.rt(a)&&n(a)}))}st(e){const n=e.targetId,i=e.Ce.count,a=this.ot(n);if(a){const l=a.target;if(Og(l))if(i===0){const c=new Me(l.path);this.et(n,c,Rn.newNoDocument(c,Be.min()))}else ct(i===1,20013,{expectedCount:i});else{const c=this._t(n);if(c!==i){const h=this.ut(e),f=h?this.ct(h,e,c):1;if(f!==0){this.it(n);const p=f===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(n,p)}}}}}ut(e){const n=e.Ce.unchangedNames;if(!n||!n.bits)return null;const{bits:{bitmap:i="",padding:a=0},hashCount:l=0}=n;let c,h;try{c=ta(i).toUint8Array()}catch(f){if(f instanceof uw)return yl("Decoding the base64 bloom filter in existence filter failed ("+f.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw f}try{h=new Cy(c,a,l)}catch(f){return yl(f instanceof Yc?"BloomFilter error: ":"Applying bloom filter failed: ",f),null}return h.ge===0?null:h}ct(e,n,i){return n.Ce.count===i-this.Pt(e,n.targetId)?0:2}Pt(e,n){const i=this.Ge.getRemoteKeysForTarget(n);let a=0;return i.forEach((l=>{const c=this.Ge.ht(),h=`projects/${c.projectId}/databases/${c.database}/documents/${l.path.canonicalString()}`;e.mightContain(h)||(this.et(n,l,null),a++)})),a}Tt(e){const n=new Map;this.ze.forEach(((l,c)=>{const h=this.ot(c);if(h){if(l.current&&Og(h.target)){const f=new Me(h.target.path);this.It(f).has(c)||this.Et(c,f)||this.et(c,f,Rn.newNoDocument(f,e))}l.Be&&(n.set(c,l.ke()),l.qe())}}));let i=Ze();this.He.forEach(((l,c)=>{let h=!0;c.forEachWhile((f=>{const p=this.ot(f);return!p||p.purpose==="TargetPurposeLimboResolution"||(h=!1,!1)})),h&&(i=i.add(l))})),this.je.forEach(((l,c)=>c.setReadTime(e)));const a=new bf(e,n,this.Ye,this.je,i);return this.je=Zi(),this.Je=mh(),this.He=mh(),this.Ye=new jt(Je),a}Xe(e,n){if(!this.rt(e))return;const i=this.Et(e,n.key)?2:0;this.nt(e).Qe(n.key,i),this.je=this.je.insert(n.key,n),this.Je=this.Je.insert(n.key,this.It(n.key).add(e)),this.He=this.He.insert(n.key,this.dt(n.key).add(e))}et(e,n,i){if(!this.rt(e))return;const a=this.nt(e);this.Et(e,n)?a.Qe(n,1):a.$e(n),this.He=this.He.insert(n,this.dt(n).delete(e)),this.He=this.He.insert(n,this.dt(n).add(e)),i&&(this.je=this.je.insert(n,i))}removeTarget(e){this.ze.delete(e)}_t(e){const n=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+n.addedDocuments.size-n.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let n=this.ze.get(e);return n||(n=new Hx,this.ze.set(e,n)),n}dt(e){let n=this.He.get(e);return n||(n=new ln(Je),this.He=this.He.insert(e,n)),n}It(e){let n=this.Je.get(e);return n||(n=new ln(Je),this.Je=this.Je.insert(e,n)),n}rt(e){const n=this.ot(e)!==null;return n||Ce("WatchChangeAggregator","Detected inactive target",e),n}ot(e){const n=this.ze.get(e);return n&&n.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new Hx),this.Ge.getRemoteKeysForTarget(e).forEach((n=>{this.et(e,n,null)}))}Et(e,n){return this.Ge.getRemoteKeysForTarget(e).has(n)}}function mh(){return new jt(Me.comparator)}function Gx(){return new jt(Me.comparator)}const x5={asc:"ASCENDING",desc:"DESCENDING"},S5={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},E5={and:"AND",or:"OR"};class w5{constructor(e,n){this.databaseId=e,this.useProto3Json=n}}function Pg(t,e){return t.useProto3Json||hf(e)?e:{value:e}}function qh(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Uw(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function T5(t,e){return qh(t,e.toTimestamp())}function yi(t){return ct(!!t,49232),Be.fromTimestamp((function(n){const i=ea(n);return new Et(i.seconds,i.nanos)})(t))}function Ay(t,e){return Lg(t,e).canonicalString()}function Lg(t,e){const n=(function(a){return new vt(["projects",a.projectId,"databases",a.database])})(t).child("documents");return e===void 0?n:n.child(e)}function zw(t){const e=vt.fromString(t);return ct($w(e),10190,{key:e.toString()}),e}function Bg(t,e){return Ay(t.databaseId,e.path)}function ng(t,e){const n=zw(e);if(n.get(1)!==t.databaseId.projectId)throw new Te(_e.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Te(_e.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Me(qw(n))}function Fw(t,e){return Ay(t.databaseId,e)}function C5(t){const e=zw(t);return e.length===4?vt.emptyPath():qw(e)}function Vg(t){return new vt(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function qw(t){return ct(t.length>4&&t.get(4)==="documents",29091,{key:t.toString()}),t.popFirst(5)}function $x(t,e,n){return{name:Bg(t,e),fields:n.value.mapValue.fields}}function A5(t,e){let n;if("targetChange"in e){e.targetChange;const i=(function(p){return p==="NO_CHANGE"?0:p==="ADD"?1:p==="REMOVE"?2:p==="CURRENT"?3:p==="RESET"?4:Pe(39313,{state:p})})(e.targetChange.targetChangeType||"NO_CHANGE"),a=e.targetChange.targetIds||[],l=(function(p,_){return p.useProto3Json?(ct(_===void 0||typeof _=="string",58123),wn.fromBase64String(_||"")):(ct(_===void 0||_ instanceof Buffer||_ instanceof Uint8Array,16193),wn.fromUint8Array(_||new Uint8Array))})(t,e.targetChange.resumeToken),c=e.targetChange.cause,h=c&&(function(p){const _=p.code===void 0?_e.UNKNOWN:Lw(p.code);return new Te(_,p.message||"")})(c);n=new Vw(i,a,l,h||null)}else if("documentChange"in e){e.documentChange;const i=e.documentChange;i.document,i.document.name,i.document.updateTime;const a=ng(t,i.document.name),l=yi(i.document.updateTime),c=i.document.createTime?yi(i.document.createTime):Be.min(),h=new Gn({mapValue:{fields:i.document.fields}}),f=Rn.newFoundDocument(a,l,c,h),p=i.targetIds||[],_=i.removedTargetIds||[];n=new wh(p,_,f.key,f)}else if("documentDelete"in e){e.documentDelete;const i=e.documentDelete;i.document;const a=ng(t,i.document),l=i.readTime?yi(i.readTime):Be.min(),c=Rn.newNoDocument(a,l),h=i.removedTargetIds||[];n=new wh([],h,c.key,c)}else if("documentRemove"in e){e.documentRemove;const i=e.documentRemove;i.document;const a=ng(t,i.document),l=i.removedTargetIds||[];n=new wh([],l,a,null)}else{if(!("filter"in e))return Pe(11601,{Rt:e});{e.filter;const i=e.filter;i.targetId;const{count:a=0,unchangedNames:l}=i,c=new g5(a,l),h=i.targetId;n=new Bw(h,c)}}return n}function R5(t,e){let n;if(e instanceof wu)n={update:$x(t,e.key,e.value)};else if(e instanceof _f)n={delete:Bg(t,e.key)};else if(e instanceof la)n={update:$x(t,e.key,e.data),updateMask:L5(e.fieldMask)};else{if(!(e instanceof f5))return Pe(16599,{Vt:e.type});n={verify:Bg(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((i=>(function(l,c){const h=c.transform;if(h instanceof zh)return{fieldPath:c.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(h instanceof xl)return{fieldPath:c.field.canonicalString(),appendMissingElements:{values:h.elements}};if(h instanceof du)return{fieldPath:c.field.canonicalString(),removeAllFromArray:{values:h.elements}};if(h instanceof Fh)return{fieldPath:c.field.canonicalString(),increment:h.Ae};throw Pe(20930,{transform:c.transform})})(0,i)))),e.precondition.isNone||(n.currentDocument=(function(a,l){return l.updateTime!==void 0?{updateTime:T5(a,l.updateTime)}:l.exists!==void 0?{exists:l.exists}:Pe(27497)})(t,e.precondition)),n}function D5(t,e){return t&&t.length>0?(ct(e!==void 0,14353),t.map((n=>(function(a,l){let c=a.updateTime?yi(a.updateTime):yi(l);return c.isEqual(Be.min())&&(c=yi(l)),new u5(c,a.transformResults||[])})(n,e)))):[]}function j5(t,e){return{documents:[Fw(t,e.path)]}}function I5(t,e){const n={structuredQuery:{}},i=e.path;let a;e.collectionGroup!==null?(a=i,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(a=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=Fw(t,a);const l=(function(p){if(p.length!==0)return Gw($r.create(p,"and"))})(e.filters);l&&(n.structuredQuery.where=l);const c=(function(p){if(p.length!==0)return p.map((_=>(function(v){return{field:al(v.field),direction:k5(v.dir)}})(_)))})(e.orderBy);c&&(n.structuredQuery.orderBy=c);const h=Pg(t,e.limit);return h!==null&&(n.structuredQuery.limit=h),e.startAt&&(n.structuredQuery.startAt=(function(p){return{before:p.inclusive,values:p.position}})(e.startAt)),e.endAt&&(n.structuredQuery.endAt=(function(p){return{before:!p.inclusive,values:p.position}})(e.endAt)),{ft:n,parent:a}}function M5(t){let e=C5(t.parent);const n=t.structuredQuery,i=n.from?n.from.length:0;let a=null;if(i>0){ct(i===1,65062);const _=n.from[0];_.allDescendants?a=_.collectionId:e=e.child(_.collectionId)}let l=[];n.where&&(l=(function(b){const v=Hw(b);return v instanceof $r&&vw(v)?v.getFilters():[v]})(n.where));let c=[];n.orderBy&&(c=(function(b){return b.map((v=>(function(E){return new Uh(ol(E.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(E.direction))})(v)))})(n.orderBy));let h=null;n.limit&&(h=(function(b){let v;return v=typeof b=="object"?b.value:b,hf(v)?null:v})(n.limit));let f=null;n.startAt&&(f=(function(b){const v=!!b.before,T=b.values||[];return new Vh(T,v)})(n.startAt));let p=null;return n.endAt&&(p=(function(b){const v=!b.before,T=b.values||[];return new Vh(T,v)})(n.endAt)),Y2(e,a,c,l,h,"F",f,p)}function O5(t,e){const n=(function(a){switch(a){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Pe(28987,{purpose:a})}})(e.purpose);return n==null?null:{"goog-listen-tags":n}}function Hw(t){return t.unaryFilter!==void 0?(function(n){switch(n.unaryFilter.op){case"IS_NAN":const i=ol(n.unaryFilter.field);return tn.create(i,"==",{doubleValue:NaN});case"IS_NULL":const a=ol(n.unaryFilter.field);return tn.create(a,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const l=ol(n.unaryFilter.field);return tn.create(l,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const c=ol(n.unaryFilter.field);return tn.create(c,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Pe(61313);default:return Pe(60726)}})(t):t.fieldFilter!==void 0?(function(n){return tn.create(ol(n.fieldFilter.field),(function(a){switch(a){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Pe(58110);default:return Pe(50506)}})(n.fieldFilter.op),n.fieldFilter.value)})(t):t.compositeFilter!==void 0?(function(n){return $r.create(n.compositeFilter.filters.map((i=>Hw(i))),(function(a){switch(a){case"AND":return"and";case"OR":return"or";default:return Pe(1026)}})(n.compositeFilter.op))})(t):Pe(30097,{filter:t})}function k5(t){return x5[t]}function N5(t){return S5[t]}function P5(t){return E5[t]}function al(t){return{fieldPath:t.canonicalString()}}function ol(t){return En.fromServerFormat(t.fieldPath)}function Gw(t){return t instanceof tn?(function(n){if(n.op==="=="){if(Ox(n.value))return{unaryFilter:{field:al(n.field),op:"IS_NAN"}};if(Mx(n.value))return{unaryFilter:{field:al(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(Ox(n.value))return{unaryFilter:{field:al(n.field),op:"IS_NOT_NAN"}};if(Mx(n.value))return{unaryFilter:{field:al(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:al(n.field),op:N5(n.op),value:n.value}}})(t):t instanceof $r?(function(n){const i=n.getFilters().map((a=>Gw(a)));return i.length===1?i[0]:{compositeFilter:{op:P5(n.op),filters:i}}})(t):Pe(54877,{filter:t})}function L5(t){const e=[];return t.fields.forEach((n=>e.push(n.canonicalString()))),{fieldPaths:e}}function $w(t){return t.length>=4&&t.get(0)==="projects"&&t.get(2)==="databases"}class qs{constructor(e,n,i,a,l=Be.min(),c=Be.min(),h=wn.EMPTY_BYTE_STRING,f=null){this.target=e,this.targetId=n,this.purpose=i,this.sequenceNumber=a,this.snapshotVersion=l,this.lastLimboFreeSnapshotVersion=c,this.resumeToken=h,this.expectedCount=f}withSequenceNumber(e){return new qs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,n){return new qs(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new qs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new qs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class B5{constructor(e){this.yt=e}}function V5(t){const e=M5({parent:t.parent,structuredQuery:t.structuredQuery});return t.limitType==="LAST"?Ng(e,e.limit,"L"):e}class U5{constructor(){this.Cn=new z5}addToCollectionParentIndex(e,n){return this.Cn.add(n),ve.resolve()}getCollectionParents(e,n){return ve.resolve(this.Cn.getEntries(n))}addFieldIndex(e,n){return ve.resolve()}deleteFieldIndex(e,n){return ve.resolve()}deleteAllFieldIndexes(e){return ve.resolve()}createTargetIndexes(e,n){return ve.resolve()}getDocumentsMatchingTarget(e,n){return ve.resolve(null)}getIndexType(e,n){return ve.resolve(0)}getFieldIndexes(e,n){return ve.resolve([])}getNextCollectionGroupToUpdate(e){return ve.resolve(null)}getMinOffset(e,n){return ve.resolve(Zs.min())}getMinOffsetFromCollectionGroup(e,n){return ve.resolve(Zs.min())}updateCollectionGroup(e,n,i){return ve.resolve()}updateIndexEntries(e,n){return ve.resolve()}}class z5{constructor(){this.index={}}add(e){const n=e.lastSegment(),i=e.popLast(),a=this.index[n]||new ln(vt.comparator),l=!a.has(i);return this.index[n]=a.add(i),l}has(e){const n=e.lastSegment(),i=e.popLast(),a=this.index[n];return a&&a.has(i)}getEntries(e){return(this.index[e]||new ln(vt.comparator)).toArray()}}const Qx={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Qw=41943040;class Hn{static withCacheSize(e){return new Hn(e,Hn.DEFAULT_COLLECTION_PERCENTILE,Hn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,n,i){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=i}}Hn.DEFAULT_COLLECTION_PERCENTILE=10,Hn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Hn.DEFAULT=new Hn(Qw,Hn.DEFAULT_COLLECTION_PERCENTILE,Hn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Hn.DISABLED=new Hn(-1,0,0);class Sl{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Sl(0)}static cr(){return new Sl(-1)}}const Wx="LruGarbageCollector",F5=1048576;function Kx([t,e],[n,i]){const a=Je(t,n);return a===0?Je(e,i):a}class q5{constructor(e){this.Ir=e,this.buffer=new ln(Kx),this.Er=0}dr(){return++this.Er}Ar(e){const n=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(n);else{const i=this.buffer.last();Kx(n,i)<0&&(this.buffer=this.buffer.delete(i).add(n))}}get maxValue(){return this.buffer.last()[0]}}class H5{constructor(e,n,i){this.garbageCollector=e,this.asyncQueue=n,this.localStore=i,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(e){Ce(Wx,`Garbage collection scheduled in ${e}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(n){Pl(n)?Ce(Wx,"Ignoring IndexedDB error during garbage collection: ",n):await Nl(n)}await this.Vr(3e5)}))}}class G5{constructor(e,n){this.mr=e,this.params=n}calculateTargetCount(e,n){return this.mr.gr(e).next((i=>Math.floor(n/100*i)))}nthSequenceNumber(e,n){if(n===0)return ve.resolve(df.ce);const i=new q5(n);return this.mr.forEachTarget(e,(a=>i.Ar(a.sequenceNumber))).next((()=>this.mr.pr(e,(a=>i.Ar(a))))).next((()=>i.maxValue))}removeTargets(e,n,i){return this.mr.removeTargets(e,n,i)}removeOrphanedDocuments(e,n){return this.mr.removeOrphanedDocuments(e,n)}collect(e,n){return this.params.cacheSizeCollectionThreshold===-1?(Ce("LruGarbageCollector","Garbage collection skipped; disabled"),ve.resolve(Qx)):this.getCacheSize(e).next((i=>i<this.params.cacheSizeCollectionThreshold?(Ce("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Qx):this.yr(e,n)))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,n){let i,a,l,c,h,f,p;const _=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((b=>(b>this.params.maximumSequenceNumbersToCollect?(Ce("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${b}`),a=this.params.maximumSequenceNumbersToCollect):a=b,c=Date.now(),this.nthSequenceNumber(e,a)))).next((b=>(i=b,h=Date.now(),this.removeTargets(e,i,n)))).next((b=>(l=b,f=Date.now(),this.removeOrphanedDocuments(e,i)))).next((b=>(p=Date.now(),il()<=Xe.DEBUG&&Ce("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${c-_}ms
	Determined least recently used ${a} in `+(h-c)+`ms
	Removed ${l} targets in `+(f-h)+`ms
	Removed ${b} documents in `+(p-f)+`ms
Total Duration: ${p-_}ms`),ve.resolve({didRun:!0,sequenceNumbersCollected:a,targetsRemoved:l,documentsRemoved:b}))))}}function $5(t,e){return new G5(t,e)}class Q5{constructor(){this.changes=new eo((e=>e.toString()),((e,n)=>e.isEqual(n))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,n){this.assertNotApplied(),this.changes.set(e,Rn.newInvalidDocument(e).setReadTime(n))}getEntry(e,n){this.assertNotApplied();const i=this.changes.get(n);return i!==void 0?ve.resolve(i):this.getFromCache(e,n)}getEntries(e,n){return this.getAllFromCache(e,n)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class W5{constructor(e,n){this.overlayedDocument=e,this.mutatedFields=n}}class K5{constructor(e,n,i,a){this.remoteDocumentCache=e,this.mutationQueue=n,this.documentOverlayCache=i,this.indexManager=a}getDocument(e,n){let i=null;return this.documentOverlayCache.getOverlay(e,n).next((a=>(i=a,this.remoteDocumentCache.getEntry(e,n)))).next((a=>(i!==null&&nu(i.mutation,a,ar.empty(),Et.now()),a)))}getDocuments(e,n){return this.remoteDocumentCache.getEntries(e,n).next((i=>this.getLocalViewOfDocuments(e,i,Ze()).next((()=>i))))}getLocalViewOfDocuments(e,n,i=Ze()){const a=Ha();return this.populateOverlays(e,a,n).next((()=>this.computeViews(e,n,a,i).next((l=>{let c=Kc();return l.forEach(((h,f)=>{c=c.insert(h,f.overlayedDocument)})),c}))))}getOverlayedDocuments(e,n){const i=Ha();return this.populateOverlays(e,i,n).next((()=>this.computeViews(e,n,i,Ze())))}populateOverlays(e,n,i){const a=[];return i.forEach((l=>{n.has(l)||a.push(l)})),this.documentOverlayCache.getOverlays(e,a).next((l=>{l.forEach(((c,h)=>{n.set(c,h)}))}))}computeViews(e,n,i,a){let l=Zi();const c=tu(),h=(function(){return tu()})();return n.forEach(((f,p)=>{const _=i.get(p.key);a.has(p.key)&&(_===void 0||_.mutation instanceof la)?l=l.insert(p.key,p):_!==void 0?(c.set(p.key,_.mutation.getFieldMask()),nu(_.mutation,p,_.mutation.getFieldMask(),Et.now())):c.set(p.key,ar.empty())})),this.recalculateAndSaveOverlays(e,l).next((f=>(f.forEach(((p,_)=>c.set(p,_))),n.forEach(((p,_)=>h.set(p,new W5(_,c.get(p)??null)))),h)))}recalculateAndSaveOverlays(e,n){const i=tu();let a=new jt(((c,h)=>c-h)),l=Ze();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,n).next((c=>{for(const h of c)h.keys().forEach((f=>{const p=n.get(f);if(p===null)return;let _=i.get(f)||ar.empty();_=h.applyToLocalView(p,_),i.set(f,_);const b=(a.get(h.batchId)||Ze()).add(f);a=a.insert(h.batchId,b)}))})).next((()=>{const c=[],h=a.getReverseIterator();for(;h.hasNext();){const f=h.getNext(),p=f.key,_=f.value,b=Dw();_.forEach((v=>{if(!l.has(v)){const T=Nw(n.get(v),i.get(v));T!==null&&b.set(v,T),l=l.add(v)}})),c.push(this.documentOverlayCache.saveOverlays(e,p,b))}return ve.waitFor(c)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(e,n){return this.remoteDocumentCache.getEntries(e,n).next((i=>this.recalculateAndSaveOverlays(e,i)))}getDocumentsMatchingQuery(e,n,i,a){return(function(c){return Me.isDocumentKey(c.path)&&c.collectionGroup===null&&c.filters.length===0})(n)?this.getDocumentsMatchingDocumentQuery(e,n.path):ww(n)?this.getDocumentsMatchingCollectionGroupQuery(e,n,i,a):this.getDocumentsMatchingCollectionQuery(e,n,i,a)}getNextDocuments(e,n,i,a){return this.remoteDocumentCache.getAllFromCollectionGroup(e,n,i,a).next((l=>{const c=a-l.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,n,i.largestBatchId,a-l.size):ve.resolve(Ha());let h=ou,f=l;return c.next((p=>ve.forEach(p,((_,b)=>(h<b.largestBatchId&&(h=b.largestBatchId),l.get(_)?ve.resolve():this.remoteDocumentCache.getEntry(e,_).next((v=>{f=f.insert(_,v)}))))).next((()=>this.populateOverlays(e,p,l))).next((()=>this.computeViews(e,f,p,Ze()))).next((_=>({batchId:h,changes:Rw(_)})))))}))}getDocumentsMatchingDocumentQuery(e,n){return this.getDocument(e,new Me(n)).next((i=>{let a=Kc();return i.isFoundDocument()&&(a=a.insert(i.key,i)),a}))}getDocumentsMatchingCollectionGroupQuery(e,n,i,a){const l=n.collectionGroup;let c=Kc();return this.indexManager.getCollectionParents(e,l).next((h=>ve.forEach(h,(f=>{const p=(function(b,v){return new Eu(v,null,b.explicitOrderBy.slice(),b.filters.slice(),b.limit,b.limitType,b.startAt,b.endAt)})(n,f.child(l));return this.getDocumentsMatchingCollectionQuery(e,p,i,a).next((_=>{_.forEach(((b,v)=>{c=c.insert(b,v)}))}))})).next((()=>c))))}getDocumentsMatchingCollectionQuery(e,n,i,a){let l;return this.documentOverlayCache.getOverlaysForCollection(e,n.path,i.largestBatchId).next((c=>(l=c,this.remoteDocumentCache.getDocumentsMatchingQuery(e,n,i,l,a)))).next((c=>{l.forEach(((f,p)=>{const _=p.getKey();c.get(_)===null&&(c=c.insert(_,Rn.newInvalidDocument(_)))}));let h=Kc();return c.forEach(((f,p)=>{const _=l.get(f);_!==void 0&&nu(_.mutation,p,ar.empty(),Et.now()),pf(n,p)&&(h=h.insert(f,p))})),h}))}}class Y5{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,n){return ve.resolve(this.Lr.get(n))}saveBundleMetadata(e,n){return this.Lr.set(n.id,(function(a){return{id:a.id,version:a.version,createTime:yi(a.createTime)}})(n)),ve.resolve()}getNamedQuery(e,n){return ve.resolve(this.kr.get(n))}saveNamedQuery(e,n){return this.kr.set(n.name,(function(a){return{name:a.name,query:V5(a.bundledQuery),readTime:yi(a.readTime)}})(n)),ve.resolve()}}class X5{constructor(){this.overlays=new jt(Me.comparator),this.qr=new Map}getOverlay(e,n){return ve.resolve(this.overlays.get(n))}getOverlays(e,n){const i=Ha();return ve.forEach(n,(a=>this.getOverlay(e,a).next((l=>{l!==null&&i.set(a,l)})))).next((()=>i))}saveOverlays(e,n,i){return i.forEach(((a,l)=>{this.St(e,n,l)})),ve.resolve()}removeOverlaysForBatchId(e,n,i){const a=this.qr.get(i);return a!==void 0&&(a.forEach((l=>this.overlays=this.overlays.remove(l))),this.qr.delete(i)),ve.resolve()}getOverlaysForCollection(e,n,i){const a=Ha(),l=n.length+1,c=new Me(n.child("")),h=this.overlays.getIteratorFrom(c);for(;h.hasNext();){const f=h.getNext().value,p=f.getKey();if(!n.isPrefixOf(p.path))break;p.path.length===l&&f.largestBatchId>i&&a.set(f.getKey(),f)}return ve.resolve(a)}getOverlaysForCollectionGroup(e,n,i,a){let l=new jt(((p,_)=>p-_));const c=this.overlays.getIterator();for(;c.hasNext();){const p=c.getNext().value;if(p.getKey().getCollectionGroup()===n&&p.largestBatchId>i){let _=l.get(p.largestBatchId);_===null&&(_=Ha(),l=l.insert(p.largestBatchId,_)),_.set(p.getKey(),p)}}const h=Ha(),f=l.getIterator();for(;f.hasNext()&&(f.getNext().value.forEach(((p,_)=>h.set(p,_))),!(h.size()>=a)););return ve.resolve(h)}St(e,n,i){const a=this.overlays.get(i.key);if(a!==null){const c=this.qr.get(a.largestBatchId).delete(i.key);this.qr.set(a.largestBatchId,c)}this.overlays=this.overlays.insert(i.key,new p5(n,i));let l=this.qr.get(n);l===void 0&&(l=Ze(),this.qr.set(n,l)),this.qr.set(n,l.add(i.key))}}class J5{constructor(){this.sessionToken=wn.EMPTY_BYTE_STRING}getSessionToken(e){return ve.resolve(this.sessionToken)}setSessionToken(e,n){return this.sessionToken=n,ve.resolve()}}class Ry{constructor(){this.Qr=new ln(fn.$r),this.Ur=new ln(fn.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,n){const i=new fn(e,n);this.Qr=this.Qr.add(i),this.Ur=this.Ur.add(i)}Wr(e,n){e.forEach((i=>this.addReference(i,n)))}removeReference(e,n){this.Gr(new fn(e,n))}zr(e,n){e.forEach((i=>this.removeReference(i,n)))}jr(e){const n=new Me(new vt([])),i=new fn(n,e),a=new fn(n,e+1),l=[];return this.Ur.forEachInRange([i,a],(c=>{this.Gr(c),l.push(c.key)})),l}Jr(){this.Qr.forEach((e=>this.Gr(e)))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const n=new Me(new vt([])),i=new fn(n,e),a=new fn(n,e+1);let l=Ze();return this.Ur.forEachInRange([i,a],(c=>{l=l.add(c.key)})),l}containsKey(e){const n=new fn(e,0),i=this.Qr.firstAfterOrEqual(n);return i!==null&&e.isEqual(i.key)}}class fn{constructor(e,n){this.key=e,this.Yr=n}static $r(e,n){return Me.comparator(e.key,n.key)||Je(e.Yr,n.Yr)}static Kr(e,n){return Je(e.Yr,n.Yr)||Me.comparator(e.key,n.key)}}class Z5{constructor(e,n){this.indexManager=e,this.referenceDelegate=n,this.mutationQueue=[],this.tr=1,this.Zr=new ln(fn.$r)}checkEmpty(e){return ve.resolve(this.mutationQueue.length===0)}addMutationBatch(e,n,i,a){const l=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const c=new m5(l,n,i,a);this.mutationQueue.push(c);for(const h of a)this.Zr=this.Zr.add(new fn(h.key,l)),this.indexManager.addToCollectionParentIndex(e,h.key.path.popLast());return ve.resolve(c)}lookupMutationBatch(e,n){return ve.resolve(this.Xr(n))}getNextMutationBatchAfterBatchId(e,n){const i=n+1,a=this.ei(i),l=a<0?0:a;return ve.resolve(this.mutationQueue.length>l?this.mutationQueue[l]:null)}getHighestUnacknowledgedBatchId(){return ve.resolve(this.mutationQueue.length===0?_y:this.tr-1)}getAllMutationBatches(e){return ve.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,n){const i=new fn(n,0),a=new fn(n,Number.POSITIVE_INFINITY),l=[];return this.Zr.forEachInRange([i,a],(c=>{const h=this.Xr(c.Yr);l.push(h)})),ve.resolve(l)}getAllMutationBatchesAffectingDocumentKeys(e,n){let i=new ln(Je);return n.forEach((a=>{const l=new fn(a,0),c=new fn(a,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([l,c],(h=>{i=i.add(h.Yr)}))})),ve.resolve(this.ti(i))}getAllMutationBatchesAffectingQuery(e,n){const i=n.path,a=i.length+1;let l=i;Me.isDocumentKey(l)||(l=l.child(""));const c=new fn(new Me(l),0);let h=new ln(Je);return this.Zr.forEachWhile((f=>{const p=f.key.path;return!!i.isPrefixOf(p)&&(p.length===a&&(h=h.add(f.Yr)),!0)}),c),ve.resolve(this.ti(h))}ti(e){const n=[];return e.forEach((i=>{const a=this.Xr(i);a!==null&&n.push(a)})),n}removeMutationBatch(e,n){ct(this.ni(n.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Zr;return ve.forEach(n.mutations,(a=>{const l=new fn(a.key,n.batchId);return i=i.delete(l),this.referenceDelegate.markPotentiallyOrphaned(e,a.key)})).next((()=>{this.Zr=i}))}ir(e){}containsKey(e,n){const i=new fn(n,0),a=this.Zr.firstAfterOrEqual(i);return ve.resolve(n.isEqual(a&&a.key))}performConsistencyCheck(e){return this.mutationQueue.length,ve.resolve()}ni(e,n){return this.ei(e)}ei(e){return this.mutationQueue.length===0?0:e-this.mutationQueue[0].batchId}Xr(e){const n=this.ei(e);return n<0||n>=this.mutationQueue.length?null:this.mutationQueue[n]}}class eM{constructor(e){this.ri=e,this.docs=(function(){return new jt(Me.comparator)})(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,n){const i=n.key,a=this.docs.get(i),l=a?a.size:0,c=this.ri(n);return this.docs=this.docs.insert(i,{document:n.mutableCopy(),size:c}),this.size+=c-l,this.indexManager.addToCollectionParentIndex(e,i.path.popLast())}removeEntry(e){const n=this.docs.get(e);n&&(this.docs=this.docs.remove(e),this.size-=n.size)}getEntry(e,n){const i=this.docs.get(n);return ve.resolve(i?i.document.mutableCopy():Rn.newInvalidDocument(n))}getEntries(e,n){let i=Zi();return n.forEach((a=>{const l=this.docs.get(a);i=i.insert(a,l?l.document.mutableCopy():Rn.newInvalidDocument(a))})),ve.resolve(i)}getDocumentsMatchingQuery(e,n,i,a){let l=Zi();const c=n.path,h=new Me(c.child("__id-9223372036854775808__")),f=this.docs.getIteratorFrom(h);for(;f.hasNext();){const{key:p,value:{document:_}}=f.getNext();if(!c.isPrefixOf(p.path))break;p.path.length>c.length+1||R2(A2(_),i)<=0||(a.has(_.key)||pf(n,_))&&(l=l.insert(_.key,_.mutableCopy()))}return ve.resolve(l)}getAllFromCollectionGroup(e,n,i,a){Pe(9500)}ii(e,n){return ve.forEach(this.docs,(i=>n(i)))}newChangeBuffer(e){return new tM(this)}getSize(e){return ve.resolve(this.size)}}class tM extends Q5{constructor(e){super(),this.Nr=e}applyChanges(e){const n=[];return this.changes.forEach(((i,a)=>{a.isValidDocument()?n.push(this.Nr.addEntry(e,a)):this.Nr.removeEntry(i)})),ve.waitFor(n)}getFromCache(e,n){return this.Nr.getEntry(e,n)}getAllFromCache(e,n){return this.Nr.getEntries(e,n)}}class nM{constructor(e){this.persistence=e,this.si=new eo((n=>xy(n)),Sy),this.lastRemoteSnapshotVersion=Be.min(),this.highestTargetId=0,this.oi=0,this._i=new Ry,this.targetCount=0,this.ai=Sl.ur()}forEachTarget(e,n){return this.si.forEach(((i,a)=>n(a))),ve.resolve()}getLastRemoteSnapshotVersion(e){return ve.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return ve.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),ve.resolve(this.highestTargetId)}setTargetsMetadata(e,n,i){return i&&(this.lastRemoteSnapshotVersion=i),n>this.oi&&(this.oi=n),ve.resolve()}Pr(e){this.si.set(e.target,e);const n=e.targetId;n>this.highestTargetId&&(this.ai=new Sl(n),this.highestTargetId=n),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,n){return this.Pr(n),this.targetCount+=1,ve.resolve()}updateTargetData(e,n){return this.Pr(n),ve.resolve()}removeTargetData(e,n){return this.si.delete(n.target),this._i.jr(n.targetId),this.targetCount-=1,ve.resolve()}removeTargets(e,n,i){let a=0;const l=[];return this.si.forEach(((c,h)=>{h.sequenceNumber<=n&&i.get(h.targetId)===null&&(this.si.delete(c),l.push(this.removeMatchingKeysForTargetId(e,h.targetId)),a++)})),ve.waitFor(l).next((()=>a))}getTargetCount(e){return ve.resolve(this.targetCount)}getTargetData(e,n){const i=this.si.get(n)||null;return ve.resolve(i)}addMatchingKeys(e,n,i){return this._i.Wr(n,i),ve.resolve()}removeMatchingKeys(e,n,i){this._i.zr(n,i);const a=this.persistence.referenceDelegate,l=[];return a&&n.forEach((c=>{l.push(a.markPotentiallyOrphaned(e,c))})),ve.waitFor(l)}removeMatchingKeysForTargetId(e,n){return this._i.jr(n),ve.resolve()}getMatchingKeysForTargetId(e,n){const i=this._i.Hr(n);return ve.resolve(i)}containsKey(e,n){return ve.resolve(this._i.containsKey(n))}}class Ww{constructor(e,n){this.ui={},this.overlays={},this.ci=new df(0),this.li=!1,this.li=!0,this.hi=new J5,this.referenceDelegate=e(this),this.Pi=new nM(this),this.indexManager=new U5,this.remoteDocumentCache=(function(a){return new eM(a)})((i=>this.referenceDelegate.Ti(i))),this.serializer=new B5(n),this.Ii=new Y5(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let n=this.overlays[e.toKey()];return n||(n=new X5,this.overlays[e.toKey()]=n),n}getMutationQueue(e,n){let i=this.ui[e.toKey()];return i||(i=new Z5(n,this.referenceDelegate),this.ui[e.toKey()]=i),i}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,n,i){Ce("MemoryPersistence","Starting transaction:",e);const a=new rM(this.ci.next());return this.referenceDelegate.Ei(),i(a).next((l=>this.referenceDelegate.di(a).next((()=>l)))).toPromise().then((l=>(a.raiseOnCommittedEvent(),l)))}Ai(e,n){return ve.or(Object.values(this.ui).map((i=>()=>i.containsKey(e,n))))}}class rM extends j2{constructor(e){super(),this.currentSequenceNumber=e}}class Dy{constructor(e){this.persistence=e,this.Ri=new Ry,this.Vi=null}static mi(e){return new Dy(e)}get fi(){if(this.Vi)return this.Vi;throw Pe(60996)}addReference(e,n,i){return this.Ri.addReference(i,n),this.fi.delete(i.toString()),ve.resolve()}removeReference(e,n,i){return this.Ri.removeReference(i,n),this.fi.add(i.toString()),ve.resolve()}markPotentiallyOrphaned(e,n){return this.fi.add(n.toString()),ve.resolve()}removeTarget(e,n){this.Ri.jr(n.targetId).forEach((a=>this.fi.add(a.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,n.targetId).next((a=>{a.forEach((l=>this.fi.add(l.toString())))})).next((()=>i.removeTargetData(e,n)))}Ei(){this.Vi=new Set}di(e){const n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ve.forEach(this.fi,(i=>{const a=Me.fromPath(i);return this.gi(e,a).next((l=>{l||n.removeEntry(a,Be.min())}))})).next((()=>(this.Vi=null,n.apply(e))))}updateLimboDocument(e,n){return this.gi(e,n).next((i=>{i?this.fi.delete(n.toString()):this.fi.add(n.toString())}))}Ti(e){return 0}gi(e,n){return ve.or([()=>ve.resolve(this.Ri.containsKey(n)),()=>this.persistence.getTargetCache().containsKey(e,n),()=>this.persistence.Ai(e,n)])}}class Hh{constructor(e,n){this.persistence=e,this.pi=new eo((i=>O2(i.path)),((i,a)=>i.isEqual(a))),this.garbageCollector=$5(this,n)}static mi(e,n){return new Hh(e,n)}Ei(){}di(e){return ve.resolve()}forEachTarget(e,n){return this.persistence.getTargetCache().forEachTarget(e,n)}gr(e){const n=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next((i=>n.next((a=>i+a))))}wr(e){let n=0;return this.pr(e,(i=>{n++})).next((()=>n))}pr(e,n){return ve.forEach(this.pi,((i,a)=>this.br(e,i,a).next((l=>l?ve.resolve():n(a)))))}removeTargets(e,n,i){return this.persistence.getTargetCache().removeTargets(e,n,i)}removeOrphanedDocuments(e,n){let i=0;const a=this.persistence.getRemoteDocumentCache(),l=a.newChangeBuffer();return a.ii(e,(c=>this.br(e,c,n).next((h=>{h||(i++,l.removeEntry(c,Be.min()))})))).next((()=>l.apply(e))).next((()=>i))}markPotentiallyOrphaned(e,n){return this.pi.set(n,e.currentSequenceNumber),ve.resolve()}removeTarget(e,n){const i=n.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,i)}addReference(e,n,i){return this.pi.set(i,e.currentSequenceNumber),ve.resolve()}removeReference(e,n,i){return this.pi.set(i,e.currentSequenceNumber),ve.resolve()}updateLimboDocument(e,n){return this.pi.set(n,e.currentSequenceNumber),ve.resolve()}Ti(e){let n=e.key.toString().length;return e.isFoundDocument()&&(n+=xh(e.data.value)),n}br(e,n,i){return ve.or([()=>this.persistence.Ai(e,n),()=>this.persistence.getTargetCache().containsKey(e,n),()=>{const a=this.pi.get(n);return ve.resolve(a!==void 0&&a>i)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class jy{constructor(e,n,i,a){this.targetId=e,this.fromCache=n,this.Es=i,this.ds=a}static As(e,n){let i=Ze(),a=Ze();for(const l of n.docChanges)switch(l.type){case 0:i=i.add(l.doc.key);break;case 1:a=a.add(l.doc.key)}return new jy(e,n.fromCache,i,a)}}class iM{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class sM{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Wj()?8:I2(Dn())>0?6:4})()}initialize(e,n){this.ps=e,this.indexManager=n,this.Rs=!0}getDocumentsMatchingQuery(e,n,i,a){const l={result:null};return this.ys(e,n).next((c=>{l.result=c})).next((()=>{if(!l.result)return this.ws(e,n,a,i).next((c=>{l.result=c}))})).next((()=>{if(l.result)return;const c=new iM;return this.Ss(e,n,c).next((h=>{if(l.result=h,this.Vs)return this.bs(e,n,c,h.size)}))})).next((()=>l.result))}bs(e,n,i,a){return i.documentReadCount<this.fs?(il()<=Xe.DEBUG&&Ce("QueryEngine","SDK will not create cache indexes for query:",sl(n),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),ve.resolve()):(il()<=Xe.DEBUG&&Ce("QueryEngine","Query:",sl(n),"scans",i.documentReadCount,"local documents and returns",a,"documents as results."),i.documentReadCount>this.gs*a?(il()<=Xe.DEBUG&&Ce("QueryEngine","The SDK decides to create cache indexes for query:",sl(n),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,gi(n))):ve.resolve())}ys(e,n){if(Lx(n))return ve.resolve(null);let i=gi(n);return this.indexManager.getIndexType(e,i).next((a=>a===0?null:(n.limit!==null&&a===1&&(n=Ng(n,null,"F"),i=gi(n)),this.indexManager.getDocumentsMatchingTarget(e,i).next((l=>{const c=Ze(...l);return this.ps.getDocuments(e,c).next((h=>this.indexManager.getMinOffset(e,i).next((f=>{const p=this.Ds(n,h);return this.Cs(n,p,c,f.readTime)?this.ys(e,Ng(n,null,"F")):this.vs(e,p,n,f)}))))})))))}ws(e,n,i,a){return Lx(n)||a.isEqual(Be.min())?ve.resolve(null):this.ps.getDocuments(e,i).next((l=>{const c=this.Ds(n,l);return this.Cs(n,c,i,a)?ve.resolve(null):(il()<=Xe.DEBUG&&Ce("QueryEngine","Re-using previous result from %s to execute query: %s",a.toString(),sl(n)),this.vs(e,c,n,C2(a,ou)).next((h=>h)))}))}Ds(e,n){let i=new ln(Cw(e));return n.forEach(((a,l)=>{pf(e,l)&&(i=i.add(l))})),i}Cs(e,n,i,a){if(e.limit===null)return!1;if(i.size!==n.size)return!0;const l=e.limitType==="F"?n.last():n.first();return!!l&&(l.hasPendingWrites||l.version.compareTo(a)>0)}Ss(e,n,i){return il()<=Xe.DEBUG&&Ce("QueryEngine","Using full collection scan to execute query:",sl(n)),this.ps.getDocumentsMatchingQuery(e,n,Zs.min(),i)}vs(e,n,i,a){return this.ps.getDocumentsMatchingQuery(e,i,a).next((l=>(n.forEach((c=>{l=l.insert(c.key,c)})),l)))}}const Iy="LocalStore",aM=3e8;class oM{constructor(e,n,i,a){this.persistence=e,this.Fs=n,this.serializer=a,this.Ms=new jt(Je),this.xs=new eo((l=>xy(l)),Sy),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(i)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new K5(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(n=>e.collect(n,this.Ms)))}}function lM(t,e,n,i){return new oM(t,e,n,i)}async function Kw(t,e){const n=ze(t);return await n.persistence.runTransaction("Handle user change","readonly",(i=>{let a;return n.mutationQueue.getAllMutationBatches(i).next((l=>(a=l,n.Bs(e),n.mutationQueue.getAllMutationBatches(i)))).next((l=>{const c=[],h=[];let f=Ze();for(const p of a){c.push(p.batchId);for(const _ of p.mutations)f=f.add(_.key)}for(const p of l){h.push(p.batchId);for(const _ of p.mutations)f=f.add(_.key)}return n.localDocuments.getDocuments(i,f).next((p=>({Ls:p,removedBatchIds:c,addedBatchIds:h})))}))}))}function cM(t,e){const n=ze(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(i=>{const a=e.batch.keys(),l=n.Ns.newChangeBuffer({trackRemovals:!0});return(function(h,f,p,_){const b=p.batch,v=b.keys();let T=ve.resolve();return v.forEach((E=>{T=T.next((()=>_.getEntry(f,E))).next((w=>{const D=p.docVersions.get(E);ct(D!==null,48541),w.version.compareTo(D)<0&&(b.applyToRemoteDocument(w,p),w.isValidDocument()&&(w.setReadTime(p.commitVersion),_.addEntry(w)))}))})),T.next((()=>h.mutationQueue.removeMutationBatch(f,b)))})(n,i,e,l).next((()=>l.apply(i))).next((()=>n.mutationQueue.performConsistencyCheck(i))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(i,a,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,(function(h){let f=Ze();for(let p=0;p<h.mutationResults.length;++p)h.mutationResults[p].transformResults.length>0&&(f=f.add(h.batch.mutations[p].key));return f})(e)))).next((()=>n.localDocuments.getDocuments(i,a)))}))}function Yw(t){const e=ze(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(n=>e.Pi.getLastRemoteSnapshotVersion(n)))}function uM(t,e){const n=ze(t),i=e.snapshotVersion;let a=n.Ms;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(l=>{const c=n.Ns.newChangeBuffer({trackRemovals:!0});a=n.Ms;const h=[];e.targetChanges.forEach(((_,b)=>{const v=a.get(b);if(!v)return;h.push(n.Pi.removeMatchingKeys(l,_.removedDocuments,b).next((()=>n.Pi.addMatchingKeys(l,_.addedDocuments,b))));let T=v.withSequenceNumber(l.currentSequenceNumber);e.targetMismatches.get(b)!==null?T=T.withResumeToken(wn.EMPTY_BYTE_STRING,Be.min()).withLastLimboFreeSnapshotVersion(Be.min()):_.resumeToken.approximateByteSize()>0&&(T=T.withResumeToken(_.resumeToken,i)),a=a.insert(b,T),(function(w,D,L){return w.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-w.snapshotVersion.toMicroseconds()>=aM?!0:L.addedDocuments.size+L.modifiedDocuments.size+L.removedDocuments.size>0})(v,T,_)&&h.push(n.Pi.updateTargetData(l,T))}));let f=Zi(),p=Ze();if(e.documentUpdates.forEach((_=>{e.resolvedLimboDocuments.has(_)&&h.push(n.persistence.referenceDelegate.updateLimboDocument(l,_))})),h.push(dM(l,c,e.documentUpdates).next((_=>{f=_.ks,p=_.qs}))),!i.isEqual(Be.min())){const _=n.Pi.getLastRemoteSnapshotVersion(l).next((b=>n.Pi.setTargetsMetadata(l,l.currentSequenceNumber,i)));h.push(_)}return ve.waitFor(h).next((()=>c.apply(l))).next((()=>n.localDocuments.getLocalViewOfDocuments(l,f,p))).next((()=>f))})).then((l=>(n.Ms=a,l)))}function dM(t,e,n){let i=Ze(),a=Ze();return n.forEach((l=>i=i.add(l))),e.getEntries(t,i).next((l=>{let c=Zi();return n.forEach(((h,f)=>{const p=l.get(h);f.isFoundDocument()!==p.isFoundDocument()&&(a=a.add(h)),f.isNoDocument()&&f.version.isEqual(Be.min())?(e.removeEntry(h,f.readTime),c=c.insert(h,f)):!p.isValidDocument()||f.version.compareTo(p.version)>0||f.version.compareTo(p.version)===0&&p.hasPendingWrites?(e.addEntry(f),c=c.insert(h,f)):Ce(Iy,"Ignoring outdated watch update for ",h,". Current version:",p.version," Watch version:",f.version)})),{ks:c,qs:a}}))}function hM(t,e){const n=ze(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(i=>(e===void 0&&(e=_y),n.mutationQueue.getNextMutationBatchAfterBatchId(i,e))))}function fM(t,e){const n=ze(t);return n.persistence.runTransaction("Allocate target","readwrite",(i=>{let a;return n.Pi.getTargetData(i,e).next((l=>l?(a=l,ve.resolve(a)):n.Pi.allocateTargetId(i).next((c=>(a=new qs(e,c,"TargetPurposeListen",i.currentSequenceNumber),n.Pi.addTargetData(i,a).next((()=>a)))))))})).then((i=>{const a=n.Ms.get(i.targetId);return(a===null||i.snapshotVersion.compareTo(a.snapshotVersion)>0)&&(n.Ms=n.Ms.insert(i.targetId,i),n.xs.set(e,i.targetId)),i}))}async function Ug(t,e,n){const i=ze(t),a=i.Ms.get(e),l=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",l,(c=>i.persistence.referenceDelegate.removeTarget(c,a)))}catch(c){if(!Pl(c))throw c;Ce(Iy,`Failed to update sequence numbers for target ${e}: ${c}`)}i.Ms=i.Ms.remove(e),i.xs.delete(a.target)}function Yx(t,e,n){const i=ze(t);let a=Be.min(),l=Ze();return i.persistence.runTransaction("Execute query","readwrite",(c=>(function(f,p,_){const b=ze(f),v=b.xs.get(_);return v!==void 0?ve.resolve(b.Ms.get(v)):b.Pi.getTargetData(p,_)})(i,c,gi(e)).next((h=>{if(h)return a=h.lastLimboFreeSnapshotVersion,i.Pi.getMatchingKeysForTargetId(c,h.targetId).next((f=>{l=f}))})).next((()=>i.Fs.getDocumentsMatchingQuery(c,e,n?a:Be.min(),n?l:Ze()))).next((h=>(mM(i,J2(e),h),{documents:h,Qs:l})))))}function mM(t,e,n){let i=t.Os.get(e)||Be.min();n.forEach(((a,l)=>{l.readTime.compareTo(i)>0&&(i=l.readTime)})),t.Os.set(e,i)}class Xx{constructor(){this.activeTargetIds=i5()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class pM{constructor(){this.Mo=new Xx,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,n,i){}addLocalQueryTarget(e,n=!0){return n&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,n,i){this.xo[e]=n}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Xx,Promise.resolve()}handleUserChange(e,n,i){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class gM{Oo(e){}shutdown(){}}const Jx="ConnectivityMonitor";class Zx{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){Ce(Jx,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){Ce(Jx,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let ph=null;function zg(){return ph===null?ph=(function(){return 268435456+Math.round(2147483648*Math.random())})():ph++,"0x"+ph.toString(16)}const rg="RestConnection",yM={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class _M{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const n=e.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),a=encodeURIComponent(this.databaseId.database);this.Uo=n+"://"+e.host,this.Ko=`projects/${i}/databases/${a}`,this.Wo=this.databaseId.database===Lh?`project_id=${i}`:`project_id=${i}&database_id=${a}`}Go(e,n,i,a,l){const c=zg(),h=this.zo(e,n.toUriEncodedString());Ce(rg,`Sending RPC '${e}' ${c}:`,h,i);const f={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(f,a,l);const{host:p}=new URL(h),_=Ml(p);return this.Jo(e,h,f,i,_).then((b=>(Ce(rg,`Received RPC '${e}' ${c}: `,b),b)),(b=>{throw yl(rg,`RPC '${e}' ${c} failed with error: `,b,"url: ",h,"request:",i),b}))}Ho(e,n,i,a,l,c){return this.Go(e,n,i,a,l)}jo(e,n,i){e["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+kl})(),e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),n&&n.headers.forEach(((a,l)=>e[l]=a)),i&&i.headers.forEach(((a,l)=>e[l]=a))}zo(e,n){const i=yM[e];return`${this.Uo}/v1/${n}:${i}`}terminate(){}}class bM{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Cn="WebChannelConnection";class vM extends _M{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,n,i,a,l){const c=zg();return new Promise(((h,f)=>{const p=new ZE;p.setWithCredentials(!0),p.listenOnce(ew.COMPLETE,(()=>{try{switch(p.getLastErrorCode()){case vh.NO_ERROR:const b=p.getResponseJson();Ce(Cn,`XHR for RPC '${e}' ${c} received:`,JSON.stringify(b)),h(b);break;case vh.TIMEOUT:Ce(Cn,`RPC '${e}' ${c} timed out`),f(new Te(_e.DEADLINE_EXCEEDED,"Request time out"));break;case vh.HTTP_ERROR:const v=p.getStatus();if(Ce(Cn,`RPC '${e}' ${c} failed with status:`,v,"response text:",p.getResponseText()),v>0){let T=p.getResponseJson();Array.isArray(T)&&(T=T[0]);const E=T?.error;if(E&&E.status&&E.message){const w=(function(L){const q=L.toLowerCase().replace(/_/g,"-");return Object.values(_e).indexOf(q)>=0?q:_e.UNKNOWN})(E.status);f(new Te(w,E.message))}else f(new Te(_e.UNKNOWN,"Server responded with status "+p.getStatus()))}else f(new Te(_e.UNAVAILABLE,"Connection failed."));break;default:Pe(9055,{l_:e,streamId:c,h_:p.getLastErrorCode(),P_:p.getLastError()})}}finally{Ce(Cn,`RPC '${e}' ${c} completed.`)}}));const _=JSON.stringify(a);Ce(Cn,`RPC '${e}' ${c} sending request:`,a),p.send(n,"POST",_,i,15)}))}T_(e,n,i){const a=zg(),l=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],c=rw(),h=nw(),f={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},p=this.longPollingOptions.timeoutSeconds;p!==void 0&&(f.longPollingTimeout=Math.round(1e3*p)),this.useFetchStreams&&(f.useFetchStreams=!0),this.jo(f.initMessageHeaders,n,i),f.encodeInitMessageHeaders=!0;const _=l.join("");Ce(Cn,`Creating RPC '${e}' stream ${a}: ${_}`,f);const b=c.createWebChannel(_,f);this.I_(b);let v=!1,T=!1;const E=new bM({Yo:D=>{T?Ce(Cn,`Not sending because RPC '${e}' stream ${a} is closed:`,D):(v||(Ce(Cn,`Opening RPC '${e}' stream ${a} transport.`),b.open(),v=!0),Ce(Cn,`RPC '${e}' stream ${a} sending:`,D),b.send(D))},Zo:()=>b.close()}),w=(D,L,q)=>{D.listen(L,(B=>{try{q(B)}catch(ee){setTimeout((()=>{throw ee}),0)}}))};return w(b,Wc.EventType.OPEN,(()=>{T||(Ce(Cn,`RPC '${e}' stream ${a} transport opened.`),E.o_())})),w(b,Wc.EventType.CLOSE,(()=>{T||(T=!0,Ce(Cn,`RPC '${e}' stream ${a} transport closed`),E.a_(),this.E_(b))})),w(b,Wc.EventType.ERROR,(D=>{T||(T=!0,yl(Cn,`RPC '${e}' stream ${a} transport errored. Name:`,D.name,"Message:",D.message),E.a_(new Te(_e.UNAVAILABLE,"The operation could not be completed")))})),w(b,Wc.EventType.MESSAGE,(D=>{if(!T){const L=D.data[0];ct(!!L,16349);const q=L,B=q?.error||q[0]?.error;if(B){Ce(Cn,`RPC '${e}' stream ${a} received error:`,B);const ee=B.status;let Q=(function(R){const j=Zt[R];if(j!==void 0)return Lw(j)})(ee),J=B.message;Q===void 0&&(Q=_e.INTERNAL,J="Unknown error status: "+ee+" with message "+B.message),T=!0,E.a_(new Te(Q,J)),b.close()}else Ce(Cn,`RPC '${e}' stream ${a} received:`,L),E.u_(L)}})),w(h,tw.STAT_EVENT,(D=>{D.stat===Rg.PROXY?Ce(Cn,`RPC '${e}' stream ${a} detected buffering proxy`):D.stat===Rg.NOPROXY&&Ce(Cn,`RPC '${e}' stream ${a} detected no buffering proxy`)})),setTimeout((()=>{E.__()}),0),E}terminate(){this.c_.forEach((e=>e.close())),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter((n=>n===e))}}function ig(){return typeof document<"u"?document:null}function vf(t){return new w5(t,!0)}class Xw{constructor(e,n,i=1e3,a=1.5,l=6e4){this.Mi=e,this.timerId=n,this.d_=i,this.A_=a,this.R_=l,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const n=Math.floor(this.V_+this.y_()),i=Math.max(0,Date.now()-this.f_),a=Math.max(0,n-i);a>0&&Ce("ExponentialBackoff",`Backing off for ${a} ms (base delay: ${this.V_} ms, delay with jitter: ${n} ms, last attempt: ${i} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,a,(()=>(this.f_=Date.now(),e()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const eS="PersistentStream";class Jw{constructor(e,n,i,a,l,c,h,f){this.Mi=e,this.S_=i,this.b_=a,this.connection=l,this.authCredentialsProvider=c,this.appCheckCredentialsProvider=h,this.listener=f,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Xw(e,n)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,n){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,e!==4?this.M_.reset():n&&n.code===_e.RESOURCE_EXHAUSTED?(Ji(n.toString()),Ji("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):n&&n.code===_e.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(n)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),n=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([i,a])=>{this.D_===n&&this.G_(i,a)}),(i=>{e((()=>{const a=new Te(_e.UNKNOWN,"Fetching auth token failed: "+i.message);return this.z_(a)}))}))}G_(e,n){const i=this.W_(this.D_);this.stream=this.j_(e,n),this.stream.Xo((()=>{i((()=>this.listener.Xo()))})),this.stream.t_((()=>{i((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((a=>{i((()=>this.z_(a)))})),this.stream.onMessage((a=>{i((()=>++this.F_==1?this.J_(a):this.onNext(a)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(e){return Ce(eS,`close with error: ${e}`),this.stream=null,this.close(4,e)}W_(e){return n=>{this.Mi.enqueueAndForget((()=>this.D_===e?n():(Ce(eS,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class xM extends Jw{constructor(e,n,i,a,l,c){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",n,i,a,c),this.serializer=l}j_(e,n){return this.connection.T_("Listen",e,n)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const n=A5(this.serializer,e),i=(function(l){if(!("targetChange"in l))return Be.min();const c=l.targetChange;return c.targetIds&&c.targetIds.length?Be.min():c.readTime?yi(c.readTime):Be.min()})(e);return this.listener.H_(n,i)}Y_(e){const n={};n.database=Vg(this.serializer),n.addTarget=(function(l,c){let h;const f=c.target;if(h=Og(f)?{documents:j5(l,f)}:{query:I5(l,f).ft},h.targetId=c.targetId,c.resumeToken.approximateByteSize()>0){h.resumeToken=Uw(l,c.resumeToken);const p=Pg(l,c.expectedCount);p!==null&&(h.expectedCount=p)}else if(c.snapshotVersion.compareTo(Be.min())>0){h.readTime=qh(l,c.snapshotVersion.toTimestamp());const p=Pg(l,c.expectedCount);p!==null&&(h.expectedCount=p)}return h})(this.serializer,e);const i=O5(this.serializer,e);i&&(n.labels=i),this.q_(n)}Z_(e){const n={};n.database=Vg(this.serializer),n.removeTarget=e,this.q_(n)}}class SM extends Jw{constructor(e,n,i,a,l,c){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",n,i,a,c),this.serializer=l}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,n){return this.connection.T_("Write",e,n)}J_(e){return ct(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,ct(!e.writeResults||e.writeResults.length===0,55816),this.listener.ta()}onNext(e){ct(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const n=D5(e.writeResults,e.commitTime),i=yi(e.commitTime);return this.listener.na(i,n)}ra(){const e={};e.database=Vg(this.serializer),this.q_(e)}ea(e){const n={streamToken:this.lastStreamToken,writes:e.map((i=>R5(this.serializer,i)))};this.q_(n)}}class EM{}class wM extends EM{constructor(e,n,i,a){super(),this.authCredentials=e,this.appCheckCredentials=n,this.connection=i,this.serializer=a,this.ia=!1}sa(){if(this.ia)throw new Te(_e.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,n,i,a){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([l,c])=>this.connection.Go(e,Lg(n,i),a,l,c))).catch((l=>{throw l.name==="FirebaseError"?(l.code===_e.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),l):new Te(_e.UNKNOWN,l.toString())}))}Ho(e,n,i,a,l){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([c,h])=>this.connection.Ho(e,Lg(n,i),a,c,h,l))).catch((c=>{throw c.name==="FirebaseError"?(c.code===_e.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),c):new Te(_e.UNKNOWN,c.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class TM{constructor(e,n){this.asyncQueue=e,this.onlineStateHandler=n,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(e){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,e==="Online"&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const n=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ji(n),this.aa=!1):Ce("OnlineStateTracker",n)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Ya="RemoteStore";class CM{constructor(e,n,i,a,l){this.localStore=e,this.datastore=n,this.asyncQueue=i,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=l,this.Aa.Oo((c=>{i.enqueueAndForget((async()=>{to(this)&&(Ce(Ya,"Restarting streams for network reachability change."),await(async function(f){const p=ze(f);p.Ea.add(4),await Cu(p),p.Ra.set("Unknown"),p.Ea.delete(4),await xf(p)})(this))}))})),this.Ra=new TM(i,a)}}async function xf(t){if(to(t))for(const e of t.da)await e(!0)}async function Cu(t){for(const e of t.da)await e(!1)}function Zw(t,e){const n=ze(t);n.Ia.has(e.targetId)||(n.Ia.set(e.targetId,e),Ny(n)?ky(n):Ll(n).O_()&&Oy(n,e))}function My(t,e){const n=ze(t),i=Ll(n);n.Ia.delete(e),i.O_()&&e1(n,e),n.Ia.size===0&&(i.O_()?i.L_():to(n)&&n.Ra.set("Unknown"))}function Oy(t,e){if(t.Va.Ue(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Be.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ll(t).Y_(e)}function e1(t,e){t.Va.Ue(e),Ll(t).Z_(e)}function ky(t){t.Va=new v5({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),At:e=>t.Ia.get(e)||null,ht:()=>t.datastore.serializer.databaseId}),Ll(t).start(),t.Ra.ua()}function Ny(t){return to(t)&&!Ll(t).x_()&&t.Ia.size>0}function to(t){return ze(t).Ea.size===0}function t1(t){t.Va=void 0}async function AM(t){t.Ra.set("Online")}async function RM(t){t.Ia.forEach(((e,n)=>{Oy(t,e)}))}async function DM(t,e){t1(t),Ny(t)?(t.Ra.ha(e),ky(t)):t.Ra.set("Unknown")}async function jM(t,e,n){if(t.Ra.set("Online"),e instanceof Vw&&e.state===2&&e.cause)try{await(async function(a,l){const c=l.cause;for(const h of l.targetIds)a.Ia.has(h)&&(await a.remoteSyncer.rejectListen(h,c),a.Ia.delete(h),a.Va.removeTarget(h))})(t,e)}catch(i){Ce(Ya,"Failed to remove targets %s: %s ",e.targetIds.join(","),i),await Gh(t,i)}else if(e instanceof wh?t.Va.Ze(e):e instanceof Bw?t.Va.st(e):t.Va.tt(e),!n.isEqual(Be.min()))try{const i=await Yw(t.localStore);n.compareTo(i)>=0&&await(function(l,c){const h=l.Va.Tt(c);return h.targetChanges.forEach(((f,p)=>{if(f.resumeToken.approximateByteSize()>0){const _=l.Ia.get(p);_&&l.Ia.set(p,_.withResumeToken(f.resumeToken,c))}})),h.targetMismatches.forEach(((f,p)=>{const _=l.Ia.get(f);if(!_)return;l.Ia.set(f,_.withResumeToken(wn.EMPTY_BYTE_STRING,_.snapshotVersion)),e1(l,f);const b=new qs(_.target,f,p,_.sequenceNumber);Oy(l,b)})),l.remoteSyncer.applyRemoteEvent(h)})(t,n)}catch(i){Ce(Ya,"Failed to raise snapshot:",i),await Gh(t,i)}}async function Gh(t,e,n){if(!Pl(e))throw e;t.Ea.add(1),await Cu(t),t.Ra.set("Offline"),n||(n=()=>Yw(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{Ce(Ya,"Retrying IndexedDB access"),await n(),t.Ea.delete(1),await xf(t)}))}function n1(t,e){return e().catch((n=>Gh(t,n,e)))}async function Sf(t){const e=ze(t),n=ra(e);let i=e.Ta.length>0?e.Ta[e.Ta.length-1].batchId:_y;for(;IM(e);)try{const a=await hM(e.localStore,i);if(a===null){e.Ta.length===0&&n.L_();break}i=a.batchId,MM(e,a)}catch(a){await Gh(e,a)}r1(e)&&i1(e)}function IM(t){return to(t)&&t.Ta.length<10}function MM(t,e){t.Ta.push(e);const n=ra(t);n.O_()&&n.X_&&n.ea(e.mutations)}function r1(t){return to(t)&&!ra(t).x_()&&t.Ta.length>0}function i1(t){ra(t).start()}async function OM(t){ra(t).ra()}async function kM(t){const e=ra(t);for(const n of t.Ta)e.ea(n.mutations)}async function NM(t,e,n){const i=t.Ta.shift(),a=Ty.from(i,e,n);await n1(t,(()=>t.remoteSyncer.applySuccessfulWrite(a))),await Sf(t)}async function PM(t,e){e&&ra(t).X_&&await(async function(i,a){if((function(c){return y5(c)&&c!==_e.ABORTED})(a.code)){const l=i.Ta.shift();ra(i).B_(),await n1(i,(()=>i.remoteSyncer.rejectFailedWrite(l.batchId,a))),await Sf(i)}})(t,e),r1(t)&&i1(t)}async function tS(t,e){const n=ze(t);n.asyncQueue.verifyOperationInProgress(),Ce(Ya,"RemoteStore received new credentials");const i=to(n);n.Ea.add(3),await Cu(n),i&&n.Ra.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.Ea.delete(3),await xf(n)}async function LM(t,e){const n=ze(t);e?(n.Ea.delete(2),await xf(n)):e||(n.Ea.add(2),await Cu(n),n.Ra.set("Unknown"))}function Ll(t){return t.ma||(t.ma=(function(n,i,a){const l=ze(n);return l.sa(),new xM(i,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)})(t.datastore,t.asyncQueue,{Xo:AM.bind(null,t),t_:RM.bind(null,t),r_:DM.bind(null,t),H_:jM.bind(null,t)}),t.da.push((async e=>{e?(t.ma.B_(),Ny(t)?ky(t):t.Ra.set("Unknown")):(await t.ma.stop(),t1(t))}))),t.ma}function ra(t){return t.fa||(t.fa=(function(n,i,a){const l=ze(n);return l.sa(),new SM(i,l.connection,l.authCredentials,l.appCheckCredentials,l.serializer,a)})(t.datastore,t.asyncQueue,{Xo:()=>Promise.resolve(),t_:OM.bind(null,t),r_:PM.bind(null,t),ta:kM.bind(null,t),na:NM.bind(null,t)}),t.da.push((async e=>{e?(t.fa.B_(),await Sf(t)):(await t.fa.stop(),t.Ta.length>0&&(Ce(Ya,`Stopping write stream with ${t.Ta.length} pending writes`),t.Ta=[]))}))),t.fa}class Py{constructor(e,n,i,a,l){this.asyncQueue=e,this.timerId=n,this.targetTimeMs=i,this.op=a,this.removalCallback=l,this.deferred=new Ki,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((c=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,n,i,a,l){const c=Date.now()+i,h=new Py(e,n,c,a,l);return h.start(i),h}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new Te(_e.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ly(t,e){if(Ji("AsyncQueue",`${e}: ${t}`),Pl(t))return new Te(_e.UNAVAILABLE,`${e}: ${t}`);throw t}class cl{static emptySet(e){return new cl(e.comparator)}constructor(e){this.comparator=e?(n,i)=>e(n,i)||Me.comparator(n.key,i.key):(n,i)=>Me.comparator(n.key,i.key),this.keyedMap=Kc(),this.sortedSet=new jt(this.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const n=this.keyedMap.get(e);return n?this.sortedSet.indexOf(n):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((n,i)=>(e(n),!1)))}add(e){const n=this.delete(e.key);return n.copy(n.keyedMap.insert(e.key,e),n.sortedSet.insert(e,null))}delete(e){const n=this.get(e);return n?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(n)):this}isEqual(e){if(!(e instanceof cl)||this.size!==e.size)return!1;const n=this.sortedSet.getIterator(),i=e.sortedSet.getIterator();for(;n.hasNext();){const a=n.getNext().key,l=i.getNext().key;if(!a.isEqual(l))return!1}return!0}toString(){const e=[];return this.forEach((n=>{e.push(n.toString())})),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,n){const i=new cl;return i.comparator=this.comparator,i.keyedMap=e,i.sortedSet=n,i}}class nS{constructor(){this.ga=new jt(Me.comparator)}track(e){const n=e.doc.key,i=this.ga.get(n);i?e.type!==0&&i.type===3?this.ga=this.ga.insert(n,e):e.type===3&&i.type!==1?this.ga=this.ga.insert(n,{type:i.type,doc:e.doc}):e.type===2&&i.type===2?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):e.type===2&&i.type===0?this.ga=this.ga.insert(n,{type:0,doc:e.doc}):e.type===1&&i.type===0?this.ga=this.ga.remove(n):e.type===1&&i.type===2?this.ga=this.ga.insert(n,{type:1,doc:i.doc}):e.type===0&&i.type===1?this.ga=this.ga.insert(n,{type:2,doc:e.doc}):Pe(63341,{Rt:e,pa:i}):this.ga=this.ga.insert(n,e)}ya(){const e=[];return this.ga.inorderTraversal(((n,i)=>{e.push(i)})),e}}class El{constructor(e,n,i,a,l,c,h,f,p){this.query=e,this.docs=n,this.oldDocs=i,this.docChanges=a,this.mutatedKeys=l,this.fromCache=c,this.syncStateChanged=h,this.excludesMetadataChanges=f,this.hasCachedResults=p}static fromInitialDocuments(e,n,i,a,l){const c=[];return n.forEach((h=>{c.push({type:0,doc:h})})),new El(e,n,cl.emptySet(n),c,i,a,!0,!1,l)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&mf(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const n=this.docChanges,i=e.docChanges;if(n.length!==i.length)return!1;for(let a=0;a<n.length;a++)if(n[a].type!==i[a].type||!n[a].doc.isEqual(i[a].doc))return!1;return!0}}class BM{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((e=>e.Da()))}}class VM{constructor(){this.queries=rS(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(n,i){const a=ze(n),l=a.queries;a.queries=rS(),l.forEach(((c,h)=>{for(const f of h.Sa)f.onError(i)}))})(this,new Te(_e.ABORTED,"Firestore shutting down"))}}function rS(){return new eo((t=>Tw(t)),mf)}async function s1(t,e){const n=ze(t);let i=3;const a=e.query;let l=n.queries.get(a);l?!l.ba()&&e.Da()&&(i=2):(l=new BM,i=e.Da()?0:1);try{switch(i){case 0:l.wa=await n.onListen(a,!0);break;case 1:l.wa=await n.onListen(a,!1);break;case 2:await n.onFirstRemoteStoreListen(a)}}catch(c){const h=Ly(c,`Initialization of query '${sl(e.query)}' failed`);return void e.onError(h)}n.queries.set(a,l),l.Sa.push(e),e.va(n.onlineState),l.wa&&e.Fa(l.wa)&&By(n)}async function a1(t,e){const n=ze(t),i=e.query;let a=3;const l=n.queries.get(i);if(l){const c=l.Sa.indexOf(e);c>=0&&(l.Sa.splice(c,1),l.Sa.length===0?a=e.Da()?0:1:!l.ba()&&e.Da()&&(a=2))}switch(a){case 0:return n.queries.delete(i),n.onUnlisten(i,!0);case 1:return n.queries.delete(i),n.onUnlisten(i,!1);case 2:return n.onLastRemoteStoreUnlisten(i);default:return}}function UM(t,e){const n=ze(t);let i=!1;for(const a of e){const l=a.query,c=n.queries.get(l);if(c){for(const h of c.Sa)h.Fa(a)&&(i=!0);c.wa=a}}i&&By(n)}function zM(t,e,n){const i=ze(t),a=i.queries.get(e);if(a)for(const l of a.Sa)l.onError(n);i.queries.delete(e)}function By(t){t.Ca.forEach((e=>{e.next()}))}var Fg,iS;(iS=Fg||(Fg={})).Ma="default",iS.Cache="cache";class o1{constructor(e,n,i){this.query=e,this.xa=n,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=i||{}}Fa(e){if(!this.options.includeMetadataChanges){const i=[];for(const a of e.docChanges)a.type!==3&&i.push(a);e=new El(e.query,e.docs,e.oldDocs,i,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let n=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),n=!0):this.La(e,this.onlineState)&&(this.ka(e),n=!0),this.Na=e,n}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let n=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),n=!0),n}La(e,n){if(!e.fromCache||!this.Da())return!0;const i=n!=="Offline";return(!this.options.qa||!i)&&(!e.docs.isEmpty()||e.hasCachedResults||n==="Offline")}Ba(e){if(e.docChanges.length>0)return!0;const n=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!n)&&this.options.includeMetadataChanges===!0}ka(e){e=El.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Fg.Cache}}class l1{constructor(e){this.key=e}}class c1{constructor(e){this.key=e}}class FM{constructor(e,n){this.query=e,this.Ya=n,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=Ze(),this.mutatedKeys=Ze(),this.eu=Cw(e),this.tu=new cl(this.eu)}get nu(){return this.Ya}ru(e,n){const i=n?n.iu:new nS,a=n?n.tu:this.tu;let l=n?n.mutatedKeys:this.mutatedKeys,c=a,h=!1;const f=this.query.limitType==="F"&&a.size===this.query.limit?a.last():null,p=this.query.limitType==="L"&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal(((_,b)=>{const v=a.get(_),T=pf(this.query,b)?b:null,E=!!v&&this.mutatedKeys.has(v.key),w=!!T&&(T.hasLocalMutations||this.mutatedKeys.has(T.key)&&T.hasCommittedMutations);let D=!1;v&&T?v.data.isEqual(T.data)?E!==w&&(i.track({type:3,doc:T}),D=!0):this.su(v,T)||(i.track({type:2,doc:T}),D=!0,(f&&this.eu(T,f)>0||p&&this.eu(T,p)<0)&&(h=!0)):!v&&T?(i.track({type:0,doc:T}),D=!0):v&&!T&&(i.track({type:1,doc:v}),D=!0,(f||p)&&(h=!0)),D&&(T?(c=c.add(T),l=w?l.add(_):l.delete(_)):(c=c.delete(_),l=l.delete(_)))})),this.query.limit!==null)for(;c.size>this.query.limit;){const _=this.query.limitType==="F"?c.last():c.first();c=c.delete(_.key),l=l.delete(_.key),i.track({type:1,doc:_})}return{tu:c,iu:i,Cs:h,mutatedKeys:l}}su(e,n){return e.hasLocalMutations&&n.hasCommittedMutations&&!n.hasLocalMutations}applyChanges(e,n,i,a){const l=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const c=e.iu.ya();c.sort(((_,b)=>(function(T,E){const w=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Pe(20277,{Rt:D})}};return w(T)-w(E)})(_.type,b.type)||this.eu(_.doc,b.doc))),this.ou(i),a=a??!1;const h=n&&!a?this._u():[],f=this.Xa.size===0&&this.current&&!a?1:0,p=f!==this.Za;return this.Za=f,c.length!==0||p?{snapshot:new El(this.query,e.tu,l,c,e.mutatedKeys,f===0,p,!1,!!i&&i.resumeToken.approximateByteSize()>0),au:h}:{au:h}}va(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new nS,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach((n=>this.Ya=this.Ya.add(n))),e.modifiedDocuments.forEach((n=>{})),e.removedDocuments.forEach((n=>this.Ya=this.Ya.delete(n))),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=Ze(),this.tu.forEach((i=>{this.uu(i.key)&&(this.Xa=this.Xa.add(i.key))}));const n=[];return e.forEach((i=>{this.Xa.has(i)||n.push(new c1(i))})),this.Xa.forEach((i=>{e.has(i)||n.push(new l1(i))})),n}cu(e){this.Ya=e.Qs,this.Xa=Ze();const n=this.ru(e.documents);return this.applyChanges(n,!0)}lu(){return El.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Vy="SyncEngine";class qM{constructor(e,n,i){this.query=e,this.targetId=n,this.view=i}}class HM{constructor(e){this.key=e,this.hu=!1}}class GM{constructor(e,n,i,a,l,c){this.localStore=e,this.remoteStore=n,this.eventManager=i,this.sharedClientState=a,this.currentUser=l,this.maxConcurrentLimboResolutions=c,this.Pu={},this.Tu=new eo((h=>Tw(h)),mf),this.Iu=new Map,this.Eu=new Set,this.du=new jt(Me.comparator),this.Au=new Map,this.Ru=new Ry,this.Vu={},this.mu=new Map,this.fu=Sl.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function $M(t,e,n=!0){const i=p1(t);let a;const l=i.Tu.get(e);return l?(i.sharedClientState.addLocalQueryTarget(l.targetId),a=l.view.lu()):a=await u1(i,e,n,!0),a}async function QM(t,e){const n=p1(t);await u1(n,e,!0,!1)}async function u1(t,e,n,i){const a=await fM(t.localStore,gi(e)),l=a.targetId,c=t.sharedClientState.addLocalQueryTarget(l,n);let h;return i&&(h=await WM(t,e,l,c==="current",a.resumeToken)),t.isPrimaryClient&&n&&Zw(t.remoteStore,a),h}async function WM(t,e,n,i,a){t.pu=(b,v,T)=>(async function(w,D,L,q){let B=D.view.ru(L);B.Cs&&(B=await Yx(w.localStore,D.query,!1).then((({documents:O})=>D.view.ru(O,B))));const ee=q&&q.targetChanges.get(D.targetId),Q=q&&q.targetMismatches.get(D.targetId)!=null,J=D.view.applyChanges(B,w.isPrimaryClient,ee,Q);return aS(w,D.targetId,J.au),J.snapshot})(t,b,v,T);const l=await Yx(t.localStore,e,!0),c=new FM(e,l.Qs),h=c.ru(l.documents),f=Tu.createSynthesizedTargetChangeForCurrentChange(n,i&&t.onlineState!=="Offline",a),p=c.applyChanges(h,t.isPrimaryClient,f);aS(t,n,p.au);const _=new qM(e,n,c);return t.Tu.set(e,_),t.Iu.has(n)?t.Iu.get(n).push(e):t.Iu.set(n,[e]),p.snapshot}async function KM(t,e,n){const i=ze(t),a=i.Tu.get(e),l=i.Iu.get(a.targetId);if(l.length>1)return i.Iu.set(a.targetId,l.filter((c=>!mf(c,e)))),void i.Tu.delete(e);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(a.targetId),i.sharedClientState.isActiveQueryTarget(a.targetId)||await Ug(i.localStore,a.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(a.targetId),n&&My(i.remoteStore,a.targetId),qg(i,a.targetId)})).catch(Nl)):(qg(i,a.targetId),await Ug(i.localStore,a.targetId,!0))}async function YM(t,e){const n=ze(t),i=n.Tu.get(e),a=n.Iu.get(i.targetId);n.isPrimaryClient&&a.length===1&&(n.sharedClientState.removeLocalQueryTarget(i.targetId),My(n.remoteStore,i.targetId))}async function XM(t,e,n){const i=iO(t);try{const a=await(function(c,h){const f=ze(c),p=Et.now(),_=h.reduce(((T,E)=>T.add(E.key)),Ze());let b,v;return f.persistence.runTransaction("Locally write mutations","readwrite",(T=>{let E=Zi(),w=Ze();return f.Ns.getEntries(T,_).next((D=>{E=D,E.forEach(((L,q)=>{q.isValidDocument()||(w=w.add(L))}))})).next((()=>f.localDocuments.getOverlayedDocuments(T,E))).next((D=>{b=D;const L=[];for(const q of h){const B=h5(q,b.get(q.key).overlayedDocument);B!=null&&L.push(new la(q.key,B,yw(B.value.mapValue),$n.exists(!0)))}return f.mutationQueue.addMutationBatch(T,p,L,h)})).next((D=>{v=D;const L=D.applyToLocalDocumentSet(b,w);return f.documentOverlayCache.saveOverlays(T,D.batchId,L)}))})).then((()=>({batchId:v.batchId,changes:Rw(b)})))})(i.localStore,e);i.sharedClientState.addPendingMutation(a.batchId),(function(c,h,f){let p=c.Vu[c.currentUser.toKey()];p||(p=new jt(Je)),p=p.insert(h,f),c.Vu[c.currentUser.toKey()]=p})(i,a.batchId,n),await Au(i,a.changes),await Sf(i.remoteStore)}catch(a){const l=Ly(a,"Failed to persist write");n.reject(l)}}async function d1(t,e){const n=ze(t);try{const i=await uM(n.localStore,e);e.targetChanges.forEach(((a,l)=>{const c=n.Au.get(l);c&&(ct(a.addedDocuments.size+a.modifiedDocuments.size+a.removedDocuments.size<=1,22616),a.addedDocuments.size>0?c.hu=!0:a.modifiedDocuments.size>0?ct(c.hu,14607):a.removedDocuments.size>0&&(ct(c.hu,42227),c.hu=!1))})),await Au(n,i,e)}catch(i){await Nl(i)}}function sS(t,e,n){const i=ze(t);if(i.isPrimaryClient&&n===0||!i.isPrimaryClient&&n===1){const a=[];i.Tu.forEach(((l,c)=>{const h=c.view.va(e);h.snapshot&&a.push(h.snapshot)})),(function(c,h){const f=ze(c);f.onlineState=h;let p=!1;f.queries.forEach(((_,b)=>{for(const v of b.Sa)v.va(h)&&(p=!0)})),p&&By(f)})(i.eventManager,e),a.length&&i.Pu.H_(a),i.onlineState=e,i.isPrimaryClient&&i.sharedClientState.setOnlineState(e)}}async function JM(t,e,n){const i=ze(t);i.sharedClientState.updateQueryState(e,"rejected",n);const a=i.Au.get(e),l=a&&a.key;if(l){let c=new jt(Me.comparator);c=c.insert(l,Rn.newNoDocument(l,Be.min()));const h=Ze().add(l),f=new bf(Be.min(),new Map,new jt(Je),c,h);await d1(i,f),i.du=i.du.remove(l),i.Au.delete(e),Uy(i)}else await Ug(i.localStore,e,!1).then((()=>qg(i,e,n))).catch(Nl)}async function ZM(t,e){const n=ze(t),i=e.batch.batchId;try{const a=await cM(n.localStore,e);f1(n,i,null),h1(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await Au(n,a)}catch(a){await Nl(a)}}async function eO(t,e,n){const i=ze(t);try{const a=await(function(c,h){const f=ze(c);return f.persistence.runTransaction("Reject batch","readwrite-primary",(p=>{let _;return f.mutationQueue.lookupMutationBatch(p,h).next((b=>(ct(b!==null,37113),_=b.keys(),f.mutationQueue.removeMutationBatch(p,b)))).next((()=>f.mutationQueue.performConsistencyCheck(p))).next((()=>f.documentOverlayCache.removeOverlaysForBatchId(p,_,h))).next((()=>f.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(p,_))).next((()=>f.localDocuments.getDocuments(p,_)))}))})(i.localStore,e);f1(i,e,n),h1(i,e),i.sharedClientState.updateMutationState(e,"rejected",n),await Au(i,a)}catch(a){await Nl(a)}}function h1(t,e){(t.mu.get(e)||[]).forEach((n=>{n.resolve()})),t.mu.delete(e)}function f1(t,e,n){const i=ze(t);let a=i.Vu[i.currentUser.toKey()];if(a){const l=a.get(e);l&&(n?l.reject(n):l.resolve(),a=a.remove(e)),i.Vu[i.currentUser.toKey()]=a}}function qg(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const i of t.Iu.get(e))t.Tu.delete(i),n&&t.Pu.yu(i,n);t.Iu.delete(e),t.isPrimaryClient&&t.Ru.jr(e).forEach((i=>{t.Ru.containsKey(i)||m1(t,i)}))}function m1(t,e){t.Eu.delete(e.path.canonicalString());const n=t.du.get(e);n!==null&&(My(t.remoteStore,n),t.du=t.du.remove(e),t.Au.delete(n),Uy(t))}function aS(t,e,n){for(const i of n)i instanceof l1?(t.Ru.addReference(i.key,e),tO(t,i)):i instanceof c1?(Ce(Vy,"Document no longer in limbo: "+i.key),t.Ru.removeReference(i.key,e),t.Ru.containsKey(i.key)||m1(t,i.key)):Pe(19791,{wu:i})}function tO(t,e){const n=e.key,i=n.path.canonicalString();t.du.get(n)||t.Eu.has(i)||(Ce(Vy,"New document in limbo: "+n),t.Eu.add(i),Uy(t))}function Uy(t){for(;t.Eu.size>0&&t.du.size<t.maxConcurrentLimboResolutions;){const e=t.Eu.values().next().value;t.Eu.delete(e);const n=new Me(vt.fromString(e)),i=t.fu.next();t.Au.set(i,new HM(n)),t.du=t.du.insert(n,i),Zw(t.remoteStore,new qs(gi(Ey(n.path)),i,"TargetPurposeLimboResolution",df.ce))}}async function Au(t,e,n){const i=ze(t),a=[],l=[],c=[];i.Tu.isEmpty()||(i.Tu.forEach(((h,f)=>{c.push(i.pu(f,e,n).then((p=>{if((p||n)&&i.isPrimaryClient){const _=p?!p.fromCache:n?.targetChanges.get(f.targetId)?.current;i.sharedClientState.updateQueryState(f.targetId,_?"current":"not-current")}if(p){a.push(p);const _=jy.As(f.targetId,p);l.push(_)}})))})),await Promise.all(c),i.Pu.H_(a),await(async function(f,p){const _=ze(f);try{await _.persistence.runTransaction("notifyLocalViewChanges","readwrite",(b=>ve.forEach(p,(v=>ve.forEach(v.Es,(T=>_.persistence.referenceDelegate.addReference(b,v.targetId,T))).next((()=>ve.forEach(v.ds,(T=>_.persistence.referenceDelegate.removeReference(b,v.targetId,T)))))))))}catch(b){if(!Pl(b))throw b;Ce(Iy,"Failed to update sequence numbers: "+b)}for(const b of p){const v=b.targetId;if(!b.fromCache){const T=_.Ms.get(v),E=T.snapshotVersion,w=T.withLastLimboFreeSnapshotVersion(E);_.Ms=_.Ms.insert(v,w)}}})(i.localStore,l))}async function nO(t,e){const n=ze(t);if(!n.currentUser.isEqual(e)){Ce(Vy,"User change. New user:",e.toKey());const i=await Kw(n.localStore,e);n.currentUser=e,(function(l,c){l.mu.forEach((h=>{h.forEach((f=>{f.reject(new Te(_e.CANCELLED,c))}))})),l.mu.clear()})(n,"'waitForPendingWrites' promise is rejected due to a user change."),n.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),await Au(n,i.Ls)}}function rO(t,e){const n=ze(t),i=n.Au.get(e);if(i&&i.hu)return Ze().add(i.key);{let a=Ze();const l=n.Iu.get(e);if(!l)return a;for(const c of l){const h=n.Tu.get(c);a=a.unionWith(h.view.nu)}return a}}function p1(t){const e=ze(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=d1.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=rO.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=JM.bind(null,e),e.Pu.H_=UM.bind(null,e.eventManager),e.Pu.yu=zM.bind(null,e.eventManager),e}function iO(t){const e=ze(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=ZM.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=eO.bind(null,e),e}class $h{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=vf(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,n){return null}Mu(e,n){return null}vu(e){return lM(this.persistence,new sM,e.initialUser,this.serializer)}Cu(e){return new Ww(Dy.mi,this.serializer)}Du(e){return new pM}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}$h.provider={build:()=>new $h};class sO extends $h{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,n){ct(this.persistence.referenceDelegate instanceof Hh,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new H5(i,e.asyncQueue,n)}Cu(e){const n=this.cacheSizeBytes!==void 0?Hn.withCacheSize(this.cacheSizeBytes):Hn.DEFAULT;return new Ww((i=>Hh.mi(i,n)),this.serializer)}}class Hg{async initialize(e,n){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>sS(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=nO.bind(null,this.syncEngine),await LM(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return(function(){return new VM})()}createDatastore(e){const n=vf(e.databaseInfo.databaseId),i=(function(l){return new vM(l)})(e.databaseInfo);return(function(l,c,h,f){return new wM(l,c,h,f)})(e.authCredentials,e.appCheckCredentials,i,n)}createRemoteStore(e){return(function(i,a,l,c,h){return new CM(i,a,l,c,h)})(this.localStore,this.datastore,e.asyncQueue,(n=>sS(this.syncEngine,n,0)),(function(){return Zx.v()?new Zx:new gM})())}createSyncEngine(e,n){return(function(a,l,c,h,f,p,_){const b=new GM(a,l,c,h,f,p);return _&&(b.gu=!0),b})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,n)}async terminate(){await(async function(n){const i=ze(n);Ce(Ya,"RemoteStore shutting down."),i.Ea.add(5),await Cu(i),i.Aa.shutdown(),i.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Hg.provider={build:()=>new Hg};class g1{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Ji("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,n){setTimeout((()=>{this.muted||e(n)}),0)}}const ia="FirestoreClient";class aO{constructor(e,n,i,a,l){this.authCredentials=e,this.appCheckCredentials=n,this.asyncQueue=i,this.databaseInfo=a,this.user=An.UNAUTHENTICATED,this.clientId=yy.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=l,this.authCredentials.start(i,(async c=>{Ce(ia,"Received user=",c.uid),await this.authCredentialListener(c),this.user=c})),this.appCheckCredentials.start(i,(c=>(Ce(ia,"Received new app check token=",c),this.appCheckCredentialListener(c,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Ki;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(n){const i=Ly(n,"Failed to shutdown persistence");e.reject(i)}})),e.promise}}async function sg(t,e){t.asyncQueue.verifyOperationInProgress(),Ce(ia,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let i=n.initialUser;t.setCredentialChangeListener((async a=>{i.isEqual(a)||(await Kw(e.localStore,a),i=a)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function oS(t,e){t.asyncQueue.verifyOperationInProgress();const n=await oO(t);Ce(ia,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((i=>tS(e.remoteStore,i))),t.setAppCheckTokenChangeListener(((i,a)=>tS(e.remoteStore,a))),t._onlineComponents=e}async function oO(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){Ce(ia,"Using user provided OfflineComponentProvider");try{await sg(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!(function(a){return a.name==="FirebaseError"?a.code===_e.FAILED_PRECONDITION||a.code===_e.UNIMPLEMENTED:!(typeof DOMException<"u"&&a instanceof DOMException)||a.code===22||a.code===20||a.code===11})(n))throw n;yl("Error using user provided cache. Falling back to memory cache: "+n),await sg(t,new $h)}}else Ce(ia,"Using default OfflineComponentProvider"),await sg(t,new sO(void 0));return t._offlineComponents}async function y1(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(Ce(ia,"Using user provided OnlineComponentProvider"),await oS(t,t._uninitializedComponentsProvider._online)):(Ce(ia,"Using default OnlineComponentProvider"),await oS(t,new Hg))),t._onlineComponents}function lO(t){return y1(t).then((e=>e.syncEngine))}async function _1(t){const e=await y1(t),n=e.eventManager;return n.onListen=$M.bind(null,e.syncEngine),n.onUnlisten=KM.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=QM.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=YM.bind(null,e.syncEngine),n}function cO(t,e,n={}){const i=new Ki;return t.asyncQueue.enqueueAndForget((async()=>(function(l,c,h,f,p){const _=new g1({next:v=>{_.Nu(),c.enqueueAndForget((()=>a1(l,b)));const T=v.docs.has(h);!T&&v.fromCache?p.reject(new Te(_e.UNAVAILABLE,"Failed to get document because the client is offline.")):T&&v.fromCache&&f&&f.source==="server"?p.reject(new Te(_e.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):p.resolve(v)},error:v=>p.reject(v)}),b=new o1(Ey(h.path),_,{includeMetadataChanges:!0,qa:!0});return s1(l,b)})(await _1(t),t.asyncQueue,e,n,i))),i.promise}function uO(t,e,n={}){const i=new Ki;return t.asyncQueue.enqueueAndForget((async()=>(function(l,c,h,f,p){const _=new g1({next:v=>{_.Nu(),c.enqueueAndForget((()=>a1(l,b))),v.fromCache&&f.source==="server"?p.reject(new Te(_e.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):p.resolve(v)},error:v=>p.reject(v)}),b=new o1(h,_,{includeMetadataChanges:!0,qa:!0});return s1(l,b)})(await _1(t),t.asyncQueue,e,n,i))),i.promise}function b1(t){const e={};return t.timeoutSeconds!==void 0&&(e.timeoutSeconds=t.timeoutSeconds),e}const lS=new Map;const v1="firestore.googleapis.com",cS=!0;class uS{constructor(e){if(e.host===void 0){if(e.ssl!==void 0)throw new Te(_e.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=v1,this.ssl=cS}else this.host=e.host,this.ssl=e.ssl??cS;if(this.isUsingEmulator=e.emulatorOptions!==void 0,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=Qw;else{if(e.cacheSizeBytes!==-1&&e.cacheSizeBytes<F5)throw new Te(_e.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}T2("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=b1(e.experimentalLongPollingOptions??{}),(function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new Te(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new Te(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new Te(_e.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&(function(i,a){return i.timeoutSeconds===a.timeoutSeconds})(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Ef{constructor(e,n,i,a){this._authCredentials=e,this._appCheckCredentials=n,this._databaseId=i,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new uS({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Te(_e.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(e){if(this._settingsFrozen)throw new Te(_e.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new uS(e),this._emulatorOptions=e.emulatorOptions||{},e.credentials!==void 0&&(this._authCredentials=(function(i){if(!i)return new p2;switch(i.type){case"firstParty":return new b2(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new Te(_e.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(n){const i=lS.get(n);i&&(Ce("ComponentProvider","Removing Datastore"),lS.delete(n),i.terminate())})(this),Promise.resolve()}}function dO(t,e,n,i={}){t=Gr(t,Ef);const a=Ml(e),l=t._getSettings(),c={...l,emulatorOptions:t._getEmulatorOptions()},h=`${e}:${n}`;a&&(qE(`https://${h}`),HE("Firestore",!0)),l.host!==v1&&l.host!==h&&yl("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const f={...l,host:h,ssl:a,emulatorOptions:i};if(!Js(f,c)&&(t._setSettings(f),i.mockUserToken)){let p,_;if(typeof i.mockUserToken=="string")p=i.mockUserToken,_=An.MOCK_USER;else{p=Vj(i.mockUserToken,t._app?.options.projectId);const b=i.mockUserToken.sub||i.mockUserToken.user_id;if(!b)throw new Te(_e.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");_=new An(b)}t._authCredentials=new g2(new sw(p,_))}}class Bl{constructor(e,n,i){this.converter=n,this._query=i,this.type="query",this.firestore=e}withConverter(e){return new Bl(this.firestore,e,this._query)}}class Ut{constructor(e,n,i){this.converter=n,this._key=i,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Ys(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Ut(this.firestore,e,this._key)}toJSON(){return{type:Ut._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,n,i){if(Su(n,Ut._jsonSchema))return new Ut(e,i||null,new Me(vt.fromString(n.referencePath)))}}Ut._jsonSchemaVersion="firestore/documentReference/1.0",Ut._jsonSchema={type:nn("string",Ut._jsonSchemaVersion),referencePath:nn("string")};class Ys extends Bl{constructor(e,n,i){super(e,n,Ey(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Ut(this.firestore,null,new Me(e))}withConverter(e){return new Ys(this.firestore,e,this._path)}}function hO(t,e,...n){if(t=rn(t),aw("collection","path",e),t instanceof Ef){const i=vt.fromString(e,...n);return Ex(i),new Ys(t,null,i)}{if(!(t instanceof Ut||t instanceof Ys))throw new Te(_e.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(vt.fromString(e,...n));return Ex(i),new Ys(t.firestore,null,i)}}function Vl(t,e,...n){if(t=rn(t),arguments.length===1&&(e=yy.newId()),aw("doc","path",e),t instanceof Ef){const i=vt.fromString(e,...n);return Sx(i),new Ut(t,null,new Me(i))}{if(!(t instanceof Ut||t instanceof Ys))throw new Te(_e.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=t._path.child(vt.fromString(e,...n));return Sx(i),new Ut(t.firestore,t instanceof Ys?t.converter:null,new Me(i))}}const dS="AsyncQueue";class hS{constructor(e=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Xw(this,"async_queue_retry"),this._c=()=>{const i=ig();i&&Ce(dS,"Visibility state changed to "+i.visibilityState),this.M_.w_()},this.ac=e;const n=ig();n&&typeof n.addEventListener=="function"&&n.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const n=ig();n&&typeof n.removeEventListener=="function"&&n.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise((()=>{}));const n=new Ki;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise))).then((()=>n.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Xu.push(e),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Pl(e))throw e;Ce(dS,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(e){const n=this.ac.then((()=>(this.rc=!0,e().catch((i=>{throw this.nc=i,this.rc=!1,Ji("INTERNAL UNHANDLED ERROR: ",fS(i)),i})).then((i=>(this.rc=!1,i))))));return this.ac=n,n}enqueueAfterDelay(e,n,i){this.uc(),this.oc.indexOf(e)>-1&&(n=0);const a=Py.createAndSchedule(this,e,n,i,(l=>this.hc(l)));return this.tc.push(a),a}uc(){this.nc&&Pe(47125,{Pc:fS(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do e=this.ac,await e;while(e!==this.ac)}Ic(e){for(const n of this.tc)if(n.timerId===e)return!0;return!1}Ec(e){return this.Tc().then((()=>{this.tc.sort(((n,i)=>n.targetTimeMs-i.targetTimeMs));for(const n of this.tc)if(n.skipDelay(),e!=="all"&&n.timerId===e)break;return this.Tc()}))}dc(e){this.oc.push(e)}hc(e){const n=this.tc.indexOf(e);this.tc.splice(n,1)}}function fS(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+`
`+t.stack),e}class no extends Ef{constructor(e,n,i,a){super(e,n,i,a),this.type="firestore",this._queue=new hS,this._persistenceKey=a?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new hS(e),this._firestoreClient=void 0,await e}}}function fO(t,e){const n=typeof t=="object"?t:WE(),i=typeof t=="string"?t:Lh,a=py(n,"firestore").getImmediate({identifier:i});if(!a._initialized){const l=Lj("firestore");l&&dO(a,...l)}return a}function wf(t){if(t._terminated)throw new Te(_e.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||mO(t),t._firestoreClient}function mO(t){const e=t._freezeSettings(),n=(function(a,l,c,h){return new P2(a,l,c,h.host,h.ssl,h.experimentalForceLongPolling,h.experimentalAutoDetectLongPolling,b1(h.experimentalLongPollingOptions),h.useFetchStreams,h.isUsingEmulator)})(t._databaseId,t._app?.options.appId||"",t._persistenceKey,e);t._componentsProvider||e.localCache?._offlineComponentProvider&&e.localCache?._onlineComponentProvider&&(t._componentsProvider={_offline:e.localCache._offlineComponentProvider,_online:e.localCache._onlineComponentProvider}),t._firestoreClient=new aO(t._authCredentials,t._appCheckCredentials,t._queue,n,t._componentsProvider&&(function(a){const l=a?._online.build();return{_offline:a?._offline.build(l),_online:l}})(t._componentsProvider))}class Cr{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Cr(wn.fromBase64String(e))}catch(n){throw new Te(_e.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+n)}}static fromUint8Array(e){return new Cr(wn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Cr._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(Su(e,Cr._jsonSchema))return Cr.fromBase64String(e.bytes)}}Cr._jsonSchemaVersion="firestore/bytes/1.0",Cr._jsonSchema={type:nn("string",Cr._jsonSchemaVersion),bytes:nn("string")};class Ru{constructor(...e){for(let n=0;n<e.length;++n)if(e[n].length===0)throw new Te(_e.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new En(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class Tf{constructor(e){this._methodName=e}}class _i{constructor(e,n){if(!isFinite(e)||e<-90||e>90)throw new Te(_e.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(n)||n<-180||n>180)throw new Te(_e.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=e,this._long=n}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Je(this._lat,e._lat)||Je(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:_i._jsonSchemaVersion}}static fromJSON(e){if(Su(e,_i._jsonSchema))return new _i(e.latitude,e.longitude)}}_i._jsonSchemaVersion="firestore/geoPoint/1.0",_i._jsonSchema={type:nn("string",_i._jsonSchemaVersion),latitude:nn("number"),longitude:nn("number")};class bi{constructor(e){this._values=(e||[]).map((n=>n))}toArray(){return this._values.map((e=>e))}isEqual(e){return(function(i,a){if(i.length!==a.length)return!1;for(let l=0;l<i.length;++l)if(i[l]!==a[l])return!1;return!0})(this._values,e._values)}toJSON(){return{type:bi._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(Su(e,bi._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((n=>typeof n=="number")))return new bi(e.vectorValues);throw new Te(_e.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}bi._jsonSchemaVersion="firestore/vectorValue/1.0",bi._jsonSchema={type:nn("string",bi._jsonSchemaVersion),vectorValues:nn("object")};const pO=/^__.*__$/;class gO{constructor(e,n,i){this.data=e,this.fieldMask=n,this.fieldTransforms=i}toMutation(e,n){return this.fieldMask!==null?new la(e,this.data,this.fieldMask,n,this.fieldTransforms):new wu(e,this.data,n,this.fieldTransforms)}}class x1{constructor(e,n,i){this.data=e,this.fieldMask=n,this.fieldTransforms=i}toMutation(e,n){return new la(e,this.data,this.fieldMask,n,this.fieldTransforms)}}function S1(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Pe(40011,{Ac:t})}}class Cf{constructor(e,n,i,a,l,c){this.settings=e,this.databaseId=n,this.serializer=i,this.ignoreUndefinedProperties=a,l===void 0&&this.Rc(),this.fieldTransforms=l||[],this.fieldMask=c||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new Cf({...this.settings,...e},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){const n=this.path?.child(e),i=this.Vc({path:n,fc:!1});return i.gc(e),i}yc(e){const n=this.path?.child(e),i=this.Vc({path:n,fc:!1});return i.Rc(),i}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Qh(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return this.fieldMask.find((n=>e.isPrefixOf(n)))!==void 0||this.fieldTransforms.find((n=>e.isPrefixOf(n.field)))!==void 0}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(e.length===0)throw this.Sc("Document fields must not be empty");if(S1(this.Ac)&&pO.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class yO{constructor(e,n,i){this.databaseId=e,this.ignoreUndefinedProperties=n,this.serializer=i||vf(e)}Cc(e,n,i,a=!1){return new Cf({Ac:e,methodName:n,Dc:i,path:En.emptyPath(),fc:!1,bc:a},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Af(t){const e=t._freezeSettings(),n=vf(t._databaseId);return new yO(t._databaseId,!!e.ignoreUndefinedProperties,n)}function E1(t,e,n,i,a,l={}){const c=t.Cc(l.merge||l.mergeFields?2:0,e,n,a);Fy("Data must be an object, but it was:",c,i);const h=C1(i,c);let f,p;if(l.merge)f=new ar(c.fieldMask),p=c.fieldTransforms;else if(l.mergeFields){const _=[];for(const b of l.mergeFields){const v=Gg(e,b,n);if(!c.contains(v))throw new Te(_e.INVALID_ARGUMENT,`Field '${v}' is specified in your field mask but missing from your input data.`);R1(_,v)||_.push(v)}f=new ar(_),p=c.fieldTransforms.filter((b=>f.covers(b.field)))}else f=null,p=c.fieldTransforms;return new gO(new Gn(h),f,p)}class Du extends Tf{_toFieldTransform(e){if(e.Ac!==2)throw e.Ac===1?e.Sc(`${this._methodName}() can only appear at the top level of your update data`):e.Sc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Du}}function _O(t,e,n){return new Cf({Ac:3,Dc:e.settings.Dc,methodName:t._methodName,fc:n},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}class zy extends Tf{constructor(e,n){super(e),this.vc=n}_toFieldTransform(e){const n=_O(this,e,!0),i=this.vc.map((l=>Ul(l,n))),a=new xl(i);return new l5(e.path,a)}isEqual(e){return e instanceof zy&&Js(this.vc,e.vc)}}function w1(t,e,n,i){const a=t.Cc(1,e,n);Fy("Data must be an object, but it was:",a,i);const l=[],c=Gn.empty();oa(i,((f,p)=>{const _=qy(e,f,n);p=rn(p);const b=a.yc(_);if(p instanceof Du)l.push(_);else{const v=Ul(p,b);v!=null&&(l.push(_),c.set(_,v))}}));const h=new ar(l);return new x1(c,h,a.fieldTransforms)}function T1(t,e,n,i,a,l){const c=t.Cc(1,e,n),h=[Gg(e,i,n)],f=[a];if(l.length%2!=0)throw new Te(_e.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let v=0;v<l.length;v+=2)h.push(Gg(e,l[v])),f.push(l[v+1]);const p=[],_=Gn.empty();for(let v=h.length-1;v>=0;--v)if(!R1(p,h[v])){const T=h[v];let E=f[v];E=rn(E);const w=c.yc(T);if(E instanceof Du)p.push(T);else{const D=Ul(E,w);D!=null&&(p.push(T),_.set(T,D))}}const b=new ar(p);return new x1(_,b,c.fieldTransforms)}function bO(t,e,n,i=!1){return Ul(n,t.Cc(i?4:3,e))}function Ul(t,e){if(A1(t=rn(t)))return Fy("Unsupported field value:",e,t),C1(t,e);if(t instanceof Tf)return(function(i,a){if(!S1(a.Ac))throw a.Sc(`${i._methodName}() can only be used with update() and set()`);if(!a.path)throw a.Sc(`${i._methodName}() is not currently supported inside arrays`);const l=i._toFieldTransform(a);l&&a.fieldTransforms.push(l)})(t,e),null;if(t===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.fc&&e.Ac!==4)throw e.Sc("Nested arrays are not supported");return(function(i,a){const l=[];let c=0;for(const h of i){let f=Ul(h,a.wc(c));f==null&&(f={nullValue:"NULL_VALUE"}),l.push(f),c++}return{arrayValue:{values:l}}})(t,e)}return(function(i,a){if((i=rn(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return s5(a.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const l=Et.fromDate(i);return{timestampValue:qh(a.serializer,l)}}if(i instanceof Et){const l=new Et(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:qh(a.serializer,l)}}if(i instanceof _i)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof Cr)return{bytesValue:Uw(a.serializer,i._byteString)};if(i instanceof Ut){const l=a.databaseId,c=i.firestore._databaseId;if(!c.isEqual(l))throw a.Sc(`Document reference is for database ${c.projectId}/${c.database} but should be for database ${l.projectId}/${l.database}`);return{referenceValue:Ay(i.firestore._databaseId||a.databaseId,i._key.path)}}if(i instanceof bi)return(function(c,h){return{mapValue:{fields:{[pw]:{stringValue:gw},[Bh]:{arrayValue:{values:c.toArray().map((p=>{if(typeof p!="number")throw h.Sc("VectorValues must only contain numeric values.");return wy(h.serializer,p)}))}}}}}})(i,a);throw a.Sc(`Unsupported field value: ${uf(i)}`)})(t,e)}function C1(t,e){const n={};return cw(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):oa(t,((i,a)=>{const l=Ul(a,e.mc(i));l!=null&&(n[i]=l)})),{mapValue:{fields:n}}}function A1(t){return!(typeof t!="object"||t===null||t instanceof Array||t instanceof Date||t instanceof Et||t instanceof _i||t instanceof Cr||t instanceof Ut||t instanceof Tf||t instanceof bi)}function Fy(t,e,n){if(!A1(n)||!ow(n)){const i=uf(n);throw i==="an object"?e.Sc(t+" a custom object"):e.Sc(t+" "+i)}}function Gg(t,e,n){if((e=rn(e))instanceof Ru)return e._internalPath;if(typeof e=="string")return qy(t,e);throw Qh("Field path arguments must be of type string or ",t,!1,void 0,n)}const vO=new RegExp("[~\\*/\\[\\]]");function qy(t,e,n){if(e.search(vO)>=0)throw Qh(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Ru(...e.split("."))._internalPath}catch{throw Qh(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Qh(t,e,n,i,a){const l=i&&!i.isEmpty(),c=a!==void 0;let h=`Function ${e}() called with invalid data`;n&&(h+=" (via `toFirestore()`)"),h+=". ";let f="";return(l||c)&&(f+=" (found",l&&(f+=` in field ${i}`),c&&(f+=` in document ${a}`),f+=")"),new Te(_e.INVALID_ARGUMENT,h+t+f)}function R1(t,e){return t.some((n=>n.isEqual(e)))}class D1{constructor(e,n,i,a,l){this._firestore=e,this._userDataWriter=n,this._key=i,this._document=a,this._converter=l}get id(){return this._key.path.lastSegment()}get ref(){return new Ut(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const e=new xO(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const n=this._document.data.field(Hy("DocumentSnapshot.get",e));if(n!==null)return this._userDataWriter.convertValue(n)}}}class xO extends D1{data(){return super.data()}}function Hy(t,e){return typeof e=="string"?qy(t,e):e instanceof Ru?e._internalPath:e._delegate._internalPath}function SO(t){if(t.limitType==="L"&&t.explicitOrderBy.length===0)throw new Te(_e.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Gy{}class EO extends Gy{}function wO(t,e,...n){let i=[];e instanceof Gy&&i.push(e),i=i.concat(n),(function(l){const c=l.filter((f=>f instanceof $y)).length,h=l.filter((f=>f instanceof Rf)).length;if(c>1||c>0&&h>0)throw new Te(_e.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(i);for(const a of i)t=a._apply(t);return t}class Rf extends EO{constructor(e,n,i){super(),this._field=e,this._op=n,this._value=i,this.type="where"}static _create(e,n,i){return new Rf(e,n,i)}_apply(e){const n=this._parse(e);return j1(e._query,n),new Bl(e.firestore,e.converter,kg(e._query,n))}_parse(e){const n=Af(e.firestore);return(function(l,c,h,f,p,_,b){let v;if(p.isKeyField()){if(_==="array-contains"||_==="array-contains-any")throw new Te(_e.INVALID_ARGUMENT,`Invalid Query. You can't perform '${_}' queries on documentId().`);if(_==="in"||_==="not-in"){pS(b,_);const E=[];for(const w of b)E.push(mS(f,l,w));v={arrayValue:{values:E}}}else v=mS(f,l,b)}else _!=="in"&&_!=="not-in"&&_!=="array-contains-any"||pS(b,_),v=bO(h,c,b,_==="in"||_==="not-in");return tn.create(p,_,v)})(e._query,"where",n,e.firestore._databaseId,this._field,this._op,this._value)}}function TO(t,e,n){const i=e,a=Hy("where",t);return Rf._create(a,i,n)}class $y extends Gy{constructor(e,n){super(),this.type=e,this._queryConstraints=n}static _create(e,n){return new $y(e,n)}_parse(e){const n=this._queryConstraints.map((i=>i._parse(e))).filter((i=>i.getFilters().length>0));return n.length===1?n[0]:$r.create(n,this._getOperator())}_apply(e){const n=this._parse(e);return n.getFilters().length===0?e:((function(a,l){let c=a;const h=l.getFlattenedFilters();for(const f of h)j1(c,f),c=kg(c,f)})(e._query,n),new Bl(e.firestore,e.converter,kg(e._query,n)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function mS(t,e,n){if(typeof(n=rn(n))=="string"){if(n==="")throw new Te(_e.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!ww(e)&&n.indexOf("/")!==-1)throw new Te(_e.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=e.path.child(vt.fromString(n));if(!Me.isDocumentKey(i))throw new Te(_e.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Ix(t,new Me(i))}if(n instanceof Ut)return Ix(t,n._key);throw new Te(_e.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${uf(n)}.`)}function pS(t,e){if(!Array.isArray(t)||t.length===0)throw new Te(_e.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function j1(t,e){const n=(function(a,l){for(const c of a)for(const h of c.getFlattenedFilters())if(l.indexOf(h.op)>=0)return h.op;return null})(t.filters,(function(a){switch(a){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(e.op));if(n!==null)throw n===e.op?new Te(_e.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new Te(_e.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${n.toString()}' filters.`)}class CO{convertValue(e,n="none"){switch(na(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Vt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,n);case 5:return e.stringValue;case 6:return this.convertBytes(ta(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,n);case 11:return this.convertObject(e.mapValue,n);case 10:return this.convertVectorValue(e.mapValue);default:throw Pe(62114,{value:e})}}convertObject(e,n){return this.convertObjectMap(e.fields,n)}convertObjectMap(e,n="none"){const i={};return oa(e,((a,l)=>{i[a]=this.convertValue(l,n)})),i}convertVectorValue(e){const n=e.fields?.[Bh].arrayValue?.values?.map((i=>Vt(i.doubleValue)));return new bi(n)}convertGeoPoint(e){return new _i(Vt(e.latitude),Vt(e.longitude))}convertArray(e,n){return(e.values||[]).map((i=>this.convertValue(i,n)))}convertServerTimestamp(e,n){switch(n){case"previous":const i=ff(e);return i==null?null:this.convertValue(i,n);case"estimate":return this.convertTimestamp(lu(e));default:return null}}convertTimestamp(e){const n=ea(e);return new Et(n.seconds,n.nanos)}convertDocumentKey(e,n){const i=vt.fromString(e);ct($w(i),9688,{name:e});const a=new cu(i.get(1),i.get(3)),l=new Me(i.popFirst(5));return a.isEqual(n)||Ji(`Document ${l} contains a document reference within a different database (${a.projectId}/${a.database}) which is not supported. It will be treated as a reference in the current database (${n.projectId}/${n.database}) instead.`),l}}function I1(t,e,n){let i;return i=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,i}class Xc{constructor(e,n){this.hasPendingWrites=e,this.fromCache=n}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Ga extends D1{constructor(e,n,i,a,l,c){super(e,n,i,a,c),this._firestore=e,this._firestoreImpl=e,this.metadata=l}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const n=new Th(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(n,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,n={}){if(this._document){const i=this._document.data.field(Hy("DocumentSnapshot.get",e));if(i!==null)return this._userDataWriter.convertValue(i,n.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Te(_e.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,n={};return n.type=Ga._jsonSchemaVersion,n.bundle="",n.bundleSource="DocumentSnapshot",n.bundleName=this._key.toString(),!e||!e.isValidDocument()||!e.isFoundDocument()?n:(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),n.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),n)}}Ga._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ga._jsonSchema={type:nn("string",Ga._jsonSchemaVersion),bundleSource:nn("string","DocumentSnapshot"),bundleName:nn("string"),bundle:nn("string")};class Th extends Ga{data(e={}){return super.data(e)}}class ul{constructor(e,n,i,a){this._firestore=e,this._userDataWriter=n,this._snapshot=a,this.metadata=new Xc(a.hasPendingWrites,a.fromCache),this.query=i}get docs(){const e=[];return this.forEach((n=>e.push(n))),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,n){this._snapshot.docs.forEach((i=>{e.call(n,new Th(this._firestore,this._userDataWriter,i.key,i,new Xc(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const n=!!e.includeMetadataChanges;if(n&&this._snapshot.excludesMetadataChanges)throw new Te(_e.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===n||(this._cachedChanges=(function(a,l){if(a._snapshot.oldDocs.isEmpty()){let c=0;return a._snapshot.docChanges.map((h=>{const f=new Th(a._firestore,a._userDataWriter,h.doc.key,h.doc,new Xc(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);return h.doc,{type:"added",doc:f,oldIndex:-1,newIndex:c++}}))}{let c=a._snapshot.oldDocs;return a._snapshot.docChanges.filter((h=>l||h.type!==3)).map((h=>{const f=new Th(a._firestore,a._userDataWriter,h.doc.key,h.doc,new Xc(a._snapshot.mutatedKeys.has(h.doc.key),a._snapshot.fromCache),a.query.converter);let p=-1,_=-1;return h.type!==0&&(p=c.indexOf(h.doc.key),c=c.delete(h.doc.key)),h.type!==1&&(c=c.add(h.doc),_=c.indexOf(h.doc.key)),{type:AO(h.type),doc:f,oldIndex:p,newIndex:_}}))}})(this,n),this._cachedChangesIncludeMetadataChanges=n),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Te(_e.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=ul._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=yy.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const n=[],i=[],a=[];return this.docs.forEach((l=>{l._document!==null&&(n.push(l._document),i.push(this._userDataWriter.convertObjectMap(l._document.data.value.mapValue.fields,"previous")),a.push(l.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function AO(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Pe(61501,{type:t})}}function RO(t){t=Gr(t,Ut);const e=Gr(t.firestore,no);return cO(wf(e),t._key).then((n=>OO(e,t,n)))}ul._jsonSchemaVersion="firestore/querySnapshot/1.0",ul._jsonSchema={type:nn("string",ul._jsonSchemaVersion),bundleSource:nn("string","QuerySnapshot"),bundleName:nn("string"),bundle:nn("string")};class M1 extends CO{constructor(e){super(),this.firestore=e}convertBytes(e){return new Cr(e)}convertReference(e){const n=this.convertDocumentKey(e,this.firestore._databaseId);return new Ut(this.firestore,null,n)}}function DO(t){t=Gr(t,Bl);const e=Gr(t.firestore,no),n=wf(e),i=new M1(e);return SO(t._query),uO(n,t._query).then((a=>new ul(e,i,t,a)))}function jO(t,e,n){t=Gr(t,Ut);const i=Gr(t.firestore,no),a=I1(t.converter,e,n);return Df(i,[E1(Af(i),"setDoc",t._key,a,t.converter!==null,n).toMutation(t._key,$n.none())])}function IO(t,e,n,...i){t=Gr(t,Ut);const a=Gr(t.firestore,no),l=Af(a);let c;return c=typeof(e=rn(e))=="string"||e instanceof Ru?T1(l,"updateDoc",t._key,e,n,i):w1(l,"updateDoc",t._key,e),Df(a,[c.toMutation(t._key,$n.exists(!0))])}function MO(t){return Df(Gr(t.firestore,no),[new _f(t._key,$n.none())])}function Df(t,e){return(function(i,a){const l=new Ki;return i.asyncQueue.enqueueAndForget((async()=>XM(await lO(i),a,l))),l.promise})(wf(t),e)}function OO(t,e,n){const i=n.docs.get(e._key),a=new M1(t);return new Ga(t,a,e._key,i,new Xc(n.hasPendingWrites,n.fromCache),e.converter)}class kO{constructor(e,n){this._firestore=e,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Af(e)}set(e,n,i){this._verifyNotCommitted();const a=ag(e,this._firestore),l=I1(a.converter,n,i),c=E1(this._dataReader,"WriteBatch.set",a._key,l,a.converter!==null,i);return this._mutations.push(c.toMutation(a._key,$n.none())),this}update(e,n,i,...a){this._verifyNotCommitted();const l=ag(e,this._firestore);let c;return c=typeof(n=rn(n))=="string"||n instanceof Ru?T1(this._dataReader,"WriteBatch.update",l._key,n,i,a):w1(this._dataReader,"WriteBatch.update",l._key,n),this._mutations.push(c.toMutation(l._key,$n.exists(!0))),this}delete(e){this._verifyNotCommitted();const n=ag(e,this._firestore);return this._mutations=this._mutations.concat(new _f(n._key,$n.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new Te(_e.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function ag(t,e){if((t=rn(t)).firestore!==e)throw new Te(_e.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}function gS(){return new Du("deleteField")}function NO(...t){return new zy("arrayUnion",t)}function O1(t){return wf(t=Gr(t,no)),new kO(t,(e=>Df(t,e)))}(function(e,n=!0){(function(a){kl=a})(Ol),gl(new Wa("firestore",((i,{instanceIdentifier:a,options:l})=>{const c=i.getProvider("app").getImmediate(),h=new no(new y2(i.getProvider("auth-internal")),new v2(c,i.getProvider("app-check-internal")),(function(p,_){if(!Object.prototype.hasOwnProperty.apply(p.options,["projectId"]))throw new Te(_e.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new cu(p.options.projectId,_)})(c,a),c);return l={useFetchStreams:n,...l},h._setSettings(l),h}),"PUBLIC").setMultipleInstances(!0)),Ws(_x,bx,e),Ws(_x,bx,"esm2020")})();function ro(){return fO(XE)}function io(t,e,n,i=1,a){{let l=e;if(e.startsWith("budgets/"))l="budgets";else if(e.startsWith("months/")){const f=e.replace("months/","").split("_");if(f.length>=2){const p=f[f.length-1];l=`months/${f[f.length-2]}/${p}`}}console.log(`[Firebase] ${t}(${i}): ${l}${a===!1?" [NOT FOUND]":""}  ${n}`)}}async function Le(t,e,n){const i=Vl(ro(),t,e),a=`${t}/${e}`,l=await RO(i),c=l.exists();return io("READ",a,n,1,c),{exists:c,data:c?l.data():null,ref:i}}async function Rr(t,e,n){const i=ro(),a=hO(i,t);let l;if(n&&n.length>0){const f=n.map(p=>TO(p.field,p.op,p.value));l=wO(a,...f)}else l=a;const c=await DO(l);let h=t;if(n&&n.length>0){const f=n.map(p=>`${p.field} ${p.op} ${JSON.stringify(p.value)}`).join(", ");h+=` WHERE ${f}`}return io("QUERY",h,e,c.docs.length),{docs:c.docs.map(f=>({id:f.id,data:f.data()}))}}async function ut(t,e,n,i,a){const l=Vl(ro(),t,e),c=`${t}/${e}`;return io("WRITE",c,i),jO(l,n,a??{})}async function k1(t,e){const i=ro();for(let a=0;a<t.length;a+=500){const l=t.slice(a,a+500),c=O1(i);for(const{collectionPath:h,docId:f,data:p}of l){const _=Vl(i,h,f);c.set(_,p)}io("BATCH_WRITE",`${l.length} docs`,e,l.length),await c.commit()}}async function Hs(t,e,n,i){const a=Vl(ro(),t,e),l=`${t}/${e}`;return io("UPDATE",l,i),IO(a,n)}async function N1(t,e,n){const i=Vl(ro(),t,e),a=`${t}/${e}`;return io("DELETE",a,n),MO(i)}async function PO(t,e,n){const a=ro();for(let l=0;l<t.length;l+=500){const c=t.slice(l,l+500),h=O1(a);for(const{collectionPath:f,docId:p}of c){const _=Vl(a,f,p);h.delete(_)}io("BATCH_DELETE",`${c.length} docs`,e,c.length),await h.commit(),n?.(l+c.length)}}function LO(t={}){const e={};return Object.entries(t).forEach(([n,i])=>{e[n]={nickname:i.nickname??"",description:i.description??"",balance:i.balance??0,account_group_id:i.account_group_id??null,sort_order:i.sort_order??0,is_income_account:i.is_income_account??!1,is_income_default:i.is_income_default??!1,is_outgo_account:i.is_outgo_account??!1,is_outgo_default:i.is_outgo_default??!1,on_budget:i.on_budget??!0,is_active:i.is_active??!0}}),e}function BO(t={}){const e={};return Object.entries(t).forEach(([n,i])=>{e[n]={name:i.name,sort_order:i.sort_order??0,expected_balance:i.expected_balance??"positive",on_budget:i.on_budget,is_active:i.is_active}}),e}function VO(t={}){const e={};return Object.entries(t).forEach(([n,i])=>{e[n]={name:i.name,description:i.description,category_group_id:i.category_group_id??null,sort_order:i.sort_order??0,default_monthly_amount:i.default_monthly_amount,default_monthly_type:i.default_monthly_type,balance:i.balance??0}}),e}function UO(t=[]){const e=t.map(n=>({id:n.id,name:n.name,sort_order:n.sort_order??0}));return e.sort((n,i)=>n.sort_order-i.sort_order),e}function zO(t={}){const e={};return Object.entries(t).forEach(([n,i])=>{e[n]={needs_recalculation:i?.needs_recalculation??!1}}),e}async function FO(t){const{exists:e,data:n}=await Le("budgets",t,"loading budget data (cache miss or stale)");if(!e||!n)throw new Error(`Budget ${t} not found`);const i=LO(n.accounts),a=BO(n.account_groups),l=VO(n.categories),c=UO(n.category_groups),h=n.total_available??0,f=zO(n.month_map),p=n.is_needs_recalculation??!1;return{budget:{id:t,name:n.name,user_ids:n.user_ids||[],accepted_user_ids:n.accepted_user_ids||[],owner_id:n.owner_id||n.user_ids?.[0]||"",owner_email:n.owner_email||"",accounts:i,account_groups:a,categories:l,category_groups:c,total_available:h,is_needs_recalculation:p,month_map:f},accounts:i,accountGroups:a,categories:l,categoryGroups:c,isNeedsRecalculation:p,monthMap:f}}function P1(t,e){return Il({queryKey:t?xe.budget(t):["budget","none"],queryFn:()=>FO(t),enabled:!!t&&e?.enabled!==!1})}function Ar(t,e,n){const i=n.toString().padStart(2,"0");return`${t}_${e}_${i}`}function Qy(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function qO(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function wt(t,e){return`${t}${e.toString().padStart(2,"0")}`}function HO(t,e,n,i){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??wt(n,i),year:t.year??n,month:t.month??i,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function GO(t,e,n,i){const a=Ar(t,e,n);return(await $e.fetchQuery({queryKey:xe.month(t,e,n),queryFn:async()=>{const{exists:c,data:h}=await Le("months",a,i?.description??`reading month ${e}/${n}`);return!c||!h?null:{month:HO(h,t,e,n)}},staleTime:PE}))?.month??null}async function Ei(t,e,n,i){const a=Ar(t,e,n),l=i?`PRE-EDIT-READ: ${i}`:"PRE-EDIT-READ",{exists:c,data:h}=await Le("months",a,l);if(!c||!h)throw new Error(`Month data not found for ${e}/${n}`);return h}async function $O(t,e,n){const i=wt(e,n);return(await Rr("months","getFutureMonths: querying months after specified month",[{field:"budget_id",op:"==",value:t},{field:"year_month_ordinal",op:">",value:i}])).docs.map(c=>({id:c.id,...c.data})).sort((c,h)=>c.year!==h.year?c.year-h.year:c.month-h.month)}function QO(t){const e={},n={};return t.category_balances&&t.category_balances.forEach(i=>{e[i.category_id]=i.end_balance}),t.account_balances&&t.account_balances.forEach(i=>{n[i.account_id]=i.end_balance}),{categoryEndBalances:e,accountEndBalances:n}}const Bs="__NO_CATEGORY__",qa="No Category";function Gi(t){return t===Bs}const Wy="__NO_ACCOUNT__",Wh="No Account";function or(t){return t===Wy}const L1={categoryEndBalances:{},accountEndBalances:{},totalIncome:0};function B1(t,e){const n=WO(t.category_balances,e.categoryEndBalances),i=KO(t,e.accountEndBalances);return{...t,previous_month_income:e.totalIncome,category_balances:n,account_balances:i,updated_at:new Date().toISOString()}}function WO(t,e){const n=new Map;for(const a of t)Gi(a.category_id)||n.set(a.category_id,a);const i=t.filter(a=>!Gi(a.category_id)).map(a=>{const l=e[a.category_id]??0;return{...a,start_balance:l,end_balance:l+a.allocated+a.spent}});for(const[a,l]of Object.entries(e))Gi(a)||n.has(a)||i.push({category_id:a,start_balance:l,allocated:0,spent:0,end_balance:l});return i}function KO(t,e){const n=new Set;for(const a of t.income||[])or(a.account_id)||n.add(a.account_id);for(const a of t.expenses||[])or(a.account_id)||n.add(a.account_id);for(const a of Object.keys(e))or(a)||n.add(a);for(const a of t.account_balances||[])or(a.account_id)||n.add(a.account_id);const i=[];for(const a of n){const l=e[a]??0,c=(t.income||[]).filter(p=>p.account_id===a).reduce((p,_)=>p+_.amount,0),h=(t.expenses||[]).filter(p=>p.account_id===a).reduce((p,_)=>p+_.amount,0),f=c+h;i.push({account_id:a,start_balance:l,income:c,expenses:h,net_change:f,end_balance:l+f})}return i}function $g(t){const e={},n={};for(const i of t.category_balances||[])Gi(i.category_id)||(e[i.category_id]=i.end_balance);for(const i of t.account_balances||[])or(i.account_id)||(n[i.account_id]=i.end_balance);return{categoryEndBalances:e,accountEndBalances:n,totalIncome:t.total_income}}const og=new Map;function YO(t){return{year:parseInt(t.slice(0,4),10),month:parseInt(t.slice(4,6),10)}}function XO(t={}){const e={};return Object.entries(t).forEach(([n,i])=>{e[n]={needs_recalculation:i?.needs_recalculation??!1}}),e}function JO(t){return Object.entries(t).filter(([,e])=>e.needs_recalculation).map(([e])=>e).sort()}function ZO(t){return Object.keys(t).sort()}async function ek(t,e){const{year:n,month:i}=YO(e),a=Ar(t,n,i),{exists:l,data:c}=await Le("months",a,`[recalc] fetching month ${n}/${i}`);return!l||!c?null:{id:a,budget_id:t,year_month_ordinal:c.year_month_ordinal??wt(n,i),year:c.year??n,month:c.month??i,income:c.income||[],total_income:c.total_income??0,previous_month_income:c.previous_month_income??0,expenses:c.expenses||[],total_expenses:c.total_expenses??0,account_balances:c.account_balances||[],category_balances:c.category_balances||[],are_allocations_finalized:c.are_allocations_finalized??!1,created_at:c.created_at,updated_at:c.updated_at}}async function tk(t,e,n){n?.(0,e.length);const i=await Promise.all(e.map(a=>ek(t,a)));return n?.(e.length,e.length),i.filter(a=>a!==null)}async function jf(t,e={}){const n=og.get(t);if(n)return n;const i=rk(t,e);og.set(t,i);try{return await i}finally{og.delete(t)}}const nk=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];async function rk(t,e={}){const{onProgress:n}=e;n?.({phase:"reading-budget",monthsProcessed:0,totalMonths:0,percentComplete:5});const{exists:i,data:a}=await Le("budgets",t,"[recalc] reading budget for month_map");if(!i||!a)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const l=XO(a.month_map),c=JO(l);if(c.length===0&&!a.is_needs_recalculation)return n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!1};const h=ZO(l),f=c.length>0?c[0]:null;if(!f)return await yS(t,l),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const p=h.indexOf(f),_=p>0,b=_?h.slice(p-1):h.slice(p),v=_?b.length-1:b.length;n?.({phase:"fetching-months",monthsFetched:0,totalMonthsToFetch:b.length,monthsProcessed:0,totalMonths:v,percentComplete:10});const T=await tk(t,b,(O,R)=>{n?.({phase:"fetching-months",monthsFetched:O,totalMonthsToFetch:R,monthsProcessed:0,totalMonths:v,percentComplete:O===0?10:30})});if(T.length===0)return await yS(t,l),n?.({phase:"complete",monthsProcessed:0,totalMonths:0,percentComplete:100}),{monthsRecalculated:0,budgetUpdated:!0};const E=_?1:0,w=T.length-1,D=w-E+1;let L=L1;_&&T.length>0&&(L=$g(T[0]));const q=[];let B=0;for(let O=E;O<=w;O++){const R=T[O],j=`${nk[R.month-1]} ${R.year}`;n?.({phase:"recalculating",currentMonth:j,monthsProcessed:B,totalMonths:D,percentComplete:Math.round(30+B/D*40)});const I=B1(R,L);q.push(I),L=$g(I),B++}n?.({phase:"saving",monthsProcessed:B,totalMonths:D,percentComplete:75});const ee=q.map(O=>({collectionPath:"months",docId:Ar(t,O.year,O.month),data:O}));await k1(ee,`[recalc] batch write ${q.length} months`);for(const O of q)$e.setQueryData(xe.month(t,O.year,O.month),{month:O});n?.({phase:"saving",monthsProcessed:B,totalMonths:D,percentComplete:92});const Q=L.accountEndBalances,J=L.categoryEndBalances;return await ik(t,Q,J,l),n?.({phase:"complete",monthsProcessed:B,totalMonths:D,percentComplete:100}),{monthsRecalculated:B,budgetUpdated:!0,finalAccountBalances:Q}}function V1(t){const e={};for(const n of Object.keys(t))e[n]={needs_recalculation:!1};return e}function U1(t,e,n){const i=Object.entries(t).reduce((l,[,c])=>{const h=c.account_group_id?n[c.account_group_id]:void 0,f=h?.on_budget!==void 0?h.on_budget:c.on_budget!==!1,p=h?.is_active!==void 0?h.is_active:c.is_active!==!1;return f&&p?l+(c.balance??0):l},0),a=Object.values(e).reduce((l,c)=>{const h=c.balance??0;return l+(h>0?h:0)},0);return i-a}async function ik(t,e,n,i){const{exists:a,data:l}=await Le("budgets",t,"[recalc] reading budget for balance update");if(!a||!l)return;const c={...l.accounts};for(const[_,b]of Object.entries(e))c[_]&&(c[_]={...c[_],balance:b});const h={...l.categories};for(const[_,b]of Object.entries(n))h[_]&&(h[_]={...h[_],balance:b});const f=V1(i),p=U1(c,h,l.account_groups||{});await ut("budgets",t,{...l,accounts:c,categories:h,total_available:p,is_needs_recalculation:!1,month_map:f,updated_at:new Date().toISOString()},"[recalc] saving balances and clearing flags"),ak(t,c,h,p,f)}function sk(t,e){const n=$e.getQueryData(xe.budget(t));n&&$e.setQueryData(xe.budget(t),{...n,isNeedsRecalculation:!1,monthMap:e,budget:{...n.budget,is_needs_recalculation:!1,month_map:e}})}function ak(t,e,n,i,a){const l=$e.getQueryData(xe.budget(t));if(l){const c={};for(const[f,p]of Object.entries(l.accounts)){const _=e[f];c[f]=_?{...p,balance:_.balance??p.balance}:p}const h={};for(const[f,p]of Object.entries(l.categories)){const _=n[f];h[f]=_?{...p,balance:_.balance??p.balance}:p}$e.setQueryData(xe.budget(t),{...l,accounts:c,categories:h,isNeedsRecalculation:!1,monthMap:a,budget:{...l.budget,accounts:e,categories:n,total_available:i,is_needs_recalculation:!1,month_map:a}})}}async function yS(t,e){const{exists:n,data:i}=await Le("budgets",t,"[recalc] reading budget to clear flags");if(!n||!i)return;const a=V1(e);await ut("budgets",t,{...i,total_available:U1(i.accounts||{},i.categories||{},i.account_groups||{}),is_needs_recalculation:!1,month_map:a,updated_at:new Date().toISOString()},"[recalc] clearing flags"),sk(t,a)}function ok(){const t=new Date,e=t.getFullYear(),n=t.getMonth()+1,i=[];for(let a=3;a>0;a--){let l=e,c=n-a;for(;c<1;)c+=12,l-=1;i.push(wt(l,c))}i.push(wt(e,n));for(let a=1;a<=3;a++){let l=e,c=n+a;for(;c>12;)c-=12,l+=1;i.push(wt(l,c))}return i}function lk(t,e){const n=xe.budget(t),i=$e.getQueryData(n);if(!i?.monthMap)return!1;for(const[a,l]of Object.entries(i.monthMap))if(a>e&&!l.needs_recalculation)return!1;return!0}function ck(t,e,n){const i=xe.budget(t),a=$e.getQueryData(i);a&&$e.setQueryData(i,{...a,isNeedsRecalculation:!0,monthMap:n,budget:{...a.budget,is_needs_recalculation:!0,month_map:n}})}async function uk(t,e,n){const i=wt(e,n);if(lk(t,i))return console.log("[markMonthsNeedRecalculation] All future months already marked in cache, skipping write"),{markedCount:0,budgetUpdated:!1};const{exists:a,data:l}=await Le("budgets",t,"reading budget for month_map update");if(!a||!l)return console.warn(`[markMonthsNeedRecalculation] Budget ${t} not found`),{markedCount:0,budgetUpdated:!1};const h={...l.month_map||{}},f=ok();for(const v of f)h[v]||(h[v]={needs_recalculation:!1});let p=0;for(const v of f)v>i&&(h[v]?.needs_recalculation||(h[v]={needs_recalculation:!0},p++));const _=l.is_needs_recalculation===!0;if(p===0&&_)return console.log("[markMonthsNeedRecalculation] No new months to mark and budget already marked, skipping write"),{markedCount:0,budgetUpdated:!1};const b=h;return ck(t,i,b),await Hs("budgets",t,{is_needs_recalculation:!0,month_map:b,updated_at:new Date().toISOString()},`marking budget and ${p} future months as needing recalculation`),{markedCount:p,budgetUpdated:!0}}async function dk(t,e,n,i=!1){const a=wt(e,n),{exists:l,data:c}=await Le("budgets",t,"reading budget for month_map update (add month)");if(!l||!c){console.warn(`[setMonthInBudgetMap] Budget ${t} not found`);return}const f={...c.month_map||{},[a]:{needs_recalculation:i}},p=f,_=xe.budget(t),b=$e.getQueryData(_);b&&$e.setQueryData(_,{...b,monthMap:p,budget:{...b.budget,month_map:p}}),await Hs("budgets",t,{month_map:p,updated_at:new Date().toISOString()},`adding month ${e}/${n} to budget month_map`)}async function z1(t,e,n,i){const{bypassDateLimit:a=!1}=i??{},l=new Date,c=l.getFullYear(),h=l.getMonth()+1,f=(e-c)*12+(n-h);if(!a&&f>3){const q=`[createMonth] Refusing to create month ${e}/${n} - it's ${f} months in the future (max allowed: 3). This likely indicates a bug in month navigation.`;throw console.error(q),new Error(q)}if(!a&&f<-3){const q=`[createMonth] Refusing to create month ${e}/${n} - it's ${Math.abs(f)} months in the past (max allowed: 3). Existing months can still be viewed, but new months cannot be created this far back.`;throw console.error(q),new Error(q)}const p=l.toISOString(),_=Ar(t,e,n);let b=0,v={},T={};if(n>1||e>new Date().getFullYear()-10){const{year:q,month:B}=Qy(e,n),ee=Ar(t,q,B),{exists:Q,data:J}=await Le("months",ee,"fetching previous month to create start balances for new month");if(Q&&J){const O={year_month_ordinal:J.year_month_ordinal??wt(q,B),year:J.year??q,month:J.month??B,income:J.income||[],total_income:J.total_income??0,previous_month_income:J.previous_month_income??0,expenses:J.expenses||[],total_expenses:J.total_expenses??0,account_balances:J.account_balances||[],category_balances:J.category_balances||[],are_allocations_finalized:J.are_allocations_finalized??!1,created_at:J.created_at,updated_at:J.updated_at};b=O.total_income;const{categoryEndBalances:R,accountEndBalances:j}=QO(O);v=R,T=j}}const E=Object.entries(v).map(([q,B])=>({category_id:q,start_balance:B,allocated:0,spent:0,end_balance:B})),w=Object.entries(T).map(([q,B])=>({account_id:q,start_balance:B,income:0,expenses:0,net_change:0,end_balance:B})),D={budget_id:t,year_month_ordinal:wt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:b,expenses:[],total_expenses:0,account_balances:w,category_balances:E,are_allocations_finalized:!1,created_at:p,updated_at:p},L={budget_id:t,year_month_ordinal:wt(e,n),year:e,month:n,income:[],total_income:0,previous_month_income:b,expenses:[],total_expenses:0,account_balances:w,category_balances:E,are_allocations_finalized:!1,created_at:p,updated_at:p};return await ut("months",_,L,"creating new month document (first time viewing this month)"),$e.setQueryData(xe.month(t,e,n),{month:D}),await dk(t,e,n,!1),D}function hk(t,e,n,i){return{budget_id:e,year_month_ordinal:t.year_month_ordinal??wt(n,i),year:t.year??n,month:t.month??i,income:t.income||[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:t.expenses||[],total_expenses:t.total_expenses??0,account_balances:t.account_balances||[],category_balances:t.category_balances||[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at,updated_at:t.updated_at}}async function fk(t,e,n){const i=Ar(t,e,n),{exists:a,data:l}=await Le("months",i,`loading month ${e}/${n}`);return!a||!l?null:hk(l,t,e,n)}async function mk(t,e,n){const i=await fk(t,e,n);return i||z1(t,e,n)}function pk(t,e,n,i){return Il({queryKey:t?xe.month(t,e,n):["month","none"],queryFn:async()=>({month:await mk(t,e,n)}),enabled:!!t&&i?.enabled!==!1})}async function gk(t){const{exists:e,data:n}=await Le("payees",t,"loading payees for autocomplete (cache miss or stale)");return e&&n?n.payees||[]:[]}function F1(t,e){return Il({queryKey:t?xe.payees(t):["payees","none"],queryFn:()=>gk(t),enabled:!!t&&e?.enabled!==!1})}async function yk(t,e){const{exists:n,data:i}=await Le("users",t,"loading user profile (cache miss or stale)");if(n&&i)return i;const a={uid:t,email:e,budget_ids:[],created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await ut("users",t,a,"creating new user document (first login)"),a}function _k(t,e,n){return Il({queryKey:t?xe.user(t):["user","none"],queryFn:()=>yk(t,e),enabled:!!t&&n?.enabled!==!1})}async function bk(t,e){const n=await Rr("budgets","loading budgets user has access to (cache miss or stale)",[{field:"user_ids",op:"array-contains",value:t}]),i=[],a=[];for(const l of n.docs){const c=l.data;c.accepted_user_ids?.includes(t)||e?.budget_ids?.includes(l.id)?i.push({id:l.id,name:c.name||"Unnamed Budget",ownerEmail:c.owner_email||null,isOwner:c.owner_id===t,isPending:!1}):a.push({budgetId:l.id,budgetName:c.name||"Unnamed Budget",ownerEmail:c.owner_email||null})}return{budgets:i,pendingInvites:a}}function vk(t,e,n){return Il({queryKey:t?xe.accessibleBudgets(t):["accessibleBudgets","none"],queryFn:async()=>t?bk(t,e):{budgets:[],pendingInvites:[]},enabled:!!t&&n?.enabled!==!1,staleTime:60*1e3})}function xk(t){if(Array.isArray(t))return t;if(t&&typeof t=="object"&&!Array.isArray(t)){const e=t;if(e._methodName==="arrayUnion"&&Array.isArray(e.vc))return console.warn("[fetchFeedback] Found corrupted arrayUnion in feedback document - extracting items from vc"),e.vc}return[]}async function Sk(){const t=await Rr("feedback","admin loading all feedback (cache miss or stale)"),e=[];for(const n of t.docs){const i=xk(n.data.items),a=n.data.user_email||n.id;i.forEach(l=>{e.push({...l,doc_id:n.id,user_email:a})})}return{items:e}}function Ek(t){return Il({queryKey:xe.feedback(),queryFn:Sk,enabled:t?.enabled!==!1})}async function wk(t,e){return $e.fetchQuery({queryKey:["budgetInvite",t,e],queryFn:async()=>{const{exists:n,data:i}=await Le("budgets",t,"checking if user has pending invite for budget");return!n||!i?null:{isInvited:i.user_ids?.includes(e)??!1,hasAccepted:i.accepted_user_ids?.includes(e)??!1,budgetName:i.name||"Unnamed Budget",ownerEmail:i.owner_email||null}},staleTime:60*1e3})}async function Qg(t,e,n){const i=await GO(t,e,n,{description:`fetching month for balance calculation (walking ${e}/${n})`});return i?{year:i.year,month:i.month,category_balances:i.category_balances,are_allocations_finalized:i.are_allocations_finalized,expenses:i.expenses}:null}async function Tk(t,e,n,i){const a={};e.forEach(v=>{a[v]=0});const l=await Qg(t,n,i);if(l?.category_balances){for(const v of l.category_balances)e.includes(v.category_id)&&(a[v.category_id]=v.end_balance);return a}const c={};e.forEach(v=>{c[v]=0});const h=[];l&&h.push(l);let f=n,p=i,_=!1;const b=120;for(let v=0;v<b&&!_;v++){const T=Qy(f,p);f=T.year,p=T.month;const E=await Qg(t,f,p);if(!E)_=!0;else if(E.category_balances){_=!0;for(const w of E.category_balances)e.includes(w.category_id)&&(c[w.category_id]=w.end_balance)}else h.push(E)}h.reverse(),Object.assign(a,c);for(const v of h){if(v.are_allocations_finalized&&v.category_balances)for(const T of v.category_balances)e.includes(T.category_id)&&(a[T.category_id]=(a[T.category_id]||0)+T.allocated);if(v.expenses)for(const T of v.expenses)e.includes(T.category_id)&&(a[T.category_id]=(a[T.category_id]||0)-T.amount)}return a}async function Ck(t,e,n,i,a){const l={...n};let c=i,h=a;const f=24;for(let p=0;p<f;p++){const _=qO(c,h);c=_.year,h=_.month;const b=await Qg(t,c,h);if(!b)break;if(b.are_allocations_finalized&&b.category_balances)for(const v of b.category_balances)e.includes(v.category_id)&&(l[v.category_id]=(l[v.category_id]||0)+v.allocated);if(b.expenses)for(const v of b.expenses)e.includes(v.category_id)&&(l[v.category_id]=(l[v.category_id]||0)-v.amount)}return l}async function _S(t,e,n,i){const a=await Tk(t,e,n,i),l=await Ck(t,e,a,n,i);return{current:a,total:l}}async function q1(t,e,n){const i=Ar(t,e.year,e.month);await ut("months",i,e,`writeMonthData: ${n}`)}async function H1(t,e,n){await uk(t,e,n)}async function Ak(t){const{budgetId:e,month:n,description:i,cascadeRecalculation:a=!0}=t;await q1(e,n,i||`${n.year}/${n.month}`),$e.setQueryData(xe.month(e,n.year,n.month),{month:n}),a&&await H1(e,n.year,n.month)}function ns(){const t=cn();return{writeData:dr({mutationFn:async({budgetId:n,month:i,description:a,cascadeRecalculation:l=!0})=>(await q1(n,i,a||`${i.year}/${i.month}`),{budgetId:n,year:i.year,month:i.month,cascadeRecalculation:l}),onMutate:async({budgetId:n,month:i})=>{const a=xe.month(n,i.year,i.month);await t.cancelQueries({queryKey:a});const l=t.getQueryData(a);return t.setQueryData(a,{month:i}),{oldMonthQueryData:l,monthKey:a}},onSuccess:async({budgetId:n,year:i,month:a,cascadeRecalculation:l})=>{l&&await H1(n,i,a)},onError:(n,i,a)=>{a?.oldMonthQueryData&&t.setQueryData(a.monthKey,a.oldMonthQueryData)}})}}function Rk(t,e,n,i){const a={};t.category_balances&&t.category_balances.forEach(c=>{a[c.category_id]=c});const l=t.expenses??[];return e.map(c=>{const f=a[c]?.start_balance??0,p=n[c]??0,_=l.filter(b=>b.category_id===c).reduce((b,v)=>b+v.amount,0);return{category_id:c,start_balance:f,allocated:p,spent:_,end_balance:f+p+_}})}function Dk(){const{writeData:t}=ns();return{saveDraftAllocations:async(n,i,a,l)=>{const c=await Ei(n,i,a,"save draft allocations"),h=c.category_balances.map(p=>({...p,allocated:l[p.category_id]??p.allocated})),f={...c,category_balances:h,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:n,month:f,cascadeRecalculation:!1}),{updatedMonth:f}},isPending:t.isPending,isError:t.isError,error:t.error}}function jk(){const{writeData:t}=ns();return{finalizeAllocations:async n=>{const{budgetId:i,year:a,month:l,allocations:c,onProgress:h}=n;h?.({phase:"saving",message:"Saving allocations..."});const f=await Ei(i,a,l,"finalize allocations"),p=f.category_balances?.map(T=>T.category_id)??[],_=p.length>0?p:Object.keys(c),b=_.length>0?Rk(f,_,c):f.category_balances,v={...f,category_balances:b,are_allocations_finalized:!0,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:i,month:v,description:"finalize allocations"}),h?.({phase:"recalculating",message:"Recalculating month balances..."}),await jf(i,{triggeringMonthOrdinal:`${a}${String(l).padStart(2,"0")}`,onProgress:T=>{let E="Recalculating balances...";T.phase==="fetching-months"?E=`Loading month data (${T.monthsFetched}/${T.totalMonthsToFetch})...`:T.phase==="recalculating"&&T.currentMonth?E=`Recalculating ${T.currentMonth}...`:T.phase==="saving"&&(E="Saving recalculated balances..."),h?.({phase:"recalculating",message:E,recalcProgress:T})}}),await $e.refetchQueries({queryKey:xe.month(i,a,l)}),await $e.refetchQueries({queryKey:xe.budget(i)}),h?.({phase:"complete",message:"Allocations applied!"}),{updatedMonth:v}},isPending:t.isPending,isError:t.isError,error:t.error}}function G1(){const{writeData:t}=ns();return{deleteAllocations:async n=>{const{budgetId:i,year:a,month:l,onProgress:c}=n;c?.({phase:"saving",message:"Deleting allocations..."});const h=await Ei(i,a,l,"delete allocations"),f=h.category_balances.map(_=>({..._,allocated:0,end_balance:_.start_balance-_.spent})),p={...h,category_balances:f,are_allocations_finalized:!1,updated_at:new Date().toISOString()};return await t.mutateAsync({budgetId:i,month:p,description:"delete allocations"}),c?.({phase:"recalculating",message:"Recalculating month balances..."}),await jf(i,{triggeringMonthOrdinal:`${a}${String(l).padStart(2,"0")}`,onProgress:_=>{let b="Recalculating balances...";_.phase==="fetching-months"?b=`Loading month data (${_.monthsFetched}/${_.totalMonthsToFetch})...`:_.phase==="recalculating"&&_.currentMonth?b=`Recalculating ${_.currentMonth}...`:_.phase==="saving"&&(b="Saving recalculated balances..."),c?.({phase:"recalculating",message:b,recalcProgress:_})}}),await $e.refetchQueries({queryKey:xe.month(i,a,l)}),await $e.refetchQueries({queryKey:xe.budget(i)}),c?.({phase:"complete",message:"Allocations deleted!"}),{updatedMonth:p}},isPending:t.isPending,isError:t.isError,error:t.error}}async function If(t,e,n){const i=e.trim();if(!i||n.includes(i))return null;const a=[...n,i].sort((l,c)=>l.toLowerCase().localeCompare(c.toLowerCase()));return await ut("payees",t,{budget_id:t,payees:a,updated_at:new Date().toISOString()},`adding new payee "${i}" to autocomplete list`),a}function ca(t){const e=t.income||[],n=t.expenses||[],i=e.reduce((h,f)=>h+f.amount,0),a=n.reduce((h,f)=>h+f.amount,0),l=Ik(t),c=Mk(t);return{...t,total_income:i,total_expenses:a,account_balances:l,category_balances:c}}function Ik(t){const e=t.income||[],n=t.expenses||[],i=t.account_balances||[],a=new Map;for(const h of i)or(h.account_id)||a.set(h.account_id,h);const l=new Set;for(const h of e)or(h.account_id)||l.add(h.account_id);for(const h of n)or(h.account_id)||l.add(h.account_id);for(const h of i)or(h.account_id)||l.add(h.account_id);const c=[];for(const h of l){const p=a.get(h)?.start_balance??0,_=e.filter(T=>T.account_id===h).reduce((T,E)=>T+E.amount,0),b=n.filter(T=>T.account_id===h).reduce((T,E)=>T+E.amount,0),v=_+b;c.push({account_id:h,start_balance:p,income:_,expenses:b,net_change:v,end_balance:p+v})}return c}function Mk(t){const e=t.expenses||[],n=t.category_balances||[],i=new Map;for(const h of n)Gi(h.category_id)||i.set(h.category_id,h);const a=new Map;for(const h of e){if(Gi(h.category_id))continue;const f=a.get(h.category_id)||0;a.set(h.category_id,f+h.amount)}const l=new Set;for(const h of n)Gi(h.category_id)||l.add(h.category_id);for(const h of e)Gi(h.category_id)||l.add(h.category_id);const c=[];for(const h of l){const f=i.get(h),p=a.get(h)??0;f?c.push({...f,spent:p,end_balance:f.start_balance+f.allocated+p}):c.push({category_id:h,start_balance:0,allocated:0,spent:p,end_balance:p})}return c}function Ok(t,e){let n=0;for(const{accountId:i,delta:a}of e){const l=t.accounts[i];if(!l)continue;const c=l.account_group_id?t.accountGroups[l.account_group_id]:void 0,h=c?.on_budget!==void 0?c.on_budget:l.on_budget!==!1,f=c?.is_active!==void 0?c.is_active:l.is_active!==!1;h&&f&&(n+=a)}return n}async function sa(t,e){if(e.length===0)return;const n=e.filter(h=>h.delta!==0);if(n.length===0)return;const i=$e.getQueryData(xe.budget(t));if(!i)return;const a=Ok(i,n),l={...i.accounts};for(const{accountId:h,delta:f}of n)l[h]&&(l[h]={...l[h],balance:l[h].balance+f});const c=i.budget?{...i.budget,total_available:i.budget.total_available+a}:i.budget;$e.setQueryData(xe.budget(t),{...i,accounts:l,budget:c})}function kk(){const t=cn(),{writeData:e}=ns();return{addIncome:async(i,a,l,c,h,f,p,_)=>{const b=await Ei(i,a,l,"add income"),v={id:`income_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:c,account_id:h,date:f,created_at:new Date().toISOString()};p?.trim()&&(v.payee=p.trim()),_&&(v.description=_);const T=[...b.income||[],v],E=ca({...b,income:T,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:i,month:E,description:"add income"}),await sa(i,[{accountId:h,delta:c}]),p?.trim()){const w=t.getQueryData(xe.payees(i))||[],D=await If(i,p,w);D&&t.setQueryData(xe.payees(i),D)}return{updatedMonth:E,newIncome:v}},isPending:e.isPending,isError:e.isError,error:e.error}}function Nk(){const t=cn(),{writeData:e}=ns();return{updateIncome:async(i,a,l,c,h,f,p,_,b)=>{const v=await Ei(i,a,l,"update income"),T=(v.income||[]).find(B=>B.id===c),E=T?.amount??0,w=T?.account_id??f,D={id:c,amount:h,account_id:f,date:p,created_at:(v.income||[]).find(B=>B.id===c)?.created_at||new Date().toISOString()};_?.trim()&&(D.payee=_.trim()),b&&(D.description=b);const L=(v.income||[]).map(B=>B.id===c?D:B),q=ca({...v,income:L,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:i,month:q,description:"update income"}),w===f?await sa(i,[{accountId:f,delta:h-E}]):await sa(i,[{accountId:w,delta:-E},{accountId:f,delta:h}]),_?.trim()){const B=t.getQueryData(xe.payees(i))||[],ee=await If(i,_,B);ee&&t.setQueryData(xe.payees(i),ee)}return{updatedMonth:q}},isPending:e.isPending,isError:e.isError,error:e.error}}function Pk(){const{writeData:t}=ns();return{deleteIncome:async(n,i,a,l)=>{const c=await Ei(n,i,a,"delete income"),h=(c.income||[]).find(v=>v.id===l),f=h?.amount??0,p=h?.account_id,_=(c.income||[]).filter(v=>v.id!==l),b=ca({...c,income:_,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:b,description:"delete income"}),p&&f>0&&await sa(n,[{accountId:p,delta:-f}]),{updatedMonth:b}},isPending:t.isPending,isError:t.isError,error:t.error}}function Lk(){const t=cn(),{writeData:e}=ns();return{addExpense:async(i,a,l,c,h,f,p,_,b,v)=>{const T=await Ei(i,a,l,"add expense"),E={id:`expense_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:c,category_id:h,account_id:f,date:p,created_at:new Date().toISOString()};_?.trim()&&(E.payee=_.trim()),b&&(E.description=b),v!==void 0&&(E.cleared=v);const w=[...T.expenses||[],E],D=ca({...T,expenses:w,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:i,month:D,description:"add expense"}),await sa(i,[{accountId:f,delta:-c}]),_?.trim()){const L=t.getQueryData(xe.payees(i))||[],q=await If(i,_,L);q&&t.setQueryData(xe.payees(i),q)}return{updatedMonth:D,newExpense:E}},isPending:e.isPending,isError:e.isError,error:e.error}}function Bk(){const t=cn(),{writeData:e}=ns();return{updateExpense:async(i,a,l,c,h,f,p,_,b,v,T)=>{const E=await Ei(i,a,l,"update expense"),w=(E.expenses||[]).find(Q=>Q.id===c),D=w?.amount??0,L=w?.account_id??p,q={id:c,amount:h,category_id:f,account_id:p,date:_,created_at:E.expenses?.find(Q=>Q.id===c)?.created_at||new Date().toISOString()};b?.trim()&&(q.payee=b.trim()),v&&(q.description=v),T!==void 0&&(q.cleared=T);const B=(E.expenses||[]).map(Q=>Q.id===c?q:Q),ee=ca({...E,expenses:B,updated_at:new Date().toISOString()});if(await e.mutateAsync({budgetId:i,month:ee,description:"update expense"}),L===p?await sa(i,[{accountId:p,delta:D-h}]):await sa(i,[{accountId:L,delta:D},{accountId:p,delta:-h}]),b?.trim()){const Q=t.getQueryData(xe.payees(i))||[],J=await If(i,b,Q);J&&t.setQueryData(xe.payees(i),J)}return{updatedMonth:ee}},isPending:e.isPending,isError:e.isError,error:e.error}}function Vk(){const{writeData:t}=ns();return{deleteExpense:async(n,i,a,l)=>{const c=await Ei(n,i,a,"delete expense"),h=(c.expenses||[]).find(v=>v.id===l),f=h?.amount??0,p=h?.account_id,_=(c.expenses||[]).filter(v=>v.id!==l),b=ca({...c,expenses:_,updated_at:new Date().toISOString()});return await t.mutateAsync({budgetId:n,month:b,description:"delete expense"}),p&&f>0&&await sa(n,[{accountId:p,delta:f}]),{updatedMonth:b}},isPending:t.isPending,isError:t.isError,error:t.error}}function $1(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Uk=$1,Q1=new vu("auth","Firebase",$1());const Kh=new fy("@firebase/auth");function zk(t,...e){Kh.logLevel<=Xe.WARN&&Kh.warn(`Auth (${Ol}): ${t}`,...e)}function Ch(t,...e){Kh.logLevel<=Xe.ERROR&&Kh.error(`Auth (${Ol}): ${t}`,...e)}function Qr(t,...e){throw Ky(t,...e)}function vi(t,...e){return Ky(t,...e)}function W1(t,e,n){const i={...Uk(),[e]:n};return new vu("auth","Firebase",i).create(e,{appName:t.name})}function Xs(t){return W1(t,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ky(t,...e){if(typeof t!="string"){const n=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=t.name),t._errorFactory.create(n,...i)}return Q1.create(t,...e)}function Ne(t,e,...n){if(!t)throw Ky(e,...n)}function $i(t){const e="INTERNAL ASSERTION FAILED: "+t;throw Ch(e),new Error(e)}function es(t,e){t||$i(e)}function Wg(){return typeof self<"u"&&self.location?.href||""}function Fk(){return bS()==="http:"||bS()==="https:"}function bS(){return typeof self<"u"&&self.location?.protocol||null}function qk(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Fk()||Gj()||"connection"in navigator)?navigator.onLine:!0}function Hk(){if(typeof navigator>"u")return null;const t=navigator;return t.languages&&t.languages[0]||t.language||null}class ju{constructor(e,n){this.shortDelay=e,this.longDelay=n,es(n>e,"Short delay should be less than long delay!"),this.isMobile=Fj()||$j()}get(){return qk()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Yy(t,e){es(t.emulator,"Emulator should always be set here");const{url:n}=t.emulator;return e?`${n}${e.startsWith("/")?e.slice(1):e}`:n}class K1{static initialize(e,n,i){this.fetchImpl=e,n&&(this.headersImpl=n),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;$i("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;$i("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;$i("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Gk={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const $k=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Qk=new ju(3e4,6e4);function so(t,e){return t.tenantId&&!e.tenantId?{...e,tenantId:t.tenantId}:e}async function ua(t,e,n,i,a={}){return Y1(t,a,async()=>{let l={},c={};i&&(e==="GET"?c=i:l={body:JSON.stringify(i)});const h=xu({key:t.config.apiKey,...c}).slice(1),f=await t._getAdditionalHeaders();f["Content-Type"]="application/json",t.languageCode&&(f["X-Firebase-Locale"]=t.languageCode);const p={method:e,headers:f,...l};return Hj()||(p.referrerPolicy="no-referrer"),t.emulatorConfig&&Ml(t.emulatorConfig.host)&&(p.credentials="include"),K1.fetch()(await X1(t,t.config.apiHost,n,h),p)})}async function Y1(t,e,n){t._canInitEmulator=!1;const i={...Gk,...e};try{const a=new Kk(t),l=await Promise.race([n(),a.promise]);a.clearNetworkTimeout();const c=await l.json();if("needConfirmation"in c)throw gh(t,"account-exists-with-different-credential",c);if(l.ok&&!("errorMessage"in c))return c;{const h=l.ok?c.errorMessage:c.error.message,[f,p]=h.split(" : ");if(f==="FEDERATED_USER_ID_ALREADY_LINKED")throw gh(t,"credential-already-in-use",c);if(f==="EMAIL_EXISTS")throw gh(t,"email-already-in-use",c);if(f==="USER_DISABLED")throw gh(t,"user-disabled",c);const _=i[f]||f.toLowerCase().replace(/[_\s]+/g,"-");if(p)throw W1(t,_,p);Qr(t,_)}}catch(a){if(a instanceof ts)throw a;Qr(t,"network-request-failed",{message:String(a)})}}async function Mf(t,e,n,i,a={}){const l=await ua(t,e,n,i,a);return"mfaPendingCredential"in l&&Qr(t,"multi-factor-auth-required",{_serverResponse:l}),l}async function X1(t,e,n,i){const a=`${e}${n}?${i}`,l=t,c=l.config.emulator?Yy(t.config,a):`${t.config.apiScheme}://${a}`;return $k.includes(n)&&(await l._persistenceManagerAvailable,l._getPersistenceType()==="COOKIE")?l._getPersistence()._getFinalTarget(c).toString():c}function Wk(t){switch(t){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class Kk{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((n,i)=>{this.timer=setTimeout(()=>i(vi(this.auth,"network-request-failed")),Qk.get())})}}function gh(t,e,n){const i={appName:t.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const a=vi(t,e,i);return a.customData._tokenResponse=n,a}function vS(t){return t!==void 0&&t.enterprise!==void 0}class Yk{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],e.recaptchaKey===void 0)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||this.recaptchaEnforcementState.length===0)return null;for(const n of this.recaptchaEnforcementState)if(n.provider&&n.provider===e)return Wk(n.enforcementState);return null}isProviderEnabled(e){return this.getProviderEnforcementState(e)==="ENFORCE"||this.getProviderEnforcementState(e)==="AUDIT"}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function Xk(t,e){return ua(t,"GET","/v2/recaptchaConfig",so(t,e))}async function Jk(t,e){return ua(t,"POST","/v1/accounts:delete",e)}async function Yh(t,e){return ua(t,"POST","/v1/accounts:lookup",e)}function ru(t){if(t)try{const e=new Date(Number(t));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}async function Zk(t,e=!1){const n=rn(t),i=await n.getIdToken(e),a=Xy(i);Ne(a&&a.exp&&a.auth_time&&a.iat,n.auth,"internal-error");const l=typeof a.firebase=="object"?a.firebase:void 0,c=l?.sign_in_provider;return{claims:a,token:i,authTime:ru(lg(a.auth_time)),issuedAtTime:ru(lg(a.iat)),expirationTime:ru(lg(a.exp)),signInProvider:c||null,signInSecondFactor:l?.sign_in_second_factor||null}}function lg(t){return Number(t)*1e3}function Xy(t){const[e,n,i]=t.split(".");if(e===void 0||n===void 0||i===void 0)return Ch("JWT malformed, contained fewer than 3 sections"),null;try{const a=VE(n);return a?JSON.parse(a):(Ch("Failed to decode base64 JWT payload"),null)}catch(a){return Ch("Caught error parsing JWT payload as JSON",a?.toString()),null}}function xS(t){const e=Xy(t);return Ne(e,"internal-error"),Ne(typeof e.exp<"u","internal-error"),Ne(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}async function hu(t,e,n=!1){if(n)return e;try{return await e}catch(i){throw i instanceof ts&&eN(i)&&t.auth.currentUser===t&&await t.auth.signOut(),i}}function eN({code:t}){return t==="auth/user-disabled"||t==="auth/user-token-expired"}class tN{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){if(e){const n=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),n}else{this.errorBackoff=3e4;const i=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,i)}}schedule(e=!1){if(!this.isRunning)return;const n=this.getInterval(e);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class Kg{constructor(e,n){this.createdAt=e,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=ru(this.lastLoginAt),this.creationTime=ru(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Xh(t){const e=t.auth,n=await t.getIdToken(),i=await hu(t,Yh(e,{idToken:n}));Ne(i?.users.length,e,"internal-error");const a=i.users[0];t._notifyReloadListener(a);const l=a.providerUserInfo?.length?J1(a.providerUserInfo):[],c=rN(t.providerData,l),h=t.isAnonymous,f=!(t.email&&a.passwordHash)&&!c?.length,p=h?f:!1,_={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:c,metadata:new Kg(a.createdAt,a.lastLoginAt),isAnonymous:p};Object.assign(t,_)}async function nN(t){const e=rn(t);await Xh(e),await e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)}function rN(t,e){return[...t.filter(i=>!e.some(a=>a.providerId===i.providerId)),...e]}function J1(t){return t.map(({providerId:e,...n})=>({providerId:e,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}))}async function iN(t,e){const n=await Y1(t,{},async()=>{const i=xu({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:a,apiKey:l}=t.config,c=await X1(t,a,"/v1/token",`key=${l}`),h=await t._getAdditionalHeaders();h["Content-Type"]="application/x-www-form-urlencoded";const f={method:"POST",headers:h,body:i};return t.emulatorConfig&&Ml(t.emulatorConfig.host)&&(f.credentials="include"),K1.fetch()(c,f)});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function sN(t,e){return ua(t,"POST","/v2/accounts:revokeToken",so(t,e))}class dl{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){Ne(e.idToken,"internal-error"),Ne(typeof e.idToken<"u","internal-error"),Ne(typeof e.refreshToken<"u","internal-error");const n="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):xS(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,n)}updateFromIdToken(e){Ne(e.length!==0,"internal-error");const n=xS(e);this.updateTokensAndExpiration(e,null,n)}async getToken(e,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(Ne(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(e,n){const{accessToken:i,refreshToken:a,expiresIn:l}=await iN(e,n);this.updateTokensAndExpiration(i,a,Number(l))}updateTokensAndExpiration(e,n,i){this.refreshToken=n||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,n){const{refreshToken:i,accessToken:a,expirationTime:l}=n,c=new dl;return i&&(Ne(typeof i=="string","internal-error",{appName:e}),c.refreshToken=i),a&&(Ne(typeof a=="string","internal-error",{appName:e}),c.accessToken=a),l&&(Ne(typeof l=="number","internal-error",{appName:e}),c.expirationTime=l),c}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new dl,this.toJSON())}_performRefresh(){return $i("not implemented")}}function Ns(t,e){Ne(typeof t=="string"||typeof t>"u","internal-error",{appName:e})}class Hr{constructor({uid:e,auth:n,stsTokenManager:i,...a}){this.providerId="firebase",this.proactiveRefresh=new tN(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=a.displayName||null,this.email=a.email||null,this.emailVerified=a.emailVerified||!1,this.phoneNumber=a.phoneNumber||null,this.photoURL=a.photoURL||null,this.isAnonymous=a.isAnonymous||!1,this.tenantId=a.tenantId||null,this.providerData=a.providerData?[...a.providerData]:[],this.metadata=new Kg(a.createdAt||void 0,a.lastLoginAt||void 0)}async getIdToken(e){const n=await hu(this,this.stsTokenManager.getToken(this.auth,e));return Ne(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(e){return Zk(this,e)}reload(){return nN(this)}_assign(e){this!==e&&(Ne(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(n=>({...n})),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const n=new Hr({...this,auth:e,stsTokenManager:this.stsTokenManager._clone()});return n.metadata._copy(this.metadata),n}_onReload(e){Ne(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,n=!1){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),n&&await Xh(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(qr(this.auth.app))return Promise.reject(Xs(this.auth));const e=await this.getIdToken();return await hu(this,Jk(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>({...e})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,n){const i=n.displayName??void 0,a=n.email??void 0,l=n.phoneNumber??void 0,c=n.photoURL??void 0,h=n.tenantId??void 0,f=n._redirectEventId??void 0,p=n.createdAt??void 0,_=n.lastLoginAt??void 0,{uid:b,emailVerified:v,isAnonymous:T,providerData:E,stsTokenManager:w}=n;Ne(b&&w,e,"internal-error");const D=dl.fromJSON(this.name,w);Ne(typeof b=="string",e,"internal-error"),Ns(i,e.name),Ns(a,e.name),Ne(typeof v=="boolean",e,"internal-error"),Ne(typeof T=="boolean",e,"internal-error"),Ns(l,e.name),Ns(c,e.name),Ns(h,e.name),Ns(f,e.name),Ns(p,e.name),Ns(_,e.name);const L=new Hr({uid:b,auth:e,email:a,emailVerified:v,displayName:i,isAnonymous:T,photoURL:c,phoneNumber:l,tenantId:h,stsTokenManager:D,createdAt:p,lastLoginAt:_});return E&&Array.isArray(E)&&(L.providerData=E.map(q=>({...q}))),f&&(L._redirectEventId=f),L}static async _fromIdTokenResponse(e,n,i=!1){const a=new dl;a.updateFromServerResponse(n);const l=new Hr({uid:n.localId,auth:e,stsTokenManager:a,isAnonymous:i});return await Xh(l),l}static async _fromGetAccountInfoResponse(e,n,i){const a=n.users[0];Ne(a.localId!==void 0,"internal-error");const l=a.providerUserInfo!==void 0?J1(a.providerUserInfo):[],c=!(a.email&&a.passwordHash)&&!l?.length,h=new dl;h.updateFromIdToken(i);const f=new Hr({uid:a.localId,auth:e,stsTokenManager:h,isAnonymous:c}),p={uid:a.localId,displayName:a.displayName||null,photoURL:a.photoUrl||null,email:a.email||null,emailVerified:a.emailVerified||!1,phoneNumber:a.phoneNumber||null,tenantId:a.tenantId||null,providerData:l,metadata:new Kg(a.createdAt,a.lastLoginAt),isAnonymous:!(a.email&&a.passwordHash)&&!l?.length};return Object.assign(f,p),f}}const SS=new Map;function Qi(t){es(t instanceof Function,"Expected a class definition");let e=SS.get(t);return e?(es(e instanceof t,"Instance stored in cache mismatched with class"),e):(e=new t,SS.set(t,e),e)}class Z1{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,n){this.storage[e]=n}async _get(e){const n=this.storage[e];return n===void 0?null:n}async _remove(e){delete this.storage[e]}_addListener(e,n){}_removeListener(e,n){}}Z1.type="NONE";const ES=Z1;function Ah(t,e,n){return`firebase:${t}:${e}:${n}`}class hl{constructor(e,n,i){this.persistence=e,this.auth=n,this.userKey=i;const{config:a,name:l}=this.auth;this.fullUserKey=Ah(this.userKey,a.apiKey,l),this.fullPersistenceKey=Ah("persistence",a.apiKey,l),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){const n=await Yh(this.auth,{idToken:e}).catch(()=>{});return n?Hr._fromGetAccountInfoResponse(this.auth,n,e):null}return Hr._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=e,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,n,i="authUser"){if(!n.length)return new hl(Qi(ES),e,i);const a=(await Promise.all(n.map(async p=>{if(await p._isAvailable())return p}))).filter(p=>p);let l=a[0]||Qi(ES);const c=Ah(i,e.config.apiKey,e.name);let h=null;for(const p of n)try{const _=await p._get(c);if(_){let b;if(typeof _=="string"){const v=await Yh(e,{idToken:_}).catch(()=>{});if(!v)break;b=await Hr._fromGetAccountInfoResponse(e,v,_)}else b=Hr._fromJSON(e,_);p!==l&&(h=b),l=p;break}}catch{}const f=a.filter(p=>p._shouldAllowMigration);return!l._shouldAllowMigration||!f.length?new hl(l,e,i):(l=f[0],h&&await l._set(c,h.toJSON()),await Promise.all(n.map(async p=>{if(p!==l)try{await p._remove(c)}catch{}})),new hl(l,e,i))}}function wS(t){const e=t.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(rT(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(eT(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(sT(e))return"Blackberry";if(aT(e))return"Webos";if(tT(e))return"Safari";if((e.includes("chrome/")||nT(e))&&!e.includes("edge/"))return"Chrome";if(iT(e))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=t.match(n);if(i?.length===2)return i[1]}return"Other"}function eT(t=Dn()){return/firefox\//i.test(t)}function tT(t=Dn()){const e=t.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function nT(t=Dn()){return/crios\//i.test(t)}function rT(t=Dn()){return/iemobile/i.test(t)}function iT(t=Dn()){return/android/i.test(t)}function sT(t=Dn()){return/blackberry/i.test(t)}function aT(t=Dn()){return/webos/i.test(t)}function Jy(t=Dn()){return/iphone|ipad|ipod/i.test(t)||/macintosh/i.test(t)&&/mobile/i.test(t)}function aN(t=Dn()){return Jy(t)&&!!window.navigator?.standalone}function oN(){return Qj()&&document.documentMode===10}function oT(t=Dn()){return Jy(t)||iT(t)||aT(t)||sT(t)||/windows phone/i.test(t)||rT(t)}function lT(t,e=[]){let n;switch(t){case"Browser":n=wS(Dn());break;case"Worker":n=`${wS(Dn())}-${t}`;break;default:n=t}const i=e.length?e.join(","):"FirebaseCore-web";return`${n}/JsCore/${Ol}/${i}`}class lN{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,n){const i=l=>new Promise((c,h)=>{try{const f=e(l);c(f)}catch(f){h(f)}});i.onAbort=n,this.queue.push(i);const a=this.queue.length-1;return()=>{this.queue[a]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const n=[];try{for(const i of this.queue)await i(e),i.onAbort&&n.push(i.onAbort)}catch(i){n.reverse();for(const a of n)try{a()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}}}async function cN(t,e={}){return ua(t,"GET","/v2/passwordPolicy",so(t,e))}const uN=6;class dN{constructor(e){const n=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=n.minPasswordLength??uN,n.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=n.maxPasswordLength),n.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=n.containsLowercaseCharacter),n.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=n.containsUppercaseCharacter),n.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=n.containsNumericCharacter),n.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=n.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=e.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=e.forceUpgradeOnSignin??!1,this.schemaVersion=e.schemaVersion}validatePassword(e){const n={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,n),this.validatePasswordCharacterOptions(e,n),n.isValid&&(n.isValid=n.meetsMinPasswordLength??!0),n.isValid&&(n.isValid=n.meetsMaxPasswordLength??!0),n.isValid&&(n.isValid=n.containsLowercaseLetter??!0),n.isValid&&(n.isValid=n.containsUppercaseLetter??!0),n.isValid&&(n.isValid=n.containsNumericCharacter??!0),n.isValid&&(n.isValid=n.containsNonAlphanumericCharacter??!0),n}validatePasswordLengthOptions(e,n){const i=this.customStrengthOptions.minPasswordLength,a=this.customStrengthOptions.maxPasswordLength;i&&(n.meetsMinPasswordLength=e.length>=i),a&&(n.meetsMaxPasswordLength=e.length<=a)}validatePasswordCharacterOptions(e,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let i;for(let a=0;a<e.length;a++)i=e.charAt(a),this.updatePasswordCharacterOptionsStatuses(n,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,n,i,a,l){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=a)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=l))}}class hN{constructor(e,n,i,a){this.app=e,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=i,this.config=a,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new TS(this),this.idTokenSubscription=new TS(this),this.beforeStateQueue=new lN(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Q1,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=a.sdkClientVersion,this._persistenceManagerAvailable=new Promise(l=>this._resolvePersistenceManagerAvailable=l)}_initializeWithPersistence(e,n){return n&&(this._popupRedirectResolver=Qi(n)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await hl.create(this,e),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),await this.currentUser.getIdToken();return}await this._updateCurrentUser(e,!0)}}async initializeCurrentUserFromIdToken(e){try{const n=await Yh(this,{idToken:e}),i=await Hr._fromGetAccountInfoResponse(this,n,e);await this.directlySetCurrentUser(i)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){if(qr(this.app)){const l=this.app.settings.authIdToken;return l?new Promise(c=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(l).then(c,c))}):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let i=n,a=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const l=this.redirectUser?._redirectEventId,c=i?._redirectEventId,h=await this.tryRedirectSignIn(e);(!l||l===c)&&h?.user&&(i=h.user,a=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(a)try{await this.beforeStateQueue.runMiddleware(i)}catch(l){i=n,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(l))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return Ne(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(e){try{await Xh(e)}catch(n){if(n?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=Hk()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if(qr(this.app))return Promise.reject(Xs(this));const n=e?rn(e):null;return n&&Ne(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(e,n=!1){if(!this._deleted)return e&&Ne(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(e),this.queue(async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()})}async signOut(){return qr(this.app)?Promise.reject(Xs(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return qr(this.app)?Promise.reject(Xs(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Qi(e))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(e)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await cN(this),n=new dN(e);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new vu("auth","Firebase",e())}onAuthStateChanged(e,n,i){return this.registerStateListener(this.authStateSubscription,e,n,i)}beforeAuthStateChanged(e,n){return this.beforeStateQueue.pushCallback(e,n)}onIdTokenChanged(e,n,i){return this.registerStateListener(this.idTokenSubscription,e,n,i)}authStateReady(){return new Promise((e,n)=>{if(this.currentUser)e();else{const i=this.onAuthStateChanged(()=>{i(),e()},n)}})}async revokeAccessToken(e){if(this.currentUser){const n=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:n};this.tenantId!=null&&(i.tenantId=this.tenantId),await sN(this,i)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(e,n){const i=await this.getOrInitRedirectPersistenceManager(n);return e===null?i.removeCurrentUser():i.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const n=e&&Qi(e)||this._popupRedirectResolver;Ne(n,this,"argument-error"),this.redirectPersistenceManager=await hl.create(this,[Qi(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===e?this._currentUser:this.redirectUser?._redirectEventId===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(e))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const e=this.currentUser?.uid??null;this.lastNotifiedUid!==e&&(this.lastNotifiedUid=e,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,n,i,a){if(this._deleted)return()=>{};const l=typeof n=="function"?n:n.next.bind(n);let c=!1;const h=this._isInitialized?Promise.resolve():this._initializationPromise;if(Ne(h,this,"internal-error"),h.then(()=>{c||l(this.currentUser)}),typeof n=="function"){const f=e.addObserver(n,i,a);return()=>{c=!0,f()}}else{const f=e.addObserver(n);return()=>{c=!0,f()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return Ne(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=lT(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const n=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();n&&(e["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(e["X-Firebase-AppCheck"]=i),e}async _getAppCheckToken(){if(qr(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return e?.error&&zk(`Error while retrieving App Check token: ${e.error}`),e?.token}}function zl(t){return rn(t)}class TS{constructor(e){this.auth=e,this.observer=null,this.addObserver=tI(n=>this.observer=n)}get next(){return Ne(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Of={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function fN(t){Of=t}function cT(t){return Of.loadJS(t)}function mN(){return Of.recaptchaEnterpriseScript}function pN(){return Of.gapiScript}function gN(t){return`__${t}${Math.floor(Math.random()*1e6)}`}class yN{constructor(){this.enterprise=new _N}ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}class _N{ready(e){e()}execute(e,n){return Promise.resolve("token")}render(e,n){return""}}const bN="recaptcha-enterprise",uT="NO_RECAPTCHA";class vN{constructor(e){this.type=bN,this.auth=zl(e)}async verify(e="verify",n=!1){async function i(l){if(!n){if(l.tenantId==null&&l._agentRecaptchaConfig!=null)return l._agentRecaptchaConfig.siteKey;if(l.tenantId!=null&&l._tenantRecaptchaConfigs[l.tenantId]!==void 0)return l._tenantRecaptchaConfigs[l.tenantId].siteKey}return new Promise(async(c,h)=>{Xk(l,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then(f=>{if(f.recaptchaKey===void 0)h(new Error("recaptcha Enterprise site key undefined"));else{const p=new Yk(f);return l.tenantId==null?l._agentRecaptchaConfig=p:l._tenantRecaptchaConfigs[l.tenantId]=p,c(p.siteKey)}}).catch(f=>{h(f)})})}function a(l,c,h){const f=window.grecaptcha;vS(f)?f.enterprise.ready(()=>{f.enterprise.execute(l,{action:e}).then(p=>{c(p)}).catch(()=>{c(uT)})}):h(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?new yN().execute("siteKey",{action:"verify"}):new Promise((l,c)=>{i(this.auth).then(h=>{if(!n&&vS(window.grecaptcha))a(h,l,c);else{if(typeof window>"u"){c(new Error("RecaptchaVerifier is only supported in browser"));return}let f=mN();f.length!==0&&(f+=h),cT(f).then(()=>{a(h,l,c)}).catch(p=>{c(p)})}}).catch(h=>{c(h)})})}}async function CS(t,e,n,i=!1,a=!1){const l=new vN(t);let c;if(a)c=uT;else try{c=await l.verify(n)}catch{c=await l.verify(n,!0)}const h={...e};if(n==="mfaSmsEnrollment"||n==="mfaSmsSignIn"){if("phoneEnrollmentInfo"in h){const f=h.phoneEnrollmentInfo.phoneNumber,p=h.phoneEnrollmentInfo.recaptchaToken;Object.assign(h,{phoneEnrollmentInfo:{phoneNumber:f,recaptchaToken:p,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in h){const f=h.phoneSignInInfo.recaptchaToken;Object.assign(h,{phoneSignInInfo:{recaptchaToken:f,captchaResponse:c,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return h}return i?Object.assign(h,{captchaResp:c}):Object.assign(h,{captchaResponse:c}),Object.assign(h,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(h,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),h}async function AS(t,e,n,i,a){if(t._getRecaptchaConfig()?.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const l=await CS(t,e,n,n==="getOobCode");return i(t,l)}else return i(t,e).catch(async l=>{if(l.code==="auth/missing-recaptcha-token"){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const c=await CS(t,e,n,n==="getOobCode");return i(t,c)}else return Promise.reject(l)})}function xN(t,e){const n=py(t,"auth");if(n.isInitialized()){const a=n.getImmediate(),l=n.getOptions();if(Js(l,e??{}))return a;Qr(a,"already-initialized")}return n.initialize({options:e})}function SN(t,e){const n=e?.persistence||[],i=(Array.isArray(n)?n:[n]).map(Qi);e?.errorMap&&t._updateErrorMap(e.errorMap),t._initializeWithPersistence(i,e?.popupRedirectResolver)}function EN(t,e,n){const i=zl(t);Ne(/^https?:\/\//.test(e),i,"invalid-emulator-scheme");const a=!1,l=dT(e),{host:c,port:h}=wN(e),f=h===null?"":`:${h}`,p={url:`${l}//${c}${f}/`},_=Object.freeze({host:c,port:h,protocol:l.replace(":",""),options:Object.freeze({disableWarnings:a})});if(!i._canInitEmulator){Ne(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),Ne(Js(p,i.config.emulator)&&Js(_,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=p,i.emulatorConfig=_,i.settings.appVerificationDisabledForTesting=!0,Ml(c)?(qE(`${l}//${c}${f}`),HE("Auth",!0)):TN()}function dT(t){const e=t.indexOf(":");return e<0?"":t.substr(0,e+1)}function wN(t){const e=dT(t),n=/(\/\/)?([^?#/]+)/.exec(t.substr(e.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",a=/^(\[[^\]]+\])(:|$)/.exec(i);if(a){const l=a[1];return{host:l,port:RS(i.substr(l.length+1))}}else{const[l,c]=i.split(":");return{host:l,port:RS(c)}}}function RS(t){if(!t)return null;const e=Number(t);return isNaN(e)?null:e}function TN(){function t(){const e=document.createElement("p"),n=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",n.position="fixed",n.width="100%",n.backgroundColor="#ffffff",n.border=".1em solid #000000",n.color="#b50000",n.bottom="0px",n.left="0px",n.margin="0px",n.zIndex="10000",n.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",t):t())}class Zy{constructor(e,n){this.providerId=e,this.signInMethod=n}toJSON(){return $i("not implemented")}_getIdTokenResponse(e){return $i("not implemented")}_linkToIdToken(e,n){return $i("not implemented")}_getReauthenticationResolver(e){return $i("not implemented")}}async function CN(t,e){return ua(t,"POST","/v1/accounts:signUp",e)}async function AN(t,e){return Mf(t,"POST","/v1/accounts:signInWithPassword",so(t,e))}async function RN(t,e){return Mf(t,"POST","/v1/accounts:signInWithEmailLink",so(t,e))}async function DN(t,e){return Mf(t,"POST","/v1/accounts:signInWithEmailLink",so(t,e))}class fu extends Zy{constructor(e,n,i,a=null){super("password",i),this._email=e,this._password=n,this._tenantId=a}static _fromEmailAndPassword(e,n){return new fu(e,n,"password")}static _fromEmailAndCode(e,n,i=null){return new fu(e,n,"emailLink",i)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e;if(n?.email&&n?.password){if(n.signInMethod==="password")return this._fromEmailAndPassword(n.email,n.password);if(n.signInMethod==="emailLink")return this._fromEmailAndCode(n.email,n.password,n.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":const n={returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return AS(e,n,"signInWithPassword",AN);case"emailLink":return RN(e,{email:this._email,oobCode:this._password});default:Qr(e,"internal-error")}}async _linkToIdToken(e,n){switch(this.signInMethod){case"password":const i={idToken:n,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"};return AS(e,i,"signUpPassword",CN);case"emailLink":return DN(e,{idToken:n,email:this._email,oobCode:this._password});default:Qr(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function fl(t,e){return Mf(t,"POST","/v1/accounts:signInWithIdp",so(t,e))}const jN="http://localhost";class Xa extends Zy{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const n=new Xa(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(n.idToken=e.idToken),e.accessToken&&(n.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(n.nonce=e.nonce),e.pendingToken&&(n.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(n.accessToken=e.oauthToken,n.secret=e.oauthTokenSecret):Qr("argument-error"),n}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const n=typeof e=="string"?JSON.parse(e):e,{providerId:i,signInMethod:a,...l}=n;if(!i||!a)return null;const c=new Xa(i,a);return c.idToken=l.idToken||void 0,c.accessToken=l.accessToken||void 0,c.secret=l.secret,c.nonce=l.nonce,c.pendingToken=l.pendingToken||null,c}_getIdTokenResponse(e){const n=this.buildRequest();return fl(e,n)}_linkToIdToken(e,n){const i=this.buildRequest();return i.idToken=n,fl(e,i)}_getReauthenticationResolver(e){const n=this.buildRequest();return n.autoCreate=!1,fl(e,n)}buildRequest(){const e={requestUri:jN,returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const n={};this.idToken&&(n.id_token=this.idToken),this.accessToken&&(n.access_token=this.accessToken),this.secret&&(n.oauth_token_secret=this.secret),n.providerId=this.providerId,this.nonce&&!this.pendingToken&&(n.nonce=this.nonce),e.postBody=xu(n)}return e}}function IN(t){switch(t){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}function MN(t){const e=$c(Qc(t)).link,n=e?$c(Qc(e)).deep_link_id:null,i=$c(Qc(t)).deep_link_id;return(i?$c(Qc(i)).link:null)||i||n||e||t}class e_{constructor(e){const n=$c(Qc(e)),i=n.apiKey??null,a=n.oobCode??null,l=IN(n.mode??null);Ne(i&&a&&l,"argument-error"),this.apiKey=i,this.operation=l,this.code=a,this.continueUrl=n.continueUrl??null,this.languageCode=n.lang??null,this.tenantId=n.tenantId??null}static parseLink(e){const n=MN(e);try{return new e_(n)}catch{return null}}}class Fl{constructor(){this.providerId=Fl.PROVIDER_ID}static credential(e,n){return fu._fromEmailAndPassword(e,n)}static credentialWithLink(e,n){const i=e_.parseLink(n);return Ne(i,"argument-error"),fu._fromEmailAndCode(e,i.code,i.tenantId)}}Fl.PROVIDER_ID="password";Fl.EMAIL_PASSWORD_SIGN_IN_METHOD="password";Fl.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class hT{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Iu extends hT{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class Vs extends Iu{constructor(){super("facebook.com")}static credential(e){return Xa._fromParams({providerId:Vs.PROVIDER_ID,signInMethod:Vs.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Vs.credentialFromTaggedObject(e)}static credentialFromError(e){return Vs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return Vs.credential(e.oauthAccessToken)}catch{return null}}}Vs.FACEBOOK_SIGN_IN_METHOD="facebook.com";Vs.PROVIDER_ID="facebook.com";class Us extends Iu{constructor(){super("google.com"),this.addScope("profile")}static credential(e,n){return Xa._fromParams({providerId:Us.PROVIDER_ID,signInMethod:Us.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:n})}static credentialFromResult(e){return Us.credentialFromTaggedObject(e)}static credentialFromError(e){return Us.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:n,oauthAccessToken:i}=e;if(!n&&!i)return null;try{return Us.credential(n,i)}catch{return null}}}Us.GOOGLE_SIGN_IN_METHOD="google.com";Us.PROVIDER_ID="google.com";class zs extends Iu{constructor(){super("github.com")}static credential(e){return Xa._fromParams({providerId:zs.PROVIDER_ID,signInMethod:zs.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return zs.credentialFromTaggedObject(e)}static credentialFromError(e){return zs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e)||!e.oauthAccessToken)return null;try{return zs.credential(e.oauthAccessToken)}catch{return null}}}zs.GITHUB_SIGN_IN_METHOD="github.com";zs.PROVIDER_ID="github.com";class Fs extends Iu{constructor(){super("twitter.com")}static credential(e,n){return Xa._fromParams({providerId:Fs.PROVIDER_ID,signInMethod:Fs.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:n})}static credentialFromResult(e){return Fs.credentialFromTaggedObject(e)}static credentialFromError(e){return Fs.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:n,oauthTokenSecret:i}=e;if(!n||!i)return null;try{return Fs.credential(n,i)}catch{return null}}}Fs.TWITTER_SIGN_IN_METHOD="twitter.com";Fs.PROVIDER_ID="twitter.com";class wl{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,n,i,a=!1){const l=await Hr._fromIdTokenResponse(e,i,a),c=DS(i);return new wl({user:l,providerId:c,_tokenResponse:i,operationType:n})}static async _forOperation(e,n,i){await e._updateTokensIfNecessary(i,!0);const a=DS(i);return new wl({user:e,providerId:a,_tokenResponse:i,operationType:n})}}function DS(t){return t.providerId?t.providerId:"phoneNumber"in t?"phone":null}class Jh extends ts{constructor(e,n,i,a){super(n.code,n.message),this.operationType=i,this.user=a,Object.setPrototypeOf(this,Jh.prototype),this.customData={appName:e.name,tenantId:e.tenantId??void 0,_serverResponse:n.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(e,n,i,a){return new Jh(e,n,i,a)}}function fT(t,e,n,i){return(e==="reauthenticate"?n._getReauthenticationResolver(t):n._getIdTokenResponse(t)).catch(l=>{throw l.code==="auth/multi-factor-auth-required"?Jh._fromErrorAndOperation(t,l,e,i):l})}async function ON(t,e,n=!1){const i=await hu(t,e._linkToIdToken(t.auth,await t.getIdToken()),n);return wl._forOperation(t,"link",i)}async function kN(t,e,n=!1){const{auth:i}=t;if(qr(i.app))return Promise.reject(Xs(i));const a="reauthenticate";try{const l=await hu(t,fT(i,a,e,t),n);Ne(l.idToken,i,"internal-error");const c=Xy(l.idToken);Ne(c,i,"internal-error");const{sub:h}=c;return Ne(t.uid===h,i,"user-mismatch"),wl._forOperation(t,a,l)}catch(l){throw l?.code==="auth/user-not-found"&&Qr(i,"user-mismatch"),l}}async function mT(t,e,n=!1){if(qr(t.app))return Promise.reject(Xs(t));const i="signIn",a=await fT(t,i,e),l=await wl._fromIdTokenResponse(t,i,a);return n||await t._updateCurrentUser(l.user),l}async function NN(t,e){return mT(zl(t),e)}async function PN(t){const e=zl(t);e._getPasswordPolicyInternal()&&await e._updatePasswordPolicy()}function LN(t,e,n){return qr(t.app)?Promise.reject(Xs(t)):NN(rn(t),Fl.credential(e,n)).catch(async i=>{throw i.code==="auth/password-does-not-meet-requirements"&&PN(t),i})}function BN(t,e,n,i){return rn(t).onIdTokenChanged(e,n,i)}function VN(t,e,n){return rn(t).beforeAuthStateChanged(e,n)}function UN(t,e,n,i){return rn(t).onAuthStateChanged(e,n,i)}function zN(t){return rn(t).signOut()}const Zh="__sak";class pT{constructor(e,n){this.storageRetriever=e,this.type=n}_isAvailable(){try{return this.storage?(this.storage.setItem(Zh,"1"),this.storage.removeItem(Zh),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(e,n){return this.storage.setItem(e,JSON.stringify(n)),Promise.resolve()}_get(e){const n=this.storage.getItem(e);return Promise.resolve(n?JSON.parse(n):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}const FN=1e3,qN=10;class gT extends pT{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(e,n)=>this.onStorageEvent(e,n),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=oT(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const n of Object.keys(this.listeners)){const i=this.storage.getItem(n),a=this.localCache[n];i!==a&&e(n,a,i)}}onStorageEvent(e,n=!1){if(!e.key){this.forAllChangedKeys((c,h,f)=>{this.notifyListeners(c,f)});return}const i=e.key;n?this.detachListener():this.stopPolling();const a=()=>{const c=this.storage.getItem(i);!n&&this.localCache[i]===c||this.notifyListeners(i,c)},l=this.storage.getItem(i);oN()&&l!==e.newValue&&e.newValue!==e.oldValue?setTimeout(a,qN):a()}notifyListeners(e,n){this.localCache[e]=n;const i=this.listeners[e];if(i)for(const a of Array.from(i))a(n&&JSON.parse(n))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((e,n,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:n,newValue:i}),!0)})},FN)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,n){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(e,n){await super._set(e,n),this.localCache[e]=JSON.stringify(n)}async _get(e){const n=await super._get(e);return this.localCache[e]=JSON.stringify(n),n}async _remove(e){await super._remove(e),delete this.localCache[e]}}gT.type="LOCAL";const HN=gT;class yT extends pT{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(e,n){}_removeListener(e,n){}}yT.type="SESSION";const _T=yT;function GN(t){return Promise.all(t.map(async e=>{try{return{fulfilled:!0,value:await e}}catch(n){return{fulfilled:!1,reason:n}}}))}class kf{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const n=this.receivers.find(a=>a.isListeningto(e));if(n)return n;const i=new kf(e);return this.receivers.push(i),i}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const n=e,{eventId:i,eventType:a,data:l}=n.data,c=this.handlersMap[a];if(!c?.size)return;n.ports[0].postMessage({status:"ack",eventId:i,eventType:a});const h=Array.from(c).map(async p=>p(n.origin,l)),f=await GN(h);n.ports[0].postMessage({status:"done",eventId:i,eventType:a,response:f})}_subscribe(e,n){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(n)}_unsubscribe(e,n){this.handlersMap[e]&&n&&this.handlersMap[e].delete(n),(!n||this.handlersMap[e].size===0)&&delete this.handlersMap[e],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}kf.receivers=[];function t_(t="",e=10){let n="";for(let i=0;i<e;i++)n+=Math.floor(Math.random()*10);return t+n}class $N{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,n,i=50){const a=typeof MessageChannel<"u"?new MessageChannel:null;if(!a)throw new Error("connection_unavailable");let l,c;return new Promise((h,f)=>{const p=t_("",20);a.port1.start();const _=setTimeout(()=>{f(new Error("unsupported_event"))},i);c={messageChannel:a,onMessage(b){const v=b;if(v.data.eventId===p)switch(v.data.status){case"ack":clearTimeout(_),l=setTimeout(()=>{f(new Error("timeout"))},3e3);break;case"done":clearTimeout(l),h(v.data.response);break;default:clearTimeout(_),clearTimeout(l),f(new Error("invalid_response"));break}}},this.handlers.add(c),a.port1.addEventListener("message",c.onMessage),this.target.postMessage({eventType:e,eventId:p,data:n},[a.port2])}).finally(()=>{c&&this.removeMessageHandler(c)})}}function xi(){return window}function QN(t){xi().location.href=t}function bT(){return typeof xi().WorkerGlobalScope<"u"&&typeof xi().importScripts=="function"}async function WN(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function KN(){return navigator?.serviceWorker?.controller||null}function YN(){return bT()?self:null}const vT="firebaseLocalStorageDb",XN=1,ef="firebaseLocalStorage",xT="fbase_key";class Mu{constructor(e){this.request=e}toPromise(){return new Promise((e,n)=>{this.request.addEventListener("success",()=>{e(this.request.result)}),this.request.addEventListener("error",()=>{n(this.request.error)})})}}function Nf(t,e){return t.transaction([ef],e?"readwrite":"readonly").objectStore(ef)}function JN(){const t=indexedDB.deleteDatabase(vT);return new Mu(t).toPromise()}function Yg(){const t=indexedDB.open(vT,XN);return new Promise((e,n)=>{t.addEventListener("error",()=>{n(t.error)}),t.addEventListener("upgradeneeded",()=>{const i=t.result;try{i.createObjectStore(ef,{keyPath:xT})}catch(a){n(a)}}),t.addEventListener("success",async()=>{const i=t.result;i.objectStoreNames.contains(ef)?e(i):(i.close(),await JN(),e(await Yg()))})})}async function jS(t,e,n){const i=Nf(t,!0).put({[xT]:e,value:n});return new Mu(i).toPromise()}async function ZN(t,e){const n=Nf(t,!1).get(e),i=await new Mu(n).toPromise();return i===void 0?null:i.value}function IS(t,e){const n=Nf(t,!0).delete(e);return new Mu(n).toPromise()}const e4=800,t4=3;class ST{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await Yg(),this.db)}async _withRetries(e){let n=0;for(;;)try{const i=await this._openDb();return await e(i)}catch(i){if(n++>t4)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return bT()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=kf._getInstance(YN()),this.receiver._subscribe("keyChanged",async(e,n)=>({keyProcessed:(await this._poll()).includes(n.key)})),this.receiver._subscribe("ping",async(e,n)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await WN(),!this.activeServiceWorker)return;this.sender=new $N(this.activeServiceWorker);const e=await this.sender._send("ping",{},800);e&&e[0]?.fulfilled&&e[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){if(!(!this.sender||!this.activeServiceWorker||KN()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Yg();return await jS(e,Zh,"1"),await IS(e,Zh),!0}catch{}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,n){return this._withPendingWrite(async()=>(await this._withRetries(i=>jS(i,e,n)),this.localCache[e]=n,this.notifyServiceWorker(e)))}async _get(e){const n=await this._withRetries(i=>ZN(i,e));return this.localCache[e]=n,n}async _remove(e){return this._withPendingWrite(async()=>(await this._withRetries(n=>IS(n,e)),delete this.localCache[e],this.notifyServiceWorker(e)))}async _poll(){const e=await this._withRetries(a=>{const l=Nf(a,!1).getAll();return new Mu(l).toPromise()});if(!e)return[];if(this.pendingWrites!==0)return[];const n=[],i=new Set;if(e.length!==0)for(const{fbase_key:a,value:l}of e)i.add(a),JSON.stringify(this.localCache[a])!==JSON.stringify(l)&&(this.notifyListeners(a,l),n.push(a));for(const a of Object.keys(this.localCache))this.localCache[a]&&!i.has(a)&&(this.notifyListeners(a,null),n.push(a));return n}notifyListeners(e,n){this.localCache[e]=n;const i=this.listeners[e];if(i)for(const a of Array.from(i))a(n)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),e4)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,n){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(n)}_removeListener(e,n){this.listeners[e]&&(this.listeners[e].delete(n),this.listeners[e].size===0&&delete this.listeners[e]),Object.keys(this.listeners).length===0&&this.stopPolling()}}ST.type="LOCAL";const n4=ST;new ju(3e4,6e4);function r4(t,e){return e?Qi(e):(Ne(t._popupRedirectResolver,t,"argument-error"),t._popupRedirectResolver)}class n_ extends Zy{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return fl(e,this._buildIdpRequest())}_linkToIdToken(e,n){return fl(e,this._buildIdpRequest(n))}_getReauthenticationResolver(e){return fl(e,this._buildIdpRequest())}_buildIdpRequest(e){const n={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(n.idToken=e),n}}function i4(t){return mT(t.auth,new n_(t),t.bypassAuthState)}function s4(t){const{auth:e,user:n}=t;return Ne(n,e,"internal-error"),kN(n,new n_(t),t.bypassAuthState)}async function a4(t){const{auth:e,user:n}=t;return Ne(n,e,"internal-error"),ON(n,new n_(t),t.bypassAuthState)}class ET{constructor(e,n,i,a,l=!1){this.auth=e,this.resolver=i,this.user=a,this.bypassAuthState=l,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(n)?n:[n]}execute(){return new Promise(async(e,n)=>{this.pendingPromise={resolve:e,reject:n};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(e){const{urlResponse:n,sessionId:i,postBody:a,tenantId:l,error:c,type:h}=e;if(c){this.reject(c);return}const f={auth:this.auth,requestUri:n,sessionId:i,tenantId:l||void 0,postBody:a||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(h)(f))}catch(p){this.reject(p)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return i4;case"linkViaPopup":case"linkViaRedirect":return a4;case"reauthViaPopup":case"reauthViaRedirect":return s4;default:Qr(this.auth,"internal-error")}}resolve(e){es(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){es(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const o4=new ju(2e3,1e4);class ll extends ET{constructor(e,n,i,a,l){super(e,n,a,l),this.provider=i,this.authWindow=null,this.pollId=null,ll.currentPopupAction&&ll.currentPopupAction.cancel(),ll.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return Ne(e,this.auth,"internal-error"),e}async onExecution(){es(this.filter.length===1,"Popup operations only handle one event");const e=t_();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch(n=>{this.reject(n)}),this.resolver._isIframeWebStorageSupported(this.auth,n=>{n||this.reject(vi(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(vi(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,ll.currentPopupAction=null}pollUserCancellation(){const e=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(vi(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(e,o4.get())};e()}}ll.currentPopupAction=null;const l4="pendingRedirect",Rh=new Map;class c4 extends ET{constructor(e,n,i=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],n,void 0,i),this.eventId=null}async execute(){let e=Rh.get(this.auth._key());if(!e){try{const i=await u4(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(i)}catch(n){e=()=>Promise.reject(n)}Rh.set(this.auth._key(),e)}return this.bypassAuthState||Rh.set(this.auth._key(),()=>Promise.resolve(null)),e()}async onAuthEvent(e){if(e.type==="signInViaRedirect")return super.onAuthEvent(e);if(e.type==="unknown"){this.resolve(null);return}if(e.eventId){const n=await this.auth._redirectUserForId(e.eventId);if(n)return this.user=n,super.onAuthEvent(e);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function u4(t,e){const n=f4(e),i=h4(t);if(!await i._isAvailable())return!1;const a=await i._get(n)==="true";return await i._remove(n),a}function d4(t,e){Rh.set(t._key(),e)}function h4(t){return Qi(t._redirectPersistence)}function f4(t){return Ah(l4,t.config.apiKey,t.name)}async function m4(t,e,n=!1){if(qr(t.app))return Promise.reject(Xs(t));const i=zl(t),a=r4(i,e),c=await new c4(i,a,n).execute();return c&&!n&&(delete c.user._redirectEventId,await i._persistUserIfCurrent(c.user),await i._setRedirectUser(null,e)),c}const p4=600*1e3;class g4{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let n=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(e,i)&&(n=!0,this.sendToConsumer(e,i),this.saveEventToCache(e))}),this.hasHandledPotentialRedirect||!y4(e)||(this.hasHandledPotentialRedirect=!0,n||(this.queuedRedirectEvent=e,n=!0)),n}sendToConsumer(e,n){if(e.error&&!wT(e)){const i=e.error.code?.split("auth/")[1]||"internal-error";n.onError(vi(this.auth,i))}else n.onAuthEvent(e)}isEventForConsumer(e,n){const i=n.eventId===null||!!e.eventId&&e.eventId===n.eventId;return n.filter.includes(e.type)&&i}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=p4&&this.cachedEventUids.clear(),this.cachedEventUids.has(MS(e))}saveEventToCache(e){this.cachedEventUids.add(MS(e)),this.lastProcessedEventTime=Date.now()}}function MS(t){return[t.type,t.eventId,t.sessionId,t.tenantId].filter(e=>e).join("-")}function wT({type:t,error:e}){return t==="unknown"&&e?.code==="auth/no-auth-event"}function y4(t){switch(t.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return wT(t);default:return!1}}async function _4(t,e={}){return ua(t,"GET","/v1/projects",e)}const b4=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,v4=/^https?/;async function x4(t){if(t.config.emulator)return;const{authorizedDomains:e}=await _4(t);for(const n of e)try{if(S4(n))return}catch{}Qr(t,"unauthorized-domain")}function S4(t){const e=Wg(),{protocol:n,hostname:i}=new URL(e);if(t.startsWith("chrome-extension://")){const c=new URL(t);return c.hostname===""&&i===""?n==="chrome-extension:"&&t.replace("chrome-extension://","")===e.replace("chrome-extension://",""):n==="chrome-extension:"&&c.hostname===i}if(!v4.test(n))return!1;if(b4.test(t))return i===t;const a=t.replace(/\./g,"\\.");return new RegExp("^(.+\\."+a+"|"+a+")$","i").test(i)}const E4=new ju(3e4,6e4);function OS(){const t=xi().___jsl;if(t?.H){for(const e of Object.keys(t.H))if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=[...t.H[e].L],t.CP)for(let n=0;n<t.CP.length;n++)t.CP[n]=null}}function w4(t){return new Promise((e,n)=>{function i(){OS(),gapi.load("gapi.iframes",{callback:()=>{e(gapi.iframes.getContext())},ontimeout:()=>{OS(),n(vi(t,"network-request-failed"))},timeout:E4.get()})}if(xi().gapi?.iframes?.Iframe)e(gapi.iframes.getContext());else if(xi().gapi?.load)i();else{const a=gN("iframefcb");return xi()[a]=()=>{gapi.load?i():n(vi(t,"network-request-failed"))},cT(`${pN()}?onload=${a}`).catch(l=>n(l))}}).catch(e=>{throw Dh=null,e})}let Dh=null;function T4(t){return Dh=Dh||w4(t),Dh}const C4=new ju(5e3,15e3),A4="__/auth/iframe",R4="emulator/auth/iframe",D4={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},j4=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function I4(t){const e=t.config;Ne(e.authDomain,t,"auth-domain-config-required");const n=e.emulator?Yy(e,R4):`https://${t.config.authDomain}/${A4}`,i={apiKey:e.apiKey,appName:t.name,v:Ol},a=j4.get(t.config.apiHost);a&&(i.eid=a);const l=t._getFrameworks();return l.length&&(i.fw=l.join(",")),`${n}?${xu(i).slice(1)}`}async function M4(t){const e=await T4(t),n=xi().gapi;return Ne(n,t,"internal-error"),e.open({where:document.body,url:I4(t),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:D4,dontclear:!0},i=>new Promise(async(a,l)=>{await i.restyle({setHideOnLeave:!1});const c=vi(t,"network-request-failed"),h=xi().setTimeout(()=>{l(c)},C4.get());function f(){xi().clearTimeout(h),a(i)}i.ping(f).then(f,()=>{l(c)})}))}const O4={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},k4=500,N4=600,P4="_blank",L4="http://localhost";class kS{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function B4(t,e,n,i=k4,a=N4){const l=Math.max((window.screen.availHeight-a)/2,0).toString(),c=Math.max((window.screen.availWidth-i)/2,0).toString();let h="";const f={...O4,width:i.toString(),height:a.toString(),top:l,left:c},p=Dn().toLowerCase();n&&(h=nT(p)?P4:n),eT(p)&&(e=e||L4,f.scrollbars="yes");const _=Object.entries(f).reduce((v,[T,E])=>`${v}${T}=${E},`,"");if(aN(p)&&h!=="_self")return V4(e||"",h),new kS(null);const b=window.open(e||"",h,_);Ne(b,t,"popup-blocked");try{b.focus()}catch{}return new kS(b)}function V4(t,e){const n=document.createElement("a");n.href=t,n.target=e;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}const U4="__/auth/handler",z4="emulator/auth/handler",F4=encodeURIComponent("fac");async function NS(t,e,n,i,a,l){Ne(t.config.authDomain,t,"auth-domain-config-required"),Ne(t.config.apiKey,t,"invalid-api-key");const c={apiKey:t.config.apiKey,appName:t.name,authType:n,redirectUrl:i,v:Ol,eventId:a};if(e instanceof hT){e.setDefaultLanguage(t.languageCode),c.providerId=e.providerId||"",eI(e.getCustomParameters())||(c.customParameters=JSON.stringify(e.getCustomParameters()));for(const[_,b]of Object.entries({}))c[_]=b}if(e instanceof Iu){const _=e.getScopes().filter(b=>b!=="");_.length>0&&(c.scopes=_.join(","))}t.tenantId&&(c.tid=t.tenantId);const h=c;for(const _ of Object.keys(h))h[_]===void 0&&delete h[_];const f=await t._getAppCheckToken(),p=f?`#${F4}=${encodeURIComponent(f)}`:"";return`${q4(t)}?${xu(h).slice(1)}${p}`}function q4({config:t}){return t.emulator?Yy(t,z4):`https://${t.authDomain}/${U4}`}const cg="webStorageSupport";class H4{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=_T,this._completeRedirectFn=m4,this._overrideRedirectResult=d4}async _openPopup(e,n,i,a){es(this.eventManagers[e._key()]?.manager,"_initialize() not called before _openPopup()");const l=await NS(e,n,i,Wg(),a);return B4(e,l,t_())}async _openRedirect(e,n,i,a){await this._originValidation(e);const l=await NS(e,n,i,Wg(),a);return QN(l),new Promise(()=>{})}_initialize(e){const n=e._key();if(this.eventManagers[n]){const{manager:a,promise:l}=this.eventManagers[n];return a?Promise.resolve(a):(es(l,"If manager is not set, promise should be"),l)}const i=this.initAndGetManager(e);return this.eventManagers[n]={promise:i},i.catch(()=>{delete this.eventManagers[n]}),i}async initAndGetManager(e){const n=await M4(e),i=new g4(e);return n.register("authEvent",a=>(Ne(a?.authEvent,e,"invalid-auth-event"),{status:i.onEvent(a.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:i},this.iframes[e._key()]=n,i}_isIframeWebStorageSupported(e,n){this.iframes[e._key()].send(cg,{type:cg},a=>{const l=a?.[0]?.[cg];l!==void 0&&n(!!l),Qr(e,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const n=e._key();return this.originValidationPromises[n]||(this.originValidationPromises[n]=x4(e)),this.originValidationPromises[n]}get _shouldInitProactively(){return oT()||tT()||Jy()}}const G4=H4;var PS="@firebase/auth",LS="1.12.0";class $4{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const n=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,n),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const n=this.internalListeners.get(e);n&&(this.internalListeners.delete(e),n(),this.updateProactiveRefresh())}assertAuthConfigured(){Ne(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function Q4(t){switch(t){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function W4(t){gl(new Wa("auth",(e,{options:n})=>{const i=e.getProvider("app").getImmediate(),a=e.getProvider("heartbeat"),l=e.getProvider("app-check-internal"),{apiKey:c,authDomain:h}=i.options;Ne(c&&!c.includes(":"),"invalid-api-key",{appName:i.name});const f={apiKey:c,authDomain:h,clientPlatform:t,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:lT(t)},p=new hN(i,a,l,f);return SN(p,n),p},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,n,i)=>{e.getProvider("auth-internal").initialize()})),gl(new Wa("auth-internal",e=>{const n=zl(e.getProvider("auth").getImmediate());return(i=>new $4(i))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Ws(PS,LS,Q4(t)),Ws(PS,LS,"esm2020")}const K4=300,Y4=FE("authIdTokenMaxAge")||K4;let BS=null;const X4=t=>async e=>{const n=e&&await e.getIdTokenResult(),i=n&&(new Date().getTime()-Date.parse(n.issuedAtTime))/1e3;if(i&&i>Y4)return;const a=n?.token;BS!==a&&(BS=a,await fetch(t,{method:a?"POST":"DELETE",headers:a?{Authorization:`Bearer ${a}`}:{}}))};function J4(t=WE()){const e=py(t,"auth");if(e.isInitialized())return e.getImmediate();const n=xN(t,{popupRedirectResolver:G4,persistence:[n4,HN,_T]}),i=FE("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const l=new URL(i,location.origin);if(location.origin===l.origin){const c=X4(l.toString());VN(n,c,()=>c(n.currentUser)),BN(n,h=>c(h))}}const a=UE("auth");return a&&EN(n,`http://${a}`),n}function Z4(){return document.getElementsByTagName("head")?.[0]??document}fN({loadJS(t){return new Promise((e,n)=>{const i=document.createElement("script");i.setAttribute("src",t),i.onload=e,i.onerror=a=>{const l=vi("internal-error");l.customData=a,n(l)},i.type="text/javascript",i.charset="UTF-8",Z4().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});W4("Browser");function ao(){const t=J4(XE);async function e(){return!1}async function n(h,f){return LN(t,h,f)}function i(){return zN(t)}function a(h){UN(t,f=>{h(f)})}function l(){return t.currentUser}return{set_user_listener:a,delete_firebase_user:e,login_firebase_user:n,logout_firebase_user:i,get_current_firebase_user:l}}const eP={currentUserId:null,selectedBudgetId:null,currentYear:new Date().getFullYear(),currentMonthNumber:new Date().getMonth()+1,lastActiveTab:"categories",lastSettingsTab:"categories",lastAdminTab:"budget",setSelectedBudgetId:()=>{},setCurrentYear:()=>{},setCurrentMonthNumber:()=>{},setLastActiveTab:()=>{},setLastSettingsTab:()=>{},setLastAdminTab:()=>{},pageTitle:"Budget",setPageTitle:()=>{},isInitialized:!1,needsFirstBudget:!1,goToPreviousMonth:()=>{},goToNextMonth:()=>{},pendingInvites:[],hasPendingInvites:!1,accessibleBudgets:[],isAdmin:!1,isTest:!1,loadAccessibleBudgets:async()=>{},switchToBudget:()=>{},checkBudgetInvite:async()=>null,clearCache:()=>{}},TT=A.createContext(eP);function tP({children:t}){const n=ao().get_current_firebase_user(),[i,a]=A.useState(null),[l,c]=A.useState(new Date().getFullYear()),[h,f]=A.useState(new Date().getMonth()+1),[p,_]=A.useState("categories"),[b,v]=A.useState("categories"),[T,E]=A.useState("budget"),[w,D]=A.useState("Budget"),L=A.useCallback(V=>{D(z=>z===V?z:V)},[]),[q,B]=A.useState(!1),[ee,Q]=A.useState(!1),J=_k(n?.uid||null,n?.email||null),O=J.data&&J.data.budget_ids.length===0,R=vk(n?.uid||null,J.data||null,{enabled:!!n?.uid&&!!J.data&&O}),j=J.data?.permission_flags?.is_admin===!0,I=J.data?.permission_flags?.is_test===!0,M=R.data?.pendingInvites||[],F=R.data?.budgets||[],k=M.length>0;A.useEffect(()=>{if(!n||q||J.isLoading)return;const V=J.data;if(!(!V&&!J.isError))if(V&&V.budget_ids.length>0)a(V.budget_ids[0]),Q(!1),B(!0);else{if(R.isLoading)return;const z=R.data;z?.pendingInvites&&z.pendingInvites.length>0?Q(!1):Q(!0),B(!0)}},[n,q,J.data,J.isLoading,J.isError,R.data,R.isLoading]);const Y=A.useCallback(()=>{h===1?(c(V=>V-1),f(12)):f(V=>V-1)},[h]),H=A.useCallback(()=>{h===12?(c(V=>V+1),f(1)):f(V=>V+1)},[h]),N=A.useCallback(async()=>{await R.refetch()},[R]),G=A.useCallback(V=>{a(V)},[]),W=A.useCallback(async V=>{if(!n)return null;try{const z=await wk(V,n.uid);return z&&z.isInvited&&!z.hasAccepted?{budgetId:V,budgetName:z.budgetName,ownerEmail:z.ownerEmail}:null}catch(z){return console.error("[BudgetContext] Error checking budget invite:",z),null}},[n]),ne=A.useCallback(()=>{localStorage.removeItem("BUDGET_APP_QUERY_CACHE")},[]),ie={currentUserId:n?.uid||null,selectedBudgetId:i,currentYear:l,currentMonthNumber:h,lastActiveTab:p,lastSettingsTab:b,lastAdminTab:T,setSelectedBudgetId:a,setCurrentYear:c,setCurrentMonthNumber:f,setLastActiveTab:_,setLastSettingsTab:v,setLastAdminTab:E,pageTitle:w,setPageTitle:L,isInitialized:q,needsFirstBudget:ee,goToPreviousMonth:Y,goToNextMonth:H,pendingInvites:M,hasPendingInvites:k,accessibleBudgets:F,isAdmin:j,isTest:I,loadAccessibleBudgets:N,switchToBudget:G,checkBudgetInvite:W,clearCache:ne};return d.jsx(TT.Provider,{value:ie,children:t})}function zt(){const t=A.useContext(TT);if(!t)throw new Error("useBudget must be used within a BudgetProvider");return t}const Fa={mobile:640,tablet:768,wide:1200},nP=Fa.mobile,ml=["January","February","March","April","May","June","July","August","September","October","November","December"],ce={primary:"#646cff",primaryLight:"#a5b4fc",error:"#f87171",errorBg:"rgba(220, 38, 38, 0.1)",errorBorder:"rgba(220, 38, 38, 0.3)",success:"#4ade80",danger:"#f87171",warning:"#facc15",debt:"#fb923c",zero:"rgba(255, 255, 255, 0.4)"},mu={maxWidth:"var(--page-max-width, 85rem)",margin:"0 auto",padding:"var(--page-padding, 2rem)"},Ou={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},rP={...Ou,padding:"0.6rem 0.875rem",gap:"0.5rem"},iP={background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1.25rem",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"1rem"},sP={display:"flex",flexDirection:"column",gap:"0.5rem"},aP={fontSize:"0.9rem",fontWeight:500},oo={padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",width:"100%",boxSizing:"border-box"},oP={...oo,cursor:"pointer"},r_={padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:"pointer",fontWeight:500,fontSize:"0.9rem",transition:"opacity 0.15s"},CT={...r_,background:ce.primary,color:"white",border:"none"},lP={...CT,padding:"0.75rem 1.5rem",borderRadius:"8px"},cP={...r_,background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)"},uP={...r_,background:"transparent",border:`1px solid ${ce.errorBorder}`,color:ce.error},dP={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",padding:"0.35rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",opacity:.8,transition:"opacity 0.15s"},hP={display:"flex",gap:"0.5rem"},fP={display:"flex",gap:"0.25rem"},AT={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.9rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",minWidth:"2rem",minHeight:"2rem",transition:"opacity 0.15s, border-color 0.15s"},mP={...AT,borderColor:ce.errorBorder,color:ce.error},Tl={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 15%, transparent)",padding:"0.25rem 0.35rem",borderRadius:"4px",cursor:"pointer",fontSize:"0.75rem",lineHeight:1,display:"flex",alignItems:"center",justifyContent:"center",opacity:.6,transition:"opacity 0.15s, background 0.15s"},i_={display:"flex",flexDirection:"column",gap:"2px"},pP={display:"flex",gap:"0.75rem",marginTop:"0.5rem"},RT={opacity:.4,cursor:"grab"},DT={position:"absolute",top:"-4px",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",transition:"opacity 0.15s"},gP={position:"relative",height:"2rem",marginTop:"-0.25rem"},yP={position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",transition:"opacity 0.15s"},_P={position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},bP={background:ce.errorBg,border:`1px solid ${ce.errorBorder}`,color:ce.error,padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},vP={background:"transparent",border:"none",color:ce.error,cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},jT={opacity:.7,marginBottom:"1.5rem"},Pf={margin:0,fontSize:"0.85rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6},s_={fontWeight:500,fontSize:"1.1rem"},Cl={display:"flex",flexDirection:"column",gap:"0.5rem",marginBottom:"1.5rem"};function xP(){return d.jsxs("div",{style:mu,children:[d.jsx("nav",{style:{marginBottom:"1rem",display:"flex",alignItems:"center"},children:d.jsx(Dt,{to:"/",style:{display:"flex",alignItems:"center"},title:"Tarron Lane Home",children:d.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane Home",style:{width:"2rem",height:"2rem"}})})}),d.jsx("h1",{children:"Tarron Lane Homepage"}),d.jsx("nav",{children:d.jsxs("ul",{children:[d.jsx("li",{children:d.jsx(Dt,{to:"/sql-test",children:"SQL Test"})}),d.jsx("li",{children:d.jsx(Dt,{to:"/budget",children:"Budget"})}),d.jsx("li",{children:d.jsx(Dt,{to:"/account",children:"Account"})})]})})]})}function lo({message:t,children:e,onDismiss:n,style:i}){return d.jsxs("div",{style:{...bP,...i},children:[d.jsx("span",{children:e??t}),n&&d.jsx("button",{onClick:n,style:vP,children:""})]})}const SP={primary:CT,"primary-large":lP,secondary:cP,danger:uP,small:dP};function Ie({variant:t="primary",isLoading:e,loadingText:n="Saving...",children:i,disabled:a,style:l,actionName:c,onClick:h,...f}){const p=SP[t],_=a||e;function b(v){h?.(v)}return d.jsx("button",{disabled:_,style:{...p,cursor:_?"not-allowed":"pointer",opacity:_?.7:1,...l},onClick:b,...f,children:e?n:i})}function Xg(t,e){const n=t.toLowerCase(),i=e.toLowerCase();if(i.includes(n)){const h=i.indexOf(n);return{match:!0,score:h===0||/\s/.test(i[h-1])?100:90}}let a=0,l=0,c=0;for(let h=0;h<i.length&&a<n.length;h++)i[h]===n[a]?(a++,c++,l+=c*2):c=0;return a===n.length?{match:!0,score:l}:{match:!1,score:0}}function VS({id:t,value:e,onChange:n,payees:i,placeholder:a="Enter payee name"}){const[l,c]=A.useState(!1),[h,f]=A.useState(-1),p=A.useRef(null),_=A.useRef(null),b=e.trim()?i.map(E=>({payee:E,...Xg(e,E)})).filter(E=>E.match).sort((E,w)=>w.score-E.score).slice(0,8).map(E=>E.payee):[];A.useEffect(()=>{function E(w){p.current&&!p.current.contains(w.target)&&c(!1)}return document.addEventListener("mousedown",E),()=>document.removeEventListener("mousedown",E)},[]);function v(E){!l||b.length===0||(E.key==="ArrowDown"?(E.preventDefault(),f(w=>Math.min(w+1,b.length-1))):E.key==="ArrowUp"?(E.preventDefault(),f(w=>Math.max(w-1,-1))):E.key==="Enter"&&h>=0?(E.preventDefault(),n(b[h]),c(!1),f(-1)):E.key==="Escape"&&(c(!1),f(-1)))}function T(E){n(E),c(!1),f(-1),_.current?.focus()}return d.jsxs("div",{ref:p,style:{position:"relative"},children:[d.jsx("input",{ref:_,id:t,type:"text",value:e,onChange:E=>{n(E.target.value),c(!0),f(-1)},onFocus:()=>c(!0),onKeyDown:v,placeholder:a,autoComplete:"off",style:oo}),l&&b.length>0&&d.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:b.map((E,w)=>d.jsx("div",{onClick:()=>T(E),style:{padding:"0.6rem 0.8rem",cursor:"pointer",background:w===h?`color-mix(in srgb, ${ce.primary} 20%, transparent)`:"transparent",borderBottom:w<b.length-1?"1px solid color-mix(in srgb, currentColor 10%, transparent)":"none",transition:"background 0.1s"},onMouseEnter:()=>f(w),children:E},E))})]})}function EP({id:t,value:e,onChange:n,categories:i,categoryGroups:a,placeholder:l="Search categories...",required:c,showAdjustmentOption:h=!1}){const f=Object.fromEntries(a.map(Y=>[Y.id,Y.name])),p=Object.entries(i).map(([Y,H])=>({id:Y,name:H.name,groupId:H.category_group_id,groupName:H.category_group_id&&f[H.category_group_id]||null,sortOrder:H.sort_order}));h&&p.unshift({id:Bs,name:qa,groupId:null,groupName:null,sortOrder:-1});const _=e===Bs,b=_?null:e?i[e]:null,v=_?qa:b?.name||"",[T,E]=A.useState(v),[w,D]=A.useState(!1),[L,q]=A.useState(-1),B=A.useRef(null),ee=A.useRef(null);A.useEffect(()=>{if(e===Bs)E(qa);else{const Y=e?i[e]:null;E(Y?.name||"")}},[e,i]);const Q=T.trim()?p.map(Y=>({...Y,...Xg(T,Y.name),groupMatch:Y.groupName?Xg(T,Y.groupName):{match:!1,score:0}})).filter(Y=>Y.match||Y.groupMatch.match).sort((Y,H)=>{const N=Math.max(Y.score,Y.groupMatch.score*.5),G=Math.max(H.score,H.groupMatch.score*.5);if(G!==N)return G-N;if(Y.groupId!==H.groupId){if(!Y.groupId)return 1;if(!H.groupId)return-1;const W=(Y.groupName||"").localeCompare(H.groupName||"");return W!==0?W:Y.groupId.localeCompare(H.groupId)}return Y.sortOrder-H.sortOrder}).slice(0,10):[...p].sort((Y,H)=>{if(Y.groupId!==H.groupId){if(!Y.groupId)return 1;if(!H.groupId)return-1;const N=(Y.groupName||"").localeCompare(H.groupName||"");return N!==0?N:Y.groupId.localeCompare(H.groupId)}return Y.sortOrder-H.sortOrder}).slice(0,10);A.useEffect(()=>{function Y(H){if(B.current&&!B.current.contains(H.target))if(D(!1),e===Bs)E(qa);else{const N=e?i[e]:null;E(N?.name||"")}}return document.addEventListener("mousedown",Y),()=>document.removeEventListener("mousedown",Y)},[e,i]);function J(Y){if(Y.key==="ArrowDown")Y.preventDefault(),w?q(H=>Math.min(H+1,Q.length-1)):(D(!0),q(0));else if(Y.key==="ArrowUp")Y.preventDefault(),q(H=>Math.max(H-1,0));else if(Y.key==="Enter")Y.preventDefault(),w&&L>=0&&Q[L]&&O(Q[L]);else if(Y.key==="Escape")if(D(!1),q(-1),e===Bs)E(qa);else{const H=e?i[e]:null;E(H?.name||"")}else if(Y.key==="Tab"&&w&&Q.length>0){const H=L>=0?L:0;O(Q[H])}}function O(Y){n(Y.id),E(Y.name),D(!1),q(-1),ee.current?.focus()}function R(Y){const H=Y.target.value;E(H),D(!0),q(-1),H!==v&&n("")}function j(){D(!0),Q.length>0&&q(0)}const I=[];let M="__initial__";Q.forEach(Y=>{Y.groupId!==M&&(M=Y.groupId,I.push({groupId:Y.groupId,groupName:Y.groupName,items:[]})),I[I.length-1].items.push(Y)});let F=-1;const k=()=>++F;return d.jsxs("div",{ref:B,style:{position:"relative"},children:[d.jsx("input",{ref:ee,id:t,type:"text",value:T,onChange:R,onFocus:j,onKeyDown:J,placeholder:l,autoComplete:"off",required:c,style:{...oo,borderColor:c&&!e?ce.error:void 0}}),w&&Q.length>0&&d.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,maxHeight:"250px",overflowY:"auto"},children:I.map((Y,H)=>d.jsxs("div",{children:[Y.groupName&&d.jsx("div",{style:{padding:"0.4rem 0.8rem",fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.5px",opacity:.6,background:"color-mix(in srgb, currentColor 5%, transparent)",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:Y.groupName}),Y.items.map(N=>{const G=k();return d.jsx("div",{onClick:()=>O(N),style:{padding:"0.6rem 0.8rem",paddingLeft:Y.groupName?"1.2rem":"0.8rem",cursor:"pointer",background:G===L?`color-mix(in srgb, ${ce.primary} 20%, transparent)`:"transparent",borderBottom:"1px solid color-mix(in srgb, currentColor 10%, transparent)",transition:"background 0.1s"},onMouseEnter:()=>q(G),children:N.name},N.id)})]},`group-${H}`))}),w&&Q.length===0&&T.trim()&&d.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"4px",background:"var(--background, #1a1a1a)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e3,padding:"0.6rem 0.8rem",opacity:.6,fontStyle:"italic"},children:"No matching categories"})]})}function Ja({children:t,onSubmit:e,actionName:n}){function i(a){e(a)}return d.jsx("form",{onSubmit:i,style:iP,children:t})}function en({label:t,htmlFor:e,children:n,hint:i,style:a}){return d.jsxs("div",{style:{...sP,...a},children:[d.jsx("label",{htmlFor:e,style:aP,children:t}),n,i&&d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:i})]})}function Za(t){return d.jsx("input",{style:oo,...t})}function wP(t){if(!t)return"";try{return new Date(t+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})}catch{return t}}function US({value:t,onChange:e,style:n,...i}){const a=A.useRef(null),l=wP(t);function c(){a.current?.showPicker?.()}return d.jsxs("div",{style:{position:"relative"},children:[d.jsx("input",{ref:a,type:"date",value:t||"",onChange:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,pointerEvents:"none"},...i}),d.jsx("div",{onClick:c,style:{...oo,cursor:"pointer",display:"flex",alignItems:"center",fontSize:"0.85rem",fontFamily:"monospace",color:t?"inherit":"color-mix(in srgb, currentColor 50%, transparent)",...n},children:l||"Select date"})]})}function pu({children:t,...e}){return d.jsx("select",{style:oP,...e,children:t})}function a_({minHeight:t="6rem",style:e,...n}){return d.jsx("textarea",{style:{...oo,width:"100%",minHeight:t,resize:"vertical",fontFamily:"inherit",boxSizing:"border-box",...e},...n})}function co({children:t}){return d.jsx("div",{style:pP,children:t})}function ug(t){const n=t.replace(/[^\d.]/g,"").split("."),i=n[0]||"",a=n[1],l=i.replace(/\B(?=(\d{3})+(?!\d))/g,",");return a!==void 0?`$${l}.${a.slice(0,2)}`:l?`$${l}`:""}function TP(t){return t.replace(/[$,]/g,"")}function Jg({id:t,value:e,onChange:n,placeholder:i="$0.00",required:a,autoFocus:l}){const[c,h]=A.useState(()=>ug(e)),f=A.useRef(null);A.useEffect(()=>{const _=ug(e);TP(c)!==e&&h(_)},[e]);function p(_){const b=_.target.value;if(!b||b==="$"){h(""),n("");return}const T=b.replace(/[^\d.]/g,"").split(".");let E=T[0];T.length>1&&(E+="."+T.slice(1).join("").slice(0,2));const w=ug(E);h(w),n(E)}return d.jsx("input",{ref:f,id:t,type:"text",inputMode:"decimal",value:c,onChange:p,placeholder:i,required:a,autoFocus:l,style:oo})}function da(t=nP){const[e,n]=A.useState(()=>typeof window>"u"?!1:window.innerWidth<t);return A.useEffect(()=>{const i=window.matchMedia(`(max-width: ${t-1}px)`);function a(c){n(c.matches)}a(i),i.addEventListener("change",a);function l(){n(window.innerWidth<t)}return window.addEventListener("resize",l),()=>{i.removeEventListener("change",a),window.removeEventListener("resize",l)}},[t]),e}function Lf({children:t,isDragging:e,isDragOver:n,onDragStart:i,onDragOver:a,onDragLeave:l,onDragEnd:c,onDrop:h,onEdit:f,onDelete:p,onMoveUp:_,onMoveDown:b,canMoveUp:v=!0,canMoveDown:T=!0,itemName:E}){const w=da(),D=_||b;return d.jsxs("div",{onDragOver:L=>{L.stopPropagation(),a(L)},onDragLeave:L=>{L.stopPropagation(),l()},onDrop:L=>{L.stopPropagation(),h(L)},style:{position:"relative"},children:[d.jsx("div",{style:{...DT,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),d.jsxs("div",{style:{...w?rP:Ou,opacity:e?.5:1},children:[d.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",gap:w?"0.5rem":"0.75rem",minWidth:0},children:[d.jsx("span",{draggable:!0,onDragStart:L=>{i(L)},onDragEnd:()=>{c()},style:{...RT,fontSize:w?"0.9rem":void 0,cursor:"grab",padding:"0.25rem",margin:"-0.25rem",borderRadius:"4px",userSelect:"none"},title:"Drag to reorder",children:""}),d.jsx("div",{style:{flex:1,minWidth:0,overflow:"hidden",textOverflow:"ellipsis"},children:t})]}),d.jsxs("div",{style:w?fP:hP,children:[w?d.jsxs(d.Fragment,{children:[d.jsx("button",{onClick:()=>{f()},style:AT,title:"Edit","aria-label":"Edit",children:""}),d.jsx("button",{onClick:()=>{p()},style:mP,title:"Delete","aria-label":"Delete",children:""})]}):d.jsxs(d.Fragment,{children:[d.jsx(Ie,{variant:"secondary",actionName:`Edit ${E||"Item"}`,onClick:f,children:"Edit"}),d.jsx(Ie,{variant:"danger",actionName:`Delete ${E||"Item"}`,onClick:p,children:"Delete"})]}),D&&d.jsxs("div",{style:i_,children:[d.jsx("button",{onClick:L=>{L.stopPropagation(),_?.()},disabled:!v,style:{...Tl,opacity:v?.6:.2,cursor:v?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),d.jsx("button",{onClick:L=>{L.stopPropagation(),b?.()},disabled:!T,style:{...Tl,opacity:T?.6:.2,cursor:T?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]})]})}function o_({isActive:t,onDragOver:e,onDragLeave:n,onDrop:i,label:a="Move to end"}){return d.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:i,style:gP,children:[d.jsx("div",{style:{...yP,opacity:t?1:.3,boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&d.jsx("span",{style:_P,children:a})]})}function ke(t){return`$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function kn(t){return t<0?`-$${Math.abs(t).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`:`$${t.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2})}`}function wi(t){return t===0?"$0.00":`${t>0?"+":"-"}${ke(t)}`}function cr(t){return`${t>=0?"+":"-"}${ke(t)}`}function Tt(t){return t===0?ce.zero:t>0?ce.success:ce.danger}function Nn(t){return t===0?ce.zero:t>0?ce.success:ce.debt}function ql(t){return t===0?ce.zero:t<0?ce.error:ce.success}function Bf(t){return t===0?ce.zero:t>0?ce.success:ce.error}function IT(){const t=cn();return{submitFeedback:dr({mutationFn:async({userId:n,userEmail:i,text:a,feedbackType:l,currentPath:c})=>{const h=i||n,f={id:`feedback_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,text:`${a}

(Submitted from: ${c})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:l},{exists:p}=await Le("feedback",h,"checking if user has existing feedback document");return p?await ut("feedback",h,{items:NO(f),user_email:i,updated_at:new Date().toISOString()},"adding new feedback item to existing document",{merge:!0}):await ut("feedback",h,{items:[f],user_email:i,created_at:new Date().toISOString(),updated_at:new Date().toISOString()},"creating new feedback document for user"),{feedbackItem:f,docId:h}},onMutate:async({userId:n,userEmail:i,text:a,feedbackType:l,currentPath:c})=>{await t.cancelQueries({queryKey:xe.feedback()});const h=t.getQueryData(xe.feedback()),f=i||n,p={id:`feedback_optimistic_${Date.now()}`,text:`${a}

(Submitted from: ${c})`,created_at:new Date().toISOString(),is_done:!1,completed_at:null,sort_order:Date.now(),feedback_type:l,doc_id:f,user_email:i};return t.setQueryData(xe.feedback(),_=>_?{items:[..._.items,p]}:{items:[p]}),{previousData:h,optimisticItemId:p.id}},onSuccess:(n,i,a)=>{t.setQueryData(xe.feedback(),l=>l&&{items:l.items.map(c=>c.id===a?.optimisticItemId?{...n.feedbackItem,doc_id:n.docId,user_email:i.userEmail}:c)})},onError:(n,i,a)=>{a?.previousData&&t.setQueryData(xe.feedback(),a.previousData)}})}}function CP(){const t=cn();return{toggleFeedback:dr({mutationFn:async({item:n})=>{const{exists:i,data:a}=await Le("feedback",n.doc_id,"PRE-EDIT-READ");if(!i||!a)throw new Error(`Feedback document not found: ${n.doc_id}`);const l=!n.is_done,c=l?new Date().toISOString():null,h=a.items||[];let f=!1;const p=h.map(_=>_.id===n.id?(f=!0,{..._,is_done:l,completed_at:c}):_);if(!f)throw console.error("[toggleFeedback] Item not found in document",{searchingFor:n.id,inDocument:n.doc_id,availableIds:h.map(_=>_.id)}),new Error(`Feedback item not found in document. Item ID: ${n.id}, Doc ID: ${n.doc_id}`);return await ut("feedback",n.doc_id,{...a,items:p,updated_at:new Date().toISOString()},`marking feedback item as ${l?"done":"not done"}`),{itemId:n.id,isDone:l,completedAt:c}},onMutate:async({item:n})=>{await t.cancelQueries({queryKey:xe.feedback()});const i=t.getQueryData(xe.feedback()),a=!n.is_done,l=a?new Date().toISOString():null;return t.setQueryData(xe.feedback(),c=>c&&{items:c.items.map(h=>h.id===n.id?{...h,is_done:a,completed_at:l}:h)}),{previousData:i}},onError:(n,i,a)=>{a?.previousData&&t.setQueryData(xe.feedback(),a.previousData)}})}}function AP(){const t=cn();return{updateSortOrder:dr({mutationFn:async({docId:n,items:i})=>{const{exists:a,data:l}=await Le("feedback",n,"PRE-EDIT-READ");if(!a||!l)throw new Error("Feedback document not found");return await ut("feedback",n,{...l,items:i,updated_at:new Date().toISOString()},"saving reordered feedback items"),{docId:n,items:i}},onMutate:async({docId:n,items:i})=>{await t.cancelQueries({queryKey:xe.feedback()});const a=t.getQueryData(xe.feedback());return t.setQueryData(xe.feedback(),l=>{if(!l)return l;const c=new Map;return i.forEach(h=>{c.set(h.id,h.sort_order)}),{items:l.items.map(h=>h.doc_id===n&&c.has(h.id)?{...h,sort_order:c.get(h.id)}:h)}}),{previousData:a}},onError:(n,i,a)=>{a?.previousData&&t.setQueryData(xe.feedback(),a.previousData)}})}}function aa({isOpen:t,onClose:e,title:n,children:i,width:a="28rem"}){if(!t)return null;function l(){e()}return d.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0, 0, 0, 0.6)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1001,padding:"1rem"},onClick:l,children:d.jsxs("div",{style:{background:"#1a1a1a",color:"rgba(255, 255, 255, 0.87)",borderRadius:"12px",padding:"1.5rem",width:a,maxWidth:"calc(100vw - 2rem)",flexShrink:0,boxSizing:"border-box",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.5)"},onClick:c=>c.stopPropagation(),children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[d.jsx("h2",{style:{margin:0,fontSize:"1.25rem"},children:n}),d.jsx("button",{onClick:l,style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",fontSize:"1.5rem",opacity:.6,lineHeight:1},children:""})]}),i]})})}const RP=2e3,DP={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function jP(){const[t,e]=A.useState(!1),[n,i]=A.useState(""),[a,l]=A.useState("bug"),[c,h]=A.useState(!1),f=A.useContext(bu),_=ao().get_current_firebase_user(),b=jn(),{submitFeedback:v}=IT();if(A.useEffect(()=>{if(c){const w=setTimeout(()=>h(!1),RP);return()=>clearTimeout(w)}},[c]),b.pathname.includes("/admin/feedback")||!f.is_logged_in)return null;function E(w){w.preventDefault(),!(!n.trim()||!f.username||!_)&&(v.mutate({userId:_.uid,userEmail:f.username,text:n.trim(),feedbackType:a,currentPath:b.pathname}),i(""),l("bug"),e(!1),h(!0))}return d.jsxs(d.Fragment,{children:[c&&d.jsxs("div",{style:{position:"fixed",bottom:"5rem",right:"1.5rem",background:"rgba(46, 213, 115, 0.95)",color:"white",padding:"0.75rem 1rem",borderRadius:"0.5rem",fontSize:"0.9rem",fontWeight:500,boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1001,display:"flex",alignItems:"center",gap:"0.5rem",animation:"fadeInUp 0.2s ease-out"},children:[d.jsx("span",{children:""}),d.jsx("span",{children:"Feedback submitted!"})]}),d.jsx("button",{onClick:()=>{e(!0)},style:{position:"fixed",bottom:"1.5rem",right:"1.5rem",width:"3rem",height:"3rem",borderRadius:"50%",background:ce.primary,color:"white",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",transition:"transform 0.15s, box-shadow 0.15s",zIndex:1e3},title:"Send Feedback",onMouseEnter:w=>{w.currentTarget.style.transform="scale(1.1)",w.currentTarget.style.boxShadow="0 6px 16px rgba(0, 0, 0, 0.4)"},onMouseLeave:w=>{w.currentTarget.style.transform="scale(1)",w.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.3)"},children:""}),d.jsx(aa,{isOpen:t,onClose:()=>{e(!1),l("bug")},title:"Send Feedback",children:d.jsxs("form",{onSubmit:E,children:[d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(w=>{const D=DP[w],L=a===w;return d.jsxs("button",{type:"button",onClick:()=>{D.label,l(w)},style:{flex:1,padding:"0.6rem 0.5rem",border:`2px solid ${D.color}`,borderRadius:"0.5rem",background:L?D.bgColor:"transparent",color:L?D.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:L?600:400,fontSize:"0.8rem",transition:"all 0.15s ease",opacity:L?1:.5,boxShadow:L?`0 0 12px ${D.bgColor}`:"none",position:"relative"},children:[D.label,L&&d.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},w)})}),d.jsx(a_,{value:n,onChange:w=>i(w.target.value),placeholder:"Share your feedback, bug reports, or feature requests...",minHeight:"8rem",autoFocus:!0,required:!0}),d.jsxs(co,{children:[d.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Feedback",onClick:()=>{e(!1),l("bug")},children:"Cancel"}),d.jsx(Ie,{type:"submit",actionName:"Submit Feedback",disabled:!n.trim(),children:"Submit"})]})]})})]})}function Ls({children:t,labelStyle:e,...n}){return d.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:"0.75rem",flex:1,cursor:"pointer",...e},children:[d.jsx("input",{type:"checkbox",style:{width:"1.25rem",height:"1.25rem",marginTop:"0.1rem",cursor:"pointer",accentColor:ce.primary},...n}),t]})}function IP({title:t,count:e,children:n,defaultExpanded:i=!1}){const[a,l]=A.useState(i);return d.jsxs("div",{style:{marginTop:"2rem"},children:[d.jsxs("button",{onClick:()=>l(!a),style:{background:"transparent",border:"none",color:"inherit",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0",fontSize:"0.9rem",opacity:.7},children:[d.jsx("span",{style:{transition:"transform 0.2s",transform:a?"rotate(90deg)":"rotate(0deg)"},children:""}),t,e!==void 0&&` (${e})`]}),a&&n]})}const MP=t=>{switch(t){case 2:return 220;case 3:return 320;case 4:return 420;case 5:return 520;case 6:return 620;default:return t*100+20}},OP=t=>t<=4?2:t<=6?3:Math.ceil(t/2);function l_(t){const{tabs:e,activeTab:n}=t,i=e.filter(b=>!b.hidden),a=i.length,l=MP(a),c=OP(a),h=Math.floor(100/c),f=`tab-nav-${a}`,p=b=>({flex:"1 1 0",padding:"0.6rem 0.5rem",border:"none",borderRadius:0,background:"transparent",cursor:"pointer",fontWeight:b?600:400,fontSize:"0.9rem",color:"inherit",opacity:b?1:.5,transition:"all 0.15s",textDecoration:"none",display:"inline-flex",alignItems:"center",justifyContent:"center",gap:"0.25rem",position:"relative",boxSizing:"border-box",outline:"none"}),_=(b,v)=>d.jsxs(d.Fragment,{children:[d.jsx("span",{children:b.label}),b.checkmark&&d.jsx("span",{style:{color:ce.success,fontWeight:600},children:""}),v&&d.jsx("span",{style:{position:"absolute",bottom:"-1px",left:"15%",right:"15%",height:"3px",background:"white",borderRadius:"2px"}})]});return d.jsxs(d.Fragment,{children:[d.jsx("style",{children:`
        .${f} {
          display: flex;
          flex-wrap: wrap;
          margin-bottom: 1.5rem;
          border-bottom: 1px solid color-mix(in srgb, currentColor 15%, transparent);
        }
        .${f} > button,
        .${f} > a {
          border: none !important;
          border-radius: 0 !important;
          outline: none !important;
        }
        .${f} > button:hover,
        .${f} > button:focus,
        .${f} > a:hover,
        .${f} > a:focus {
          border: none !important;
          border-color: transparent !important;
        }
        @media (max-width: ${l}px) {
          .${f} > * {
            flex: 1 1 ${h}% !important;
            min-width: ${h}% !important;
          }
        }
      `}),d.jsx("div",{className:f,children:i.map(b=>{const v=n===b.id;return t.mode==="link"?d.jsx(Dt,{to:`${t.linkPrefix}/${b.id}`,onClick:()=>(`${b.label}`,void 0),style:p(v),children:_(b,v)},b.id):d.jsx("button",{onClick:()=>{`${b.label}`,t.onTabChange(b.id)},style:p(v),children:_(b,v)},b.id)})})]})}function c_({items:t}){const[e,n]=A.useState(!1),i=A.useRef(null),l=jn().pathname;A.useEffect(()=>{function h(f){i.current&&!i.current.contains(f.target)&&n(!1)}if(e)return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[e]),A.useEffect(()=>{function h(f){f.key==="Escape"&&n(!1)}if(e)return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[e]);const c=t.filter(h=>h.hidden?!1:h.to?h.to==="/budget"?!(l==="/budget"||/^\/budget\/\d{4}\/\d{1,2}\/\w+$/.test(l)):h.to==="/account"||h.to==="/"?l!==h.to:!l.startsWith(h.to):!0);return d.jsxs("div",{ref:i,style:{position:"relative"},children:[d.jsx("button",{onClick:()=>{n(!e)},style:{display:"flex",alignItems:"center",justifyContent:"center",width:"2.5rem",height:"2.5rem",borderRadius:"8px",background:e?"color-mix(in srgb, currentColor 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:"none",cursor:"pointer",fontSize:"1.25rem",color:"inherit",transition:"background 0.15s",lineHeight:1},title:"Menu","aria-expanded":e,"aria-haspopup":"true",children:""}),e&&d.jsx("div",{style:{position:"absolute",top:"100%",right:0,marginTop:"0.5rem",minWidth:"180px",background:"#1a1a2e",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",zIndex:1e3,overflow:"hidden"},children:c.map((h,f)=>{if(h.divider)return d.jsx("div",{style:{height:"1px",background:"color-mix(in srgb, currentColor 15%, transparent)",margin:"0.25rem 0"}},f);const p=d.jsxs(d.Fragment,{children:[h.icon&&d.jsx("span",{style:{width:"1.5rem",textAlign:"center"},children:h.icon}),d.jsx("span",{children:h.label})]}),_={display:"flex",alignItems:"center",gap:"0.75rem",padding:"0.75rem 1rem",fontSize:"0.95rem",color:"inherit",textDecoration:"none",cursor:"pointer",transition:"background 0.15s",background:"transparent",border:"none",width:"100%",textAlign:"left"},b={background:"color-mix(in srgb, currentColor 10%, transparent)"};return h.to?d.jsx(Dt,{to:h.to,style:_,onMouseEnter:v=>Object.assign(v.currentTarget.style,b),onMouseLeave:v=>v.currentTarget.style.background="transparent",onClick:()=>{`${h.label}`,n(!1)},children:p},f):d.jsx("button",{onClick:()=>{`${h.label}`,h.onClick?.(),n(!1)},style:_,onMouseEnter:v=>Object.assign(v.currentTarget.style,b),onMouseLeave:v=>v.currentTarget.style.background="transparent",children:p},f)})})]})}function kP({title:t,showBackArrow:e=!1,hideMenu:n=!1}){const{isAdmin:i}=zt(),a=jn(),c=[...a.pathname==="/budget"||a.pathname.startsWith("/budget/")&&!a.pathname.startsWith("/budget/settings")&&!a.pathname.startsWith("/budget/admin")&&!a.pathname.startsWith("/budget/analytics")&&!a.pathname.startsWith("/budget/my-budgets")?[]:[{label:"Budget",icon:"",to:"/budget"}],{label:"Budget Settings",icon:"",to:"/budget/settings"},{label:"Analytics",icon:"",to:"/budget/analytics"},...i?[{label:"Admin",icon:"",to:"/budget/admin"}]:[],{label:"Switch Budgets",icon:"",to:"/budget/my-budgets"},{divider:!0,label:""},{label:"Exit Budget App",icon:"",to:"/"}];return d.jsxs("nav",{style:{marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[d.jsx("div",{style:{flex:"0 0 auto"},children:e?d.jsx(Dt,{to:"/",onClick:()=>void 0,style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none"},title:"Back to Home",children:""}):d.jsx(Dt,{to:"/budget",onClick:()=>void 0,title:"Budget Home",children:d.jsx("img",{src:"/budget-icon.svg",alt:"Budget",style:{width:"1.5rem",height:"1.5rem"}})})}),d.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem",textAlign:"center",flex:"1 1 auto"},children:t}),d.jsx("div",{style:{flex:"0 0 auto"},children:n?d.jsx("div",{style:{width:"1.5rem"}}):d.jsx(c_,{items:c})})]})}function MT({children:t,style:e}){return d.jsx("div",{style:{width:"100%",maxWidth:"var(--content-max-width, 900px)",marginLeft:"auto",marginRight:"auto",...e},children:t})}function Zg(t){return new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"2-digit"})}function NP(){return d.jsxs("div",{style:mu,children:[d.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsx(Dt,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),d.jsxs(Dt,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[d.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),d.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"SQL Test"})]}),d.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:d.jsx(c_,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),d.jsx("h1",{children:"SQL Test"}),d.jsx("h2",{children:"Setup"}),d.jsxs("h3",{children:["1. Open up your preferred web browser to ",d.jsx("a",{href:"https://www.programiz.com/sql/online-compiler/",target:"_blank",rel:"noopener noreferrer",children:"https://www.programiz.com/sql/online-compiler/"})]}),d.jsxs("ul",{children:[d.jsx("li",{children:"This is a basic online sql query editor"}),d.jsxs("li",{children:["It will include three tables: ",d.jsx("b",{children:'"Customer"'}),", ",d.jsx("b",{children:'"Orders"'}),", and ",d.jsx("b",{children:'"Shippings"'})]})]}),d.jsx("h3",{children:"2. Run the below query block inside the online editor to make some updates to the schema."}),d.jsx("pre",{style:{backgroundColor:"#1a1a1a",padding:"1rem",borderRadius:"8px",overflow:"auto"},children:d.jsx("code",{children:`ALTER TABLE shippings
ADD order_id INT;

UPDATE shippings
SET order_id = CASE
  WHEN shipping_id = 1 THEN 5
    WHEN shipping_id = 2 THEN 1
    WHEN shipping_id = 3 THEN 3
    WHEN shipping_id = 4 THEN 6
    WHEN shipping_id = 5 THEN 4
END
WHERE shipping_id IN (1,2,3,4,5);

INSERT INTO shippings (shipping_id, status, customer, order_id)
VALUES (6, "Cancelled", 4, 2);

INSERT INTO orders (order_id, item, amount, customer_id)
VALUES (6, "Monitor", 800, 5);`})}),d.jsx("h2",{children:"SQL Problems"}),d.jsx("p",{children:"Write queries in the online editor to answer these questions."}),d.jsx("h3",{children:"Question #1"}),d.jsx("p",{children:'Calculate the total number of orders, the total $ amount, and the total items "delivered" by Country. Show the following columns: country, order count, total $ amount, and total delivered. Order by total $ amount largest to smallest.'}),d.jsx("h3",{children:"Question #2"}),d.jsx("p",{children:"Find the customers who have placed orders with the HIGHEST total amount for each country. One record per country. Display the customer's first name, last name, country, and the corresponding highest total order amount. Also include the shipping status of the associated order."})]})}function PP(){const t=A.useContext(bu),e=ao(),[n,i]=A.useState(!1),a=jn(),l=yu(),c=a.state?.from||"/";A.useEffect(()=>{t.is_logged_in&&c!=="/"&&l(c,{replace:!0})},[t.is_logged_in,c,l]);function h(){i(!0),e.logout_firebase_user().then(function(){i(!1)})}return d.jsxs("div",{style:mu,children:[d.jsxs("nav",{style:{marginBottom:"1rem",display:"grid",gridTemplateColumns:"1fr auto 1fr",alignItems:"center"},children:[d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsx(Dt,{to:"/",style:{opacity:.6,fontSize:"1.5rem",textDecoration:"none",padding:"0.25rem 0.5rem"},title:"Back to Home",children:""})}),d.jsxs(Dt,{to:"/",style:{display:"flex",alignItems:"center",gap:"0.5rem",textDecoration:"none",color:"inherit"},title:"Tarron Lane Home",children:[d.jsx("img",{src:"/t-icon.svg",alt:"Tarron Lane",style:{width:"1.5rem",height:"1.5rem"}}),d.jsx("span",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Account"})]}),d.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:d.jsx(c_,{items:[{label:"Budget",icon:"",to:"/budget"},{label:"Account",icon:"",to:"/account"}]})})]}),d.jsx("h1",{children:"Account"}),t.is_logged_in?n?d.jsx("p",{children:"Logging Out..."}):d.jsxs(d.Fragment,{children:[d.jsxs("p",{children:["You are logged in as ",t.username]}),d.jsx("button",{onClick:h,style:{marginTop:"1rem"},children:"Logout"})]}):d.jsx(LP,{})]})}function LP(){const t=ao(),[e,n]=A.useState(""),[i,a]=A.useState(""),[l,c]=A.useState(!1),[h,f]=A.useState("");function p(v){n(v.target.value)}function _(v){a(v.target.value)}function b(v){v.preventDefault(),c(!0),f(""),t.login_firebase_user(e,i).then(function(){}).catch(function(){f("Incorrect login credentials")}).finally(function(){c(!1)})}return d.jsxs("form",{onSubmit:b,children:[d.jsxs("div",{children:[d.jsx("label",{htmlFor:"username",children:"Email: "}),d.jsx("input",{id:"username",type:"email",value:e,onChange:p})]}),d.jsxs("div",{children:[d.jsx("label",{htmlFor:"password",children:"Password: "}),d.jsx("input",{id:"password",type:"password",value:i,onChange:_})]}),l?d.jsx("p",{children:"Logging in..."}):d.jsx("button",{children:"Login"}),h&&d.jsx("p",{style:{color:"red"},children:h})]})}function BP(){const[t,e]=A.useState(()=>typeof window>"u"?1200:window.innerWidth);return A.useEffect(()=>{function n(){e(window.innerWidth)}return window.addEventListener("resize",n),n(),()=>window.removeEventListener("resize",n)},[]),{width:t,isWide:t>=Fa.wide,isMedium:t>=Fa.tablet&&t<Fa.wide,isNarrowMedium:t>=Fa.mobile&&t<Fa.tablet,isMobile:t<Fa.mobile}}function VP(){const t=cn();return{updateAccounts:dr({mutationFn:async({budgetId:n,accounts:i})=>{const{exists:a,data:l}=await Le("budgets",n,"PRE-EDIT-READ");if(!a||!l)throw new Error("Budget not found");return await ut("budgets",n,{...l,accounts:i},"saving updated accounts (user edited account settings)"),i},onMutate:async({budgetId:n,accounts:i})=>{await t.cancelQueries({queryKey:xe.budget(n)});const a=t.getQueryData(xe.budget(n));return a&&t.setQueryData(xe.budget(n),{...a,accounts:i}),{previousData:a}},onSuccess:(n,{budgetId:i})=>{const a=t.getQueryData(xe.budget(i));a&&t.setQueryData(xe.budget(i),{...a,accounts:n})},onError:(n,{budgetId:i},a)=>{a?.previousData&&t.setQueryData(xe.budget(i),a.previousData)}})}}function UP(t){const e={};return Object.entries(t).forEach(([n,i])=>{e[n]={name:i.name,sort_order:i.sort_order},i.expected_balance!==void 0&&(e[n].expected_balance=i.expected_balance),i.on_budget!==void 0&&(e[n].on_budget=i.on_budget),i.is_active!==void 0&&(e[n].is_active=i.is_active)}),e}function zP(){const t=cn();return{updateAccountGroups:dr({mutationFn:async({budgetId:n,accountGroups:i})=>{const{exists:a,data:l}=await Le("budgets",n,"PRE-EDIT-READ");if(!a||!l)throw new Error("Budget not found");const c=UP(i);return await ut("budgets",n,{...l,account_groups:c},"saving updated account groups (user edited group settings)"),i},onMutate:async({budgetId:n,accountGroups:i})=>{await t.cancelQueries({queryKey:xe.budget(n)});const a=t.getQueryData(xe.budget(n));return a&&t.setQueryData(xe.budget(n),{...a,accountGroups:i}),{previousData:a}},onSuccess:(n,{budgetId:i})=>{const a=t.getQueryData(xe.budget(i));a&&t.setQueryData(xe.budget(i),{...a,accountGroups:n})},onError:(n,{budgetId:i},a)=>{a?.previousData&&t.setQueryData(xe.budget(i),a.previousData)}})}}function FP(t){const e={};return Object.entries(t).forEach(([n,i])=>{e[n]={name:i.name,category_group_id:i.category_group_id??null,sort_order:i.sort_order,balance:i.balance??0},i.description!==void 0&&(e[n].description=i.description),i.default_monthly_amount!==void 0&&(e[n].default_monthly_amount=i.default_monthly_amount),i.default_monthly_type!==void 0&&(e[n].default_monthly_type=i.default_monthly_type)}),e}function qP(){const t=cn();return{updateCategories:dr({mutationFn:async({budgetId:n,categories:i})=>{const{exists:a,data:l}=await Le("budgets",n,"PRE-EDIT-READ");if(!a||!l)throw new Error("Budget not found");const c=FP(i);return await ut("budgets",n,{...l,categories:c},"saving updated categories (user edited category settings)"),i},onMutate:async({budgetId:n,categories:i})=>{await t.cancelQueries({queryKey:xe.budget(n)});const a=t.getQueryData(xe.budget(n));return a&&t.setQueryData(xe.budget(n),{...a,categories:i}),{previousData:a}},onSuccess:(n,{budgetId:i})=>{const a=t.getQueryData(xe.budget(i));a&&t.setQueryData(xe.budget(i),{...a,categories:n})},onError:(n,{budgetId:i},a)=>{a?.previousData&&t.setQueryData(xe.budget(i),a.previousData)}})}}function HP(){const t=cn();return{updateCategoryGroups:dr({mutationFn:async({budgetId:n,categoryGroups:i})=>{const{exists:a,data:l}=await Le("budgets",n,"PRE-EDIT-READ");if(!a||!l)throw new Error("Budget not found");return await ut("budgets",n,{...l,category_groups:i},"saving updated category groups (user edited group settings)"),i},onMutate:async({budgetId:n,categoryGroups:i})=>{await t.cancelQueries({queryKey:xe.budget(n)});const a=t.getQueryData(xe.budget(n));return a&&t.setQueryData(xe.budget(n),{...a,categoryGroups:i}),{previousData:a}},onSuccess:(n,{budgetId:i})=>{const a=t.getQueryData(xe.budget(i));a&&t.setQueryData(xe.budget(i),{...a,categoryGroups:n})},onError:(n,{budgetId:i},a)=>{a?.previousData&&t.setQueryData(xe.budget(i),a.previousData)}})}}function GP(){const t=cn();return{renameBudget:dr({mutationFn:async({budgetId:n,newName:i})=>{const{exists:a,data:l}=await Le("budgets",n,"PRE-EDIT-READ");if(!a||!l)throw new Error("Budget not found");return await ut("budgets",n,{...l,name:i.trim()},`renaming budget to "${i.trim()}"`),i.trim()},onMutate:async({budgetId:n,newName:i})=>{await t.cancelQueries({queryKey:xe.budget(n)});const a=t.getQueryData(xe.budget(n));return a&&t.setQueryData(xe.budget(n),{...a,budget:{...a.budget,name:i.trim()}}),{previousData:a}},onSuccess:(n,{budgetId:i})=>{const a=t.getQueryData(xe.budget(i));a&&t.setQueryData(xe.budget(i),{...a,budget:{...a.budget,name:n}})},onError:(n,{budgetId:i},a)=>{a?.previousData&&t.setQueryData(xe.budget(i),a.previousData)}})}}function $P(){const t=cn();return{createBudget:dr({mutationFn:async({name:n,userId:i,userEmail:a})=>{const l=`budget_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,c=new Date().toISOString(),h={name:n.trim()||"My Budget",user_ids:[i],accepted_user_ids:[i],owner_id:i,owner_email:a,accounts:{},account_groups:{},categories:{},category_groups:[],created_at:c,updated_at:c};await ut("budgets",l,h,"creating new budget document");const{exists:f,data:p}=await Le("users",i,"reading user document to add new budget to their list");return f&&p?await ut("users",i,{...p,budget_ids:[l,...p.budget_ids],updated_at:c},"adding new budget to user's budget list"):await ut("users",i,{uid:i,email:a,budget_ids:[l],created_at:c,updated_at:c},"creating new user document with first budget"),{budgetId:l,budget:{id:l,...h}}},onSuccess:(n,{userId:i})=>{t.invalidateQueries({queryKey:xe.user(i)}),t.invalidateQueries({queryKey:xe.accessibleBudgets(i)})}})}}function QP(){const t=cn();return{acceptInvite:dr({mutationFn:async({budgetId:n,userId:i})=>{const a=new Date().toISOString(),{exists:l,data:c}=await Le("budgets",n,"verifying user was invited to this budget");if(!l||!c)throw new Error("Budget not found");if(!c.user_ids?.includes(i))throw new Error("You have not been invited to this budget");const{data:h}=await Le("users",i,"PRE-EDIT-READ");if(h?.budget_ids?.includes(n))throw new Error("You have already accepted this invite");return await ut("users",i,{...h||{uid:i,email:null},budget_ids:[n,...h?.budget_ids||[]],updated_at:a},"adding accepted budget to user's budget list"),await ut("budgets",n,{...c,accepted_user_ids:[...c.accepted_user_ids||[],i]},"marking user as accepted in budget's accepted_user_ids"),{budgetId:n}},onSuccess:(n,{userId:i})=>{t.invalidateQueries({queryKey:xe.user(i)}),t.invalidateQueries({queryKey:xe.accessibleBudgets(i)}),t.invalidateQueries({queryKey:xe.budget(n.budgetId)})}})}}function WP(){const t=cn();return{inviteUser:dr({mutationFn:async({budgetId:n,userId:i})=>{const{exists:a,data:l}=await Le("budgets",n,"PRE-EDIT-READ");if(!a||!l)throw new Error("Budget not found");if(l.user_ids?.includes(i))throw new Error("User is already invited");return await ut("budgets",n,{...l,user_ids:[...l.user_ids||[],i]},"adding user to budget's invited users list"),{budgetId:n}},onMutate:async({budgetId:n,userId:i})=>{await t.cancelQueries({queryKey:xe.budget(n)});const a=t.getQueryData(xe.budget(n));return a&&t.setQueryData(xe.budget(n),{...a,budget:{...a.budget,user_ids:[...a.budget.user_ids,i]}}),{previousData:a}},onSuccess:(n,{budgetId:i})=>{const a=t.getQueryData(xe.budget(i));a&&t.setQueryData(xe.budget(i),a)},onError:(n,{budgetId:i},a)=>{a?.previousData&&t.setQueryData(xe.budget(i),a.previousData)}})}}function KP(){const t=cn();return{revokeUser:dr({mutationFn:async({budgetId:n,userId:i})=>{const{exists:a,data:l}=await Le("budgets",n,"PRE-EDIT-READ");if(!a||!l)throw new Error("Budget not found");return await ut("budgets",n,{...l,user_ids:(l.user_ids||[]).filter(c=>c!==i),accepted_user_ids:(l.accepted_user_ids||[]).filter(c=>c!==i)},"removing user from budget's access lists"),{budgetId:n}},onMutate:async({budgetId:n,userId:i})=>{await t.cancelQueries({queryKey:xe.budget(n)});const a=t.getQueryData(xe.budget(n));return a&&t.setQueryData(xe.budget(n),{...a,budget:{...a.budget,user_ids:a.budget.user_ids.filter(l=>l!==i),accepted_user_ids:a.budget.accepted_user_ids.filter(l=>l!==i)}}),{previousData:a}},onSuccess:(n,{budgetId:i})=>{const a=t.getQueryData(xe.budget(i));a&&t.setQueryData(xe.budget(i),a)},onError:(n,{budgetId:i},a)=>{a?.previousData&&t.setQueryData(xe.budget(i),a.previousData)}})}}function Pn(t,e){const n=P1(t),{updateAccounts:i}=VP(),{updateAccountGroups:a}=zP(),{updateCategories:l}=qP(),{updateCategoryGroups:c}=HP(),{renameBudget:h}=GP(),{createBudget:f}=$P(),{acceptInvite:p}=QP(),{inviteUser:_}=WP(),{revokeUser:b}=KP(),v=n.data,T=v?.budget||null,E=A.useMemo(()=>v?.accounts||{},[v?.accounts]),w=A.useMemo(()=>v?.accountGroups||{},[v?.accountGroups]),D=A.useMemo(()=>v?.categories||{},[v?.categories]),L=A.useMemo(()=>v?.categoryGroups||[],[v?.categoryGroups]),q=T?.owner_id===e,B=A.useMemo(()=>T?.user_ids||[],[T?.user_ids]),ee=A.useMemo(()=>T?.accepted_user_ids||[],[T?.accepted_user_ids]),Q=T?.total_available??0,J=A.useMemo(()=>v?.monthMap||{},[v?.monthMap]),O=A.useCallback(async X=>{if(!t)throw new Error("No budget selected");await i.mutateAsync({budgetId:t,accounts:X})},[t,i]),R=A.useCallback(async X=>{if(!t)throw new Error("No budget selected");await a.mutateAsync({budgetId:t,accountGroups:X})},[t,a]),j=A.useCallback(async X=>{if(!t)throw new Error("No budget selected");await l.mutateAsync({budgetId:t,categories:X})},[t,l]),I=A.useCallback(async X=>{if(!t)throw new Error("No budget selected");await c.mutateAsync({budgetId:t,categoryGroups:X})},[t,c]),M=A.useCallback(async(X,re)=>{if(!t)throw new Error("No budget selected");await Promise.all([i.mutateAsync({budgetId:t,accounts:X}),a.mutateAsync({budgetId:t,accountGroups:re})])},[t,i,a]),F=A.useCallback(async(X,re)=>{if(!t)throw new Error("No budget selected");await Promise.all([l.mutateAsync({budgetId:t,categories:X}),c.mutateAsync({budgetId:t,categoryGroups:re})])},[t,l,c]),k=A.useCallback(async X=>{if(!t)throw new Error("No budget selected");await h.mutateAsync({budgetId:t,newName:X})},[t,h]),Y=A.useCallback(async X=>{if(!e)throw new Error("Not authenticated");return await f.mutateAsync({name:X.trim()||"My Budget",userId:e,userEmail:null})},[e,f]),H=A.useCallback(async X=>{if(!t)throw new Error("No budget selected");await _.mutateAsync({budgetId:t,userId:X})},[t,_]),N=A.useCallback(async X=>{if(!t)throw new Error("No budget selected");await b.mutateAsync({budgetId:t,userId:X})},[t,b]),G=A.useCallback(async X=>{if(!e)throw new Error("Not authenticated");await p.mutateAsync({budgetId:X,userId:e})},[e,p]),W=A.useCallback(X=>{if(!t)return;const re=$e.getQueryData(xe.budget(t));re&&$e.setQueryData(xe.budget(t),{...re,accounts:X})},[t]),ne=A.useCallback(X=>{if(!t)return;const re=$e.getQueryData(xe.budget(t));re&&$e.setQueryData(xe.budget(t),{...re,accountGroups:X})},[t]),ie=A.useCallback(X=>{if(!t)return;const re=$e.getQueryData(xe.budget(t));re&&$e.setQueryData(xe.budget(t),{...re,categories:X})},[t]),V=A.useCallback(X=>{if(!t)return;const re=$e.getQueryData(xe.budget(t));re&&$e.setQueryData(xe.budget(t),{...re,categoryGroups:X})},[t]),z=A.useCallback(async()=>{t&&await $e.invalidateQueries({queryKey:xe.budget(t)})},[t]),$=A.useCallback(()=>Object.entries(E).filter(([,X])=>{const re=X.account_group_id?w[X.account_group_id]:void 0,ue=re?.on_budget!==void 0?re.on_budget:X.on_budget!==!1,he=re?.is_active!==void 0?re.is_active:X.is_active!==!1;return ue&&he}).reduce((X,[,re])=>X+re.balance,0),[E,w]);return{isLoading:n.isLoading,isFetching:n.isFetching,error:n.error,budget:T,accounts:E,accountGroups:w,categories:D,categoryGroups:L,isOwner:q,budgetUserIds:B,acceptedUserIds:ee,totalAvailable:Q,monthMap:J,saveAccounts:O,saveAccountGroups:R,saveCategories:j,saveCategoryGroups:I,saveAccountsAndGroups:M,saveCategoriesAndGroups:F,renameBudget:k,createBudget:Y,inviteUser:H,revokeUser:N,acceptInvite:G,setAccountsOptimistic:W,setAccountGroupsOptimistic:ne,setCategoriesOptimistic:ie,setCategoryGroupsOptimistic:V,refreshBudget:z,getOnBudgetTotal:$}}function uo(t,e,n){const{addLoadingHold:i,removeLoadingHold:a}=Qn(),l=pk(t,e,n,{enabled:!!t});A.useEffect(()=>(l.isLoading?i("month-query","Loading month data..."):a("month-query"),()=>a("month-query")),[l.isLoading,i,a]);const{addIncome:c}=kk(),{updateIncome:h}=Nk(),{deleteIncome:f}=Pk(),{addExpense:p}=Lk(),{updateExpense:_}=Bk(),{deleteExpense:b}=Vk(),v=l.data?.month||null,T=v?.income||[],E=v?.expenses||[],w=v?.category_balances||[],D=v?.total_income||0,L=v?.total_expenses||0,q=v?.are_allocations_finalized||!1,B=v?.previous_month_income??0,ee=A.useCallback(async(M,F,k,Y,H)=>{if(!t)throw new Error("No budget selected");const[N,G]=k.split("-").map(Number);await c(t,N,G,M,F,k,Y,H)},[t,c]),Q=A.useCallback(async(M,F,k,Y,H,N)=>{if(!t)throw new Error("No budget selected");await h(t,e,n,M,F,k,Y,H,N)},[t,e,n,h]),J=A.useCallback(async M=>{if(!t)throw new Error("No budget selected");await f(t,e,n,M)},[t,e,n,f]),O=A.useCallback(async(M,F,k,Y,H,N,G)=>{if(!t)throw new Error("No budget selected");const[W,ne]=Y.split("-").map(Number);await p(t,W,ne,M,F,k,Y,H,N,G)},[t,p]),R=A.useCallback(async(M,F,k,Y,H,N,G,W)=>{if(!t)throw new Error("No budget selected");await _(t,e,n,M,F,k,Y,H,N,G,W)},[t,e,n,_]),j=A.useCallback(async M=>{if(!t)throw new Error("No budget selected");await b(t,e,n,M)},[t,e,n,b]),I=A.useCallback(async()=>{t&&await $e.invalidateQueries({queryKey:xe.month(t,e,n)})},[t,e,n]);return{isLoading:l.isLoading,isFetching:l.isFetching,error:l.error,month:v,income:T,expenses:E,categoryBalances:w,totalIncome:D,totalExpenses:L,areAllocationsFinalized:q,previousMonthIncome:B,addIncome:ee,updateIncome:Q,deleteIncome:J,addExpense:O,updateExpense:R,deleteExpense:j,refreshMonth:I}}function YP(){const{selectedBudgetId:t,currentUserId:e}=zt(),{budget:n,accounts:i,accountGroups:a,saveAccounts:l,saveAccountGroups:c,saveAccountsAndGroups:h,setAccountsOptimistic:f,setAccountGroupsOptimistic:p}=Pn(t,e),[_,b]=A.useState(null),v=A.useMemo(()=>Object.entries(i).reduce((R,[j,I])=>{const M=I.account_group_id||"ungrouped";return R[M]||(R[M]=[]),R[M].push({...I,id:j}),R},{}),[i]),T=A.useMemo(()=>Object.entries(a).sort(([,R],[,j])=>R.sort_order-j.sort_order).map(([R,j])=>({...j,id:R})),[a]),E=A.useCallback((R,j)=>{if(!n)return;const I=Object.values(i).filter(H=>j==="ungrouped"?!H.account_group_id:H.account_group_id===j),M=I.length>0?Math.max(...I.map(H=>H.sort_order)):-1,F=`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,k={nickname:R.nickname,description:"",balance:0,account_group_id:j==="ungrouped"?null:j,sort_order:M+1,is_income_account:R.is_income_account??!1,is_income_default:R.is_income_default??!1,is_outgo_account:R.is_outgo_account??!1,is_outgo_default:R.is_outgo_default??!1,on_budget:R.on_budget!==!1,is_active:R.is_active!==!1},Y={...i};R.is_income_default&&Object.keys(Y).forEach(H=>{Y[H]={...Y[H],is_income_default:!1}}),R.is_outgo_default&&Object.keys(Y).forEach(H=>{Y[H]={...Y[H],is_outgo_default:!1}}),Y[F]=k,f(Y),l(Y).catch(H=>{console.error("[useAccountHandlers] Error creating account:",H),b(H instanceof Error?H.message:"Failed to create account.")})},[n,i,f,l]),w=A.useCallback((R,j)=>{if(!n)return;const I=i[R];if(!I)return;const M=I.account_group_id||"ungrouped",F=j.account_group_id;let k=I.sort_order;if(M!==(F||"ungrouped")){const H=Object.values(i).filter(N=>(N.account_group_id||"ungrouped")===(F||"ungrouped"));k=H.length>0?Math.max(...H.map(N=>N.sort_order))+1:0}const Y={};Object.entries(i).forEach(([H,N])=>{H===R?Y[H]={...N,nickname:j.nickname,account_group_id:F,sort_order:k,is_income_account:j.is_income_account??!1,is_income_default:j.is_income_default??!1,is_outgo_account:j.is_outgo_account??!1,is_outgo_default:j.is_outgo_default??!1,on_budget:j.on_budget!==!1,is_active:j.is_active!==!1}:(Y[H]={...N},j.is_income_default&&!I.is_income_default&&(Y[H].is_income_default=!1),j.is_outgo_default&&!I.is_outgo_default&&(Y[H].is_outgo_default=!1))}),f(Y),l(Y).catch(H=>{console.error("[useAccountHandlers] Error saving account:",H),b(H instanceof Error?H.message:"Failed to save account.")})},[n,i,f,l]),D=A.useCallback(R=>{if(!confirm("Are you sure you want to delete this account?")||!n)return;const{[R]:j,...I}=i;f(I),l(I).catch(M=>{console.error("[useAccountHandlers] Error deleting account:",M),b(M instanceof Error?M.message:"Failed to delete account.")})},[n,i,f,l]),L=A.useCallback(async(R,j)=>{const I=i[R];if(!I)return;const M=I.account_group_id||"ungrouped",F=Object.entries(i).filter(([,W])=>(W.account_group_id||"ungrouped")===M).sort(([,W],[,ne])=>W.sort_order-ne.sort_order),k=F.findIndex(([W])=>W===R),Y=j==="up"?k-1:k+1;if(Y<0||Y>=F.length)return;const[H,N]=F[Y],G={};if(Object.entries(i).forEach(([W,ne])=>{W===R?G[W]={...ne,sort_order:N.sort_order}:W===H?G[W]={...ne,sort_order:I.sort_order}:G[W]={...ne}}),f(G),!!n)try{await l(G)}catch(W){f(i),b(W instanceof Error?W.message:"Failed to move account")}},[n,i,f,l]),q=A.useCallback(R=>{if(!n)return;const j=Object.values(a).map(Y=>Y.sort_order),I=j.length>0?Math.max(...j):-1,M=`account_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,F={name:R.name,sort_order:I+1,expected_balance:R.expected_balance,on_budget:R.on_budget,is_active:R.is_active},k={...a,[M]:F};p(k),c(k).catch(Y=>{console.error("[useAccountHandlers] Error creating group:",Y),b(Y instanceof Error?Y.message:"Failed to create account type.")})},[n,a,p,c]),B=A.useCallback((R,j)=>{if(!n)return;const I={...a,[R]:{...a[R],name:j.name,expected_balance:j.expected_balance,on_budget:j.on_budget,is_active:j.is_active}};p(I),c(I).catch(M=>{console.error("[useAccountHandlers] Error updating group:",M),b(M instanceof Error?M.message:"Failed to update account type.")})},[n,a,p,c]),ee=A.useCallback(R=>{if(!confirm("Are you sure you want to delete this account type? Accounts in this type will move to Ungrouped.")||!n)return;const j={};Object.entries(i).forEach(([F,k])=>{j[F]=k.account_group_id===R?{...k,account_group_id:null}:k});const{[R]:I,...M}=a;f(j),p(M),h(j,M).catch(F=>{console.error("[useAccountHandlers] Error deleting group:",F),b(F instanceof Error?F.message:"Failed to delete account type.")})},[n,i,a,f,p,h]),Q=A.useCallback(async(R,j)=>{const I=Object.entries(a).sort(([,H],[,N])=>H.sort_order-N.sort_order),M=I.findIndex(([H])=>H===R),F=j==="up"?M-1:M+1;if(F<0||F>=I.length)return;const[k]=I.splice(M,1);I.splice(F,0,k);const Y={};if(I.forEach(([H,N],G)=>{Y[H]={...N,sort_order:G}}),p(Y),!!n)try{await c(Y)}catch(H){p(a),b(H instanceof Error?H.message:"Failed to move account type")}},[n,a,p,c]),J=A.useCallback(async(R,j,I)=>{const M=i[R];if(!M)return;const F=I==="ungrouped"?null:I,k=Object.entries(i).filter(([,N])=>(N.account_group_id||"ungrouped")===I),Y={};Object.entries(i).forEach(([N,G])=>{N!==R&&(Y[N]={...G})});let H;if(j==="__group_end__"||k.length===0||!k.find(([N])=>N===j))H=(k.length>0?Math.max(...k.filter(([G])=>G!==R).map(([,G])=>G.sort_order)):-1)+1;else{const N=k.find(([G])=>G===j);if(N){const[,G]=N;H=G.sort_order,Object.entries(Y).forEach(([W,ne])=>{(ne.account_group_id||"ungrouped")===I&&ne.sort_order>=H&&(Y[W]={...ne,sort_order:ne.sort_order+1})})}else H=0}if(Y[R]={...M,account_group_id:F,sort_order:H},f(Y),!!n)try{await l(Y)}catch(N){b(N instanceof Error?N.message:"Failed to save changes")}},[n,i,f,l]),O=A.useCallback(async(R,j)=>{if(R===j)return;const I=Object.entries(a).sort(([,H],[,N])=>H.sort_order-N.sort_order),M=I.findIndex(([H])=>H===R),F=[...I],[k]=F.splice(M,1);if(j==="__end__")F.push(k);else{const H=F.findIndex(([N])=>N===j);F.splice(H,0,k)}const Y={};if(F.forEach(([H,N],G)=>{Y[H]={...N,sort_order:G}}),p(Y),!!n)try{await c(Y)}catch(H){b(H instanceof Error?H.message:"Failed to save new order")}},[n,a,p,c]);return{accounts:i,accountGroups:a,accountsByGroup:v,sortedGroups:T,currentBudget:n,error:_,setError:b,handleCreateAccount:E,handleUpdateAccount:w,handleDeleteAccount:D,handleMoveAccount:L,handleCreateGroup:q,handleUpdateGroup:B,handleDeleteGroup:ee,handleMoveGroup:Q,reorderAccountsInGroup:J,reorderGroups:O}}function zS(t,e){if(!t)return{};const n={};return Object.entries(e).forEach(([i,a])=>{if(a.default_monthly_type==="percentage")return;const l=t.category_balances?.find(c=>c.category_id===i);l&&l.allocated>0?n[i]=l.allocated.toString():a.default_monthly_amount!==void 0&&a.default_monthly_amount>0?n[i]=a.default_monthly_amount.toString():n[i]=""}),n}function XP(){const{addLoadingHold:t,removeLoadingHold:e}=Qn(),{selectedBudgetId:n,currentUserId:i,currentYear:a,currentMonthNumber:l}=zt(),{categories:c,getOnBudgetTotal:h,totalAvailable:f}=Pn(n,i),{month:p,isLoading:_,previousMonthIncome:b,areAllocationsFinalized:v}=uo(n,a,l),T=A.useMemo(()=>p?.income?p.income.reduce((z,$)=>z+$.amount,0):0,[p]),{saveDraftAllocations:E}=Dk(),{finalizeAllocations:w}=jk(),{deleteAllocations:D}=G1(),L=A.useMemo(()=>zS(p,c),[p,c]),[q,B]=A.useState(L),[ee,Q]=A.useState(!1),[J,O]=A.useState(null),R=A.useRef(null);A.useMemo(()=>Object.values(c).reduce((z,$)=>z+($.balance??0),0),[c]),A.useEffect(()=>{if(!p)return;const z=`${p.year}-${p.month}`;R.current!==z&&(Q(!1),B(zS(p,c)),R.current=z)},[p,c]);const j=A.useCallback((z,$)=>{if($.default_monthly_type==="percentage"&&$.default_monthly_amount!==void 0)return $.default_monthly_amount/100*b;const X=q[z],re=parseFloat(X||"0");return isNaN(re)?0:re},[q,b]),I=A.useMemo(()=>Object.entries(c).reduce((z,[$,X])=>{const re=j($,X),ue=X.balance??0;if(ue<0){const he=Math.abs(ue),Se=Math.max(0,re-he);return z+Se}return z+re},0),[c,j]),M=h(),F=v?(p?.category_balances||[]).reduce((z,$)=>{const X=c[$.category_id]?.balance??0,re=$.allocated,ue=X-re;if(ue<0){const he=Math.abs(ue);return z+Math.max(0,re-he)}return z+re},0):0,k=ee?f+F:f,Y=A.useMemo(()=>ee?k-I:k-I+F,[k,I,F,ee]),H=A.useCallback((z,$)=>{B(X=>({...X,[z]:$}))},[]),N=A.useCallback(()=>{if(!p)return;const z={};Object.entries(c).forEach(([$,X])=>{if(X.default_monthly_type==="percentage")return;const re=p.category_balances?.find(ue=>ue.category_id===$);re&&re.allocated>0?z[$]=re.allocated.toString():X.default_monthly_amount!==void 0&&X.default_monthly_amount>0?z[$]=X.default_monthly_amount.toString():z[$]=""}),B(z),Q(!1)},[p,c]),G=A.useCallback(()=>{const z={};return Object.entries(c).forEach(([$,X])=>{const re=j($,X);re>0&&(z[$]=re)}),z},[c,j]),W=A.useCallback(async()=>{if(n){O(null),t("allocations-save","Saving allocations...");try{await E(n,a,l,G()),Q(!1)}catch(z){O(z instanceof Error?z.message:"Failed to save allocations")}finally{e("allocations-save")}}},[n,a,l,E,G,t,e]),ne=A.useCallback(async()=>{if(n){O(null),t("allocations-finalize","Applying allocations...");try{await w({budgetId:n,year:a,month:l,allocations:G(),onProgress:z=>{t("allocations-finalize",z.message)}}),Q(!1)}catch(z){O(z instanceof Error?z.message:"Failed to finalize allocations")}finally{e("allocations-finalize")}}},[n,a,l,w,G,t,e]),ie=A.useCallback(async()=>{if(n){O(null),t("allocations-delete","Deleting allocations...");try{await D({budgetId:n,year:a,month:l,onProgress:$=>{t("allocations-delete",$.message)}});const z={};Object.entries(c).forEach(([$,X])=>{X.default_monthly_type!=="percentage"&&(X.default_monthly_amount!==void 0&&X.default_monthly_amount>0?z[$]=X.default_monthly_amount.toString():z[$]="")}),B(z),Q(!1)}catch(z){O(z instanceof Error?z.message:"Failed to delete allocations")}finally{e("allocations-delete")}}},[n,a,l,D,c,t,e]),V=I-F;return{localAllocations:q,isEditingAppliedAllocations:ee,error:J,monthLoading:_,onBudgetTotal:M,availableNow:k,currentDraftTotal:I,draftChangeAmount:V,availableAfterApply:Y,previousMonthIncome:b,currentMonthIncome:T,allocationsFinalized:v,getAllocationAmount:j,handleAllocationChange:H,resetAllocationsToSaved:N,handleSaveAllocations:W,handleFinalizeAllocations:ne,handleDeleteAllocations:ie,setIsEditingAppliedAllocations:Q,setError:O}}function JP({budgetId:t,categories:e,currentYear:n,currentMonth:i,updateCategoriesWithBalances:a}){const l=A.useMemo(()=>{const v={};return Object.entries(e).forEach(([T,E])=>{v[T]={current:E.balance??0,total:E.balance??0}}),v},[e]),[c,h]=A.useState(!1),[f,p]=A.useState(null),_=A.useCallback(async()=>{if(!t||Object.keys(e).length===0)return null;const v=Object.keys(e),{total:T}=await _S(t,v,n,i),E={};Object.entries(e).forEach(([D,L])=>{const q=L.balance,B=T[D]??0;Math.abs(q-B)>.01&&(E[D]={stored:q,calculated:B})});const w=Object.keys(E).length>0?E:null;return p(w),w},[t,e,n,i]),b=A.useCallback(async()=>{if(!(!t||Object.keys(e).length===0)){h(!0);try{const v=Object.keys(e),{total:T}=await _S(t,v,n,i),E={};Object.entries(e).forEach(([w,D])=>{E[w]={...D,balance:T[w]??0}}),await a(E),p(null)}finally{h(!1)}}},[t,e,a,n,i]);return{categoryBalances:l,loadingBalances:c,categoryBalanceMismatch:f,checkCategoryBalanceMismatch:_,recalculateAndSaveCategoryBalances:b}}function ZP({categories:t,categoryGroups:e,currentBudget:n,setCategoriesOptimistic:i,setCategoryGroupsOptimistic:a,saveCategories:l,saveCategoryGroups:c,setError:h}){const[f,p]=A.useState(null),[_,b]=A.useState(null),[v,T]=A.useState(null),[E,w]=A.useState(null);function D(I,M){p("category"),b(M),I.dataTransfer.effectAllowed="move"}function L(I,M,F){I.preventDefault(),f==="category"&&(M!==_&&T(M),w(F))}function q(I,M){I.preventDefault(),f==="category"?(w(M),T(null)):f==="group"&&M!==_&&T(M)}function B(){T(null)}function ee(){w(null)}function Q(){p(null),b(null),T(null),w(null)}async function J(I,M,F){if(I.preventDefault(),I.stopPropagation(),!_||f!=="category"){Q();return}const k=t[_];if(!k)return;const Y=F==="ungrouped"?null:F,H=Object.entries(t).filter(([,W])=>(W.category_group_id||"ungrouped")===F),N={};Object.entries(t).forEach(([W,ne])=>{W!==_&&(N[W]=ne)});let G;if(M==="__group_end__"||H.length===0||!H.find(([W])=>W===M))G=(H.length>0?Math.max(...H.filter(([ne])=>ne!==_).map(([,ne])=>ne.sort_order)):-1)+1;else{const W=H.find(([ne])=>ne===M);W?(G=W[1].sort_order,Object.entries(N).forEach(([ne,ie])=>{(ie.category_group_id||"ungrouped")===F&&ie.sort_order>=G&&(N[ne]={...ie,sort_order:ie.sort_order+1})})):G=0}if(N[_]={...k,category_group_id:Y,sort_order:G},i(N),Q(),!!n)try{await l(N)}catch(W){h(W instanceof Error?W.message:"Failed to save changes")}}async function O(I,M){I.preventDefault(),f==="category"?await J(I,"__group_end__",M):f==="group"&&await j(I,M)}function R(I,M){I.stopPropagation(),p("group"),b(M),I.dataTransfer.effectAllowed="move"}async function j(I,M){if(I.preventDefault(),!_||f!=="group"||_===M){Q();return}const F=e.findIndex(N=>N.id===_),k=[...e],[Y]=k.splice(F,1);if(M==="__end__")k.push(Y);else{const N=k.findIndex(G=>G.id===M);k.splice(N,0,Y)}const H=k.map((N,G)=>({...N,sort_order:G}));if(a(H),Q(),!!n)try{await c(H)}catch(N){h(N instanceof Error?N.message:"Failed to save new order")}}return{dragType:f,draggedId:_,dragOverId:v,dragOverGroupId:E,setDragOverId:T,setDragOverGroupId:w,handleCategoryDragStart:D,handleCategoryDragOver:L,handleDragOverGroup:q,handleDragLeave:B,handleDragLeaveGroup:ee,handleDragEnd:Q,handleCategoryDrop:J,handleDropOnGroup:O,handleGroupDragStart:R,handleGroupDrop:j}}function eL(){const{selectedBudgetId:t,currentUserId:e,currentYear:n,currentMonthNumber:i}=zt(),{budget:a,categories:l,categoryGroups:c,isLoading:h,saveCategories:f,saveCategoryGroups:p,saveCategoriesAndGroups:_,setCategoriesOptimistic:b,setCategoryGroupsOptimistic:v,getOnBudgetTotal:T}=Pn(t,e),[E,w]=A.useState(null),{categoryBalances:D,loadingBalances:L,categoryBalanceMismatch:q,checkCategoryBalanceMismatch:B,recalculateAndSaveCategoryBalances:ee}=JP({budgetId:t,categories:l,currentYear:n,currentMonth:i,updateCategoriesWithBalances:f}),Q=ZP({categories:l,categoryGroups:c,currentBudget:a,setCategoriesOptimistic:b,setCategoryGroupsOptimistic:v,saveCategories:f,saveCategoryGroups:p,setError:w});async function J(N,G){if(!a)return;const W=G==="ungrouped"?null:G,ne=Object.values(l).filter(X=>G==="ungrouped"?!X.category_group_id:X.category_group_id===G),ie=ne.length>0?Math.max(...ne.map(X=>X.sort_order)):-1,V=`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,z={name:N.name,description:N.description??"",category_group_id:W,sort_order:ie+1,default_monthly_amount:N.default_monthly_amount??0,default_monthly_type:N.default_monthly_type??"fixed",balance:0},$={...l,[V]:z};b($);try{await f($)}catch(X){b(l),w(X instanceof Error?X.message:"Failed to create category")}}async function O(N,G){if(a)try{const W=l[N];if(!W)return;const ne=W.category_group_id||"ungrouped",ie=G.category_group_id;let V=W.sort_order;if(ne!==(ie||"ungrouped")){const $=Object.values(l).filter(X=>(X.category_group_id||"ungrouped")===(ie||"ungrouped")).filter((X,re,ue)=>l[N]!==ue[re]);V=$.length>0?Math.max(...$.map(X=>X.sort_order))+1:0}const z={...l,[N]:{...W,name:G.name,description:G.description??"",category_group_id:ie,sort_order:V,default_monthly_amount:G.default_monthly_amount??0,default_monthly_type:G.default_monthly_type??"fixed"}};b(z),await f(z)}catch(W){w(W instanceof Error?W.message:"Failed to update category")}}async function R(N){if(confirm("Are you sure you want to delete this category?")&&a)try{const{[N]:G,...W}=l;b(W),await f(W)}catch(G){w(G instanceof Error?G.message:"Failed to delete category")}}async function j(N,G){const W=l[N];if(!W)return;const ne=W.category_group_id||"ungrouped",ie=Object.entries(l).filter(([,ue])=>(ue.category_group_id||"ungrouped")===ne).sort((ue,he)=>ue[1].sort_order-he[1].sort_order),V=ie.findIndex(([ue])=>ue===N),z=G==="up"?V-1:V+1;if(z<0||z>=ie.length)return;const[$,X]=ie[z],re={};if(Object.entries(l).forEach(([ue,he])=>{ue===N?re[ue]={...he,sort_order:X.sort_order}:ue===$?re[ue]={...he,sort_order:W.sort_order}:re[ue]=he}),b(re),!!a)try{await f(re)}catch(ue){b(l),w(ue instanceof Error?ue.message:"Failed to move category")}}async function I(N){if(a)try{const G=c.length>0?Math.max(...c.map(ie=>ie.sort_order)):-1,W={id:`category_group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:N.name,sort_order:G+1},ne=[...c,W];v(ne),await p(ne)}catch(G){w(G instanceof Error?G.message:"Failed to create group")}}async function M(N,G){if(a)try{const W=c.map(ne=>ne.id===N?{...ne,name:G.name}:ne);v(W),await p(W)}catch(W){w(W instanceof Error?W.message:"Failed to update group")}}async function F(N){if(confirm("Are you sure you want to delete this group? Categories in this group will move to Uncategorized.")&&a)try{const G={};Object.entries(l).forEach(([ne,ie])=>{G[ne]=ie.category_group_id===N?{...ie,category_group_id:null}:ie});const W=c.filter(ne=>ne.id!==N);b(G),v(W),await _(G,W)}catch(G){w(G instanceof Error?G.message:"Failed to delete group")}}async function k(N,G){const W=[...c].sort(($,X)=>$.sort_order-X.sort_order),ne=W.findIndex($=>$.id===N),ie=G==="up"?ne-1:ne+1;if(ie<0||ie>=W.length)return;const[V]=W.splice(ne,1);W.splice(ie,0,V);const z=W.map(($,X)=>({...$,sort_order:X}));if(v(z),!!a)try{await p(z)}catch($){v(c),w($ instanceof Error?$.message:"Failed to move group")}}const Y=Object.entries(l).reduce((N,[G,W])=>{const ne=W.category_group_id||"ungrouped";return N[ne]||(N[ne]=[]),N[ne].push([G,W]),N},{}),H=[...c].sort((N,G)=>N.sort_order-G.sort_order);return{currentBudget:a,categories:l,categoryGroups:c,categoriesByGroup:Y,sortedGroups:H,categoryBalances:D,isLoading:h,loadingBalances:L,error:E,setError:w,getOnBudgetTotal:T,categoryBalanceMismatch:q,checkCategoryBalanceMismatch:B,recalculateAndSaveCategoryBalances:ee,handleCreateCategory:J,handleUpdateCategory:O,handleDeleteCategory:R,handleMoveCategory:j,handleCreateGroup:I,handleUpdateGroup:M,handleDeleteGroup:F,handleMoveGroup:k,dragType:Q.dragType,draggedId:Q.draggedId,dragOverId:Q.dragOverId,dragOverGroupId:Q.dragOverGroupId,setDragOverId:Q.setDragOverId,setDragOverGroupId:Q.setDragOverGroupId,handleCategoryDragStart:Q.handleCategoryDragStart,handleCategoryDragOver:Q.handleCategoryDragOver,handleDragOverGroup:Q.handleDragOverGroup,handleDragLeave:Q.handleDragLeave,handleDragLeaveGroup:Q.handleDragLeaveGroup,handleDragEnd:Q.handleDragEnd,handleCategoryDrop:Q.handleCategoryDrop,handleDropOnGroup:Q.handleDropOnGroup,handleGroupDragStart:Q.handleGroupDragStart,handleGroupDrop:Q.handleGroupDrop}}function OT(t){return t.nickname===void 0||t.description===void 0||t.balance===void 0||t.sort_order===void 0||t.is_income_account===void 0||t.is_income_default===void 0||t.is_outgo_account===void 0||t.is_outgo_default===void 0||t.on_budget===void 0||t.is_active===void 0}function kT(t){return t.name===void 0||t.description===void 0||t.sort_order===void 0||t.default_monthly_amount===void 0||t.default_monthly_type===void 0||t.balance===void 0}function NT(t){return t.name===void 0||t.sort_order===void 0}function PT(t){return t.budget_id===void 0||t.year_month_ordinal===void 0||t.year===void 0||t.month===void 0||!Array.isArray(t.income)||t.total_income===void 0||t.previous_month_income===void 0||!Array.isArray(t.expenses)||t.total_expenses===void 0||!Array.isArray(t.account_balances)||!Array.isArray(t.category_balances)||t.are_allocations_finalized===void 0||t.created_at===void 0||t.updated_at===void 0}function LT(){const t=new Date,e=t.getFullYear();let i=t.getMonth()+1+2,a=e;return i>12&&(i-=12,a+=1),{year:a,month:i}}function BT(t,e,n){return t>n.year||t===n.year&&e>n.month}async function tL(){const t=await Rr("budgets","database cleanup: scanning all budgets");let e=0,n=0,i=0,a=0,l=0,c=0,h=0,f=0,p=0;const _=new Set;for(const D of t.docs){const L=D.data;if(Array.isArray(L.accounts)||Array.isArray(L.categories)||Array.isArray(L.account_groups)){e++;continue}_.add(D.id),L.month_map===void 0&&f++,L.earliest_month!==void 0&&p++;const q=L.accounts;if(q&&typeof q=="object"){let Q=!1;for(const J of Object.values(q))OT(J)&&(l++,Q=!0);Q&&n++}const B=L.categories;if(B&&typeof B=="object"){let Q=!1;for(const J of Object.values(B))kT(J)&&(c++,Q=!0);Q&&i++}const ee=L.account_groups;if(ee&&typeof ee=="object"){let Q=!1;for(const J of Object.values(ee))NT(J)&&(h++,Q=!0);Q&&a++}}const b=await Rr("months","database cleanup: scanning all months"),v=LT(),T=[];let E=0,w=0;for(const D of b.docs){const L=D.data,q=L.year,B=L.month;q&&B&&BT(q,B,v)&&T.push({docId:D.id,budgetId:L.budget_id,year:q,month:B}),PT(L)&&E++,L.is_needs_recalculation!==void 0&&w++}return T.sort((D,L)=>D.year!==L.year?D.year-L.year:D.month-L.month),{totalBudgets:t.docs.length,budgetsWithArrays:e,budgetsWithMissingAccountDefaults:n,budgetsWithMissingCategoryDefaults:i,budgetsWithMissingGroupDefaults:a,accountsNeedingDefaults:l,categoriesNeedingDefaults:c,groupsNeedingDefaults:h,budgetsNeedingMonthMapUpdate:f,budgetsWithDeprecatedEarliestMonth:p,totalMonths:b.docs.length,futureMonthsToDelete:T,monthsWithSchemaIssues:E,monthsWithOldRecalcField:w}}function FS(t){return{nickname:t.nickname??"",description:t.description??"",balance:t.balance??0,account_group_id:t.account_group_id??null,sort_order:t.sort_order??0,is_income_account:t.is_income_account??!1,is_income_default:t.is_income_default??!1,is_outgo_account:t.is_outgo_account??!1,is_outgo_default:t.is_outgo_default??!1,on_budget:t.on_budget??!0,is_active:t.is_active??!0}}function qS(t){return{name:t.name??"",description:t.description??"",category_group_id:t.category_group_id??null,sort_order:t.sort_order??0,default_monthly_amount:t.default_monthly_amount??0,default_monthly_type:t.default_monthly_type??"fixed",balance:t.balance??0}}function HS(t){return{name:t.name??"",sort_order:t.sort_order??0,...t.expected_balance!==void 0&&{expected_balance:t.expected_balance},...t.on_budget!==void 0&&{on_budget:t.on_budget},...t.is_active!==void 0&&{is_active:t.is_active}}}function nL(t,e){const n=e.match(/_(\d{4})(\d{2})$/),i=n?parseInt(n[1]):new Date().getFullYear(),a=n?parseInt(n[2]):new Date().getMonth()+1,l=`${i}${String(a).padStart(2,"0")}`;return{budget_id:t.budget_id??"",year_month_ordinal:t.year_month_ordinal??l,year:t.year??i,month:t.month??a,income:Array.isArray(t.income)?t.income:[],total_income:t.total_income??0,previous_month_income:t.previous_month_income??0,expenses:Array.isArray(t.expenses)?t.expenses:[],total_expenses:t.total_expenses??0,account_balances:Array.isArray(t.account_balances)?t.account_balances:[],category_balances:Array.isArray(t.category_balances)?t.category_balances:[],are_allocations_finalized:t.are_allocations_finalized??!1,created_at:t.created_at??new Date().toISOString(),updated_at:t.updated_at??new Date().toISOString()}}async function rL(t){const e={},n=await Rr("months",`database cleanup: querying all months for budget ${t}`,[{field:"budget_id",op:"==",value:t}]);for(const i of n.docs){const a=i.data;if(a.year&&a.month){const l=wt(a.year,a.month);e[l]={needs_recalculation:!1}}}return e}async function iL(){const t=[];let e=0,n=0,i=0,a=0,l=0,c=0,h=0,f=0,p=0,_=0;const b=await Rr("budgets","database cleanup: reading all budgets to fix");for(const E of b.docs)try{const{exists:w,data:D}=await Le("budgets",E.id,"database cleanup: reading budget for update");if(!w||!D)continue;let L=!1;const q={...D};if(Array.isArray(D.accounts)){const B=D.accounts,ee={};for(const Q of B){const J=Q.id||`account_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;ee[J]=FS(Q),n++}q.accounts=ee,L=!0,l++}if(Array.isArray(D.categories)){const B=D.categories,ee={};for(const Q of B){const J=Q.id||`category_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;ee[J]=qS(Q),i++}q.categories=ee,L=!0,l++}if(Array.isArray(D.account_groups)){const B=D.account_groups,ee={};for(const Q of B){const J=Q.id||`group_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;ee[J]=HS(Q),a++}q.account_groups=ee,L=!0,l++}if(!Array.isArray(D.accounts)&&D.accounts&&typeof D.accounts=="object"){const B=D.accounts,ee={};for(const[Q,J]of Object.entries(B))OT(J)?(ee[Q]=FS(J),n++,L=!0):ee[Q]=J;L&&(q.accounts=ee)}if(!Array.isArray(D.categories)&&D.categories&&typeof D.categories=="object"){const B=D.categories,ee={};let Q=!1;for(const[J,O]of Object.entries(B))kT(O)?(ee[J]=qS(O),i++,Q=!0):ee[J]=O;Q&&(q.categories=ee,L=!0)}if(!Array.isArray(D.account_groups)&&D.account_groups&&typeof D.account_groups=="object"){const B=D.account_groups,ee={};let Q=!1;for(const[J,O]of Object.entries(B))NT(O)?(ee[J]=HS(O),a++,Q=!0):ee[J]=O;Q&&(q.account_groups=ee,L=!0)}if(D.month_map===void 0){const B=await rL(E.id);q.month_map=B,L=!0,c++,console.log(`[DatabaseCleanup] Added complete month_map to budget ${E.id} with ${Object.keys(B).length} months`)}delete q.category_balances,delete q.allocations,delete q.allocations_finalized,delete q.is_needs_recalculation,delete q.earliest_month,L&&(await ut("budgets",E.id,q,"database cleanup: saving fixed budget"),e++),D.earliest_month!==void 0&&(await Hs("budgets",E.id,{earliest_month:gS(),updated_at:new Date().toISOString()},`database cleanup: removing deprecated earliest_month from budget ${E.id}`),h++,console.log(`[DatabaseCleanup] Removed deprecated earliest_month from budget ${E.id}`))}catch(w){t.push(`Budget ${E.id}: ${w instanceof Error?w.message:"Unknown error"}`)}const v=await Rr("months","database cleanup: reading all months"),T=LT();for(const E of v.docs)try{const w=E.data,D=w.year,L=w.month;if(D&&L&&BT(D,L,T)){await N1("months",E.id,`database cleanup: deleting future month ${D}-${L}`),f++;continue}if(PT(w)){const q=nL(w,E.id);await ut("months",E.id,q,"database cleanup: saving fixed month"),p++}w.is_needs_recalculation!==void 0&&(await Hs("months",E.id,{is_needs_recalculation:gS(),updated_at:new Date().toISOString()},`database cleanup: removing is_needs_recalculation from month ${D}/${L}`),_++,console.log(`[DatabaseCleanup] Removed is_needs_recalculation from month ${D}/${L}`))}catch(w){t.push(`Month ${E.id}: ${w instanceof Error?w.message:"Unknown error"}`)}return{budgetsProcessed:e,accountsFixed:n,categoriesFixed:i,groupsFixed:a,arraysConverted:l,monthMapsUpdated:c,deprecatedFieldsRemoved:h,futureMonthsDeleted:f,monthsFixed:p,oldRecalcFieldsRemoved:_,errors:t}}function sL({currentUser:t,onComplete:e}){const[n,i]=A.useState(!1),[a,l]=A.useState(!1),[c,h]=A.useState(null),[f,p]=A.useState(null);async function _(){if(t){i(!0);try{const E=await tL();h(E)}catch(E){console.error("Failed to scan database:",E)}finally{i(!1)}}}async function b(){if(t){l(!0),p(null);try{const E=await iL();p(E),e?.()}catch(E){p({budgetsProcessed:0,accountsFixed:0,categoriesFixed:0,groupsFixed:0,arraysConverted:0,monthMapsUpdated:0,deprecatedFieldsRemoved:0,futureMonthsDeleted:0,monthsFixed:0,oldRecalcFieldsRemoved:0,errors:[E instanceof Error?E.message:"Unknown error"]})}finally{l(!1)}}}const v=c!==null&&(c.budgetsWithArrays>0||c.accountsNeedingDefaults>0||c.categoriesNeedingDefaults>0||c.groupsNeedingDefaults>0||c.budgetsNeedingMonthMapUpdate>0||c.budgetsWithDeprecatedEarliestMonth>0||c.futureMonthsToDelete.length>0||c.monthsWithSchemaIssues>0||c.monthsWithOldRecalcField>0),T=c!==null?c.budgetsWithArrays+c.accountsNeedingDefaults+c.categoriesNeedingDefaults+c.groupsNeedingDefaults+c.budgetsNeedingMonthMapUpdate+c.budgetsWithDeprecatedEarliestMonth+c.futureMonthsToDelete.length+c.monthsWithSchemaIssues+c.monthsWithOldRecalcField:0;return{status:c,isScanning:n,scanStatus:_,hasIssues:v,totalIssues:T,isRunning:a,result:f,runCleanup:b}}function dg(t){return t.includes("@")?!1:!!(/_[a-z0-9]+_(com|org|net|edu|io|co|uk|gov|mil|biz|info)$/i.test(t)&&(t.match(/_/g)||[]).length>=2||/_[a-z0-9]+\.(com|org|net|edu|io|co|uk|gov|mil|biz|info)$/i.test(t)&&(t.match(/_/g)||[]).length>=1)}function aL(t){let e=t;const n=/^(.+)_(gmail|yahoo|hotmail|outlook|icloud|aol|proton|protonmail)\.(.+)$/i,i=e.match(n);return i?`${i[1]}@${i[2]}.${i[3]}`:(e=e.replace(/_com$/,".com").replace(/_net$/,".net").replace(/_org$/,".org").replace(/_edu$/,".edu").replace(/_io$/,".io"),e=e.replace(/_gmail_/,"@gmail.").replace(/_yahoo_/,"@yahoo.").replace(/_hotmail_/,"@hotmail.").replace(/_outlook_/,"@outlook.").replace(/_icloud_/,"@icloud."),e)}function jh(t){if(t===null||typeof t!="object"||Array.isArray(t))return!1;const e=t;return e._methodName==="arrayUnion"&&Array.isArray(e.vc)}function VT(t){return t.vc||[]}function GS(t){return Array.isArray(t.items)?t.items:jh(t.items)?VT(t.items):[]}function oL({currentUser:t}){const[e,n]=A.useState(!1),[i,a]=A.useState(!1),[l,c]=A.useState(null),[h,f]=A.useState(null);async function p(){if(!t)return;n(!0);const b={documentsFound:0,sanitizedDocuments:[],corruptedDocuments:[],isHealthy:!0};try{const v=await Rr("feedback","feedback migration: scanning for issues");b.documentsFound=v.docs.length;for(const T of v.docs)dg(T.id)&&b.sanitizedDocuments.push(T.id),jh(T.data.items)&&b.corruptedDocuments.push(T.id);b.isHealthy=b.sanitizedDocuments.length===0&&b.corruptedDocuments.length===0,c(b)}catch(v){console.error("Failed to scan feedback:",v)}finally{n(!1)}}async function _(){if(!t)return;a(!0);const b=h?{...h,mergedItems:0,deletedDocuments:0,fixedDocuments:0,errors:[]}:{documentsFound:0,sanitizedDocuments:[],corruptedDocuments:[],mergedItems:0,deletedDocuments:0,fixedDocuments:0,errors:[]};try{const v=await Rr("feedback","feedback migration: listing all documents");b.documentsFound=v.docs.length,b.sanitizedDocuments=[],b.corruptedDocuments=[];for(const T of v.docs){const E=dg(T.id);if(jh(T.data.items)&&!E){b.corruptedDocuments.push(T.id);const D=VT(T.data.items);try{await ut("feedback",T.id,{items:D,user_email:T.data.user_email||T.id,created_at:T.data.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},`feedback migration: fixing corrupted arrayUnion in ${T.id}`),b.fixedDocuments++}catch(L){b.errors.push(`Failed to fix ${T.id}: ${L instanceof Error?L.message:"Unknown error"}`)}}}for(const T of v.docs)if(dg(T.id)){b.sanitizedDocuments.push(T.id);const E=T.id,w=aL(E),D=GS(T.data),{exists:L,data:q}=await Le("feedback",w,`feedback migration: checking if ${w} exists`);if(L&&q){const B=GS(q),ee=new Set(B.map(J=>J.id)),Q=D.filter(J=>!ee.has(J.id));if(Q.length>0||jh(q.items)){const J=[...B,...Q];await ut("feedback",w,{...q,items:J,updated_at:new Date().toISOString()},`feedback migration: merging ${Q.length} items from ${E}`),b.mergedItems+=Q.length}}else D.length>0&&(await ut("feedback",w,{items:D,user_email:w,created_at:T.data.created_at||new Date().toISOString(),updated_at:new Date().toISOString()},`feedback migration: creating ${w} from ${E}`),b.mergedItems+=D.length);try{await N1("feedback",E,`feedback migration: deleting sanitized document ${E}`),b.deletedDocuments++}catch(B){b.errors.push(`Failed to delete ${E}: ${B instanceof Error?B.message:"Unknown error"}`)}}f(b)}catch(v){b.errors.push(v instanceof Error?v.message:"Migration failed"),f(b)}finally{a(!1)}}return{status:l,isScanning:e,scanStatus:p,isMigratingFeedback:i,feedbackMigrationResult:h,migrateFeedbackDocuments:_}}async function lL(t){const{exists:e,data:n}=await Le("budgets",t,`[delete all months] reading budget ${t} for reset`);if(!e||!n)return;const i={...n.accounts};for(const l of Object.keys(i))i[l]&&typeof i[l]=="object"&&(i[l]={...i[l],balance:0});const a={...n.categories};for(const l of Object.keys(a))a[l]&&typeof a[l]=="object"&&(a[l]={...a[l],balance:0});await ut("budgets",t,{...n,accounts:i,categories:a,month_map:{},total_available:0,is_needs_recalculation:!1,updated_at:new Date().toISOString()},`[delete all months] resetting budget ${t} balances to zero`)}function cL({currentUser:t,onComplete:e}){const[n,i]=A.useState(!1),[a,l]=A.useState(!1),[c,h]=A.useState(null),[f,p]=A.useState(null),[_,b]=A.useState(null);async function v(){if(t){i(!0);try{const E=await Rr("months","delete all months: scanning for all months"),w=[],D=new Set;for(const L of E.docs){const{budget_id:q,year:B,month:ee}=L.data;D.add(q),w.push({docId:L.id,budgetId:q,year:B,month:ee})}w.sort((L,q)=>L.budgetId!==q.budgetId?L.budgetId.localeCompare(q.budgetId):L.year!==q.year?L.year-q.year:L.month-q.month),h({monthsToDelete:w,monthsCount:w.length,budgetCount:D.size})}catch{}finally{i(!1)}}}async function T(){if(!t||!c||c.monthsToDelete.length===0)return;l(!0),p(null);const E=c.monthsToDelete.length,w=new Set,D=[];for(const Q of c.monthsToDelete)w.add(Q.budgetId);b({phase:"deleting",deleted:0,total:E,currentMonth:null,budgetsRecalculated:0,totalBudgets:c.budgetCount,percentComplete:0});const L=c.monthsToDelete.map(Q=>({collectionPath:"months",docId:Q.docId}));let q=0;try{await PO(L,"delete all months: batch deleting all month documents",Q=>{q=Q,b({phase:"deleting",deleted:Q,total:E,currentMonth:`Batch ${Math.ceil(Q/500)} of ${Math.ceil(E/500)}`,budgetsRecalculated:0,totalBudgets:c.budgetCount,percentComplete:Math.round(Q/E*70)})}),q=E}catch(Q){D.push(`Batch delete failed: ${Q instanceof Error?Q.message:"Unknown error"}`)}const B=Array.from(w);let ee=0;for(const Q of B){b({phase:"resetting-budgets",deleted:q,total:E,currentMonth:`Budget ${ee+1}/${B.length}`,budgetsRecalculated:ee,totalBudgets:B.length,percentComplete:70+Math.round(ee/B.length*25)});try{await lL(Q),ee++}catch{ee++}}b({phase:"clearing-cache",deleted:q,total:E,currentMonth:null,budgetsRecalculated:ee,totalBudgets:B.length,percentComplete:95});try{$e.removeQueries({queryKey:["budget"]}),$e.removeQueries({queryKey:["month"]}),localStorage.removeItem("BUDGET_APP_QUERY_CACHE")}catch{}b({phase:"complete",deleted:q,total:E,currentMonth:null,budgetsRecalculated:ee,totalBudgets:B.length,percentComplete:100}),p({deleted:q,errors:D,budgetsRecalculated:ee}),l(!1),b(null),D.length===0&&(h({monthsToDelete:[],monthsCount:0,budgetCount:0}),e?.())}return{status:c,isScanning:n,scanStatus:v,isDeleting:a,deleteResult:f,deleteProgress:_,deleteAllMonths:T}}function UT(t){const e=[];let n="",i=!1;for(let a=0;a<t.length;a++){const l=t[a];l==='"'?i=!i:l===","&&!i?(e.push(n.trim()),n=""):n+=l}return e.push(n.trim()),e}function zT(t){if(!t)return 0;let e=t.replace(/[$\s]/g,"");const n=e.startsWith("(")||e.startsWith("-");e=e.replace(/[()]/g,"").replace("-",""),e=e.replace(/,/g,"");const i=parseFloat(e);return isNaN(i)?0:n?-i:i}function FT(t){if(!t)return null;const e=t.split("/");if(e.length!==3)return null;const n=parseInt(e[0],10),i=parseInt(e[1],10),a=parseInt(e[2],10);return isNaN(n)||isNaN(i)||isNaN(a)||n<1||n>12||i<1||i>31?null:{year:a,month:n,day:i}}function uL(t){const e=t.toLowerCase().trim();return e==="income"?"income":e==="spend"?"spend":e==="allocation"||e==="allocations"?"allocation":null}function qT(t){if(!t)return!1;const e=t.toLowerCase().trim();return e==="true"||e==="1"||e==="yes"}function dL(t){const e=t.split(`
`).filter(i=>i.trim()),n=[];for(const i of e){const a=UT(i);if(a.length<6)continue;const[l,c,h,f,p,_,b,v]=a;if(l.toLowerCase()==="type")continue;const T=uL(l);if(!T)continue;const E=FT(c);if(!E)continue;const w=zT(_),D=qT(v||"");n.push({recordType:T,date:c,year:E.year,month:E.month,day:E.day,payee:h,category:f,account:p,amount:w,description:b||"",cleared:D,rawLine:i})}return n}function HT(t,e,n){const i=e.toString().padStart(2,"0"),a=n.toString().padStart(2,"0");return`${t}-${i}-${a}`}function hL(t,e){return e.toLowerCase()==="income"?"income":t.toLowerCase()==="budget allocation"?"allocation":"spend"}function fL(t){const e=t.split(`
`).filter(i=>i.trim()),n=[];for(const i of e){const a=UT(i);if(a.length<5)continue;const[l,c,h,f,p,_,b]=a;if(l.toLowerCase()==="cash flow"||l.toLowerCase()==="date")continue;const v=FT(l);if(!v)continue;const T=hL(c,h),E=zT(p),w=qT(b||"");n.push({recordType:T,date:l,year:v.year,month:v.month,day:v.day,payee:c,category:h,account:f,amount:E,description:_||"",cleared:w,rawLine:i})}return n}const tf=["n/a","na","none","-",""];function GT(t,e,n){const i=t.toLowerCase();for(const[a,l]of Object.entries(e))if((n?l.nickname:l.name).toLowerCase()===i)return a;return null}function $T(t,e,n){if(tf.includes(t.toLowerCase().trim()))return Bs;const i=n.get(t);return i?i.newId:GT(t,e,!1)}function QT(t,e,n){if(tf.includes(t.toLowerCase().trim()))return Wy;const i=n.get(t);return i?i.newId:GT(t,e,!0)}function mL(t,e,n,i){const a=[];let l=0,c=0;const h=e.income.length,f=[];for(const _ of t){const b=QT(_.account,n,i);if(!b){a.push(`Unknown account "${_.account}" for income on ${_.date}`),c++;continue}const v={id:`income_import_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:_.amount,account_id:b,date:HT(_.year,_.month,_.day),payee:_.payee,description:_.description,cleared:_.cleared,created_at:new Date().toISOString()};f.push(v),l++}return{monthData:ca({...e,income:f,updated_at:new Date().toISOString()}),imported:l,skipped:c,errors:a,cleared:h}}function pL(t,e,n,i,a,l){const c=[];let h=0,f=0;const p=e.expenses.length,_=[];for(const v of t){const T=$T(v.category,n,a);if(!T){c.push(`Unknown category "${v.category}" for expense on ${v.date}`),f++;continue}const E=QT(v.account,i,l);if(!E){c.push(`Unknown account "${v.account}" for expense on ${v.date}`),f++;continue}const w={id:`expense_import_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,amount:v.amount,category_id:T,account_id:E,date:HT(v.year,v.month,v.day),payee:v.payee,description:v.description,cleared:v.cleared,created_at:new Date().toISOString()};_.push(w),h++}return{monthData:ca({...e,expenses:_,updated_at:new Date().toISOString()}),imported:h,skipped:f,errors:c,cleared:p}}function gL(t,e,n,i){const a=[];let l=0,c=0;const h=e.category_balances.filter(_=>_.allocated>0).length,f=new Map;for(const _ of t){const b=$T(_.category,n,i);if(!b){a.push(`Unknown category "${_.category}" for allocation on ${_.date}`),c++;continue}const v=f.get(b)||0;f.set(b,v+_.amount),l++}const p=e.category_balances.map(_=>{const b=f.get(_.category_id);return b!==void 0?{..._,allocated:b,end_balance:_.start_balance+b-_.spent}:{..._,allocated:0,end_balance:_.start_balance-_.spent}});for(const[_,b]of f)p.find(v=>v.category_id===_)||p.push({category_id:_,start_balance:0,allocated:b,spent:0,end_balance:b});return{monthData:{...e,category_balances:p,are_allocations_finalized:!0,updated_at:new Date().toISOString()},imported:l,skipped:c,errors:a,cleared:h}}function yL(t,e,n,i,a){const l=new Set(Object.values(e).map(p=>p.name.toLowerCase())),c=new Set(Object.values(n).map(p=>p.nickname.toLowerCase())),h=new Set,f=new Set;for(const p of t){if(p.recordType==="spend"||p.recordType==="allocation"){const _=p.category.toLowerCase().trim(),b=l.has(_),v=i.has(p.category),T=tf.includes(_);!b&&!v&&!T&&p.category&&h.add(p.category)}if(p.recordType==="spend"||p.recordType==="income"){const _=p.account.toLowerCase().trim(),b=c.has(_),v=a.has(p.account),T=tf.includes(_);!b&&!v&&!T&&p.account&&f.add(p.account)}}return{unmappedCategories:Array.from(h).sort(),unmappedAccounts:Array.from(f).sort()}}const $S=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function _L(t,e,n){const i=Object.entries(t).reduce((l,[,c])=>{const h=c.account_group_id?n[c.account_group_id]:void 0,f=h?.on_budget!==void 0?h.on_budget:c.on_budget!==!1,p=h?.is_active!==void 0?h.is_active:c.is_active!==!1;return f&&p?l+(c.balance??0):l},0),a=Object.values(e).reduce((l,c)=>{const h=c.balance??0;return l+(h>0?h:0)},0);return i-a}async function bL(t,e,n){const{exists:i,data:a}=await Le("budgets",t,"[seed import] reading budget for final update");if(!i||!a)throw new Error(`Budget ${t} not found`);const l={...a.accounts};for(const[b,v]of Object.entries(e.accountEndBalances))l[b]&&(l[b]={...l[b],balance:v});const c={...a.categories};for(const[b,v]of Object.entries(e.categoryEndBalances))c[b]&&(c[b]={...c[b],balance:v});const f={...a.month_map||{}};for(const{info:b}of n)f[b.ordinal]={needs_recalculation:!1};const p=_L(l,c,a.account_groups||{});await ut("budgets",t,{...a,accounts:l,categories:c,total_available:p,is_needs_recalculation:!1,month_map:f,updated_at:new Date().toISOString()},"[seed import] saving final balances");const _=$e.getQueryData(xe.budget(t));if(_){const b={};for(const[T,E]of Object.entries(_.accounts)){const w=l[T];b[T]=w?{...E,balance:w.balance??E.balance}:E}const v={};for(const[T,E]of Object.entries(_.categories)){const w=c[T];v[T]=w?{...E,balance:w.balance??E.balance}:E}$e.setQueryData(xe.budget(t),{..._,accounts:b,categories:v,isNeedsRecalculation:!1,monthMap:f,budget:{..._.budget,accounts:l,categories:c,total_available:p,is_needs_recalculation:!1,month_map:f}})}}async function vL(t,e,n,i,a,l,c){const h=[];let f=0,p=0,_=0,b=0,v=0,T=0;const E=[],w=new Map;for(const I of e){const M=`${I.year}-${I.month}`;w.has(M)||w.set(M,[]),w.get(M).push(I)}for(const[I,M]of w){const[F,k]=I.split("-"),Y=parseInt(F,10),H=parseInt(k,10);E.push({key:I,year:Y,month:H,ordinal:wt(Y,H),name:`${$S[H-1]} ${Y}`,rows:M})}if(E.sort((I,M)=>I.ordinal.localeCompare(M.ordinal)),E.length>0){const I=new Set(E.map(H=>H.ordinal)),M=E[0],F=E[E.length-1];let k=M.year,Y=M.month;for(;k<F.year||k===F.year&&Y<=F.month;){const H=wt(k,Y);I.has(H)||E.push({key:`${k}-${Y}`,year:k,month:Y,ordinal:H,name:`${$S[Y-1]} ${k}`,rows:[]}),Y++,Y>12&&(Y=1,k++)}E.sort((H,N)=>H.ordinal.localeCompare(N.ordinal))}const D=E.filter(I=>I.rows.length===0).length,L=E.length;c({phase:"reading-months",currentMonth:null,monthsProcessed:0,totalMonths:L,recordsImported:0,totalRecords:e.length,monthsCreated:0,monthsToCreate:0,gapMonths:D,percentComplete:5,incomeImported:0,spendImported:0,allocationsImported:0});const q=await Promise.all(E.map(async I=>{try{const M=await Ei(t,I.year,I.month,"seed import combined");return{info:I,data:M,needsCreation:!1}}catch{return{info:I,data:null,needsCreation:!0}}})),B=new Map(q.map(I=>[I.info.ordinal,I])),ee=E.map(I=>B.get(I.ordinal)),Q=ee.filter(I=>I.needsCreation).length;if(Q>0){c({phase:"creating-months",currentMonth:null,monthsProcessed:0,totalMonths:L,recordsImported:0,totalRecords:e.length,monthsCreated:0,monthsToCreate:Q,gapMonths:D,percentComplete:15,incomeImported:0,spendImported:0,allocationsImported:0});for(const I of ee)if(I.needsCreation)try{I.data=await z1(t,I.info.year,I.info.month,{bypassDateLimit:!0}),_++,c({phase:"creating-months",currentMonth:I.info.name,monthsProcessed:0,totalMonths:L,recordsImported:0,totalRecords:e.length,monthsCreated:_,monthsToCreate:Q,gapMonths:D,percentComplete:15+Math.round(_/Q*10),incomeImported:0,spendImported:0,allocationsImported:0})}catch(M){I.error=`Failed to create month ${I.info.month}/${I.info.year}: ${M instanceof Error?M.message:"Unknown error"}`,h.push(I.error),p+=I.info.rows.length}}c({phase:"processing-months",currentMonth:null,monthsProcessed:0,totalMonths:L,recordsImported:0,totalRecords:e.length,monthsCreated:_,monthsToCreate:Q,gapMonths:D,percentComplete:30,incomeImported:0,spendImported:0,allocationsImported:0});const J=[];let O=0,R=L1;for(const I of ee){if(!I.data||I.error){O++;continue}let M=I.data;const F=I.info.rows,k=F.filter(N=>N.recordType==="income"),Y=F.filter(N=>N.recordType==="spend"),H=F.filter(N=>N.recordType==="allocation");if(k.length>0){const N=mL(k,M,i,l);M=N.monthData,f+=N.imported,b+=N.imported,p+=N.skipped,h.push(...N.errors)}if(Y.length>0){const N=pL(Y,M,n,i,a,l);M=N.monthData,f+=N.imported,v+=N.imported,p+=N.skipped,h.push(...N.errors)}if(H.length>0){const N=gL(H,M,n,a);M=N.monthData,f+=N.imported,T+=N.imported,p+=N.skipped,h.push(...N.errors)}M=B1(M,R),R=$g(M),J.push({info:I.info,data:M}),O++,c({phase:"processing-months",currentMonth:I.info.name,monthsProcessed:O,totalMonths:L,recordsImported:f,totalRecords:e.length,monthsCreated:_,monthsToCreate:Q,gapMonths:D,percentComplete:30+Math.round(O/L*30),incomeImported:b,spendImported:v,allocationsImported:T})}c({phase:"saving-months",currentMonth:null,monthsProcessed:J.length,totalMonths:J.length,recordsImported:f,totalRecords:e.length,monthsCreated:_,monthsToCreate:Q,gapMonths:D,percentComplete:65,incomeImported:b,spendImported:v,allocationsImported:T});const j=J.map(({info:I,data:M})=>({collectionPath:"months",docId:Ar(t,I.year,I.month),data:M}));try{await k1(j,`seed import combined (${J.length} months)`)}catch(I){h.push(`Error batch saving months: ${I instanceof Error?I.message:"Unknown error"}`)}c({phase:"updating-budget",currentMonth:null,monthsProcessed:J.length,totalMonths:J.length,recordsImported:f,totalRecords:e.length,monthsCreated:_,monthsToCreate:Q,gapMonths:D,percentComplete:85,incomeImported:b,spendImported:v,allocationsImported:T});try{await bL(t,R,J)}catch(I){h.push(`Error updating budget: ${I instanceof Error?I.message:"Unknown error"}`)}return{success:h.length===0,imported:f,skipped:p,errors:h}}function xL(t){const[e,n]=A.useState("idle"),[i,a]=A.useState(null),[l,c]=A.useState([]),[h,f]=A.useState([]),[p,_]=A.useState([]),[b,v]=A.useState([]),[T,E]=A.useState(new Map),[w,D]=A.useState(new Map),[L,q]=A.useState(null),[B,ee]=A.useState(null),Q=e==="parsing",J=e==="importing",O=l.length>0||h.length>0,R=A.useCallback(async()=>{if(!t)return{categoryMappings:new Map,accountMappings:new Map};try{const{exists:N,data:G}=await Le("data_mappings",`${t}_import_data_map`,"loading existing import mappings");if(!N||!G)return{categoryMappings:new Map,accountMappings:new Map};const W=new Map,ne=new Map;if(G.category_mappings)for(const[ie,V]of Object.entries(G.category_mappings))W.set(ie,{oldName:ie,newId:V.id,newName:V.name});if(G.account_mappings)for(const[ie,V]of Object.entries(G.account_mappings))ne.set(ie,{oldName:ie,newId:V.id,newName:V.name});return{categoryMappings:W,accountMappings:ne}}catch(N){return console.error("[useSeedImport] Failed to load existing mappings:",N),{categoryMappings:new Map,accountMappings:new Map}}},[t]),j=A.useCallback(async(N,G)=>{if(!t)return;const W={},ne={};for(const[V,z]of N)W[V]={id:z.newId,name:z.newName};for(const[V,z]of G)ne[V]={id:z.newId,name:z.newName};const ie={category_mappings:W,account_mappings:ne,last_updated:new Date().toISOString()};await ut("data_mappings",`${t}_import_data_map`,ie,"saving import mappings")},[t]),I=N=>{const G=N.split(`
`)[0]?.toLowerCase().trim()||"";return G.startsWith("cash flow")||G.startsWith("date,")?"raw_cash_flow":(G.startsWith("type,")||G.startsWith("income,")||G.startsWith("spend,")||G.startsWith("allocation,"),"combined")},M=A.useCallback(async(N,G,W)=>{n("parsing"),q(null);try{const ne=await N.text(),ie=I(ne),V=ie==="raw_cash_flow"?fL(ne):dL(ne);if(console.log(`[useSeedImport] Detected format: ${ie}, parsed ${V.length} rows`),V.length===0){n("error"),a(null);return}a(V);const z=new Set,$=new Set,X=["n/a","na","none","-",""];for(const Ve of V){if((Ve.recordType==="spend"||Ve.recordType==="allocation")&&Ve.category){const nt=Ve.category.toLowerCase().trim();X.includes(nt)||z.add(Ve.category)}if((Ve.recordType==="spend"||Ve.recordType==="income")&&Ve.account){const nt=Ve.account.toLowerCase().trim();X.includes(nt)||$.add(Ve.account)}}const re=Array.from(z).sort(),ue=Array.from($).sort(),{categoryMappings:he,accountMappings:Se}=await R(),fe=new Map;for(const[Ve,nt]of Object.entries(G))fe.set(nt.name.toLowerCase(),{id:Ve,name:nt.name});const te=new Map;for(const[Ve,nt]of Object.entries(W))te.set(nt.nickname.toLowerCase(),{id:Ve,name:nt.nickname});const Ee=[],De=[];for(const Ve of re)if(he.has(Ve)){const nt=fe.get(Ve.toLowerCase()),bt=he.get(Ve);(!nt||nt.id!==bt.newId)&&Ee.push(Ve)}for(const Ve of ue)if(Se.has(Ve)){const nt=te.get(Ve.toLowerCase()),bt=Se.get(Ve);(!nt||nt.id!==bt.newId)&&De.push(Ve)}_(Ee),v(De);const st=new Map(he);for(const Ve of re)if(!st.has(Ve)){const nt=fe.get(Ve.toLowerCase());nt&&st.set(Ve,{oldName:Ve,newId:nt.id,newName:nt.name})}const He=new Map(Se);for(const Ve of ue)if(!He.has(Ve)){const nt=te.get(Ve.toLowerCase());nt&&He.set(Ve,{oldName:Ve,newId:nt.id,newName:nt.name})}E(st),D(He);const{unmappedCategories:Ft,unmappedAccounts:In}=yL(V,G,W,st,He);c(Ft),f(In),Ft.length>0||In.length>0?n("mapping"):n("ready")}catch(ne){console.error("[useSeedImport] Parse error:",ne),n("error"),a(null)}},[R]),F=A.useCallback((N,G,W)=>{E(ne=>{const ie=new Map(ne);return ie.set(N,{oldName:N,newId:G,newName:W}),ie}),c(ne=>{const ie=ne.filter(V=>V===N?!1:!T.has(V));return ie.length===0&&h.length===0&&n("ready"),ie})},[T,h.length]),k=A.useCallback((N,G,W)=>{D(ne=>{const ie=new Map(ne);return ie.set(N,{oldName:N,newId:G,newName:W}),ie}),f(ne=>{const ie=ne.filter(V=>V===N?!1:!w.has(V));return ie.length===0&&l.length===0&&n("ready"),ie})},[w,l.length]),Y=A.useCallback(async(N,G)=>{if(!t||!i)return;n("importing"),ee({phase:"saving-mappings",currentMonth:null,monthsProcessed:0,totalMonths:0,recordsImported:0,totalRecords:i.length,monthsCreated:0,monthsToCreate:0,gapMonths:0,percentComplete:0,incomeImported:0,spendImported:0,allocationsImported:0}),await j(T,w);const W=await vL(t,i,N,G,T,w,ne=>ee(ne));$e.removeQueries({queryKey:["month"]}),$e.removeQueries({queryKey:xe.budget(t)}),ee(ne=>ne?{...ne,phase:"complete",percentComplete:100}:null),q(W),n(W.success?"complete":"error")},[t,i,T,w,j]),H=A.useCallback(()=>{n("idle"),a(null),c([]),f([]),_([]),v([]),q(null),ee(null)},[]);return{status:e,parsedData:i,unmappedCategories:l,unmappedAccounts:h,customMappedCategories:p,customMappedAccounts:b,categoryMappings:T,accountMappings:w,importResult:L,importProgress:B,parseFile:M,setCategoryMapping:F,setAccountMapping:k,runImport:Y,reset:H,isParsing:Q,isImporting:J,hasUnmappedEntities:O}}function SL({onCreateNew:t}){const[e,n]=A.useState(""),[i,a]=A.useState(!1),[l,c]=A.useState(null);async function h(f){f.preventDefault(),a(!0),c(null);try{await t(e.trim()||void 0)}catch(p){c(p instanceof Error?p.message:"Failed to create budget"),a(!1)}}return d.jsxs("div",{style:{maxWidth:"500px",margin:"0 auto"},children:[d.jsx("h1",{style:{marginBottom:"0.5rem"},children:"Welcome!"}),d.jsx("p",{style:{opacity:.7,marginBottom:"2rem"},children:"You don't have any budgets yet. Create your first budget to get started."}),l&&d.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1.5rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:l}),d.jsx("button",{onClick:()=>c(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, #646cff 8%, transparent)",border:"1px solid color-mix(in srgb, #646cff 25%, transparent)",padding:"2rem",borderRadius:"12px"},children:[d.jsxs("h2",{style:{margin:"0 0 1rem 0",fontSize:"1.1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Create Your Budget"]}),d.jsxs("form",{onSubmit:h,children:[d.jsxs("div",{style:{marginBottom:"1.5rem"},children:[d.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),d.jsx("input",{type:"text",value:e,onChange:f=>n(f.target.value),placeholder:"My Budget",autoFocus:!0,style:{width:"100%",padding:"0.75rem 1rem",borderRadius:"8px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",color:"inherit",boxSizing:"border-box"}}),d.jsx("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.5},children:"You can always rename this later"})]}),d.jsx("button",{type:"submit",disabled:i,style:{width:"100%",background:ce.primary,color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:i?"not-allowed":"pointer",fontWeight:600,opacity:i?.7:1,fontSize:"1rem"},children:i?"Creating...":"Create Budget"})]})]}),d.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",opacity:.6},children:"If someone has invited you to their budget, you can accept the invitation from the budget settings page after creating your account."})]})}function EL({invites:t,onAccept:e,onCreateNew:n}){const[i,a]=A.useState(null),[l,c]=A.useState(!1),[h,f]=A.useState(""),[p,_]=A.useState(!1),[b,v]=A.useState(null);async function T(w){a(w),v(null);try{await e(w)}catch(D){v(D instanceof Error?D.message:"Failed to accept invitation"),a(null)}}async function E(w){w.preventDefault(),_(!0),v(null);try{await n(h.trim()||void 0)}catch(D){v(D instanceof Error?D.message:"Failed to create new budget"),_(!1)}}return d.jsxs("div",{children:[d.jsx("h1",{style:{marginBottom:"0.5rem"},children:"Welcome!"}),d.jsxs("p",{style:{opacity:.7,marginBottom:"2rem"},children:["You've been invited to join ",t.length===1?"a budget":"some budgets",". Choose one to get started!"]}),b&&d.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1.5rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:b}),d.jsx("button",{onClick:()=>v(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 8%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 25%, transparent)",padding:"1.5rem",borderRadius:"12px",marginBottom:"1.5rem"},children:[d.jsxs("h2",{style:{margin:"0 0 1rem 0",fontSize:"1.1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Budget Invitations"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:t.map(w=>d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"1rem 1.25rem",borderRadius:"8px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[d.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[d.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.05rem"},children:w.budgetName}),w.ownerEmail&&d.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.6},children:["From: ",w.ownerEmail]})]}),d.jsx("button",{onClick:()=>T(w.budgetId),disabled:i!==null||p,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"8px",cursor:i!==null||p?"not-allowed":"pointer",fontWeight:500,opacity:i!==null||p?.7:1,fontSize:"0.9rem"},children:i===w.budgetId?"Joining...":"Accept & Join"})]},w.budgetId))})]}),d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",border:"1px dashed color-mix(in srgb, currentColor 20%, transparent)",padding:"1.5rem",borderRadius:"12px"},children:l?d.jsxs("form",{onSubmit:E,children:[d.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Create Your Budget"}),d.jsxs("div",{style:{marginBottom:"1rem"},children:[d.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.9rem",opacity:.8},children:"Budget Name"}),d.jsx("input",{type:"text",value:h,onChange:w=>f(w.target.value),placeholder:"My Budget",autoFocus:!0,style:{width:"100%",padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 25%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit",boxSizing:"border-box"}})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[d.jsx("button",{type:"submit",disabled:p||i!==null,style:{background:ce.primary,color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:p||i!==null?"not-allowed":"pointer",fontWeight:500,opacity:p||i!==null?.7:1,fontSize:"0.9rem"},children:p?"Creating...":"Create Budget"}),d.jsx("button",{type:"button",onClick:()=>{c(!1),f("")},disabled:p,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:p?"not-allowed":"pointer",fontWeight:500,opacity:p?.7:.8,fontSize:"0.9rem"},children:"Cancel"})]})]}):d.jsxs("div",{style:{textAlign:"center"},children:[d.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.7},children:"Or start fresh with your own budget"}),d.jsx("button",{onClick:()=>c(!0),disabled:i!==null,style:{background:ce.primary,color:"white",border:"none",padding:"0.6rem 1.5rem",borderRadius:"8px",cursor:i!==null?"not-allowed":"pointer",fontWeight:500,opacity:i!==null?.7:1,fontSize:"0.9rem"},children:"Create New Budget"})]})})]})}function wL({activeTab:t,setActiveTab:e,allocationsFinalized:n}){const i=A.useMemo(()=>[{id:"categories",label:"Categories",checkmark:n},{id:"accounts",label:"Accounts"},{id:"income",label:"Income"},{id:"spend",label:"Spend"}],[n]);return d.jsx(l_,{mode:"button",tabs:i,activeTab:t,onTabChange:a=>e(a)})}function TL({isOpen:t,onClose:e,onProceed:n,results:i}){const a=!i||i.status==="confirming",l=i&&!["confirming","done","error"].includes(i.status),c=a||i?.status==="done"||i?.status==="error";function h(){c&&e()}return d.jsx(aa,{isOpen:t,onClose:h,title:"Recalculate Balances",width:"540px",children:d.jsxs("div",{style:{padding:"0.5rem 0"},children:[a&&d.jsxs(d.Fragment,{children:[d.jsxs("p",{style:{margin:"0 0 1rem 0",fontSize:"0.95rem",lineHeight:1.5},children:["This will recalculate category balances and account balances from the ",d.jsx("strong",{children:"current month forward"}),"."]}),d.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.9rem",opacity:.7},children:"Use this if your data seems out of sync or after fixing bugs. Past months will not be modified."}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",marginBottom:"1.5rem"},children:[d.jsx(Zo,{status:"waiting",label:"Find all months to process"}),d.jsx(Zo,{status:"waiting",label:"Process months"}),d.jsx(Zo,{status:"waiting",label:"Update budget totals"})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(Ie,{variant:"secondary",actionName:"Cancel Recalculation",onClick:e,children:"Cancel"}),d.jsx(Ie,{actionName:"Proceed with Recalculation",onClick:n,children:"Proceed"})]})]}),!a&&d.jsxs(d.Fragment,{children:[d.jsx("p",{style:{margin:"0 0 1.5rem 0",fontSize:"0.9rem",opacity:.7},children:"Recalculating category balances and account balances..."}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[d.jsx(Zo,{status:i?.status==="pending"?"waiting":"complete",label:"Find all months to process",detail:i&&i.status!=="pending"?`Found ${i.monthsFound||0} month${i.monthsFound!==1?"s":""}`:void 0}),d.jsx(Zo,{status:QS(i?.status,["pending","finding_months"],"processing_months"),label:"Process months",detail:i?.status==="processing_months"?`Processing: ${i.currentMonthLabel} (${(i.currentMonthIndex||0)+1}/${i.monthsFound||0})`:i?.monthsProcessed!==void 0?`Processed ${i.monthsProcessed} month${i.monthsProcessed!==1?"s":""}`:void 0}),d.jsx(Zo,{status:i?.status==="error"?"error":QS(i?.status,["pending","finding_months","processing_months"],"updating_budget"),label:"Update budget totals",detail:i?.status==="error"?i.error:void 0,isError:i?.status==="error"})]}),i?.status==="done"&&d.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:`color-mix(in srgb, ${ce.success} 10%, transparent)`,border:`1px solid ${ce.success}`,borderRadius:"8px",textAlign:"center"},children:[d.jsx("p",{style:{margin:0,fontWeight:600,color:ce.success},children:" Recalculation complete!"}),d.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.9rem",opacity:.8},children:[i.monthsProcessed," month",i.monthsProcessed!==1?"s":""," processed",d.jsx("br",{}),"Total Income: ",ke(i.totalIncomeRecalculated||0),d.jsx("br",{}),"Total Expenses: ",ke(i.totalExpensesRecalculated||0)]})]}),(i?.status==="done"||i?.status==="error")&&d.jsx("div",{style:{marginTop:"1.5rem",display:"flex",justifyContent:"center"},children:d.jsx(Ie,{actionName:"Close Recalculation Modal",onClick:e,children:"Done"})}),l&&d.jsx("p",{style:{marginTop:"1.5rem",textAlign:"center",fontSize:"0.85rem",opacity:.6},children:"Please wait, do not close this window..."})]})]})})}function QS(t,e,n){return!t||e.includes(t)?t===n?"active":"waiting":t===n?"active":"complete"}function Zo({status:t,label:e,detail:n,isError:i}){const a=t==="waiting"?"":t==="active"?"":t==="error"?"":"";return d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[d.jsx("span",{style:{fontSize:"1.1rem",width:"1.5rem",textAlign:"center"},children:a}),d.jsxs("div",{style:{flex:1},children:[d.jsx("p",{style:{margin:0,fontWeight:500},children:e}),n&&d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:i?1:.6,color:i?ce.error:"inherit"},children:n})]})]})}function u_({isDisabled:t,onCloseMenu:e}){const{selectedBudgetId:n,currentUserId:i,currentYear:a,currentMonthNumber:l}=zt(),{categories:c,accounts:h,saveCategories:f,saveAccounts:p}=Pn(n,i),[_,b]=A.useState(!1),[v,T]=A.useState(!1),[E,w]=A.useState(null);function D(){T(!0),w({status:"confirming"})}async function L(){if(n){b(!0),w({status:"pending"});try{w({status:"finding_months"});const B=new Date,ee=a||B.getFullYear(),Q=l||B.getMonth()+1,{year:J,month:O}=Qy(ee,Q),R={year:J,month:O},j=await $O(n,J,O),I=Object.keys(c);w({status:"finding_months",monthsFound:j.length}),await new Promise($=>setTimeout($,100));const M={};let F=null;const k=Ar(n,R.year,R.month),{exists:Y,data:H}=await Le("months",k,"recalculate: reading previous month for starting balances");if(Y&&H&&(F=H,H.category_balances))for(const $ of H.category_balances)M[$.category_id]=$.end_balance??0;I.forEach($=>{M[$]===void 0&&(M[$]=0)});let N=0,G=0;for(let $=0;$<j.length;$++){const X=j[$],re=`${ml[X.month-1]} ${X.year}`;w({status:"processing_months",monthsFound:j.length,currentMonthIndex:$,currentMonthLabel:re});const ue=Ar(n,X.year,X.month),{exists:he,data:Se}=await Le("months",ue,`recalculate: reading full month data for ${re}`);if(!he||!Se){console.warn(`Month ${re} not found, skipping`);continue}const fe=Se.income||[],te=Se.expenses||[],Ee=Se.are_allocations_finalized||!1,De=fe.reduce((at,Wn)=>at+Wn.amount,0),st=te.reduce((at,Wn)=>at+Wn.amount,0);N+=De,G+=st;const He={};if(Se.category_balances)for(const at of Se.category_balances)He[at.category_id]={allocated:at.allocated??0};const Ft=I.map(at=>{const Wn=M[at]??0;let jr=0;Ee&&He[at]&&(jr=He[at].allocated);let It=0;te.length>0&&(It=te.filter(qt=>qt.category_id===at).reduce((qt,Yn)=>qt+Yn.amount,0));const Kn=Wn+jr+It;return{category_id:at,start_balance:Wn,allocated:jr,spent:It,end_balance:Kn}});Ft.forEach(at=>{M[at.category_id]=at.end_balance});const Ve=($===0?F:j[$-1])?.total_income??0,bt=Object.keys(h).map(at=>{const Wn=fe.filter(qt=>qt.account_id===at).reduce((qt,Yn)=>qt+Yn.amount,0),jr=te.filter(qt=>qt.account_id===at).reduce((qt,Yn)=>qt+Yn.amount,0),It=Wn+jr;let Kn=0;if(Se.account_balances){const qt=Se.account_balances.find(Yn=>Yn.account_id===at);qt&&(Kn=qt.start_balance??0)}return{account_id:at,start_balance:Kn,income:Wn,expenses:jr,net_change:It,end_balance:Kn+It}}),kt={budget_id:n,year_month_ordinal:wt(X.year,X.month),year:X.year,month:X.month,income:fe,total_income:De,previous_month_income:Ve,expenses:te,total_expenses:st,account_balances:bt,category_balances:Ft,are_allocations_finalized:Ee,created_at:Se.created_at||new Date().toISOString(),updated_at:new Date().toISOString()};await Ak({budgetId:n,month:kt,description:"recalculate all months"}),await new Promise(at=>setTimeout(at,50))}const W={};Object.keys(h).forEach($=>{W[$]=0});const ne=await Rr("months","recalculate: querying all months for account balances",[{field:"budget_id",op:"==",value:n}]);for(const $ of ne.docs){const X=Ar(n,$.data.year,$.data.month),{exists:re,data:ue}=await Le("months",X,`recalculate: reading month ${$.data.year}/${$.data.month} for account balances`);if(!re||!ue)continue;const he=ue.income||[],Se=ue.expenses||[];for(const fe of he)fe.account_id&&W[fe.account_id]!==void 0&&(W[fe.account_id]+=fe.amount);for(const fe of Se)fe.account_id&&W[fe.account_id]!==void 0&&(W[fe.account_id]-=fe.amount)}const ie={};Object.entries(h).forEach(([$,X])=>{ie[$]={...X,balance:W[$]??0}}),await p(ie),w({status:"updating_budget",monthsFound:j.length,monthsProcessed:j.length,totalIncomeRecalculated:N,totalExpensesRecalculated:G});const V={...M},z={};Object.entries(c).forEach(([$,X])=>{z[$]={...X,balance:V[$]??0}}),await f(z);for(const $ of j)$e.invalidateQueries({queryKey:xe.month(n,$.year,$.month)});w({status:"done",monthsFound:j.length,monthsProcessed:j.length,totalIncomeRecalculated:N,totalExpensesRecalculated:G})}catch(B){console.error("Recalculate error:",B),w({status:"error",error:B instanceof Error?B.message:"Failed to recalculate"})}finally{b(!1)}}}function q(){T(!1),w(null),e?.()}return d.jsxs(d.Fragment,{children:[d.jsxs("button",{onClick:D,disabled:t||_,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.5rem",cursor:t||_?"not-allowed":"pointer",opacity:t||_?.5:1,fontSize:"1rem",display:"flex",alignItems:"center",justifyContent:"center"},title:"Recalculate balances from this month forward",children:[_?"":""," Recalculate"]}),d.jsx(TL,{isOpen:v,onClose:q,onProceed:L,results:E})]})}function WS({direction:t,isDisabled:e,isLoading:n,disabledReason:i,onNavigate:a}){const[l,c]=A.useState(!1),h=n||e,f=t==="prev"?"":"",p=t==="prev"?"Previous month":"Next month",_=()=>{n||(e?(c(!0),setTimeout(()=>c(!1),2e3)):a())};return d.jsxs("div",{style:{position:"relative"},children:[d.jsx("button",{onClick:_,onMouseEnter:()=>e&&c(!0),onMouseLeave:()=>c(!1),style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"8px",padding:"0.75rem 1rem",cursor:h?"not-allowed":"pointer",fontSize:"1.25rem",opacity:h?.5:1,transition:"opacity 0.15s, background 0.15s"},title:e?void 0:p,children:f}),l&&e&&d.jsx("div",{style:{position:"absolute",top:"100%",...t==="prev"?{left:0}:{right:0},marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:ce.warning,color:"#000",borderRadius:"6px",fontSize:"0.75rem",fontWeight:500,width:"max-content",maxWidth:"min(300px, 50vw)",textAlign:"center",zIndex:20,boxShadow:"0 2px 8px rgba(0,0,0,0.3)"},children:i})]})}function CL(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1+3;for(;n>12;)n-=12,e+=1;return{year:e,month:n}}function AL(){const t=new Date;let e=t.getFullYear(),n=t.getMonth()+1-3;for(;n<1;)n+=12,e-=1;return{year:e,month:n}}function RL(t){return Object.keys(t).sort()[0]}function DL(t){const e=parseInt(t.slice(0,4),10),n=parseInt(t.slice(4,6),10);return{year:e,month:n}}function jL(t){const e=AL(),n=RL(t);if(!n)return e;const i=wt(e.year,e.month);return n<i?DL(n):e}function IL(t,e){return e===1?{year:t-1,month:12}:{year:t,month:e-1}}function ML(t,e){return e===12?{year:t+1,month:1}:{year:t,month:e+1}}function OL({onPreviousMonth:t,onNextMonth:e}){const{isLoading:n}=Qn(),{currentYear:i,currentMonthNumber:a,isAdmin:l,selectedBudgetId:c,currentUserId:h,setCurrentYear:f,setCurrentMonthNumber:p}=zt(),{budget:_,monthMap:b}=Pn(c,h),{month:v}=uo(c,i,a),T=IL(i,a),E=ML(i,a),w=jL(b),D=CL(),L=wt(w.year,w.month),q=wt(D.year,D.month),B=wt(T.year,T.month),ee=wt(E.year,E.month),Q=B<L,J=ee>q,[O,R]=A.useState(!1),[j,I]=A.useState(!1),[M,F]=A.useState(i),[k,Y]=A.useState(a),H=A.useRef(null);A.useEffect(()=>{if(!O)return;function ne(ie){H.current&&!H.current.contains(ie.target)&&(R(!1),I(!1))}return document.addEventListener("mousedown",ne),()=>document.removeEventListener("mousedown",ne)},[O]);function N(){j||(F(i),Y(a)),I(!j)}function G(){f(M),p(k),I(!1),R(!1)}function W(){if(!v||!_)return;const ne={...v,_meta:{downloaded_at:new Date().toISOString(),budget_id:_.id,budget_name:_.name}},ie=new Blob([JSON.stringify(ne,null,2)],{type:"application/json"}),V=URL.createObjectURL(ie),z=document.createElement("a");z.href=V,z.download=`month_${i}_${String(a).padStart(2,"0")}.json`,document.body.appendChild(z),z.click(),document.body.removeChild(z),URL.revokeObjectURL(V),R(!1)}return d.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px"},children:[d.jsx(WS,{direction:"prev",isDisabled:Q,isLoading:n,disabledReason:"Cannot create months more than 3 months into the past",onNavigate:t}),d.jsxs("div",{ref:H,style:{textAlign:"center",minWidth:"180px",position:"relative"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"flex-start",justifyContent:"center",gap:"0.25rem"},children:[d.jsxs("h2",{style:{margin:0,fontSize:"1.5rem"},children:[ml[a-1]," ",i]}),d.jsx("button",{onClick:()=>R(!O),style:{background:"transparent",border:"none",cursor:"pointer",fontSize:"0.5rem",opacity:.4,padding:"0.15rem",borderRadius:"4px",transition:"opacity 0.15s, transform 0.15s",transform:O?"rotate(180deg)":"rotate(0deg)",marginTop:"0.25rem"},title:"Month options",children:""})]}),n&&d.jsxs(d.Fragment,{children:[d.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),d.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.4rem",marginTop:"0.35rem"},children:[d.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid color-mix(in srgb, currentColor 20%, transparent)",borderTopColor:ce.primary,borderRadius:"50%",animation:"spin 0.8s linear infinite"}}),d.jsx("span",{style:{fontSize:"0.8rem",opacity:.6},children:"Loading..."})]})]}),O&&d.jsxs("div",{style:{position:"absolute",top:"100%",left:"50%",transform:"translateX(-50%)",marginTop:"0.5rem",background:"var(--background, #242424)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"8px",padding:"0.25rem",zIndex:100,minWidth:"160px",boxShadow:"0 4px 12px rgba(0,0,0,0.3)"},children:[d.jsx(u_,{isDisabled:n,onCloseMenu:()=>R(!1)}),d.jsx("button",{onClick:N,style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Jump to a specific month",children:" Go to Month"}),j&&(()=>{const ne=w.year,ie=D.year,V=M>ne,z=M<ie;return d.jsxs("div",{style:{padding:"0.75rem",borderTop:"1px solid color-mix(in srgb, currentColor 15%, transparent)",marginTop:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[d.jsx("button",{onClick:()=>F($=>$-1),disabled:!V,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:V?"pointer":"not-allowed",fontSize:"0.8rem",opacity:V?1:.3},title:V?"Previous year":"Cannot go further back",children:""}),d.jsx("span",{style:{flex:1,textAlign:"center",fontSize:"0.9rem",fontWeight:500},children:M}),d.jsx("button",{onClick:()=>F($=>$+1),disabled:!z,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",border:"none",borderRadius:"4px",padding:"0.25rem 0.5rem",cursor:z?"pointer":"not-allowed",fontSize:"0.8rem",opacity:z?1:.3},title:z?"Next year":"Cannot go further ahead",children:""})]}),d.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.25rem",marginBottom:"0.5rem"},children:ml.map(($,X)=>{const re=X+1,ue=re===k,he=M===i&&re===a,Se=wt(M,re),fe=Se<L,te=Se>q,Ee=fe||te;let De=$;return fe?De="Too far in the past":te&&(De="Too far in the future"),d.jsx("button",{onClick:()=>Y(re),disabled:Ee,style:{background:ue?ce.primary:"color-mix(in srgb, currentColor 8%, transparent)",border:he?`1px solid ${ce.primary}`:"1px solid transparent",borderRadius:"4px",padding:"0.35rem 0.25rem",cursor:Ee?"not-allowed":"pointer",fontSize:"0.7rem",color:ue?"#fff":"inherit",opacity:Ee?.3:1,transition:"background 0.15s"},title:De,children:$.slice(0,3)},re)})}),(()=>{const $=wt(M,k),X=$>=L&&$<=q;return d.jsxs("button",{onClick:G,disabled:!X,style:{width:"100%",background:X?ce.primary:"color-mix(in srgb, currentColor 20%, transparent)",border:"none",borderRadius:"6px",padding:"0.5rem",cursor:X?"pointer":"not-allowed",fontSize:"0.85rem",color:X?"#fff":"inherit",fontWeight:500,opacity:X?1:.5},children:["Go to ",ml[k-1]," ",M]})})()]})})(),l&&v&&d.jsx("button",{onClick:()=>{W()},style:{display:"flex",alignItems:"center",gap:"0.5rem",width:"100%",background:"transparent",border:"none",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",transition:"background 0.15s"},title:"Download month document as JSON (for debugging)",children:" Download JSON"})]})]}),d.jsx(WS,{direction:"next",isDisabled:J,isLoading:n,disabledReason:"Cannot create months more than 3 months into the future",onNavigate:e})]})}const kL={background:ce.primary,border:"none",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px",color:"white"},NL={background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"},PL={background:"transparent",border:`1px solid ${ce.errorBorder}`,color:ce.error,cursor:"pointer",fontSize:"0.9rem",padding:"0.35rem 0.5rem",borderRadius:"4px"};function WT({accounts:t,accountGroups:e,categories:n,categoryGroups:i,payees:a,initialData:l,defaultAccountId:c,defaultDate:h,config:f,onSubmit:p,onCancel:_,onDelete:b,extraContent:v}){const{isWide:T}=BP(),{showCategory:E=!1,showCleared:w=!1,accountLabel:D="Account",payeePlaceholder:L="Payee name",descriptionPlaceholder:q="Optional note",submitLabel:B}=f,ee=new Date().toISOString().split("T")[0],[Q,J]=A.useState(l?.date||h||ee),[O,R]=A.useState(l?.payee||""),[j,I]=A.useState(l?.categoryId||""),[M,F]=A.useState(l?.accountId||c||(t[0]?t[0][0]:"")),[k,Y]=A.useState(l?.amount?.toString()||""),[H,N]=A.useState(l?.description||""),[G,W]=A.useState(l?.cleared||!1),ne={},ie=[];t.forEach(([te,Ee])=>{Ee.account_group_id?(ne[Ee.account_group_id]||(ne[Ee.account_group_id]=[]),ne[Ee.account_group_id].push([te,Ee])):ie.push([te,Ee])});function V(te){te.preventDefault();const Ee=parseFloat(k);isNaN(Ee)||Ee<=0||E&&!j||!M||!Q||p({date:Q,payee:O.trim()||void 0,categoryId:E?j:void 0,accountId:M,amount:Ee,description:H.trim()||void 0,cleared:w?G:void 0})}const z=d.jsxs(pu,{id:"txn-account",value:M,onChange:te=>F(te.target.value),required:!0,style:{fontSize:"0.85rem",padding:"0.5rem"},children:[Object.entries(e).map(([te,Ee])=>{const De=ne[te];return De?.length?d.jsx("optgroup",{label:Ee.name,children:De.map(([st,He])=>d.jsx("option",{value:st,children:He.nickname},st))},te):null}),ie.length>0&&d.jsx("optgroup",{label:"Other",children:ie.map(([te,Ee])=>d.jsx("option",{value:te,children:Ee.nickname},te))})]}),$=E&&n&&i?d.jsx(en,{label:"Category",htmlFor:"txn-category",children:d.jsx(EP,{id:"txn-category",value:j,onChange:I,categories:n,categoryGroups:i,placeholder:"Search...",required:!0,showAdjustmentOption:f.showAdjustmentCategory})}):null,X=w?d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.35rem"},children:[d.jsx("label",{htmlFor:"txn-cleared",style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:"Clr"}),d.jsx(Ls,{id:"txn-cleared",checked:G,onChange:te=>W(te.target.checked)})]}):null,re=d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:"0.25rem",paddingBottom:"0.1rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.7,fontWeight:500},children:""}),d.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[d.jsx("button",{type:"submit",title:B,style:kL,children:""}),d.jsx("button",{type:"button",onClick:()=>{_()},title:"Cancel",style:NL,children:""}),b&&d.jsx("button",{type:"button",onClick:()=>{b()},title:"Delete",style:PL,children:""})]})]}),ue=d.jsxs(co,{children:[d.jsx(Ie,{type:"submit",actionName:B,children:B}),d.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Transaction Form",onClick:_,children:"Cancel"}),b&&d.jsx(Ie,{type:"button",variant:"danger",actionName:"Delete Transaction",onClick:b,children:" Delete"})]}),he=E&&n&&i,Se={fontSize:"0.85rem",padding:"0.5rem"};if(!T)return d.jsxs(Ja,{actionName:B,onSubmit:V,children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[d.jsx(en,{label:"Date",htmlFor:"txn-date",children:d.jsx(US,{id:"txn-date",value:Q,onChange:te=>J(te.target.value),required:!0})}),d.jsx(en,{label:"Amount",htmlFor:"txn-amount",children:d.jsx(Jg,{id:"txn-amount",value:k,onChange:Y,placeholder:"$0.00",required:!0,autoFocus:!0})})]}),d.jsx(en,{label:"Payee",htmlFor:"txn-payee",children:d.jsx(VS,{id:"txn-payee",value:O,onChange:R,payees:a,placeholder:L})}),$,d.jsx(en,{label:D,htmlFor:"txn-account",children:z}),d.jsx(en,{label:"Description (optional)",htmlFor:"txn-description",children:d.jsx(Za,{id:"txn-description",value:H,onChange:te=>N(te.target.value),placeholder:q})}),w&&d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx(Ls,{id:"txn-cleared-stacked",checked:G,onChange:te=>W(te.target.checked)}),d.jsx("label",{htmlFor:"txn-cleared-stacked",style:{fontSize:"0.9rem",cursor:"pointer"},children:"Cleared (appeared in bank account)"})]}),v]}),ue]});const fe=he?w?"6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) 6rem minmax(10rem, 2fr) auto auto":"6rem minmax(8rem, 1fr) minmax(8rem, 1fr) minmax(8rem, 1fr) 6rem minmax(10rem, 2fr) auto":w?"6rem minmax(10rem, 1fr) minmax(10rem, 1fr) 6rem minmax(12rem, 2fr) auto auto":"6rem minmax(10rem, 1fr) minmax(10rem, 1fr) 6rem minmax(12rem, 2fr) auto";return d.jsxs(Ja,{actionName:B,onSubmit:V,children:[d.jsxs("div",{style:{display:"grid",gridTemplateColumns:fe,gap:"1rem",alignItems:"end"},children:[d.jsx(en,{label:"Date",htmlFor:"txn-date",children:d.jsx(US,{id:"txn-date",value:Q,onChange:te=>J(te.target.value),required:!0,style:Se})}),d.jsx(en,{label:"Payee",htmlFor:"txn-payee",children:d.jsx(VS,{id:"txn-payee",value:O,onChange:R,payees:a,placeholder:L})}),$,d.jsx(en,{label:D,htmlFor:"txn-account",children:z}),d.jsx(en,{label:"Amount",htmlFor:"txn-amount",children:d.jsx(Jg,{id:"txn-amount",value:k,onChange:Y,placeholder:"$0.00",required:!0,autoFocus:!0})}),d.jsx(en,{label:"Description",htmlFor:"txn-description",children:d.jsx(Za,{id:"txn-description",value:H,onChange:te=>N(te.target.value),placeholder:q,style:Se})}),X,re]}),v]})}function KS({accounts:t,accountGroups:e,payees:n,initialData:i,defaultAccountId:a,defaultDate:l,onSubmit:c,onCancel:h,onDelete:f,submitLabel:p}){function _(b){c(b.amount,b.accountId,b.date,b.payee,b.description)}return d.jsx(WT,{accounts:t,accountGroups:e,payees:n,initialData:i?{date:i.date,payee:i.payee,accountId:i.account_id,amount:i.amount,description:i.description}:void 0,defaultAccountId:a,defaultDate:l,config:{showCategory:!1,showCleared:!1,accountLabel:"Deposit To",payeePlaceholder:"e.g., Employer, Client name",descriptionPlaceholder:"e.g., January paycheck",submitLabel:p},onSubmit:_,onCancel:h,onDelete:f})}const el={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function LL(){const{selectedBudgetId:t,currentUserId:e,currentYear:n,currentMonthNumber:i,setCurrentYear:a,setCurrentMonthNumber:l}=zt(),{accounts:c,accountGroups:h}=Pn(t,e),{month:f,isLoading:p,addIncome:_,updateIncome:b,deleteIncome:v}=uo(t,n,i),T=da(),[E,w]=A.useState(null),[D,L]=A.useState(!1),[q,B]=A.useState(null),J=F1(t,{enabled:D||q!==null}).data||[];function O(W){const ne=W.account_group_id?h[W.account_group_id]:void 0;return ne?.is_active!==void 0?ne.is_active:W.is_active!==!1}function R(W){const ne=W.account_group_id?h[W.account_group_id]:void 0;return ne?.on_budget!==void 0?ne.on_budget:W.on_budget!==!1}const j=Object.entries(c).filter(([,W])=>O(W)&&R(W)),I=j.filter(([,W])=>W.is_income_account),M=I.length>0?I:j,F=j.find(([,W])=>W.is_income_default),k=F?F[0]:void 0,Y=f?.income.reduce((W,ne)=>W+ne.amount,0)||0;function H(W,ne,ie,V,z){w(null),L(!1);const[$,X]=ie.split("-").map(Number);_(W,ne,ie,V,z).then(()=>{($!==n||X!==i)&&(a($),l(X))}).catch(re=>{w(re instanceof Error?re.message:"Failed to add income")})}function N(W,ne,ie,V,z,$){w(null),B(null),b(W,ne,ie,V,z,$).catch(X=>{w(X instanceof Error?X.message:"Failed to update income")})}function G(W){confirm("Are you sure you want to delete this income entry?")&&(w(null),v(W).catch(ne=>{w(ne instanceof Error?ne.message:"Failed to delete income")}))}return d.jsxs("div",{style:{opacity:p?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:p?"none":"auto"},children:[E&&d.jsx("div",{style:{background:`color-mix(in srgb, ${ce.error} 15%, transparent)`,border:`1px solid ${ce.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ce.error},children:E}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:T?"1fr":"5rem 1.5fr 2fr 7rem 1.5fr 3rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:"grid",gridTemplateColumns:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Income:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:Tt(Y),fontWeight:600},children:ke(Y)})]})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!D&&d.jsx(Ie,{actionName:"Open Add Income Form",onClick:()=>L(!0),disabled:M.length===0,style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Income"})})]}),!T&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:el,children:"Date"}),d.jsx("div",{style:el,children:"Payee"}),d.jsx("div",{style:el,children:"Account"}),d.jsx("div",{style:{...el,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:el,children:"Description"}),d.jsx("div",{style:el})]})]}),d.jsx("div",{style:{gridColumn:"1 / -1",fontSize:"0.8rem",opacity:.55,fontStyle:"italic",padding:"0.5rem 0"},children:" All income entries on this page count towards the tithing owed calculation."}),M.length===0&&d.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:[Object.keys(c).length===0?"You need to create at least one account before adding income.":'No accounts are set up for income deposits. Edit an account and enable "Show in income deposit list".'," ",d.jsx(Dt,{to:"/budget/accounts",style:{color:ce.primaryLight},children:"Manage accounts "})]}),D&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(KS,{accounts:M,accountGroups:h,payees:J,defaultAccountId:k,defaultDate:`${n}-${String(i).padStart(2,"0")}-01`,onSubmit:H,onCancel:()=>L(!1),submitLabel:"Add Income",isMobile:T})}),f?.income.slice().sort((W,ne)=>(W.date||"").localeCompare(ne.date||"")).map((W,ne)=>q===W.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(KS,{accounts:M,accountGroups:h,payees:J,initialData:W,onSubmit:(ie,V,z,$,X)=>N(W.id,ie,V,z,$,X),onCancel:()=>B(null),onDelete:()=>G(W.id),submitLabel:"Save",isMobile:T})},W.id):d.jsx(BL,{income:W,accountName:or(W.account_id)?Wh:c[W.account_id]?.nickname||"Unknown Account",accountGroupName:or(W.account_id)?void 0:c[W.account_id]?.account_group_id?h[c[W.account_id].account_group_id]?.name:void 0,onEdit:()=>{W.payee||`${W.amount}`,B(W.id)},onDelete:()=>G(W.id),isMobile:T,isEvenRow:ne%2===0},W.id)),(!f?.income||f.income.length===0)&&!D&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No income recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function BL({income:t,accountName:e,accountGroupName:n,onEdit:i,onDelete:a,isMobile:l,isEvenRow:c}){const h=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",f=n?`${n} / ${e}`:e,p=c?"color-mix(in srgb, currentColor 3%, transparent)":"color-mix(in srgb, currentColor 6%, transparent)";if(l)return d.jsxs("div",{onClick:i,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:p,cursor:"pointer",transition:"background 0.15s"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:h}),d.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""})]}),d.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",f]})]}),d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsxs("span",{style:{fontWeight:600,color:ce.success,fontFamily:"monospace"},children:["+",ke(t.amount)]})})]});const _={padding:"0.6rem 0.25rem",background:p,display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{display:"contents"},children:[d.jsx("div",{style:{..._,fontSize:"0.85rem",opacity:.6,fontFamily:"monospace"},children:h}),d.jsx("div",{style:{..._,fontWeight:500,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),d.jsx("div",{style:{..._,opacity:.7,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem"},children:f})}),d.jsxs("div",{style:{..._,justifyContent:"flex-end",fontWeight:600,color:ce.success,fontFamily:"monospace"},children:["+",ke(t.amount)]}),d.jsx("div",{style:{..._,paddingLeft:"0.5rem",opacity:.6,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem"},children:t.description||""})}),d.jsxs("div",{style:{..._,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:i,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:a,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:b=>b.currentTarget.style.opacity="1",onMouseLeave:b=>b.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}function YS({accounts:t,accountGroups:e,categories:n,categoryGroups:i,payees:a,initialData:l,defaultAccountId:c,defaultDate:h,onSubmit:f,onCancel:p,onDelete:_,submitLabel:b}){function v(T){f(T.amount,T.categoryId,T.accountId,T.date,T.payee,T.description,T.cleared)}return d.jsx(WT,{accounts:t,accountGroups:e,categories:n,categoryGroups:i,payees:a,initialData:l?{date:l.date,payee:l.payee,categoryId:l.category_id,accountId:l.account_id,amount:l.amount,description:l.description,cleared:l.cleared}:void 0,defaultAccountId:c,defaultDate:h,config:{showCategory:!0,showCleared:!0,showAdjustmentCategory:!0,accountLabel:"Pay From",payeePlaceholder:"e.g., Grocery Store",descriptionPlaceholder:"e.g., Weekly groceries",submitLabel:b},onSubmit:v,onCancel:p,onDelete:_})}const Ps={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"1px solid rgba(255,255,255,0.1)"};function VL(){const{selectedBudgetId:t,currentUserId:e,currentYear:n,currentMonthNumber:i,setCurrentYear:a,setCurrentMonthNumber:l}=zt(),{accounts:c,accountGroups:h,categories:f,categoryGroups:p}=Pn(t,e),{month:_,isLoading:b,addExpense:v,updateExpense:T,deleteExpense:E}=uo(t,n,i),w=da(),[D,L]=A.useState(null),[q,B]=A.useState(!1),[ee,Q]=A.useState(null),R=F1(t,{enabled:q||ee!==null}).data||[];function j(ie){const V=ie.account_group_id?h[ie.account_group_id]:void 0;return V?.is_active!==void 0?V.is_active:ie.is_active!==!1}function I(ie){const V=ie.account_group_id?h[ie.account_group_id]:void 0;return V?.on_budget!==void 0?V.on_budget:ie.on_budget!==!1}const M=Object.entries(c).filter(([,ie])=>j(ie)&&I(ie)),F=M.filter(([,ie])=>ie.is_outgo_account),k=F.length>0?F:M,Y=M.find(([,ie])=>ie.is_outgo_default),H=Y?Y[0]:void 0,N=_?.expenses?.reduce((ie,V)=>ie+V.amount,0)||0;function G(ie,V,z,$,X,re,ue){L(null),B(!1);const[he,Se]=$.split("-").map(Number);v(ie,V,z,$,X,re,ue).then(()=>{(he!==n||Se!==i)&&(a(he),l(Se))}).catch(fe=>{L(fe instanceof Error?fe.message:"Failed to add expense")})}function W(ie,V,z,$,X,re,ue,he){L(null),Q(null),T(ie,V,z,$,X,re,ue,he).catch(Se=>{L(Se instanceof Error?Se.message:"Failed to update expense")})}function ne(ie){confirm("Are you sure you want to delete this expense?")&&(L(null),E(ie).catch(V=>{L(V instanceof Error?V.message:"Failed to delete expense")}))}return d.jsxs("div",{style:{opacity:b?.5:1,transition:"opacity 0.15s ease-out",pointerEvents:b?"none":"auto"},children:[D&&d.jsx("div",{style:{background:`color-mix(in srgb, ${ce.error} 15%, transparent)`,border:`1px solid ${ce.error}`,borderRadius:"8px",padding:"0.75rem",marginBottom:"1rem",color:ce.error},children:D}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:w?"1fr":"5rem 1.5fr 7rem 1fr 6rem 1fr 3rem 4rem"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",borderBottom:"1px solid rgba(255,255,255,0.15)",display:"grid",gridTemplateColumns:"subgrid"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Expenses:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:Tt(N),fontWeight:600},children:cr(N)})]})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:!q&&d.jsx(Ie,{actionName:"Open Add Expense Form",onClick:()=>B(!0),disabled:k.length===0||Object.keys(f).length===0,style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:"+ Add Expense"})})]}),!w&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:Ps,children:"Date"}),d.jsx("div",{style:Ps,children:"Payee"}),d.jsx("div",{style:{...Ps,textAlign:"center"},children:"Category"}),d.jsx("div",{style:Ps,children:"Account"}),d.jsx("div",{style:{...Ps,textAlign:"right"},children:"Amount"}),d.jsx("div",{style:Ps,children:"Description"}),d.jsx("div",{style:{...Ps,textAlign:"center"},children:"Clr"}),d.jsx("div",{style:Ps})]})]}),k.length===0&&d.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:[Object.keys(c).length===0?"You need to create at least one account before adding expenses.":'No accounts are set up for expenses. Edit an account and enable "Show in expense list".'," ",d.jsx(Dt,{to:"/budget/accounts",style:{color:ce.primaryLight},children:"Manage accounts "})]}),Object.keys(f).length===0&&d.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,fontSize:"0.9rem",padding:"1rem 0"},children:["You need to create at least one category before adding expenses."," ",d.jsx(Dt,{to:"/budget/settings/categories",style:{color:ce.primaryLight},children:"Create categories "})]}),q&&d.jsx("div",{style:{gridColumn:"1 / -1",marginBottom:"1rem"},children:d.jsx(YS,{accounts:k,accountGroups:h,categories:f,categoryGroups:p,payees:R,defaultAccountId:H,defaultDate:`${n}-${String(i).padStart(2,"0")}-01`,onSubmit:G,onCancel:()=>B(!1),submitLabel:"Add Expense",isMobile:w})}),_?.expenses?.slice().sort((ie,V)=>(ie.date||"").localeCompare(V.date||"")).map((ie,V)=>ee===ie.id?d.jsx("div",{style:{gridColumn:"1 / -1",padding:"0.5rem"},children:d.jsx(YS,{accounts:k,accountGroups:h,categories:f,categoryGroups:p,payees:R,initialData:ie,onSubmit:(z,$,X,re,ue,he,Se)=>W(ie.id,z,$,X,re,ue,he,Se),onCancel:()=>Q(null),onDelete:()=>ne(ie.id),submitLabel:"Save",isMobile:w})},ie.id):d.jsx(UL,{expense:ie,categoryName:Gi(ie.category_id)?qa:f[ie.category_id]?.name||"Unknown Category",accountName:or(ie.account_id)?Wh:c[ie.account_id]?.nickname||"Unknown Account",accountGroupName:or(ie.account_id)?void 0:c[ie.account_id]?.account_group_id?h[c[ie.account_id].account_group_id]?.name:void 0,onEdit:()=>{ie.payee||`${ie.amount}`,Q(ie.id)},onDelete:()=>ne(ie.id),isMobile:w,isEvenRow:V%2===0},ie.id)),(!_?.expenses||_.expenses.length===0)&&!q&&d.jsx("p",{style:{gridColumn:"1 / -1",opacity:.5,fontSize:"0.9rem",textAlign:"center",padding:"1.5rem"},children:"No expenses recorded for this month"}),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}function UL({expense:t,categoryName:e,accountName:n,accountGroupName:i,onEdit:a,onDelete:l,isMobile:c,isEvenRow:h}){const f=t.date?new Date(t.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"}):"",p=i?`${i} / ${n}`:n,_=h?"color-mix(in srgb, currentColor 3%, transparent)":"color-mix(in srgb, currentColor 6%, transparent)";if(c)return d.jsxs("div",{onClick:a,style:{gridColumn:"1 / -1",display:"grid",gridTemplateColumns:"1fr auto",gap:"0.5rem",padding:"0.75rem 1rem",background:_,cursor:"pointer",transition:"background 0.15s"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{fontSize:"0.75rem",opacity:.5,fontFamily:"monospace",minWidth:"3rem"},children:f}),d.jsx("span",{style:{fontWeight:500,fontSize:"0.9rem"},children:t.payee||""}),t.cleared&&d.jsx("span",{style:{fontSize:"0.7rem",color:ce.success},title:"Cleared",children:""})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("span",{style:{fontSize:"0.7rem",background:`color-mix(in srgb, ${ce.primary} 20%, transparent)`,color:ce.primaryLight,padding:"0.1rem 0.4rem",borderRadius:"3px"},children:e}),d.jsxs("span",{style:{fontSize:"0.75rem",opacity:.6},children:[" ",p]})]})]}),d.jsx("div",{style:{display:"flex",alignItems:"center"},children:d.jsx("span",{style:{fontWeight:600,color:Tt(t.amount),fontFamily:"monospace"},children:cr(t.amount)})})]});const b={padding:"0.6rem 0.25rem",background:_,display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{display:"contents"},children:[d.jsx("div",{style:{...b,fontSize:"0.85rem",opacity:.6,fontFamily:"monospace"},children:f}),d.jsx("div",{style:{...b,fontWeight:500,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.payee||""})}),d.jsx("div",{style:{...b,justifyContent:"center"},children:d.jsx("span",{style:{fontSize:"0.8rem",background:`color-mix(in srgb, ${ce.primary} 15%, transparent)`,color:ce.primaryLight,padding:"0.2rem 0.5rem",borderRadius:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e})}),d.jsx("div",{style:{...b,opacity:.7,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.85rem"},children:p})}),d.jsx("div",{style:{...b,justifyContent:"flex-end",fontWeight:600,color:Tt(t.amount),fontFamily:"monospace"},children:cr(t.amount)}),d.jsx("div",{style:{...b,paddingLeft:"0.5rem",opacity:.6,overflow:"hidden"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontSize:"0.8rem"},children:t.description||""})}),d.jsx("div",{style:{...b,justifyContent:"center",color:t.cleared?ce.success:"inherit",opacity:t.cleared?1:.3,fontSize:"1rem"},children:t.cleared?"":""}),d.jsxs("div",{style:{...b,justifyContent:"flex-end",gap:"0.25rem"},children:[d.jsx("button",{onClick:a,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Edit",children:""}),d.jsx("button",{onClick:l,style:{background:"transparent",border:"none",cursor:"pointer",opacity:.5,fontSize:"0.85rem",padding:"0.25rem",transition:"opacity 0.15s"},onMouseEnter:v=>v.currentTarget.style.opacity="1",onMouseLeave:v=>v.currentTarget.style.opacity="0.5",title:"Delete",children:""})]})]})}function zL({isOpen:t,onClose:e,onDeleted:n}){const{addLoadingHold:i,removeLoadingHold:a}=Qn(),{selectedBudgetId:l,currentYear:c,currentMonthNumber:h}=zt(),{deleteAllocations:f}=G1(),[p,_]=A.useState(null),b=async()=>{if(l){_(null),i("allocations-delete","Deleting allocations...");try{await f({budgetId:l,year:c,month:h}),e(),n?.()}catch(v){_(v instanceof Error?v.message:"Failed to delete allocations")}finally{a("allocations-delete")}}};return d.jsxs(aa,{isOpen:t,onClose:e,title:"Delete Allocations",children:[p&&d.jsx(lo,{message:p,onDismiss:()=>_(null)}),d.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to delete all allocations for this month? This will remove all allocated amounts and reset the month to unfinalized."}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(Ie,{actionName:"Cancel Delete Allocations",variant:"secondary",onClick:e,children:"Cancel"}),d.jsx(Ie,{actionName:"Confirm Delete Allocations",variant:"danger",onClick:b,children:"Delete Allocations"})]})]})}function XS({isDraftMode:t,isEditingAppliedAllocations:e,availableNow:n,currentMonthIncome:i,balanceTotals:a,draftChangeAmount:l,availableAfterApply:c,currentDraftTotal:h}){const f=t&&h!==void 0?h:a.allocated;return d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{fontWeight:600,color:t||e?ce.primary:"inherit",marginRight:"0.25rem"},children:t||e?"Allocations Worksheet:":"Month Summary:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:t?"Avail: ":"Inc: "}),t?d.jsx("span",{style:{color:Tt(n),fontWeight:600},children:ke(n)}):d.jsxs("span",{style:{color:ce.success,fontWeight:600},children:["+",ke(i)]})]}),d.jsxs("span",{children:[t&&d.jsx("span",{style:{opacity:.6},children:" "}),d.jsx("span",{style:{opacity:.6},children:t?"Draft: ":"Alloc: "}),d.jsxs("span",{style:{color:t?ce.primary:ce.success,fontWeight:600},children:[t?"":"+",ke(t?f:a.allocated)]}),e&&l!==0&&d.jsxs("span",{style:{fontSize:"0.85em",color:l>0?ce.warning:ce.success,marginLeft:"0.25rem"},children:["(",cr(l),")"]})]}),!t&&d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Spent: "}),d.jsx("span",{style:{color:ql(a.spent),fontWeight:600},children:wi(a.spent)})]}),d.jsxs("span",{children:[t&&d.jsx("span",{style:{opacity:.6},children:"= "}),d.jsx("span",{style:{opacity:.6},children:t?"Remaining: ":"Net: "}),t?d.jsx("span",{style:{color:Tt(c),fontWeight:600},children:ke(c)}):d.jsx("span",{style:{color:Tt(a.allocated+a.spent),fontWeight:600},children:ke(a.allocated+a.spent)})]})]})}function FL({totals:t}){return d.jsxs(d.Fragment,{children:[d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Start: "}),d.jsx("span",{style:{color:Tt(t.start),fontWeight:600},children:ke(t.start)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Inc: "}),d.jsxs("span",{style:{color:ce.success,fontWeight:600},children:["+",ke(t.income)]})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Exp: "}),d.jsx("span",{style:{color:ql(t.expenses),fontWeight:600},children:wi(t.expenses)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"End: "}),d.jsx("span",{style:{color:Tt(t.end),fontWeight:600},children:ke(t.end)})]})]})}function hg({isDraftMode:t,isEditingAppliedAllocations:e,allocationsFinalized:n,onSave:i,onApply:a,onEdit:l,onCancel:c,onDelete:h}){return d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:[t&&!e&&d.jsxs(d.Fragment,{children:[d.jsx(Ie,{actionName:"Save Draft Allocations",onClick:i,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Save"}),d.jsx(Ie,{actionName:"Apply Allocations",onClick:a,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"})]}),!t&&n&&d.jsx(Ie,{actionName:"Edit Allocations",onClick:l,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Edit Allocations"}),e&&d.jsxs(d.Fragment,{children:[d.jsx(Ie,{actionName:"Apply Allocations",onClick:a,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:" Apply"}),d.jsx(Ie,{actionName:"Cancel Edit Allocations",onClick:c,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em"},children:""}),d.jsx(Ie,{actionName:"Open Delete Allocations Modal",onClick:h,variant:"secondary",style:{fontSize:"0.8rem",padding:"0.4em 0.8em",color:ce.error},children:""})]})]})}function qL({category:t,balance:e,localAllocation:n,previousMonthIncome:i,isDraftMode:a,onAllocationChange:l,projectedAllTime:c}){const h=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,f=h?t.default_monthly_amount/100*i:0,p=h?f.toFixed(2):n,_=a&&!h,b=a?c:t.balance??0,v=t.balance??0,T=v<0,E=T?Math.abs(v):0,w=h?f:parseFloat(n)||0,D=T?Math.min(w,E):0,L=T?Math.max(0,w-E):0,q=T&&w>0&&L>0;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem"},children:d.jsx("span",{style:{fontWeight:500},children:t.name})}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),d.jsx("span",{style:{color:Nn(e.start_balance)},children:kn(e.start_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Alloc"}),_?d.jsxs(d.Fragment,{children:[d.jsx("input",{type:"text",inputMode:"decimal",value:p?`$${p}`:"",onChange:B=>{const ee=B.target.value.replace(/[^\d.]/g,"");l(ee)},placeholder:"$0",style:{width:"100%",maxWidth:"80px",padding:"0.25rem 0.35rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 8%, transparent)",fontSize:"0.8rem",color:"inherit",boxSizing:"border-box"}}),T&&w>0&&d.jsxs("div",{style:{fontSize:"0.65rem",marginTop:"0.15rem",lineHeight:1.3},children:[d.jsxs("span",{style:{color:ce.debt,display:"block"},children:[ke(D),"  debt"]}),q&&d.jsxs("span",{style:{color:ce.success,display:"block"},children:[ke(L),"  balance"]})]})]}):d.jsx("span",{style:{color:Bf(e.allocated)},children:cr(e.allocated)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Spent"}),d.jsx("span",{style:{color:ql(e.spent)},children:wi(e.spent)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),d.jsx("span",{style:{color:Nn(e.end_balance)},children:kn(e.end_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:a?"Proj. All-Time":"All-Time"}),d.jsx("span",{style:{color:a?b<0?ce.debt:ce.primary:Nn(b)},children:kn(b)})]})]}),a&&h&&d.jsx("div",{style:{marginTop:"0.5rem"},children:d.jsxs("span",{style:{fontSize:"0.8rem"},children:[d.jsxs("span",{style:{opacity:.6},children:[ke(i),"  "]}),d.jsxs("span",{style:{color:ce.primary},children:[t.default_monthly_amount,"%"]}),d.jsx("span",{style:{opacity:.6},children:" = "}),d.jsx("span",{style:{color:ce.primary},children:ke(f)})]})})]})}function JS({name:t,categories:e,groupTotals:n,getCategoryBalance:i,localAllocations:a,savedAllocations:l,previousMonthIncome:c,isDraftMode:h,onAllocationChange:f,isMobile:p,isUngrouped:_,getAllocationAmount:b}){const v={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600},T=n.allocated+n.spent,E=e.reduce((w,[D,L])=>{const q=L.balance??0;if(h){const B=b(D,L),ee=l[D]??0,Q=B-ee;return w+q+Q}return w+q},0);return d.jsxs("div",{style:{display:"contents"},children:[!p&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...v,paddingLeft:"0.5rem",opacity:_?.7:1},children:[d.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:t}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),d.jsx("div",{style:{...v,justifyContent:"flex-end",color:Nn(n.start)},children:d.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:kn(n.start)})}),d.jsx("div",{style:{...v,justifyContent:h?"center":"flex-end",color:Bf(n.allocated)},children:d.jsxs("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:["+",ke(n.allocated)]})}),d.jsx("div",{style:{...v,justifyContent:"flex-end",color:ql(n.spent)},children:d.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:wi(n.spent)})}),d.jsx("div",{style:{...v,justifyContent:"flex-end",color:Nn(T)},children:d.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:cr(T)})}),d.jsx("div",{style:{...v,justifyContent:"flex-end",color:Nn(n.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:d.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:kn(n.end)})}),d.jsx("div",{style:{...v,justifyContent:"flex-end",color:E<0?ce.debt:ce.primary},children:d.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:kn(E)})})]}),!h&&p&&d.jsxs("div",{style:{gridColumn:"1 / -1",paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.04)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsxs("span",{style:{fontWeight:600,opacity:_?.7:1},children:[d.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:t}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),d.jsx("span",{style:{fontWeight:600,color:Nn(n.end),borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:kn(n.end)})]}),e.map(([w,D],L)=>{const q=i(w);if(!q)return null;const B=D.balance??0;let ee=B;if(h){const Q=b(w,D),J=l[w]??0,O=Q-J;ee=B+O}return p?d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsx(qL,{category:D,balance:q,localAllocation:a[w]||"",previousMonthIncome:c,isDraftMode:h,onAllocationChange:Q=>f(w,Q),projectedAllTime:ee})},w):d.jsx(HL,{category:D,balance:q,localAllocation:a[w]||"",previousMonthIncome:c,isDraftMode:h,onAllocationChange:Q=>f(w,Q),allTimeBalance:ee,isEvenRow:L%2===0},w)})]})}function HL({category:t,balance:e,localAllocation:n,previousMonthIncome:i,isDraftMode:a,onAllocationChange:l,allTimeBalance:c,isEvenRow:h}){const f=t.default_monthly_type==="percentage"&&t.default_monthly_amount!==void 0&&t.default_monthly_amount>0,p=f?t.default_monthly_amount/100*i:0,_=f?p.toFixed(2):n,b=t.balance??0,v=b<0,T=v?Math.abs(b):0,E=f?p:parseFloat(n)||0,w=v?Math.min(E,T):0,D=v?Math.max(0,E-T):0,L=v&&E>0&&D>0,q=h?"rgba(255,255,255,0.02)":"transparent",B={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",background:q,display:"flex",alignItems:"center",fontSize:"0.9rem",minHeight:"2.4rem",boxSizing:"border-box"},ee=e.allocated+e.spent;return d.jsxs("div",{style:{display:"contents"},children:[d.jsx("div",{style:{paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingRight:"0.5rem",paddingLeft:"1.5rem",background:q,display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:500,overflow:"hidden",borderLeft:"2px solid rgba(255,255,255,0.1)",minHeight:"2.4rem",boxSizing:"border-box"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name})}),d.jsx("div",{style:{...B,justifyContent:"flex-end",color:Nn(e.start_balance)},children:kn(e.start_balance)}),a?d.jsx("div",{style:{...B,justifyContent:"center",flexDirection:"column",gap:"0.1rem",paddingTop:"0.35rem",paddingBottom:"0.35rem"},children:f?d.jsxs("span",{style:{fontSize:"0.85rem"},children:[d.jsxs("span",{style:{color:ce.primary},children:[t.default_monthly_amount,"%"]}),d.jsx("span",{style:{opacity:.5},children:" = "}),d.jsx("span",{style:{color:ce.primary},children:ke(p)})]}):d.jsxs(d.Fragment,{children:[d.jsx("input",{type:"text",inputMode:"decimal",value:_?`$${_}`:"",onChange:Q=>{const J=Q.target.value.replace(/[^\d.]/g,"");l(J)},placeholder:"$0.00",style:{width:"100px",padding:"0.2rem 0.5rem",borderRadius:"4px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.9rem",lineHeight:1,color:"inherit",boxSizing:"border-box"}}),v&&E>0&&d.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"center",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"center"},children:[d.jsxs("span",{style:{color:ce.debt},children:[ke(w),"  debt"]}),L&&d.jsxs("span",{style:{color:ce.success},children:[ke(D),"  bal"]})]})]})}):(()=>{const Q=e.start_balance<0,J=Q?Math.abs(e.start_balance):0,O=Q?Math.min(e.allocated,J):0,R=Q?Math.max(0,e.allocated-J):0,j=Q&&e.allocated>0;return d.jsxs("div",{style:{...B,justifyContent:"flex-end",flexDirection:"column",alignItems:"flex-end",gap:"0.1rem",color:Bf(e.allocated)},children:[d.jsxs("span",{children:["+",ke(e.allocated)]}),j&&d.jsxs("div",{style:{fontSize:"0.6rem",whiteSpace:"nowrap",textAlign:"right",lineHeight:1.3,display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[d.jsxs("span",{style:{color:ce.debt},children:[ke(O),"  debt"]}),R>0&&d.jsxs("span",{style:{color:ce.success},children:[ke(R),"  bal"]})]})]})})(),d.jsx("div",{style:{...B,justifyContent:"flex-end",color:ql(e.spent)},children:wi(e.spent)}),d.jsx("div",{style:{...B,justifyContent:"flex-end",color:Nn(ee)},children:cr(ee)}),d.jsx("div",{style:{...B,justifyContent:"flex-end",fontWeight:600,color:Nn(e.end_balance),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:kn(e.end_balance)}),d.jsx("div",{style:{...B,justifyContent:"flex-end",color:c<0?ce.debt:ce.primary},children:kn(c)})]})}function ku({message:t="Loading...",spinnerColor:e=ce.primary,children:n,spinnerSize:i=4}){return d.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(15, 15, 20, 0.95)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",zIndex:9999,gap:"1.5rem",backdropFilter:"blur(4px)"},children:[d.jsx("div",{style:{width:`${i}rem`,height:`${i}rem`,border:"3px solid rgba(255, 255, 255, 0.15)",borderTopColor:e,borderRadius:"50%",animation:"loadingOverlaySpin 0.8s linear infinite"}}),d.jsx("p",{style:{color:"rgba(255, 255, 255, 0.95)",fontSize:"1.2rem",fontWeight:600,letterSpacing:"0.02em",margin:0},children:t}),n,d.jsx("style",{children:`
        @keyframes loadingOverlaySpin {
          to { transform: rotate(360deg); }
        }
      `})]})}function Vf({percent:t,gradient:e="linear-gradient(90deg, #646cff, #8b5cf6)",width:n=300}){return d.jsx("div",{style:{width:`${n}px`,height:"8px",background:"rgba(255, 255, 255, 0.1)",borderRadius:"4px",overflow:"hidden"},children:d.jsx("div",{style:{width:`${t}%`,height:"100%",background:e,borderRadius:"4px",transition:"width 0.3s ease-out"}})})}function mn({value:t,label:e,color:n="#646cff"}){return d.jsxs("div",{style:{textAlign:"center"},children:[d.jsx("p",{style:{color:n,fontSize:"1.5rem",fontWeight:700,margin:0},children:t}),d.jsx("p",{style:{color:"rgba(255, 255, 255, 0.6)",fontSize:"0.8rem",margin:"0.25rem 0 0",textTransform:"uppercase",letterSpacing:"0.05em"},children:e})]})}function pl({children:t,columns:e=3}){return d.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${e}, 1fr)`,gap:"2rem",textAlign:"center"},children:t})}function Uf({percent:t}){return d.jsxs("p",{style:{color:"rgba(255, 255, 255, 0.5)",fontSize:"0.9rem",margin:0},children:[t,"% complete"]})}function GL(t){const e=Object.entries(t).reduce((n,[i,a])=>{const l=a.category_group_id||"ungrouped";return n[l]||(n[l]=[]),n[l].push([i,a]),n},{});return Object.keys(e).forEach(n=>{e[n].sort((i,a)=>i[1].sort_order-a[1].sort_order)}),e}function $L(t,e,n,i,a){const l={};t?.category_balances&&t.category_balances.forEach(h=>{l[h.category_id]=h});const c={};return Object.entries(e).forEach(([h,f])=>{const p=l[h],_=p?.start_balance??0,b=p?.spent??0;let v=0;n?v=a(h,f):i&&p&&(v=p.allocated),c[h]={category_id:h,start_balance:_,allocated:v,spent:b,end_balance:_+v+b}}),c}function QL(t,e){const n={};t?.account_balances&&t.account_balances.forEach(a=>{n[a.account_id]=a});const i={};return Object.entries(e).forEach(([a,l])=>{const h=n[a]?.start_balance??l.balance;let f=0;t?.income&&(f=t.income.filter(b=>b.account_id===a).reduce((b,v)=>b+v.amount,0));let p=0;t?.expenses&&(p=t.expenses.filter(b=>b.account_id===a).reduce((b,v)=>b+v.amount,0));const _=f+p;i[a]={account_id:a,start_balance:h,income:f,expenses:p,net_change:_,end_balance:h+_}}),i}function WL(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,income:e.income+n.income,expenses:e.expenses+n.expenses,netChange:e.netChange+n.net_change,end:e.end+n.end_balance}),{start:0,income:0,expenses:0,netChange:0,end:0})}function KL(t){return Object.values(t).reduce((e,n)=>({start:e.start+n.start_balance,allocated:e.allocated+n.allocated,spent:e.spent+n.spent,end:e.end+n.end_balance}),{start:0,allocated:0,spent:0,end:0})}const Ua={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function YL(){const{selectedBudgetId:t,currentUserId:e,currentYear:n,currentMonthNumber:i}=zt(),{categories:a,categoryGroups:l,monthMap:c}=Pn(t,e),{month:h}=uo(t,n,i),f=da(),p=wt(n,i),_=c[p]?.needs_recalculation===!0,b=A.useRef(!1),[v,T]=A.useState(null);A.useEffect(()=>{!t||!h||!_||b.current||(b.current=!0,`${n}${String(i).padStart(2,"0")}`,jf(t,{onProgress:ue=>T(ue)}).then(()=>{$e.invalidateQueries({queryKey:xe.month(t,n,i)})}).catch(ue=>{console.error("[MonthCategories] Recalculation failed:",ue)}).finally(()=>{b.current=!1,T(null)}))},[t,_,h,n,i]);const[E,w]=A.useState(!1),{localAllocations:D,isEditingAppliedAllocations:L,error:q,availableNow:B,currentDraftTotal:ee,draftChangeAmount:Q,availableAfterApply:J,previousMonthIncome:O,currentMonthIncome:R,allocationsFinalized:j,getAllocationAmount:I,handleAllocationChange:M,resetAllocationsToSaved:F,handleSaveAllocations:k,handleFinalizeAllocations:Y,setIsEditingAppliedAllocations:H,setError:N}=XP(),G=[...l].sort((ue,he)=>ue.sort_order-he.sort_order),W=A.useMemo(()=>GL(a),[a]),ne=!j||L,ie=A.useMemo(()=>$L(h,a,ne,j,I),[h,a,ne,j,I]),V=ue=>ie[ue],z=A.useMemo(()=>KL(ie),[ie]),$=A.useMemo(()=>{const ue={};if(h?.category_balances)for(const he of h.category_balances)ue[he.category_id]=he.allocated;return ue},[h]),X=A.useMemo(()=>Object.entries(a).reduce((ue,[he,Se])=>{const fe=Se.balance??0;if(ne){const te=I(he,Se),Ee=$[he]??0,De=te-Ee;return ue+fe+De}return ue+fe},0),[a,ne,I,$]),re=()=>{if(!v)return"";switch(v.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return v.currentMonth?`Recalculating ${v.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}};return d.jsxs(d.Fragment,{children:[v&&d.jsxs(ku,{message:re(),spinnerColor:"#22c55e",children:[d.jsx(Vf,{percent:v.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),d.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(v.totalMonthsToFetch??0)>0&&d.jsx(mn,{value:`${v.monthsFetched||0}/${v.totalMonthsToFetch}`,label:"Months Loaded",color:v.phase==="fetching-months"?"#22c55e":"#6b7280"}),(v.totalMonths??0)>0&&d.jsx(mn,{value:`${v.monthsProcessed}/${v.totalMonths}`,label:"Months Recalculated",color:v.phase==="recalculating"?"#22c55e":"#6b7280"})]}),d.jsx(Uf,{percent:v.percentComplete})]}),q&&d.jsx(lo,{message:q,onDismiss:()=>N(null)}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:f?"1fr":ne?"2fr 1fr 200px 1fr 1fr 1fr 120px":"2fr 1fr 1fr 1fr 1fr 1fr 120px"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:f?"block":"grid",gridTemplateColumns:f?void 0:"subgrid"},children:[ne&&d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:f?"0.5rem":"0.25rem"},children:[d.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:d.jsx(XS,{isDraftMode:ne,isEditingAppliedAllocations:L,availableNow:B,currentMonthIncome:R,balanceTotals:z,draftChangeAmount:Q,availableAfterApply:J,currentDraftTotal:ee})}),d.jsx(hg,{isDraftMode:ne,isEditingAppliedAllocations:L,allocationsFinalized:j,onSave:k,onApply:Y,onEdit:()=>H(!0),onCancel:F,onDelete:()=>w(!0)})]}),!f&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:Ua,children:"Category"}),d.jsx("div",{style:{...Ua,textAlign:"right"},children:"Start"}),d.jsx("div",{style:{...Ua,textAlign:ne?"center":"right"},children:"Allocated"}),d.jsx("div",{style:{...Ua,textAlign:"right"},children:"Spent"}),d.jsx("div",{style:{...Ua,textAlign:"right"},children:"Net Change"}),d.jsx("div",{style:{...Ua,textAlign:"right",paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:"End"}),d.jsx("div",{style:{...Ua,textAlign:"right"},children:"All-Time"})]}),!f&&(()=>{const ue={paddingTop:"0.6rem",paddingBottom:"0.6rem",paddingLeft:"0.5rem",paddingRight:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600,display:"flex",alignItems:"center",fontSize:"0.9rem"},he=z.allocated+z.spent;return d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{...ue,gap:"0.75rem"},children:["Grand Totals",!ne&&d.jsx(hg,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:j,onSave:k,onApply:Y,onEdit:()=>H(!0),onCancel:F,onDelete:()=>w(!0)})]}),d.jsx("div",{style:{...ue,justifyContent:"flex-end",color:Nn(z.start)},children:kn(z.start)}),d.jsxs("div",{style:{...ue,justifyContent:ne?"center":"flex-end",color:Bf(z.allocated)},children:["+",ke(z.allocated)]}),d.jsx("div",{style:{...ue,justifyContent:"flex-end",color:ql(z.spent)},children:wi(z.spent)}),d.jsx("div",{style:{...ue,justifyContent:"flex-end",color:Nn(he)},children:cr(he)}),d.jsx("div",{style:{...ue,justifyContent:"flex-end",color:Nn(z.end),paddingRight:"1rem",borderRight:"2px solid rgba(128, 128, 128, 0.4)"},children:kn(z.end)}),d.jsx("div",{style:{...ue,justifyContent:"flex-end",color:X<0?ce.debt:ce.primary},children:kn(X)})]})})(),!ne&&f&&d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[d.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),d.jsx(XS,{isDraftMode:!1,isEditingAppliedAllocations:!1,availableNow:B,currentMonthIncome:R,balanceTotals:z,draftChangeAmount:Q,availableAfterApply:J,currentDraftTotal:ee}),d.jsx(hg,{isDraftMode:!1,isEditingAppliedAllocations:!1,allocationsFinalized:j,onSave:k,onApply:Y,onEdit:()=>H(!0),onCancel:F,onDelete:()=>w(!0)})]})]}),Object.keys(a).length===0&&d.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No categories yet."," ",d.jsx(Dt,{to:"/budget/settings/categories",style:{color:ce.primaryLight},children:"Create categories "})]}),G.map(ue=>{const he=W[ue.id]||[];if(he.length===0)return null;const Se=he.reduce((fe,[te])=>{const Ee=V(te);return Ee?{start:fe.start+Ee.start_balance,allocated:fe.allocated+Ee.allocated,spent:fe.spent+Ee.spent,end:fe.end+Ee.end_balance}:fe},{start:0,allocated:0,spent:0,end:0});return d.jsx(JS,{name:ue.name,categories:he,groupTotals:Se,getCategoryBalance:V,localAllocations:D,savedAllocations:$,previousMonthIncome:O,isDraftMode:ne,onAllocationChange:M,isMobile:f,getAllocationAmount:I},ue.id)}),W.ungrouped?.length>0&&(()=>{const ue=W.ungrouped,he=ue.reduce((Se,[fe])=>{const te=V(fe);return te?{start:Se.start+te.start_balance,allocated:Se.allocated+te.allocated,spent:Se.spent+te.spent,end:Se.end+te.end_balance}:Se},{start:0,allocated:0,spent:0,end:0});return d.jsx(JS,{name:"Uncategorized",categories:ue,groupTotals:he,getCategoryBalance:V,localAllocations:D,savedAllocations:$,previousMonthIncome:O,isDraftMode:ne,onAllocationChange:M,isMobile:f,isUngrouped:!0,getAllocationAmount:I},"ungrouped")})(),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]}),d.jsx(zL,{isOpen:E,onClose:()=>w(!1),onDeleted:()=>H(!1)})]})}function KT(t){return t===0?ce.zero:t>0?ce.success:ce.error}function YT(t){return t===0?ce.zero:t<0?ce.error:ce.success}function XT(t){return t===0?ce.zero:t>0?ce.success:ce.error}function ZS({name:t,accounts:e,groupTotals:n,accountBalances:i,isMobile:a,isUngrouped:l}){const c={padding:"0.6rem 0.5rem",marginTop:"1.25rem",borderTop:"1px solid rgba(255,255,255,0.2)",background:"rgba(255,255,255,0.04)",display:"flex",alignItems:"center",fontSize:"0.9rem",fontWeight:600};return d.jsxs("div",{style:{display:"contents"},children:[d.jsxs("div",{style:{...c,opacity:l?.7:1},children:[d.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:t}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400},children:["(",e.length,")"]})]}),d.jsx("div",{style:{...c,justifyContent:"flex-end",color:Tt(n.start)},children:d.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:ke(n.start)})}),d.jsx("div",{style:{...c,justifyContent:"flex-end",color:KT(n.income)},children:d.jsxs("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:["+",ke(n.income)]})}),d.jsx("div",{style:{...c,justifyContent:"flex-end",color:YT(n.expenses)},children:d.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:wi(n.expenses)})}),d.jsx("div",{style:{...c,justifyContent:"flex-end",color:XT(n.netChange)},children:d.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:cr(n.netChange)})}),d.jsx("div",{style:{...c,justifyContent:"flex-end",color:Tt(n.end)},children:d.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:ke(n.end)})}),e.map(([h,f],p)=>{const _=i[h];return _?a?d.jsx("div",{style:{gridColumn:"1 / -1"},children:d.jsx(JL,{account:f,balance:_})},h):d.jsx(XL,{account:f,balance:_,isEvenRow:p%2===0},h):null})]})}function XL({account:t,balance:e,isEvenRow:n}){const a={padding:"0.5rem 0.5rem",background:n?"rgba(255,255,255,0.02)":"transparent",display:"flex",alignItems:"center",fontSize:"0.9rem"};return d.jsxs("div",{style:{display:"contents"},children:[d.jsx("div",{style:{...a,fontWeight:500,overflow:"hidden",paddingLeft:"1.5rem",borderLeft:"2px solid rgba(255,255,255,0.1)"},children:d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.nickname})}),d.jsx("div",{style:{...a,justifyContent:"flex-end",color:Tt(e.start_balance)},children:ke(e.start_balance)}),d.jsxs("div",{style:{...a,justifyContent:"flex-end",color:KT(e.income)},children:["+",ke(e.income)]}),d.jsx("div",{style:{...a,justifyContent:"flex-end",color:YT(e.expenses)},children:wi(e.expenses)}),d.jsx("div",{style:{...a,justifyContent:"flex-end",color:XT(e.net_change)},children:cr(e.net_change)}),d.jsx("div",{style:{...a,justifyContent:"flex-end",fontWeight:600,color:Tt(e.end_balance)},children:ke(e.end_balance)})]})}function JL({account:t,balance:e}){return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",padding:"0.75rem",marginBottom:"0.25rem"},children:[d.jsx("div",{style:{marginBottom:"0.5rem"},children:d.jsx("span",{style:{fontWeight:500},children:t.nickname})}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"0.25rem",fontSize:"0.75rem"},children:[d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Start"}),d.jsx("span",{children:ke(e.start_balance)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"Net Change"}),d.jsx("span",{style:{color:Tt(e.net_change)},children:cr(e.net_change)})]}),d.jsxs("div",{children:[d.jsx("span",{style:{opacity:.6,display:"block"},children:"End"}),d.jsx("span",{style:{color:Tt(e.end_balance)},children:ke(e.end_balance)})]})]}),(e.income!==0||e.expenses!==0)&&d.jsxs("div",{style:{marginTop:"0.5rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)",display:"flex",gap:"1rem",fontSize:"0.7rem",opacity:.7},children:[e.income!==0&&d.jsxs("span",{children:[cr(e.income)," income"]}),e.expenses!==0&&d.jsxs("span",{children:[wi(e.expenses)," expenses"]})]})]})}const tl={fontSize:"0.75rem",fontWeight:600,opacity:.6,textTransform:"uppercase",letterSpacing:"0.05em",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"2px solid rgba(255,255,255,0.2)"};function ZL(t){return t===0?ce.zero:t>0?ce.success:ce.error}function e6(t){return t===0?ce.zero:t<0?ce.error:ce.success}function t6(t){return t===0?ce.zero:t>0?ce.success:ce.error}function n6(){const{selectedBudgetId:t,currentUserId:e,currentYear:n,currentMonthNumber:i}=zt(),{accounts:a,accountGroups:l,monthMap:c}=Pn(t,e),{month:h}=uo(t,n,i),f=da(),p=wt(n,i),_=c[p]?.needs_recalculation===!0,b=A.useRef(!1),[v,T]=A.useState(null);A.useEffect(()=>{!t||!h||!_||b.current||(b.current=!0,`${n}${String(i).padStart(2,"0")}`,jf(t,{onProgress:J=>T(J)}).then(()=>{$e.invalidateQueries({queryKey:xe.month(t,n,i)})}).catch(J=>{console.error("[MonthAccounts] Recalculation failed:",J)}).finally(()=>{b.current=!1,T(null)}))},[t,_,h,n,i]);const E=A.useMemo(()=>Object.entries(l).map(([J,O])=>({id:J,...O})).sort((J,O)=>J.sort_order-O.sort_order),[l]),w=A.useMemo(()=>{const J={};return Object.entries(a).forEach(([O,R])=>{const j=R.account_group_id||"ungrouped";J[j]||(J[j]=[]),J[j].push([O,R])}),Object.keys(J).forEach(O=>{J[O].sort((R,j)=>R[1].sort_order-j[1].sort_order)}),J},[a]),D=A.useMemo(()=>QL(h,a),[h,a]),L=A.useMemo(()=>WL(D),[D]),q=L.income+L.expenses,ee={...{padding:"0.6rem 0.5rem",display:"flex",alignItems:"center",fontSize:"0.9rem"},borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)",fontWeight:600},Q=()=>{if(!v)return"";switch(v.phase){case"reading-budget":return"Reading budget data...";case"fetching-months":return"Fetching months...";case"recalculating":return v.currentMonth?`Recalculating ${v.currentMonth}...`:"Recalculating...";case"saving":return"Saving results...";case"complete":return"Recalculation complete!";default:return"Recalculating balances..."}};return d.jsxs(d.Fragment,{children:[v&&d.jsxs(ku,{message:Q(),spinnerColor:"#22c55e",children:[d.jsx(Vf,{percent:v.percentComplete,gradient:"linear-gradient(90deg, #22c55e, #10b981)"}),d.jsxs("div",{style:{display:"flex",gap:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[(v.totalMonthsToFetch??0)>0&&d.jsx(mn,{value:`${v.monthsFetched||0}/${v.totalMonthsToFetch}`,label:"Months Loaded",color:v.phase==="fetching-months"?"#22c55e":"#6b7280"}),(v.totalMonths??0)>0&&d.jsx(mn,{value:`${v.monthsProcessed}/${v.totalMonths}`,label:"Months Recalculated",color:v.phase==="recalculating"?"#22c55e":"#6b7280"})]}),d.jsx(Uf,{percent:v.percentComplete})]}),d.jsxs("div",{style:{display:"grid",gridTemplateColumns:f?"1fr":"2fr 1fr 1fr 1fr 1fr 1fr"},children:[d.jsxs("div",{style:{gridColumn:"1 / -1",position:"sticky",top:0,zIndex:49,backgroundColor:"#242424",display:"grid",gridTemplateColumns:"subgrid"},children:[!f&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:tl,children:"Account"}),d.jsx("div",{style:{...tl,textAlign:"right"},children:"Start"}),d.jsx("div",{style:{...tl,textAlign:"right"},children:"Income"}),d.jsx("div",{style:{...tl,textAlign:"right"},children:"Expenses"}),d.jsx("div",{style:{...tl,textAlign:"right"},children:"Net Change"}),d.jsx("div",{style:{...tl,textAlign:"right"},children:"End"})]}),f?d.jsxs("div",{style:{gridColumn:"1 / -1",display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderTop:"2px solid rgba(255,255,255,0.3)",borderBottom:"2px solid rgba(255,255,255,0.3)"},children:[d.jsx("span",{style:{fontWeight:600},children:"Grand Totals:"}),d.jsx(FL,{totals:L})]}):d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{...ee},children:"Grand Totals"}),d.jsx("div",{style:{...ee,justifyContent:"flex-end",color:Tt(L.start)},children:ke(L.start)}),d.jsxs("div",{style:{...ee,justifyContent:"flex-end",color:ZL(L.income)},children:["+",ke(L.income)]}),d.jsx("div",{style:{...ee,justifyContent:"flex-end",color:e6(L.expenses)},children:wi(L.expenses)}),d.jsx("div",{style:{...ee,justifyContent:"flex-end",color:t6(q)},children:cr(q)}),d.jsx("div",{style:{...ee,justifyContent:"flex-end",color:Tt(L.end)},children:ke(L.end)})]})]}),Object.keys(a).length===0&&d.jsxs("p",{style:{gridColumn:"1 / -1",opacity:.6,textAlign:"center",padding:"2rem"},children:["No accounts yet."," ",d.jsx(Dt,{to:"/budget/settings/accounts",style:{color:ce.primaryLight},children:"Add accounts "})]}),E.map(J=>{const O=w[J.id]||[];if(O.length===0)return null;const R=O.reduce((j,[I])=>{const M=D[I];return M?{start:j.start+M.start_balance,income:j.income+M.income,expenses:j.expenses+M.expenses,netChange:j.netChange+M.net_change,end:j.end+M.end_balance}:j},{start:0,income:0,expenses:0,netChange:0,end:0});return d.jsx(ZS,{name:J.name,accounts:O,groupTotals:R,accountBalances:D,isMobile:f},J.id)}),w.ungrouped?.length>0&&(()=>{const J=w.ungrouped,O=J.reduce((R,[j])=>{const I=D[j];return I?{start:R.start+I.start_balance,income:R.income+I.income,expenses:R.expenses+I.expenses,netChange:R.netChange+I.net_change,end:R.end+I.end_balance}:R},{start:0,income:0,expenses:0,netChange:0,end:0});return d.jsx(ZS,{name:"Ungrouped",accounts:J,groupTotals:O,accountBalances:D,isMobile:f,isUngrouped:!0},"ungrouped")})(),d.jsx("div",{style:{gridColumn:"1 / -1",height:"2rem"}})]})]})}const r6=["income","categories","accounts","spend"];function eE(t){const e=t.year?parseInt(t.year,10):null,n=t.month?parseInt(t.month,10):null,i=t.tab&&r6.includes(t.tab)?t.tab:null;return{year:e&&!isNaN(e)&&e>=2e3&&e<=2100?e:null,month:n&&!isNaN(n)&&n>=1&&n<=12?n:null,tab:i}}function i6(){const t=new Date;return{year:t.getFullYear(),month:t.getMonth()+1}}function tE(){const t=DR(),e=yu(),[n,i]=vD(),{addLoadingHold:a,removeLoadingHold:l}=Qn(),{currentUserId:c,selectedBudgetId:h,currentYear:f,currentMonthNumber:p,lastActiveTab:_,setCurrentYear:b,setCurrentMonthNumber:v,setLastActiveTab:T,setPageTitle:E,goToPreviousMonth:w,goToNextMonth:D,hasPendingInvites:L,pendingInvites:q,needsFirstBudget:B}=zt(),{budget:ee,isLoading:Q,createBudget:J,acceptInvite:O}=Pn(h,c),R=!Q,[j,I]=A.useState(!1);A.useEffect(()=>(R||a("budget-data","Loading budget data..."),()=>l("budget-data")),[R,a,l]);const M=A.useRef(!1),F=n.get("error"),[k,Y]=A.useState(F);A.useEffect(()=>{F&&(n.delete("error"),i(n,{replace:!0}))},[F,n,i]);const[H,N]=A.useState(()=>{const{tab:re}=eE(t);return re??_}),G=re=>{N(re),T(re)};A.useEffect(()=>{if(M.current)return;const{year:re,month:ue}=eE(t);re&&b(re),ue&&v(ue),M.current=!0},[t,b,v]),A.useEffect(()=>{if(!M.current)return;const re=`/budget/${f}/${p}/${H}`,ue=`/budget/${t.year}/${t.month}/${t.tab}`;re!==ue&&e(re,{replace:!0})},[f,p,H,e,t]);const{month:W,error:ne,isLoading:ie}=uo(R?h:null,f,p);A.useEffect(()=>{if(!ne||j)return;const re=ne.message||"";(re.includes("months in the past")||re.includes("Refusing to create month"))&&(console.log(`[Budget] Month creation failed: ${re}`),queueMicrotask(()=>{a("month-redirect","Redirecting to current month..."),I(!0);const{year:ue,month:he}=i6();console.log(`[Budget] Redirecting from ${f}/${p} to current month: ${ue}/${he}`),Y(`Cannot create month ${f}/${p} - it's too far in the past. Redirected to current month.`),b(ue),v(he)}))},[ne,j,f,p,b,v,a]),A.useEffect(()=>{j&&W&&!ie&&queueMicrotask(()=>{I(!1),l("month-redirect")})},[j,W,ie,l]),A.useLayoutEffect(()=>{E(ee?.name||"Budget")},[ee?.name,E]);async function V(re){try{await O(re)}catch(ue){Y(ue instanceof Error?ue.message:"Failed to accept invite")}}async function z(re){try{await J(re||"My Budget")}catch(ue){Y(ue instanceof Error?ue.message:"Failed to create budget")}}if(!ee&&L)return d.jsx(EL,{invites:q,onAccept:V,onCreateNew:z});if(!ee&&B)return d.jsx(SL,{onCreateNew:z});if(!R||j)return null;function $(){Y(null),w()}function X(){Y(null),D()}return d.jsxs(MT,{children:[k&&d.jsx(lo,{message:k,onDismiss:()=>Y(null)}),d.jsx(OL,{onPreviousMonth:$,onNextMonth:X}),d.jsx(wL,{activeTab:H,setActiveTab:G,allocationsFinalized:W?.are_allocations_finalized}),H==="income"&&d.jsx(LL,{},`${f}-${p}`),H==="categories"&&d.jsx(YL,{},`${f}-${p}`),H==="accounts"&&d.jsx(n6,{},`${f}-${p}`),H==="spend"&&d.jsx(VL,{},`${f}-${p}`)]})}function s6(){const{setPageTitle:t}=zt();return A.useLayoutEffect(()=>{t("Analytics")},[t]),d.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"50vh",textAlign:"center",gap:"1.5rem"},children:[d.jsx("div",{style:{fontSize:"4rem",opacity:.8},children:""}),d.jsx("h1",{style:{margin:0,fontSize:"2rem",fontWeight:600},children:"Analytics"}),d.jsx("p",{style:{margin:0,fontSize:"1.25rem",opacity:.6,maxWidth:"400px"},children:"Coming Soon"}),d.jsx("p",{style:{margin:0,fontSize:"0.95rem",opacity:.5,maxWidth:"500px",lineHeight:1.6},children:"Track spending trends, category breakdowns, and insights about your budget over time."}),d.jsx(Dt,{to:"/budget",style:{marginTop:"1rem",padding:"0.75rem 1.5rem",background:ce.primary,color:"white",borderRadius:"8px",textDecoration:"none",fontWeight:500,transition:"opacity 0.15s"},children:"Back to Budget"})]})}function nf({initialData:t,onSubmit:e,onCancel:n,submitLabel:i,accountGroups:a,showGroupSelector:l=!1,showIncomeSettings:c=!1,hasExistingIncomeDefault:h=!1,hasExistingOutgoDefault:f=!1,currentGroupId:p}){const[_,b]=A.useState(t||{nickname:"",account_group_id:null,is_income_account:!1,is_income_default:!1,is_outgo_account:!1,is_outgo_default:!1,on_budget:!0,is_active:!0}),v=_.account_group_id||p,T=v?a.find(B=>B.id===v):null,E=T?.is_active!==void 0,w=T?.on_budget!==void 0;function D(B){B.preventDefault(),_.nickname.trim()&&e(_)}function L(B){b({..._,is_income_account:B,is_income_default:B?_.is_income_default:!1})}function q(B){b({..._,is_outgo_account:B,is_outgo_default:B?_.is_outgo_default:!1})}return d.jsxs(Ja,{actionName:i==="Create Account"?"Create Account":"Update Account",onSubmit:D,children:[d.jsx(en,{label:"Account Nickname",htmlFor:"account-nickname",children:d.jsx(Za,{id:"account-nickname",type:"text",value:_.nickname,onChange:B=>b({..._,nickname:B.target.value}),placeholder:"e.g., Main Checking, Savings",required:!0,autoFocus:!0})}),l&&d.jsx(en,{label:"Account Type",htmlFor:"account-group",children:d.jsxs(pu,{id:"account-group",value:_.account_group_id||"ungrouped",onChange:B=>b({..._,account_group_id:B.target.value==="ungrouped"?null:B.target.value}),children:[d.jsx("option",{value:"ungrouped",children:"Ungrouped"}),a.map(B=>d.jsx("option",{value:B.id,children:B.name},B.id))]})}),c&&d.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.75rem"},children:[d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Account Status"}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx(Ls,{id:"is-active",checked:E?T.is_active:_.is_active!==!1,onChange:B=>b({..._,is_active:B.target.checked}),disabled:E,children:d.jsx("span",{style:{opacity:E?.5:1},children:"Active account"})}),E&&d.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ce.warning},children:['Set by account type "',T.name,'"']})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem"},children:[d.jsx(Ls,{id:"on-budget",checked:w?T.on_budget:_.on_budget!==!1,onChange:B=>b({..._,on_budget:B.target.checked}),disabled:w,children:d.jsx("span",{style:{opacity:w?.5:1},children:"On budget (affects budget totals)"})}),w&&d.jsxs("p",{style:{margin:0,fontSize:"0.7rem",opacity:.6,marginLeft:"2rem",color:ce.warning},children:['Set by account type "',T.name,'"']})]})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Income Settings"}),d.jsx(Ls,{id:"is-income-account",checked:_.is_income_account||!1,onChange:B=>L(B.target.checked),children:"Show in income deposit list"}),_.is_income_account&&d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[d.jsx(Ls,{id:"is-income-default",checked:_.is_income_default||!1,onChange:B=>b({..._,is_income_default:B.target.checked}),disabled:h&&!t?.is_income_default,children:"Default account for new income"}),h&&!t?.is_income_default&&d.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsx("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:"Expense Settings"}),d.jsx(Ls,{id:"is-outgo-account",checked:_.is_outgo_account||!1,onChange:B=>q(B.target.checked),children:"Show in expense account list"}),_.is_outgo_account&&d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.25rem",marginLeft:"2rem"},children:[d.jsx(Ls,{id:"is-outgo-default",checked:_.is_outgo_default||!1,onChange:B=>b({..._,is_outgo_default:B.target.checked}),disabled:f&&!t?.is_outgo_default,children:"Default account for new expenses"}),f&&!t?.is_outgo_default&&d.jsx("p",{style:{margin:0,fontSize:"0.75rem",opacity:.5},children:"Another account is already set as default"})]})]})]}),d.jsxs(co,{children:[d.jsx(Ie,{type:"submit",actionName:i,children:i}),d.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Account Form",onClick:n,children:"Cancel"})]})]})}function nE({label:t,value:e,onChange:n,trueLabel:i,falseLabel:a,undefinedLabel:l}){function c(){n(e===void 0?!0:e===!0?!1:void 0)}const h=e===!0?i:e===!1?a:l,f=e===!0?ce.success:e===!1?ce.warning:"inherit",p=e===!0?"":e===!1?"":"";return d.jsxs("button",{type:"button",onClick:c,style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 0.75rem",background:e!==void 0?`color-mix(in srgb, ${f} 15%, transparent)`:"color-mix(in srgb, currentColor 8%, transparent)",border:e!==void 0?`1px solid color-mix(in srgb, ${f} 40%, transparent)`:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",cursor:"pointer",fontSize:"0.85rem",color:"inherit",textAlign:"left",width:"100%"},children:[d.jsx("span",{style:{width:"1.25rem",height:"1.25rem",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",background:e!==void 0?f:"color-mix(in srgb, currentColor 20%, transparent)",color:e!==void 0?"white":"inherit",fontWeight:600,fontSize:"0.75rem"},children:p}),d.jsxs("span",{style:{flex:1},children:[d.jsxs("span",{style:{opacity:.7},children:[t,":"]})," ",d.jsx("span",{style:{fontWeight:500,color:f},children:h})]}),d.jsx("span",{style:{fontSize:"0.7rem",opacity:.5},children:"click to cycle"})]})}function JT({initialData:t,onSubmit:e,onCancel:n,submitLabel:i}){const[a,l]=A.useState(t||{name:"",expected_balance:"positive"});function c(h){h.preventDefault(),a.name.trim()&&e(a)}return d.jsxs(Ja,{actionName:i==="Create Account Type"?"Create Account Type":"Update Account Type",onSubmit:c,children:[d.jsx(en,{label:"Account Type Name",htmlFor:"group-name",children:d.jsx(Za,{id:"group-name",type:"text",value:a.name,onChange:h=>l({...a,name:h.target.value}),placeholder:"e.g., Checking, Savings, Credit Cards, Investments",required:!0,autoFocus:!0})}),d.jsx(en,{label:"Expected Balance",htmlFor:"expected-balance",children:d.jsxs(pu,{id:"expected-balance",value:a.expected_balance,onChange:h=>l({...a,expected_balance:h.target.value}),children:[d.jsx("option",{value:"positive",children:"Normally Positive (e.g., Checking, Savings)"}),d.jsx("option",{value:"negative",children:"Normally Negative (e.g., Credit Cards, Loans)"}),d.jsx("option",{value:"any",children:"Either (no warnings)"})]})}),d.jsxs("div",{style:{padding:"0.75rem",background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"8px",display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsxs("p",{style:{margin:0,fontSize:"0.85rem",opacity:.7},children:["Group-Level Overrides ",d.jsx("span",{style:{fontSize:"0.75rem",opacity:.6},children:"(applies to all accounts in this type)"})]}),d.jsx(nE,{label:"Active status",value:a.is_active,onChange:h=>l({...a,is_active:h}),trueLabel:"All active",falseLabel:"All inactive",undefinedLabel:"Per account"}),d.jsx(nE,{label:"Budget status",value:a.on_budget,onChange:h=>l({...a,on_budget:h}),trueLabel:"All on budget",falseLabel:"All off budget",undefinedLabel:"Per account"})]}),d.jsxs(co,{children:[d.jsx(Ie,{type:"submit",actionName:i,children:i}),d.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Account Type Form",onClick:n,children:"Cancel"})]})]})}function nl({icon:t,label:e,variant:n,title:i}){const l={success:{background:`color-mix(in srgb, ${ce.success} 20%, transparent)`,border:`1px solid color-mix(in srgb, ${ce.success} 40%, transparent)`,color:ce.success,opacity:1},warning:{background:`color-mix(in srgb, ${ce.warning} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${ce.warning} 35%, transparent)`,color:ce.warning,opacity:1},muted:{background:"color-mix(in srgb, currentColor 12%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",color:"inherit",opacity:.7},income:{background:`color-mix(in srgb, ${ce.success} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ce.success} 25%, transparent)`,color:ce.success,opacity:.7},expense:{background:`color-mix(in srgb, ${ce.warning} 10%, transparent)`,border:`1px solid color-mix(in srgb, ${ce.warning} 25%, transparent)`,color:ce.warning,opacity:.7}}[n];return d.jsxs("span",{title:i||e,style:{display:"inline-flex",alignItems:"center",gap:"0.25rem",background:l.background,border:l.border,padding:"0.15rem 0.4rem",borderRadius:"4px",fontSize:"0.7rem",fontWeight:500,textTransform:"uppercase",letterSpacing:"0.3px",color:l.color,opacity:l.opacity,whiteSpace:"nowrap"},children:[d.jsx("span",{style:{fontSize:"0.75rem"},children:t}),e]})}function ZT({account:t,accountGroups:e}){const n=[],i=t.account_group_id?e.find(c=>c.id===t.account_group_id):null,a=i?.is_active!==void 0?i.is_active:t.is_active!==!1,l=i?.on_budget!==void 0?i.on_budget:t.on_budget!==!1;if(!a){const c=i?.is_active!==void 0;n.push(d.jsx(nl,{icon:"",label:c?"Inactive (type)":"Inactive",variant:"warning",title:c?`Set by "${i.name}" account type`:"Account is inactive/archived"},"inactive"))}if(!l){const c=i?.on_budget!==void 0;n.push(d.jsx(nl,{icon:"",label:c?"Off Budget (type)":"Off Budget",variant:"warning",title:c?`Set by "${i.name}" account type`:"Tracking only - not included in budget"},"off-budget"))}return t.is_income_default?n.push(d.jsx(nl,{icon:"",label:"Income Default",variant:"success",title:"Default income deposit account"},"income-default")):t.is_income_account&&n.push(d.jsx(nl,{icon:"",label:"Income",variant:"income",title:"Income deposit account"},"income")),t.is_outgo_default?n.push(d.jsx(nl,{icon:"",label:"Expense Default",variant:"warning",title:"Default expense account"},"outgo-default")):t.is_outgo_account&&n.push(d.jsx(nl,{icon:"",label:"Expense",variant:"expense",title:"Expense account"},"outgo")),n.length===0?null:d.jsx(d.Fragment,{children:n})}function a6({group:t}){const e=[];return t.is_active===!1?e.push(d.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ce.warning} 20%, transparent)`,color:ce.warning,whiteSpace:"nowrap"},title:"All accounts in this type are inactive",children:"All Inactive"},"inactive")):t.is_active===!0&&e.push(d.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ce.success} 20%, transparent)`,color:ce.success,whiteSpace:"nowrap"},title:"All accounts in this type are active",children:"All Active"},"active")),t.on_budget===!1?e.push(d.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ce.warning} 20%, transparent)`,color:ce.warning,whiteSpace:"nowrap"},title:"All accounts in this type are off budget",children:"All Off Budget"},"off-budget")):t.on_budget===!0&&e.push(d.jsx("span",{style:{fontSize:"0.65rem",fontWeight:500,padding:"0.15rem 0.35rem",borderRadius:"4px",background:`color-mix(in srgb, ${ce.success} 20%, transparent)`,color:ce.success,whiteSpace:"nowrap"},title:"All accounts in this type are on budget",children:"All On Budget"},"on-budget")),e.length===0?null:d.jsx(d.Fragment,{children:e})}function eC({isActive:t,onDragOver:e,onDragLeave:n,onDrop:i}){return d.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:i,style:{position:"relative",height:"2rem",marginTop:"-0.25rem"},children:[d.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",opacity:t?1:.3,transition:"opacity 0.15s",boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&d.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Move to end"})]})}function o6(t,e){return!e||e==="any"||t===0?!1:e==="positive"&&t<0||e==="negative"&&t>0}function l6(t,e){return!e||e==="any"||t===0?null:e==="positive"&&t<0?"Unexpected negative balance":e==="negative"&&t>0?"Unexpected positive balance (credit owed to you?)":null}function c6({group:t,groupIndex:e,totalGroups:n,accounts:i,allGroups:a,allAccounts:l,editingAccountId:c,editingGroupId:h,createForGroupId:f,setEditingAccountId:p,setEditingGroupId:_,setCreateForGroupId:b,dragType:v,draggedId:T,dragOverId:E,dragOverGroupId:w,setDragOverId:D,setDragOverGroupId:L,onAccountDragStart:q,onAccountDragOver:B,onAccountDrop:ee,onGroupDragStart:Q,onGroupDragOver:J,onGroupDrop:O,onDragLeave:R,onDragLeaveGroup:j,onDragEnd:I,onDropOnGroup:M,onCreateAccount:F,onUpdateAccount:k,onDeleteAccount:Y,onMoveAccount:H,onUpdateGroup:N,onDeleteGroup:G,onMoveGroup:W}){const ne=da(),ie=[...i].sort((te,Ee)=>te.sort_order-Ee.sort_order),V=v==="group"&&T===t.id,z=v==="group"&&E===t.id,$=v==="account"&&w===t.id,re=(T&&v==="account"?l[T]:null)&&Object.entries(l).find(([te])=>te===T)?.[1]&&Object.entries(l).find(([te])=>te===T)?.[1]?.account_group_id!==t.id,ue=v==="group"&&z&&T!==t.id,he=e>0,Se=e<n-1,fe=ie.reduce((te,Ee)=>te+Ee.balance,0);return d.jsxs("div",{children:[v==="group"&&!V&&d.jsxs("div",{onDragOver:te=>{te.preventDefault(),D(t.id)},onDragLeave:R,onDrop:te=>O(te,t.id),style:{position:"relative",height:ue?"2.5rem":"0.5rem",marginBottom:ue?"-0.5rem":"-0.25rem",transition:"height 0.15s"},children:[d.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",opacity:ue?1:0,transition:"opacity 0.15s",boxShadow:ue?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),ue&&d.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Drop here"})]}),d.jsx("div",{draggable:h!==t.id,onDragStart:te=>Q(te,t.id),onDragOver:te=>J(te,t.id),onDragLeave:j,onDragEnd:I,onDrop:te=>M(te,t.id),style:{background:V?"color-mix(in srgb, currentColor 3%, transparent)":$&&re?`color-mix(in srgb, ${ce.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",opacity:V?.5:1,border:$&&re?`2px dashed ${ce.primary}`:"2px solid transparent",cursor:h===t.id?"default":"grab",transition:"all 0.15s"},children:h===t.id?d.jsx(JT,{initialData:{name:t.name,expected_balance:t.expected_balance||"positive",on_budget:t.on_budget,is_active:t.is_active},onSubmit:te=>N(t.id,te),onCancel:()=>_(null),submitLabel:"Save"}):d.jsxs(d.Fragment,{children:[d.jsx(u6,{group:t,accountCount:ie.length,groupTotal:fe,canMoveUp:he,canMoveDown:Se,isMobile:ne,createForGroupId:f,onEdit:()=>_(t.id),onDelete:()=>G(t.id),onMoveUp:()=>W(t.id,"up"),onMoveDown:()=>W(t.id,"down"),onAddAccount:()=>b(t.id)}),ne&&d.jsx("div",{style:{marginBottom:"0.5rem"},children:d.jsx(Ie,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>b(t.id),disabled:f!==null,children:"+ Account"})}),d.jsxs("div",{style:Cl,children:[ie.map((te,Ee)=>c===te.id?d.jsx(nf,{initialData:{nickname:te.nickname,account_group_id:te.account_group_id,is_income_account:te.is_income_account,is_income_default:te.is_income_default,is_outgo_account:te.is_outgo_account,is_outgo_default:te.is_outgo_default,on_budget:te.on_budget,is_active:te.is_active},onSubmit:De=>k(te.id,De),onCancel:()=>p(null),submitLabel:"Save",accountGroups:a,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:te.account_group_id,hasExistingIncomeDefault:Object.entries(l).some(([De,st])=>st.is_income_default&&De!==te.id),hasExistingOutgoDefault:Object.entries(l).some(([De,st])=>st.is_outgo_default&&De!==te.id)},te.id):d.jsx(Lf,{isDragging:v==="account"&&T===te.id,isDragOver:E===te.id,onDragStart:De=>{De.stopPropagation(),q(De,te.id)},onDragOver:De=>B(De,te.id,t.id),onDragLeave:R,onDragEnd:I,onDrop:De=>ee(De,te.id,t.id),onEdit:()=>{te.nickname,p(te.id)},onDelete:()=>{te.nickname,Y(te.id)},onMoveUp:()=>H(te.id,"up"),onMoveDown:()=>H(te.id,"down"),canMoveUp:Ee>0,canMoveDown:Ee<ie.length-1,children:d.jsxs("div",{children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("span",{style:s_,children:te.nickname}),d.jsx(ZT,{account:te,accountGroups:a})]}),d.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"1.1rem",fontWeight:600,color:Tt(te.balance)},children:[ke(te.balance),o6(te.balance,t.expected_balance)&&d.jsx("span",{title:l6(te.balance,t.expected_balance)||"",style:{marginLeft:"0.5rem",fontSize:"0.85rem"},children:""})]})]})},te.id)),ie.length===0&&!f&&d.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0"},children:"No accounts in this type"}),v==="account"&&ie.length>0&&d.jsx(eC,{groupId:t.id,isActive:E===`__end__${t.id}`,onDragOver:te=>{te.preventDefault(),te.stopPropagation(),D(`__end__${t.id}`),L(t.id)},onDragLeave:te=>{te.stopPropagation(),D(null)},onDrop:te=>{te.stopPropagation(),ee(te,"__group_end__",t.id)}}),f===t.id&&d.jsx(nf,{initialData:{nickname:"",account_group_id:t.id},onSubmit:te=>F(te,t.id),onCancel:()=>b(null),submitLabel:"Create",accountGroups:a,showIncomeSettings:!0,currentGroupId:t.id})]}),f!==t.id&&d.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:d.jsx(Ie,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:()=>b(t.id),disabled:f!==null,children:"+ Add Account"})})]})})]})}function u6({group:t,accountCount:e,groupTotal:n,canMoveUp:i,canMoveDown:a,isMobile:l,createForGroupId:c,onEdit:h,onDelete:f,onMoveUp:p,onMoveDown:_,onAddAccount:b}){return d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:l?"0.5rem":"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)",gap:"0.5rem",flexWrap:l?"wrap":"nowrap"},children:[d.jsxs("h3",{style:{...Pf,margin:0,display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0,flexWrap:"wrap"},children:[!l&&d.jsx("span",{style:{cursor:"grab",opacity:.4},children:""}),d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:t.name}),d.jsxs("span",{style:{opacity:.5,fontWeight:400,fontSize:"0.9rem",flexShrink:0},children:["(",e,")"]}),d.jsx("span",{style:{marginLeft:"0.5rem",fontWeight:600,fontSize:"0.9rem",color:Tt(n),flexShrink:0,borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:ke(n)}),d.jsx(a6,{group:t})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0,alignItems:"center"},children:[!l&&d.jsx(Ie,{variant:"small",actionName:`Open Add Account Form (${t.name})`,onClick:b,disabled:c!==null,children:"+ Account"}),d.jsx("button",{onClick:()=>{t.name,h()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit account type",children:""}),d.jsx("button",{onClick:()=>{t.name,f()},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete account type",children:""}),d.jsxs("div",{style:i_,children:[d.jsx("button",{onClick:p,disabled:!i,style:{...Tl,opacity:i?.6:.2,cursor:i?"pointer":"default"},title:"Move up","aria-label":"Move up",children:""}),d.jsx("button",{onClick:_,disabled:!a,style:{...Tl,opacity:a?.6:.2,cursor:a?"pointer":"default"},title:"Move down","aria-label":"Move down",children:""})]})]})]})}function d6({accounts:t,allGroups:e,allAccounts:n,hasGroups:i,editingAccountId:a,createForGroupId:l,setEditingAccountId:c,setCreateForGroupId:h,dragType:f,draggedId:p,dragOverId:_,dragOverGroupId:b,setDragOverId:v,setDragOverGroupId:T,onAccountDragStart:E,onAccountDragOver:w,onAccountDrop:D,onDragOverGroup:L,onDropOnGroup:q,onDragLeave:B,onDragLeaveGroup:ee,onDragEnd:Q,onCreateAccount:J,onUpdateAccount:O,onDeleteAccount:R,onMoveAccount:j}){const I=[...t].sort((H,N)=>H.sort_order-N.sort_order),M=f==="account"&&b==="ungrouped",k=(p&&f==="account"?n[p]:null)&&Object.entries(n).find(([H])=>H===p)?.[1]&&Object.entries(n).find(([H])=>H===p)?.[1]?.account_group_id!==null;if(I.length===0&&!l&&i&&f!=="account")return null;const Y=I.reduce((H,N)=>H+N.balance,0);return d.jsxs("div",{onDragOver:H=>L(H,"ungrouped"),onDragLeave:ee,onDrop:H=>q(H,"ungrouped"),style:{background:M&&k?`color-mix(in srgb, ${ce.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",border:M&&k?`2px dashed ${ce.primary}`:"2px solid transparent",transition:"all 0.15s"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)"},children:[d.jsxs("h3",{style:{...Pf,margin:0,opacity:.7,display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{style:{borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:"Ungrouped"}),d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400,fontSize:"0.9rem"},children:["(",I.length,")"]}),I.length>0&&d.jsx("span",{style:{marginLeft:"0.5rem",fontWeight:600,fontSize:"0.9rem",color:Tt(Y),borderBottom:"2px solid currentColor",paddingBottom:"2px"},children:ke(Y)})]}),d.jsx(Ie,{variant:"small",actionName:"Open Add Account Form (Ungrouped)",onClick:()=>h("ungrouped"),disabled:l!==null,children:"+ Account"})]}),d.jsxs("div",{style:Cl,children:[I.map((H,N)=>a===H.id?d.jsx(nf,{initialData:{nickname:H.nickname,account_group_id:H.account_group_id,is_income_account:H.is_income_account,is_income_default:H.is_income_default,is_outgo_account:H.is_outgo_account,is_outgo_default:H.is_outgo_default,on_budget:H.on_budget,is_active:H.is_active},onSubmit:G=>O(H.id,G),onCancel:()=>c(null),submitLabel:"Save",accountGroups:e,showGroupSelector:!0,showIncomeSettings:!0,currentGroupId:null,hasExistingIncomeDefault:Object.entries(n).some(([G,W])=>W.is_income_default&&G!==H.id),hasExistingOutgoDefault:Object.entries(n).some(([G,W])=>W.is_outgo_default&&G!==H.id)},H.id):d.jsx(Lf,{isDragging:f==="account"&&p===H.id,isDragOver:_===H.id,onDragStart:G=>E(G,H.id),onDragOver:G=>w(G,H.id,"ungrouped"),onDragLeave:B,onDragEnd:Q,onDrop:G=>D(G,H.id,"ungrouped"),onEdit:()=>{H.nickname,c(H.id)},onDelete:()=>{H.nickname,R(H.id)},onMoveUp:()=>j(H.id,"up"),onMoveDown:()=>j(H.id,"down"),canMoveUp:N>0,canMoveDown:N<I.length-1,children:d.jsxs("div",{children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("span",{style:s_,children:H.nickname}),d.jsx(ZT,{account:H,accountGroups:e})]}),d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"1.1rem",fontWeight:600,color:Tt(H.balance)},children:ke(H.balance)})]})},H.id)),I.length===0&&f==="account"&&d.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0",textAlign:"center"},children:"Drop here to ungroup"}),f==="account"&&I.length>0&&d.jsx(eC,{groupId:"ungrouped",isActive:_==="__end__ungrouped",onDragOver:H=>{H.preventDefault(),H.stopPropagation(),v("__end__ungrouped"),T("ungrouped")},onDragLeave:H=>{H.stopPropagation(),v(null)},onDrop:H=>{H.stopPropagation(),D(H,"__group_end__","ungrouped")}}),l==="ungrouped"&&d.jsx(nf,{initialData:{nickname:"",account_group_id:null},onSubmit:H=>J(H,"ungrouped"),onCancel:()=>h(null),submitLabel:"Create",accountGroups:e,showIncomeSettings:!0,currentGroupId:null})]}),l!=="ungrouped"&&d.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:d.jsx(Ie,{variant:"small",actionName:"Open Add Account Form (Ungrouped)",onClick:()=>h("ungrouped"),disabled:l!==null,children:"+ Add Account"})})]})}function h6(){const{accounts:t,accountsByGroup:e,sortedGroups:n,currentBudget:i,error:a,setError:l,handleCreateAccount:c,handleUpdateAccount:h,handleDeleteAccount:f,handleMoveAccount:p,handleCreateGroup:_,handleUpdateGroup:b,handleDeleteGroup:v,handleMoveGroup:T,reorderAccountsInGroup:E,reorderGroups:w}=YP(),D=da(),[L,q]=A.useState(null),[B,ee]=A.useState(null),[Q,J]=A.useState(null),[O,R]=A.useState(!1),[j,I]=A.useState(null),[M,F]=A.useState(null),[k,Y]=A.useState(null),[H,N]=A.useState(null);function G(fe,te){I("account"),F(te),fe.dataTransfer.effectAllowed="move"}function W(fe,te,Ee){fe.preventDefault(),j==="account"&&(te!==M&&Y(te),N(Ee))}function ne(fe,te){fe.preventDefault(),j==="account"?(N(te),Y(null)):j==="group"&&te!==M&&Y(te)}function ie(){Y(null)}function V(){N(null)}function z(){I(null),F(null),Y(null),N(null)}async function $(fe,te,Ee){if(fe.preventDefault(),fe.stopPropagation(),!M||j!=="account"){z();return}await E(M,te,Ee),z()}async function X(fe,te){fe.preventDefault(),j==="account"?await $(fe,"__group_end__",te):j==="group"&&await ue(fe,te)}function re(fe,te){fe.stopPropagation(),I("group"),F(te),fe.dataTransfer.effectAllowed="move"}async function ue(fe,te){if(fe.preventDefault(),!M||j!=="group"||M===te){z();return}await w(M,te),z()}const he=A.useMemo(()=>{const fe=Object.values(t),te=fe.reduce((st,He)=>st+(He.balance??0),0);let Ee=0,De=0;for(const st of fe){const He=n.find(In=>In.id===st.account_group_id);st.on_budget===!0||st.on_budget===void 0&&He?.on_budget!==!1?Ee+=st.balance??0:De+=st.balance??0}return{count:fe.length,groupCount:n.length,totalBalance:te,onBudgetTotal:Ee,offBudgetTotal:De}},[t,n]);if(!i)return d.jsx("p",{children:"No budget found. Please log in."});const Se=e.ungrouped||[];return d.jsxs("div",{children:[a&&d.jsx(lo,{message:a,onDismiss:()=>l(null)}),d.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Accounts:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),d.jsx("span",{style:{color:Tt(he.onBudgetTotal),fontWeight:600},children:ke(he.onBudgetTotal)})]}),he.offBudgetTotal!==0&&d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Off-Budget: "}),d.jsx("span",{style:{fontWeight:600,opacity:.7},children:ke(he.offBudgetTotal)})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Total: "}),d.jsx("span",{style:{color:Tt(he.totalBalance),fontWeight:600},children:ke(he.totalBalance)})]}),d.jsx("span",{style:{opacity:.5,fontSize:"0.8rem"},children:D?"Drag to move.":"Drag between types or use  to reorder."})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:d.jsx(u_,{})})]})}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",paddingTop:"1rem"},children:[Object.keys(t).length===0&&n.length===0&&d.jsx("p",{style:{opacity:.7},children:"No accounts yet. Create an account type first, then add accounts!"}),n.map((fe,te)=>d.jsx(c6,{group:fe,groupIndex:te,totalGroups:n.length,accounts:e[fe.id]||[],allGroups:n,allAccounts:t,editingAccountId:L,editingGroupId:Q,createForGroupId:B,setEditingAccountId:q,setEditingGroupId:J,setCreateForGroupId:ee,dragType:j,draggedId:M,dragOverId:k,dragOverGroupId:H,setDragOverId:Y,setDragOverGroupId:N,onAccountDragStart:G,onAccountDragOver:W,onAccountDrop:$,onGroupDragStart:re,onGroupDragOver:ne,onGroupDrop:ue,onDragLeave:ie,onDragLeaveGroup:V,onDragEnd:z,onDropOnGroup:X,onCreateAccount:c,onUpdateAccount:(Ee,De)=>{h(Ee,De),q(null)},onDeleteAccount:f,onMoveAccount:p,onUpdateGroup:(Ee,De)=>{b(Ee,De),J(null)},onDeleteGroup:v,onMoveGroup:T},fe.id)),j==="group"&&n.length>0&&d.jsx(o_,{isActive:k==="__end__",onDragOver:fe=>{fe.preventDefault(),Y("__end__")},onDragLeave:ie,onDrop:fe=>ue(fe,"__end__"),label:"Move account type to end"}),d.jsx(d6,{accounts:Se,allGroups:n,allAccounts:t,hasGroups:n.length>0,editingAccountId:L,createForGroupId:B,setEditingAccountId:q,setCreateForGroupId:ee,dragType:j,draggedId:M,dragOverId:k,dragOverGroupId:H,setDragOverId:Y,setDragOverGroupId:N,onAccountDragStart:G,onAccountDragOver:W,onAccountDrop:$,onDragOverGroup:ne,onDropOnGroup:X,onDragLeave:ie,onDragLeaveGroup:V,onDragEnd:z,onCreateAccount:c,onUpdateAccount:(fe,te)=>{h(fe,te),q(null)},onDeleteAccount:f,onMoveAccount:p})]}),O?d.jsx(JT,{onSubmit:fe=>{_(fe),R(!1)},onCancel:()=>R(!1),submitLabel:"Create Account Type"}):d.jsx(Ie,{variant:"primary-large",actionName:"Open Add Account Type Form",onClick:()=>R(!0),children:"+ Add Account Type"})]})}function rf({initialData:t,onSubmit:e,onCancel:n,submitLabel:i,categoryGroups:a=[],showGroupSelector:l=!1}){const[c,h]=A.useState(t||{name:"",category_group_id:null}),[f,p]=A.useState(t?.default_monthly_amount?.toString()||""),[_,b]=A.useState(t?.default_monthly_type||"fixed"),[v,T]=A.useState(!1);function E(w){if(w.preventDefault(),!c.name.trim())return;T(!0);const D=parseFloat(f),L=!isNaN(D)&&D>0;e({...c,description:c.description?.trim()||void 0,default_monthly_amount:L?D:void 0,default_monthly_type:L?_:void 0})}return d.jsxs(Ja,{actionName:i==="Create"?"Create Category":"Update Category",onSubmit:E,children:[d.jsx(en,{label:"Category Name",htmlFor:"category-name",children:d.jsx(Za,{id:"category-name",type:"text",value:c.name,onChange:w=>h({...c,name:w.target.value}),placeholder:"e.g., Groceries, Rent, Gas",required:!0,autoFocus:!0})}),d.jsx(en,{label:"Description (optional)",htmlFor:"category-description",children:d.jsx(a_,{id:"category-description",value:c.description||"",onChange:w=>h({...c,description:w.target.value}),placeholder:"What is this category used for?",minHeight:"3rem"})}),l&&d.jsx(en,{label:"Category Group",htmlFor:"category-group",children:d.jsxs(pu,{id:"category-group",value:c.category_group_id||"ungrouped",onChange:w=>h({...c,category_group_id:w.target.value==="ungrouped"?null:w.target.value}),children:[d.jsx("option",{value:"ungrouped",children:"Uncategorized"}),a.map(w=>d.jsx("option",{value:w.id,children:w.name},w.id))]})}),d.jsxs(en,{label:"Default Monthly Allocation (optional)",htmlFor:"default-amount",children:[d.jsxs("div",{style:{display:"flex",gap:"0.5rem",alignItems:"center"},children:[d.jsxs(pu,{id:"default-type",value:_,onChange:w=>b(w.target.value),style:{width:"auto",flex:"0 0 auto"},children:[d.jsx("option",{value:"fixed",children:"Fixed $"}),d.jsx("option",{value:"percentage",children:"% of Prev Income"})]}),_==="fixed"?d.jsx(Jg,{id:"default-amount",value:f,onChange:p,placeholder:"$0.00"}):d.jsx(Za,{id:"default-amount",type:"number",value:f,onChange:w=>p(w.target.value),placeholder:"0",min:"0",max:"100",step:"0.1",style:{width:"80px"}}),_==="percentage"&&d.jsx("span",{style:{opacity:.6},children:"%"})]}),d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.75rem",opacity:.6},children:_==="fixed"?"Suggested fixed amount to allocate each month":"Percentage of previous month's total income"})]}),d.jsxs(co,{children:[d.jsx(Ie,{type:"submit",actionName:i==="Create"?"Create Category":"Save Category",isLoading:v,children:i}),d.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Category Form",onClick:n,children:"Cancel"})]})]})}function tC({initialData:t,onSubmit:e,onCancel:n,submitLabel:i}){const[a,l]=A.useState(t||{name:""}),[c,h]=A.useState(!1);function f(p){p.preventDefault(),a.name.trim()&&(h(!0),e(a))}return d.jsxs(Ja,{actionName:i==="Create Group"?"Create Category Group":"Update Category Group",onSubmit:f,children:[d.jsx(en,{label:"Group Name",htmlFor:"group-name",children:d.jsx(Za,{id:"group-name",type:"text",value:a.name,onChange:p=>l({...a,name:p.target.value}),placeholder:"e.g., Housing, Transportation, Food",required:!0,autoFocus:!0})}),d.jsxs(co,{children:[d.jsx(Ie,{type:"submit",actionName:i==="Create Group"?"Create Category Group":"Save Category Group",isLoading:c,children:i}),d.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Category Group Form",onClick:n,children:"Cancel"})]})]})}function nC({isActive:t,onDragOver:e,onDragLeave:n,onDrop:i}){return d.jsxs("div",{onDragOver:e,onDragLeave:n,onDrop:i,style:{position:"relative",height:"2rem",marginTop:"-0.25rem"},children:[d.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",opacity:t?1:.3,transition:"opacity 0.15s",boxShadow:t?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),t&&d.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Move to end"})]})}function f6({group:t,groupIndex:e,groupCategories:n,sortedGroups:i,categoryGroups:a,categoryBalances:l,loadingBalances:c,dragType:h,draggedId:f,dragOverId:p,dragOverGroupId:_,editingCategoryId:b,setEditingCategoryId:v,createForGroupId:T,setCreateForGroupId:E,editingGroupId:w,setEditingGroupId:D,handleCreateCategory:L,handleUpdateCategory:q,handleDeleteCategory:B,handleMoveCategory:ee,handleUpdateGroup:Q,handleDeleteGroup:J,handleMoveGroup:O,handleCategoryDragStart:R,handleCategoryDragOver:j,handleDragOverGroup:I,handleDragLeave:M,handleDragLeaveGroup:F,handleDragEnd:k,handleCategoryDrop:Y,handleDropOnGroup:H,handleGroupDragStart:N,handleGroupDrop:G,setDragOverId:W,setDragOverGroupId:ne,isMobile:ie,categories:V}){const z=h==="group"&&f===t.id,$=h==="group"&&p===t.id,X=h==="category"&&_===t.id,re=f&&h==="category"?V[f]:null,ue=re&&(re.category_group_id||"ungrouped")!==t.id,he=h==="group"&&$&&f!==t.id,Se=e>0,fe=e<i.length-1;return d.jsxs("div",{children:[h==="group"&&!z&&d.jsxs("div",{onDragOver:te=>{te.preventDefault(),W(t.id)},onDragLeave:M,onDrop:te=>G(te,t.id),style:{position:"relative",height:he?"2.5rem":"0.5rem",marginBottom:he?"-0.5rem":"-0.25rem",transition:"height 0.15s"},children:[d.jsx("div",{style:{position:"absolute",top:"50%",left:0,right:0,height:"3px",background:ce.primary,borderRadius:"2px",opacity:he?1:0,transition:"opacity 0.15s",boxShadow:he?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),he&&d.jsx("span",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",fontSize:"0.75rem",opacity:.7,background:"var(--background, #1a1a1a)",padding:"0 0.5rem",whiteSpace:"nowrap"},children:"Drop here"})]}),d.jsx("div",{onDragOver:te=>I(te,t.id),onDragLeave:F,onDrop:te=>H(te,t.id),style:{background:z?"color-mix(in srgb, currentColor 3%, transparent)":X&&ue?`color-mix(in srgb, ${ce.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",opacity:z?.5:1,border:X&&ue?`2px dashed ${ce.primary}`:"2px solid transparent",transition:"all 0.15s"},children:w===t.id?d.jsx(tC,{initialData:{name:t.name},onSubmit:te=>Q(t.id,te),onCancel:()=>D(null),submitLabel:"Save"}):d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:ie?"0.5rem":"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)",gap:"0.5rem",flexWrap:ie?"wrap":"nowrap"},children:[d.jsxs("h3",{style:{...Pf,margin:0,display:"flex",alignItems:"center",gap:"0.5rem",flex:1,minWidth:0},children:[!ie&&d.jsx("span",{draggable:!0,onDragStart:te=>N(te,t.id),onDragEnd:k,style:{cursor:"grab",opacity:.4,padding:"0.25rem",margin:"-0.25rem",borderRadius:"4px",userSelect:"none"},title:"Drag to reorder group",children:""}),d.jsx("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),d.jsxs("span",{style:{opacity:.5,fontWeight:400,fontSize:"0.9rem",flexShrink:0},children:["(",n.length,")"]})]}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0,alignItems:"center"},children:[!ie&&d.jsx(Ie,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>E(t.id),disabled:T!==null,children:"+ Category"}),d.jsx("button",{onClick:()=>{t.name,D(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Edit group",children:""}),d.jsx("button",{onClick:()=>{t.name,J(t.id)},style:{background:"transparent",border:"none",cursor:"pointer",opacity:.6,fontSize:"0.9rem",padding:"0.25rem"},title:"Delete group",children:""}),d.jsxs("div",{style:i_,children:[d.jsx("button",{onClick:()=>O(t.id,"up"),disabled:!Se,style:{...Tl,opacity:Se?.6:.2,cursor:Se?"pointer":"default"},title:"Move group up","aria-label":"Move group up",children:""}),d.jsx("button",{onClick:()=>O(t.id,"down"),disabled:!fe,style:{...Tl,opacity:fe?.6:.2,cursor:fe?"pointer":"default"},title:"Move group down","aria-label":"Move group down",children:""})]})]})]}),ie&&d.jsx("div",{style:{marginBottom:"0.5rem"},children:d.jsx(Ie,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>E(t.id),disabled:T!==null,children:"+ Category"})}),d.jsxs("div",{style:Cl,children:[n.map(([te,Ee])=>b===te?d.jsx(rf,{initialData:{name:Ee.name,description:Ee.description,category_group_id:Ee.category_group_id,default_monthly_amount:Ee.default_monthly_amount,default_monthly_type:Ee.default_monthly_type},onSubmit:De=>q(te,De),onCancel:()=>v(null),submitLabel:"Save",categoryGroups:a,showGroupSelector:!0},te):d.jsx(Lf,{isDragging:h==="category"&&f===te,isDragOver:p===te,onDragStart:De=>{De.stopPropagation(),R(De,te)},onDragOver:De=>j(De,te,t.id),onDragLeave:M,onDragEnd:k,onDrop:De=>Y(De,te,t.id),onEdit:()=>{Ee.name,v(te)},onDelete:()=>{Ee.name,B(te)},onMoveUp:()=>ee(te,"up"),onMoveDown:()=>ee(te,"down"),canMoveUp:n.findIndex(([De])=>De===te)>0,canMoveDown:n.findIndex(([De])=>De===te)<n.length-1,children:d.jsx(rC,{category:Ee,catId:te,categoryBalances:l,loadingBalances:c})},te)),n.length===0&&!T&&d.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0"},children:"No categories in this group"}),h==="category"&&n.length>0&&d.jsx(nC,{groupId:t.id,isActive:p===`__end__${t.id}`,onDragOver:te=>{te.preventDefault(),te.stopPropagation(),W(`__end__${t.id}`),ne(t.id)},onDragLeave:te=>{te.stopPropagation(),W(null)},onDrop:te=>{te.stopPropagation(),Y(te,"__group_end__",t.id)}}),T===t.id&&d.jsx(rf,{initialData:{name:"",category_group_id:t.id},onSubmit:te=>L(te,t.id),onCancel:()=>E(null),submitLabel:"Create",categoryGroups:a})]}),T!==t.id&&d.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:d.jsx(Ie,{variant:"small",actionName:`Open Add Category Form (${t.name})`,onClick:()=>E(t.id),disabled:T!==null,children:"+ Add Category"})})]})})]})}function rC({category:t,catId:e,categoryBalances:n,loadingBalances:i}){const a=n[e]||{current:0,total:0};return d.jsxs("div",{children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexWrap:"wrap"},children:[d.jsx("span",{style:s_,children:t.name}),t.default_monthly_amount!==void 0&&t.default_monthly_amount>0&&d.jsxs("span",{style:{fontSize:"0.75rem",opacity:.8,background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.15rem 0.4rem",borderRadius:"4px"},children:["Default: ",t.default_monthly_type==="percentage"?d.jsxs(d.Fragment,{children:[d.jsxs("span",{style:{color:ce.success,fontWeight:500},children:[t.default_monthly_amount,"%"]})," of prev income"]}):d.jsxs(d.Fragment,{children:[d.jsx("span",{style:{color:ce.success,fontWeight:500},children:ke(t.default_monthly_amount)}),"/mo"]})]})]}),t.description&&d.jsx("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",opacity:.6,lineHeight:1.3},children:t.description}),d.jsxs("div",{style:{marginTop:"0.25rem"},children:[d.jsxs("p",{style:{margin:0,fontSize:"1rem",fontWeight:600,color:Nn(a.current)},children:[i?"...":kn(a.current),d.jsx("span",{style:{fontSize:"0.75rem",fontWeight:400,opacity:.6,marginLeft:"0.35rem"},children:"available now"})]}),d.jsxs("p",{style:{margin:"0.15rem 0 0 0",fontSize:"0.85rem",fontWeight:500,color:Nn(a.total),opacity:.75},children:[i?"...":kn(a.total),d.jsx("span",{style:{fontSize:"0.7rem",fontWeight:400,opacity:.7,marginLeft:"0.35rem"},children:"total allocated"})]})]})]})}function m6({ungroupedCategories:t,categoryGroups:e,categoryBalances:n,loadingBalances:i,dragType:a,draggedId:l,dragOverId:c,dragOverGroupId:h,editingCategoryId:f,setEditingCategoryId:p,createForGroupId:_,setCreateForGroupId:b,handleCreateCategory:v,handleUpdateCategory:T,handleDeleteCategory:E,handleMoveCategory:w,handleCategoryDragStart:D,handleCategoryDragOver:L,handleDragOverGroup:q,handleDragLeaveGroup:B,handleDragLeave:ee,handleDragEnd:Q,handleCategoryDrop:J,handleDropOnGroup:O,setDragOverId:R,setDragOverGroupId:j,categories:I,hasGroups:M}){const F=a==="category"&&h==="ungrouped",k=l&&a==="category"?I[l]:null,Y=k&&k.category_group_id!==null;return t.length===0&&!_&&M&&a!=="category"?null:d.jsxs("div",{onDragOver:H=>q(H,"ungrouped"),onDragLeave:B,onDrop:H=>O(H,"ungrouped"),style:{background:F&&Y?`color-mix(in srgb, ${ce.primary} 10%, transparent)`:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1rem",border:F&&Y?`2px dashed ${ce.primary}`:"2px solid transparent",transition:"all 0.15s"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem",paddingBottom:"0.5rem",borderBottom:"1px solid color-mix(in srgb, currentColor 15%, transparent)"},children:[d.jsxs("h3",{style:{...Pf,margin:0,opacity:.7},children:["Uncategorized",d.jsxs("span",{style:{marginLeft:"0.5rem",opacity:.5,fontWeight:400,fontSize:"0.9rem"},children:["(",t.length,")"]})]}),d.jsx(Ie,{variant:"small",actionName:"Open Add Category Form (Uncategorized)",onClick:()=>b("ungrouped"),disabled:_!==null,children:"+ Category"})]}),d.jsxs("div",{style:Cl,children:[t.map(([H,N])=>f===H?d.jsx(rf,{initialData:{name:N.name,description:N.description,category_group_id:N.category_group_id,default_monthly_amount:N.default_monthly_amount,default_monthly_type:N.default_monthly_type},onSubmit:G=>T(H,G),onCancel:()=>p(null),submitLabel:"Save",categoryGroups:e,showGroupSelector:!0},H):d.jsx(Lf,{isDragging:a==="category"&&l===H,isDragOver:c===H,onDragStart:G=>D(G,H),onDragOver:G=>L(G,H,"ungrouped"),onDragLeave:ee,onDragEnd:Q,onDrop:G=>J(G,H,"ungrouped"),onEdit:()=>{N.name,p(H)},onDelete:()=>{N.name,E(H)},onMoveUp:()=>w(H,"up"),onMoveDown:()=>w(H,"down"),canMoveUp:t.findIndex(([G])=>G===H)>0,canMoveDown:t.findIndex(([G])=>G===H)<t.length-1,children:d.jsx(rC,{category:N,catId:H,categoryBalances:n,loadingBalances:i})},H)),t.length===0&&a==="category"&&d.jsx("p",{style:{opacity:.5,fontSize:"0.9rem",margin:"0.5rem 0",textAlign:"center"},children:"Drop here to uncategorize"}),a==="category"&&t.length>0&&d.jsx(nC,{groupId:"ungrouped",isActive:c==="__end__ungrouped",onDragOver:H=>{H.preventDefault(),H.stopPropagation(),R("__end__ungrouped"),j("ungrouped")},onDragLeave:H=>{H.stopPropagation(),R(null)},onDrop:H=>{H.stopPropagation(),J(H,"__group_end__","ungrouped")}}),_==="ungrouped"&&d.jsx(rf,{initialData:{name:"",category_group_id:null},onSubmit:H=>v(H,"ungrouped"),onCancel:()=>b(null),submitLabel:"Create",categoryGroups:e})]}),_!=="ungrouped"&&d.jsx("div",{style:{marginTop:"0.75rem",paddingTop:"0.5rem",borderTop:"1px solid color-mix(in srgb, currentColor 10%, transparent)"},children:d.jsx(Ie,{variant:"small",actionName:"Open Add Category Form (Uncategorized)",onClick:()=>b("ungrouped"),disabled:_!==null,children:"+ Add Category"})})]})}function p6(){const{currentBudget:t,categories:e,categoryGroups:n,categoriesByGroup:i,sortedGroups:a,categoryBalances:l,isLoading:c,loadingBalances:h,error:f,setError:p,getOnBudgetTotal:_,handleCreateCategory:b,handleUpdateCategory:v,handleDeleteCategory:T,handleMoveCategory:E,handleCreateGroup:w,handleUpdateGroup:D,handleDeleteGroup:L,handleMoveGroup:q,dragType:B,draggedId:ee,dragOverId:Q,dragOverGroupId:J,setDragOverId:O,setDragOverGroupId:R,handleCategoryDragStart:j,handleCategoryDragOver:I,handleDragOverGroup:M,handleDragLeave:F,handleDragLeaveGroup:k,handleDragEnd:Y,handleCategoryDrop:H,handleDropOnGroup:N,handleGroupDragStart:G,handleGroupDrop:W}=eL(),ne=da(),{addLoadingHold:ie,removeLoadingHold:V}=Qn();A.useEffect(()=>(c?ie("categories","Loading categories..."):V("categories"),()=>V("categories")),[c,ie,V]);const[z,$]=A.useState(null),[X,re]=A.useState(null),[ue,he]=A.useState(null),[Se,fe]=A.useState(!1);if(!t)return d.jsx("p",{children:"No budget found. Please log in."});const te=Object.values(l).reduce((He,Ft)=>He+Ft.current,0),Ee=Object.values(l).reduce((He,Ft)=>He+Ft.total,0),De=_()-te,st=Math.abs(Ee-te)>.01;return c?null:d.jsxs("div",{children:[f&&d.jsx(lo,{message:f,onDismiss:()=>p(null)}),d.jsx("div",{style:{position:"sticky",top:0,zIndex:50,backgroundColor:"#242424",marginLeft:"calc(-1 * var(--page-padding, 2rem))",marginRight:"calc(-1 * var(--page-padding, 2rem))",paddingLeft:"var(--page-padding, 2rem)",paddingRight:"var(--page-padding, 2rem)",paddingTop:"0.5rem",paddingBottom:"0.5rem",borderBottom:"1px solid rgba(255,255,255,0.15)"},children:d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:"0.5rem 1rem",fontSize:"0.85rem"},children:[d.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"0.5rem 1rem",flex:1,alignItems:"center"},children:[d.jsx("span",{style:{fontWeight:600},children:"Categories:"}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"On-Budget: "}),d.jsx("span",{style:{color:Tt(_()),fontWeight:600},children:ke(_())})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Allocated: "}),d.jsx("span",{style:{color:ce.primary,fontWeight:600},children:h?"...":ke(te)}),st&&d.jsxs("span",{style:{opacity:.5,fontSize:"0.8rem"},children:[" (",ke(Ee)," total)"]})]}),d.jsxs("span",{children:[d.jsx("span",{style:{opacity:.6},children:"Available: "}),d.jsx("span",{style:{color:Tt(De),fontWeight:600},children:h?"...":ke(De)})]}),d.jsx("span",{style:{opacity:.6},children:ne?"Drag to move between groups.":"Drag categories between groups, or use  to reorder."})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem",flexShrink:0},children:d.jsx(u_,{})})]})}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"1rem",marginBottom:"1.5rem",paddingTop:"1rem"},children:[Object.keys(e).length===0&&n.length===0&&d.jsx("p",{style:{opacity:.7},children:"No categories yet. Create a group first, then add categories!"}),a.map((He,Ft)=>{const In=(i[He.id]||[]).sort((Ve,nt)=>Ve[1].sort_order-nt[1].sort_order);return d.jsx(f6,{group:He,groupIndex:Ft,groupCategories:In,sortedGroups:a,categoryGroups:n,categoryBalances:l,loadingBalances:h,dragType:B,draggedId:ee,dragOverId:Q,dragOverGroupId:J,editingCategoryId:z,setEditingCategoryId:$,createForGroupId:X,setCreateForGroupId:re,editingGroupId:ue,setEditingGroupId:he,handleCreateCategory:b,handleUpdateCategory:v,handleDeleteCategory:T,handleMoveCategory:E,handleUpdateGroup:D,handleDeleteGroup:L,handleMoveGroup:q,handleCategoryDragStart:j,handleCategoryDragOver:I,handleDragOverGroup:M,handleDragLeave:F,handleDragLeaveGroup:k,handleDragEnd:Y,handleCategoryDrop:H,handleDropOnGroup:N,handleGroupDragStart:G,handleGroupDrop:W,setDragOverId:O,setDragOverGroupId:R,isMobile:ne,categories:e},He.id)}),B==="group"&&a.length>0&&d.jsx(o_,{isActive:Q==="__end__",onDragOver:He=>{He.preventDefault(),O("__end__")},onDragLeave:F,onDrop:He=>W(He,"__end__"),label:"Move group to end"}),d.jsx(m6,{ungroupedCategories:(i.ungrouped||[]).sort((He,Ft)=>He[1].sort_order-Ft[1].sort_order),categoryGroups:n,categoryBalances:l,loadingBalances:h,dragType:B,draggedId:ee,dragOverId:Q,dragOverGroupId:J,editingCategoryId:z,setEditingCategoryId:$,createForGroupId:X,setCreateForGroupId:re,handleCreateCategory:b,handleUpdateCategory:v,handleDeleteCategory:T,handleMoveCategory:E,handleCategoryDragStart:j,handleCategoryDragOver:I,handleDragOverGroup:M,handleDragLeaveGroup:k,handleDragLeave:F,handleDragEnd:Y,handleCategoryDrop:H,handleDropOnGroup:N,setDragOverId:O,setDragOverGroupId:R,categories:e,hasGroups:n.length>0})]}),Se?d.jsx(tC,{onSubmit:He=>{w(He),fe(!1)},onCancel:()=>fe(!1),submitLabel:"Create Group"}):d.jsx(Ie,{variant:"primary-large",actionName:"Open Add Category Group Form",onClick:()=>fe(!0),children:"+ Add Category Group"})]})}const g6=["accounts","categories","users"];function y6(){const{addLoadingHold:t,removeLoadingHold:e}=Qn(),{selectedBudgetId:n,currentUserId:i,lastSettingsTab:a,setLastSettingsTab:l,setPageTitle:c}=zt();A.useLayoutEffect(()=>{c("Budget Settings")},[c]);const{isOwner:h,isLoading:f}=Pn(n,i);A.useEffect(()=>(f?t("settings","Loading settings..."):e("settings"),()=>e("settings")),[f,t,e]);const p=jn(),_=p.pathname==="/budget/settings",b=A.useMemo(()=>{const D=p.pathname;return D.includes("/settings/accounts")?"accounts":D.includes("/settings/categories")?"categories":D.includes("/settings/users")?"users":"categories"},[p.pathname]),v=b==="users";A.useEffect(()=>{_||l(b)},[b,_,l]);function T(){return!g6.includes(a)||a==="users"&&!h?"categories":a}const E=A.useMemo(()=>[{id:"accounts",label:"Accounts",icon:""},{id:"categories",label:"Categories",icon:""},{id:"users",label:"Users",icon:"",hidden:!h}],[h]);return f?null:!h&&v?d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only the budget owner can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(Dt,{to:"/budget/settings/categories",style:{color:"#646cff"},children:"Go to Categories "})})]}):d.jsxs("div",{children:[d.jsx(l_,{mode:"link",linkPrefix:"/budget/settings",tabs:E,activeTab:_?T():b}),_?d.jsx(af,{to:`/budget/settings/${T()}`,replace:!0}):d.jsx(MT,{children:d.jsx(of,{})})]})}function _6(){const{selectedBudgetId:t,currentUserId:e}=zt(),{budget:n,budgetUserIds:i,acceptedUserIds:a,inviteUser:l,revokeUser:c}=Pn(t,e),[h,f]=A.useState(""),[p,_]=A.useState(!1),[b,v]=A.useState(null),[T,E]=A.useState(null);if(!n)return d.jsx("p",{children:"No budget found."});async function w(B){if(B.preventDefault(),!(!h.trim()||!n)){_(!0),v(null),E(null);try{await l(h.trim()),f(""),E("Invite sent! The user can now accept the invitation from their account.")}catch(ee){v(ee instanceof Error?ee.message:"Failed to invite user")}finally{_(!1)}}}async function D(B){if(!n)return;if(B===n.owner_id){v("Cannot revoke the budget owner");return}if(B===e){v("Cannot revoke yourself from the budget");return}const ee=a.includes(B);if(confirm(ee?"Are you sure you want to revoke this user's access? They will lose access to this budget.":"Are you sure you want to cancel this invitation?")){v(null),E(null);try{await c(B),E(ee?"User access revoked.":"Invitation cancelled.")}catch(J){v(J instanceof Error?J.message:"Failed to revoke user")}}}const L=i.filter(B=>a.includes(B)),q=i.filter(B=>!a.includes(B));return d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Budget Users"}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Invite users to access this budget. They must accept the invitation before they can access it."}),b&&d.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:b}),d.jsx("button",{onClick:()=>v(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),T&&d.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:T}),d.jsx("button",{onClick:()=>E(null),style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Active Users (",L.length,")"]}),L.length===0?d.jsx("p",{style:{opacity:.6,margin:0},children:"No users have accepted invitations yet."}):d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:L.map(B=>{const ee=B===n.owner_id,Q=B===e;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[d.jsx("div",{style:{flex:1,minWidth:0},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:B}),ee&&d.jsx("span",{style:{background:"color-mix(in srgb, #646cff 20%, transparent)",color:"#a5b4fc",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),Q&&d.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"You"})]})}),!ee&&!Q&&d.jsx("button",{onClick:()=>D(B),style:{background:"transparent",border:"1px solid rgba(220, 38, 38, 0.4)",color:"#f87171",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap"},children:"Revoke Access"})]},B)})})]}),q.length>0&&d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:["Pending Invitations (",q.length,")"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:q.map(B=>d.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem"},children:[d.jsx("div",{style:{flex:1,minWidth:0},children:d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap"},children:[d.jsx("code",{style:{fontSize:"0.85rem",background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",wordBreak:"break-all"},children:B}),d.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600},children:"Pending"})]})}),d.jsx("button",{onClick:()=>D(B),style:{background:"transparent",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",color:"inherit",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:"pointer",fontSize:"0.8rem",whiteSpace:"nowrap",opacity:.8},children:"Cancel Invite"})]},B))})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsx("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem"},children:"Invite User"}),d.jsxs("form",{onSubmit:w,style:{display:"flex",gap:"0.75rem"},children:[d.jsx("input",{type:"text",value:h,onChange:B=>f(B.target.value),placeholder:"Enter Firebase User ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),d.jsx("button",{type:"submit",disabled:p||!h.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:p||!h.trim()?"not-allowed":"pointer",fontWeight:500,opacity:p||!h.trim()?.7:1,whiteSpace:"nowrap"},children:p?"Inviting...":"Send Invite"})]}),d.jsx("p",{style:{margin:"1rem 0 0 0",fontSize:"0.85rem",opacity:.6},children:" The invited user will need to accept the invitation from their Account page using this budget's ID:"}),d.jsx("code",{style:{display:"block",marginTop:"0.5rem",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 10%, transparent)",borderRadius:"6px",fontSize:"0.85rem",wordBreak:"break-all"},children:n.id})]})]})}const b6=["budget","feedback","migration","tests"];function v6(){const{isAdmin:t,isTest:e,lastAdminTab:n,setLastAdminTab:i,setPageTitle:a}=zt();A.useLayoutEffect(()=>{a("Budget Admin")},[a]);const l=jn(),c=l.pathname==="/budget/admin",h=A.useMemo(()=>{const b=l.pathname;return b.includes("/admin/budget")?"budget":b.includes("/admin/feedback")?"feedback":b.includes("/admin/migration")?"migration":b.includes("/admin/tests")?"tests":"budget"},[l.pathname]),f=h==="tests";A.useEffect(()=>{c||i(h)},[h,c,i]);function p(){return!b6.includes(n)||n==="tests"&&!e?"budget":n}const _=A.useMemo(()=>[{id:"budget",label:"Budget",icon:""},{id:"feedback",label:"Feedback",icon:""},{id:"migration",label:"Migration",icon:""},{id:"tests",label:"Tests",icon:"",hidden:!e}],[e]);return t?!e&&f?d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only test users can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(Dt,{to:"/budget/admin/budget",style:{color:"#646cff"},children:"Go to Admin "})})]}):d.jsxs("div",{children:[d.jsx(l_,{mode:"link",linkPrefix:"/budget/admin",tabs:_,activeTab:h}),c?d.jsx(af,{to:`/budget/admin/${p()}`,replace:!0}):d.jsx(of,{})]}):d.jsxs("div",{children:[d.jsx("h1",{children:"Access Denied"}),d.jsx("p",{style:{opacity:.7},children:"Only administrators can access this section."}),d.jsx("p",{style:{marginTop:"1rem"},children:d.jsx(Dt,{to:"/budget",style:{color:"#646cff"},children:"Go to Budget "})})]})}function x6(){const{addLoadingHold:t,removeLoadingHold:e}=Qn(),{selectedBudgetId:n,currentUserId:i,isAdmin:a}=zt(),{budget:l,accounts:c,accountGroups:h,categories:f,categoryGroups:p,isOwner:_,isLoading:b}=Pn(n,i);return A.useEffect(()=>(b?t("settings-budget","Loading budget info..."):e("settings-budget"),()=>e("settings-budget")),[b,t,e]),b?null:l?d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Budget Summary"}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Information about the currently selected budget."}),d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem",fontSize:"0.95rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Name:"}),d.jsx("strong",{children:l.name})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"ID:"}),d.jsx("code",{style:{background:"color-mix(in srgb, currentColor 10%, transparent)",padding:"0.2rem 0.5rem",borderRadius:"4px",fontSize:"0.85rem"},children:l.id})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Owner:"}),d.jsx("strong",{children:l.owner_email||l.owner_id})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""}),d.jsx("span",{style:{opacity:.7,minWidth:"80px"},children:"Users:"}),d.jsxs("span",{children:[l.user_ids.length," user",l.user_ids.length!==1?"s":"",d.jsxs("span",{style:{opacity:.7},children:["  ",_?"You are the owner":"Shared with you"]})]})]})]})}),a&&d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsx("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem"},children:"Admin Tools"}),d.jsx("button",{onClick:()=>{const v={...l,accounts:c,account_groups:h,categories:f,category_groups:p,_meta:{downloaded_at:new Date().toISOString()}},T=new Blob([JSON.stringify(v,null,2)],{type:"application/json"}),E=URL.createObjectURL(T),w=document.createElement("a");w.href=E,w.download=`budget_${l.id}.json`,document.body.appendChild(w),w.click(),document.body.removeChild(w),URL.revokeObjectURL(E)},style:{display:"inline-flex",alignItems:"center",gap:"0.5rem",background:"color-mix(in srgb, currentColor 10%, transparent)",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",borderRadius:"6px",padding:"0.5rem 0.75rem",cursor:"pointer",fontSize:"0.85rem",color:"inherit",transition:"background 0.15s"},title:"Download budget document as JSON (for debugging)",children:" Download Budget JSON"})]})]}):d.jsx("p",{style:{opacity:.7},children:"No budget selected."})}function rE({budget:t,isCurrent:e,isAccepting:n,isSwitching:i,isEditing:a,editName:l,isRenaming:c,onAccept:h,onSwitch:f,onStartEdit:p,onCancelEdit:_,onEditNameChange:b,onSaveEdit:v}){const T=e&&t.isOwner;return d.jsx("div",{style:{background:e?"color-mix(in srgb, #646cff 15%, transparent)":"color-mix(in srgb, currentColor 8%, transparent)",border:e?"2px solid color-mix(in srgb, #646cff 50%, transparent)":"1px solid transparent",padding:"1rem",borderRadius:"8px"},children:a?d.jsxs("form",{onSubmit:v,children:[d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:d.jsx("input",{type:"text",value:l,onChange:E=>b(E.target.value),placeholder:"Budget name",autoFocus:!0,style:{flex:1,padding:"0.5rem 0.75rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"1rem",fontWeight:600,color:"inherit"}})}),d.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[d.jsx("button",{type:"submit",disabled:c||!l.trim(),style:{background:"#22c55e",color:"white",border:"none",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:c||!l.trim()?"not-allowed":"pointer",fontWeight:500,opacity:c||!l.trim()?.7:1,fontSize:"0.8rem"},children:c?"Saving...":"Save"}),d.jsx("button",{type:"button",onClick:_,disabled:c,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.4rem 0.75rem",borderRadius:"6px",cursor:c?"not-allowed":"pointer",fontWeight:500,opacity:c?.7:.8,fontSize:"0.8rem"},children:"Cancel"})]})]}):d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[d.jsxs("div",{style:{flex:1,minWidth:"200px"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",flexWrap:"wrap",marginBottom:"0.25rem"},children:[d.jsx("span",{style:{fontWeight:600},children:t.name}),t.isOwner&&d.jsx("span",{style:{background:"color-mix(in srgb, #646cff 20%, transparent)",color:"#a5b4fc",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Owner"}),e&&d.jsx("span",{style:{background:"color-mix(in srgb, #22c55e 20%, transparent)",color:"#4ade80",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Active"}),t.isPending&&d.jsx("span",{style:{background:"color-mix(in srgb, #f59e0b 20%, transparent)",color:"#fbbf24",padding:"0.15rem 0.5rem",borderRadius:"4px",fontSize:"0.65rem",textTransform:"uppercase",fontWeight:600},children:"Pending"}),T&&d.jsx("button",{onClick:p,style:{background:"transparent",border:"none",padding:"0.15rem",cursor:"pointer",opacity:.5,fontSize:"0.8rem",lineHeight:1},title:"Rename budget",children:""})]}),d.jsx("p",{style:{margin:0,fontSize:"0.8rem",opacity:.6},children:t.ownerEmail?`Owner: ${t.ownerEmail}`:`ID: ${t.id}`})]}),d.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:t.isPending?d.jsx("button",{onClick:h,disabled:n,style:{background:"#22c55e",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:n?"not-allowed":"pointer",fontWeight:500,opacity:n?.7:1,fontSize:"0.85rem"},children:n?"Accepting...":"Accept"}):e?null:d.jsx("button",{onClick:f,disabled:i,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:i?"not-allowed":"pointer",fontWeight:500,opacity:i?.7:1,fontSize:"0.85rem"},children:i?"Switching...":"Switch"})})]})})}const ey={critical_bug:{label:"Critical Bug",color:"#ff4757",bgColor:"rgba(255, 71, 87, 0.15)"},bug:{label:"Bug",color:"#ffa502",bgColor:"rgba(255, 165, 2, 0.15)"},new_feature:{label:"New Feature",color:"#2ed573",bgColor:"rgba(46, 213, 115, 0.15)"},core_feature:{label:"Core Feature",color:"#1e90ff",bgColor:"rgba(30, 144, 255, 0.15)"},qol:{label:"QOL",color:"#a55eea",bgColor:"rgba(165, 94, 234, 0.15)"}};function iC({type:t,onClick:e}){const n=t==="feature"?"new_feature":t,i=n&&n in ey?n:"bug",a=ey[i];return d.jsx("button",{type:"button",onClick:e,style:{padding:"0.25rem 0.5rem",borderRadius:"0.25rem",background:a.bgColor,color:a.color,fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase",letterSpacing:"0.025em",flexShrink:0,border:"none",cursor:"pointer",transition:"opacity 0.15s, transform 0.15s"},onMouseEnter:l=>{l.currentTarget.style.opacity="0.8",l.currentTarget.style.transform="scale(1.05)"},onMouseLeave:l=>{l.currentTarget.style.opacity="1",l.currentTarget.style.transform="scale(1)"},title:"Click to change type",children:a.label})}function S6({item:t,isDragging:e,isDragOver:n,onDragStart:i,onDragOver:a,onDragLeave:l,onDragEnd:c,onDrop:h,onToggleDone:f,onTypeClick:p}){return d.jsxs("div",{onDragOver:_=>{_.stopPropagation(),a(_)},onDragLeave:_=>{_.stopPropagation(),l()},onDrop:_=>{_.stopPropagation(),h(_)},style:{position:"relative"},children:[d.jsx("div",{style:{...DT,opacity:n?1:0,boxShadow:n?"0 0 8px rgba(100, 108, 255, 0.6)":"none"}}),d.jsxs("div",{draggable:!0,onDragStart:i,onDragEnd:c,style:{...Ou,cursor:"grab",opacity:e?.5:1,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[d.jsx("span",{style:{...RT},children:""}),d.jsx("input",{type:"checkbox",checked:t.is_done,onChange:f,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ce.primary,flexShrink:0}}),d.jsx(iC,{type:t.feedback_type,onClick:p})]}),d.jsxs("div",{style:{marginLeft:"3.25rem"},children:[d.jsx("p",{style:{margin:0,lineHeight:1.5},children:t.text}),d.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.6},children:[t.user_email,"  ",Zg(t.created_at)]})]})]})]})}function E6({item:t,onToggleDone:e,onTypeClick:n}){return d.jsxs("div",{style:{...Ou,opacity:.6,flexDirection:"column",alignItems:"stretch",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem"},children:[d.jsx("input",{type:"checkbox",checked:t.is_done,onChange:e,style:{width:"1.25rem",height:"1.25rem",cursor:"pointer",accentColor:ce.primary,flexShrink:0}}),d.jsx(iC,{type:t.feedback_type,onClick:n})]}),d.jsxs("div",{style:{marginLeft:"2rem"},children:[d.jsx("p",{style:{margin:0,lineHeight:1.5,textDecoration:"line-through"},children:t.text}),d.jsxs("p",{style:{margin:"0.5rem 0 0 0",fontSize:"0.8rem",opacity:.8},children:[t.user_email,"  Created: ",Zg(t.created_at)]}),t.completed_at&&d.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.8rem",color:ce.success},children:[" Completed: ",Zg(t.completed_at)]})]})]})}function zf({noMargin:t}={}){return d.jsx("span",{style:{display:"inline-block",width:"14px",height:"14px",border:"2px solid rgba(255, 255, 255, 0.3)",borderTopColor:"white",borderRadius:"50%",animation:"spin 0.8s linear infinite",marginRight:t?0:"0.5rem",verticalAlign:"middle"}})}function Ff({title:t,description:e,status:n,statusText:i,onRefresh:a,isRefreshing:l,isBusy:c=!1,children:h,cardName:f}){const _=(()=>{switch(n){case"unknown":return{color:"#9ca3af",text:i??"Unknown"};case"clean":case"complete":return{color:"#22c55e",text:i??" Clean"};case"needs-action":return{color:"#f59e0b",text:i??"Action Needed"}}})(),b=l||c;return d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"12px",padding:"1.5rem",marginBottom:"1rem"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.75rem"},children:[d.jsxs("div",{style:{flex:1},children:[d.jsx("h3",{style:{margin:"0 0 0.5rem 0"},children:t}),d.jsx("p",{style:{margin:0,opacity:.7,fontSize:"0.9rem"},children:e})]}),d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",flexShrink:0},children:[n!=="unknown"&&d.jsx("span",{style:{color:_.color,fontWeight:600,fontSize:"0.9rem"},children:_.text}),d.jsxs("button",{onClick:()=>{a()},disabled:b,style:{background:"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",padding:"0.35rem 0.65rem",borderRadius:"6px",cursor:b?"not-allowed":"pointer",fontWeight:500,fontSize:"0.85rem",opacity:b?.6:1,display:"flex",alignItems:"center",gap:"0.3rem"},title:"Refresh status",children:[l?d.jsx(zf,{noMargin:!0}):""," Refresh"]})]})]}),h]})}const w6={unknown:{bg:"rgba(100, 100, 100, 0.1)",border:"rgba(100, 100, 100, 0.3)",color:"#9ca3af"},clean:{bg:"rgba(34, 197, 94, 0.1)",border:"rgba(34, 197, 94, 0.3)",color:"#4ade80"},warning:{bg:"rgba(245, 158, 11, 0.1)",border:"rgba(245, 158, 11, 0.3)",color:"#fbbf24"},running:{bg:"rgba(100, 108, 255, 0.1)",border:"rgba(100, 108, 255, 0.3)",color:"#a5b4fc"},success:{bg:"rgba(34, 197, 94, 0.1)",border:"rgba(34, 197, 94, 0.3)",color:"#4ade80"}};function pn({type:t,children:e}){const n=w6[t];return d.jsx("div",{style:{background:n.bg,border:`1px solid ${n.border}`,color:n.color,padding:"0.75rem 1rem",borderRadius:"8px",display:"flex",alignItems:"center"},children:e})}function qf({onClick:t,disabled:e,isBusy:n,busyText:i,children:a,actionName:l}){const c=e||n;return d.jsx("button",{onClick:()=>{t()},disabled:c,style:{marginTop:"1rem",background:"#646cff",color:"white",border:"none",padding:"0.75rem 1.5rem",borderRadius:"8px",cursor:c?"not-allowed":"pointer",fontWeight:500,opacity:c?.7:1,display:"flex",alignItems:"center",gap:"0.4rem"},children:n?d.jsxs(d.Fragment,{children:[d.jsx(zf,{noMargin:!0})," ",i??"Running..."]}):a})}function T6({hasData:t,status:e,hasIssues:n,totalIssues:i,isRunning:a,result:l,onRunCleanup:c,onRefresh:h,isRefreshing:f,disabled:p}){const _=()=>t?l&&l.errors.length===0&&(l.accountsFixed>0||l.categoriesFixed>0||l.groupsFixed>0||l.monthMapsUpdated>0||l.deprecatedFieldsRemoved>0||l.futureMonthsDeleted>0||l.monthsFixed>0||l.oldRecalcFieldsRemoved>0)?"complete":n?"needs-action":"clean":"unknown",b=l?l.accountsFixed+l.categoriesFixed+l.groupsFixed+l.monthMapsUpdated+l.deprecatedFieldsRemoved+l.futureMonthsDeleted+l.monthsFixed+l.oldRecalcFieldsRemoved:0;return d.jsx(Ff,{title:" Database Cleanup",description:"Validates and fixes all budget and month documents to match the expected schema. Converts legacy formats, adds missing default values, and removes invalid future months.",status:_(),onRefresh:h,isRefreshing:f,isBusy:a,children:a?d.jsx(pn,{type:"running",children:"Running database cleanup..."}):l?d.jsx(pn,{type:l.errors.length>0?"warning":"success",children:d.jsxs("div",{children:[l.errors.length>0?"":""," Cleanup complete",d.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[l.budgetsProcessed>0&&d.jsxs("li",{children:[l.budgetsProcessed," budget",l.budgetsProcessed!==1?"s":""," updated"]}),l.arraysConverted>0&&d.jsxs("li",{children:[l.arraysConverted," array",l.arraysConverted!==1?"s":""," converted to maps"]}),l.accountsFixed>0&&d.jsxs("li",{children:[l.accountsFixed," account",l.accountsFixed!==1?"s":""," fixed"]}),l.categoriesFixed>0&&d.jsxs("li",{children:[l.categoriesFixed," categor",l.categoriesFixed!==1?"ies":"y"," fixed"]}),l.groupsFixed>0&&d.jsxs("li",{children:[l.groupsFixed," group",l.groupsFixed!==1?"s":""," fixed"]}),l.monthMapsUpdated>0&&d.jsxs("li",{children:[l.monthMapsUpdated," budget",l.monthMapsUpdated!==1?"s":""," got month_map updated"]}),l.deprecatedFieldsRemoved>0&&d.jsxs("li",{children:[l.deprecatedFieldsRemoved," budget",l.deprecatedFieldsRemoved!==1?"s":""," had deprecated fields removed"]}),l.futureMonthsDeleted>0&&d.jsxs("li",{children:[l.futureMonthsDeleted," future month",l.futureMonthsDeleted!==1?"s":""," deleted"]}),l.monthsFixed>0&&d.jsxs("li",{children:[l.monthsFixed," month",l.monthsFixed!==1?"s":""," schema fixed"]}),l.oldRecalcFieldsRemoved>0&&d.jsxs("li",{children:[l.oldRecalcFieldsRemoved," month",l.oldRecalcFieldsRemoved!==1?"s":""," had old recalc field removed"]}),b===0&&d.jsx("li",{children:"No changes needed"})]}),l.errors.length>0&&d.jsxs(d.Fragment,{children:[d.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[l.errors.slice(0,5).map((v,T)=>d.jsx("li",{children:v},T)),l.errors.length>5&&d.jsxs("li",{style:{opacity:.7},children:["...and ",l.errors.length-5," more errors"]})]})]})]})}):t?n?d.jsxs(d.Fragment,{children:[d.jsx(pn,{type:"warning",children:d.jsxs("div",{children:[d.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",i," issue",i!==1?"s":""," to fix:"]}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[e.budgetsWithArrays>0&&d.jsxs("li",{children:[e.budgetsWithArrays," budget",e.budgetsWithArrays!==1?"s":""," using legacy array format"]}),e.accountsNeedingDefaults>0&&d.jsxs("li",{children:[e.accountsNeedingDefaults," account",e.accountsNeedingDefaults!==1?"s":""," missing default values"]}),e.categoriesNeedingDefaults>0&&d.jsxs("li",{children:[e.categoriesNeedingDefaults," categor",e.categoriesNeedingDefaults!==1?"ies":"y"," missing default values"]}),e.groupsNeedingDefaults>0&&d.jsxs("li",{children:[e.groupsNeedingDefaults," account group",e.groupsNeedingDefaults!==1?"s":""," missing default values"]}),e.budgetsNeedingMonthMapUpdate>0&&d.jsxs("li",{children:[e.budgetsNeedingMonthMapUpdate," budget",e.budgetsNeedingMonthMapUpdate!==1?"s":""," missing month_map"]}),e.budgetsWithDeprecatedEarliestMonth>0&&d.jsxs("li",{children:[e.budgetsWithDeprecatedEarliestMonth," budget",e.budgetsWithDeprecatedEarliestMonth!==1?"s":""," with deprecated earliest_month field to remove"]}),e.futureMonthsToDelete.length>0&&d.jsxs("li",{children:[e.futureMonthsToDelete.length," future month",e.futureMonthsToDelete.length!==1?"s":""," to delete",d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1rem",fontSize:"0.85rem",opacity:.8},children:[e.futureMonthsToDelete.slice(0,3).map(v=>d.jsxs("li",{children:[ml[v.month-1]," ",v.year]},v.docId)),e.futureMonthsToDelete.length>3&&d.jsxs("li",{style:{opacity:.7},children:["...and ",e.futureMonthsToDelete.length-3," more"]})]})]}),e.monthsWithSchemaIssues>0&&d.jsxs("li",{children:[e.monthsWithSchemaIssues," month",e.monthsWithSchemaIssues!==1?"s":""," with schema issues"]}),e.monthsWithOldRecalcField>0&&d.jsxs("li",{children:[e.monthsWithOldRecalcField," month",e.monthsWithOldRecalcField!==1?"s":""," with deprecated is_needs_recalculation field"]})]}),d.jsxs("p",{style:{margin:"0.75rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["Scanned ",e.totalBudgets," budgets and ",e.totalMonths," months."]})]})}),d.jsxs(qf,{onClick:c,disabled:p,isBusy:a,busyText:"Running...",actionName:"Run Database Cleanup",children:[" Fix ",i," Issue",i!==1?"s":""]})]}):d.jsx(pn,{type:"clean",children:d.jsxs("div",{children:[" Database is clean",d.jsxs("p",{style:{margin:"0.25rem 0 0 0",fontSize:"0.85rem",opacity:.7},children:["All ",e.totalBudgets," budgets and ",e.totalMonths," months match expected schema."]})]})}):d.jsx(pn,{type:"unknown",children:" Status unknown  click Refresh to scan the database"})})}function C6({hasData:t,status:e,isMigrating:n,onMigrate:i,onRefresh:a,isRefreshing:l,disabled:c,migrationResult:h}){const f=e&&(e.sanitizedDocuments.length>0||e.corruptedDocuments.length>0),p=h&&(h.deletedDocuments>0||h.fixedDocuments>0),_=()=>t?p?"complete":f?"needs-action":"clean":"unknown";return d.jsx(Ff,{title:" Consolidate Feedback Documents",description:"Fixes corrupted feedback data and merges documents with sanitized IDs into proper email format.",status:_(),onRefresh:a,isRefreshing:l,isBusy:n,children:n?d.jsx(pn,{type:"running",children:"Migrating feedback documents..."}):t?p?d.jsx(pn,{type:"success",children:d.jsxs("div",{children:[" Migration complete:",d.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.25rem",fontSize:"0.9rem"},children:[h.fixedDocuments>0&&d.jsxs("li",{children:["Fixed ",h.fixedDocuments," corrupted document(s)"]}),h.deletedDocuments>0&&d.jsxs("li",{children:["Merged & deleted ",h.deletedDocuments," sanitized document(s)"]}),h.mergedItems>0&&d.jsxs("li",{children:["Merged ",h.mergedItems," feedback item(s)"]})]}),h.errors.length>0&&d.jsxs(d.Fragment,{children:[d.jsx("div",{style:{marginTop:"0.5rem"},children:" Errors:"}),d.jsx("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem",fontSize:"0.9rem"},children:h.errors.map((b,v)=>d.jsx("li",{children:b},v))})]})]})}):f?d.jsxs(d.Fragment,{children:[d.jsx(pn,{type:"warning",children:d.jsxs("div",{children:[e?.corruptedDocuments&&e.corruptedDocuments.length>0&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",e.corruptedDocuments.length," corrupted document(s):"]}),d.jsx("ul",{style:{margin:"0 0 0.75rem 0",paddingLeft:"1.25rem",fontSize:"0.9rem"},children:e.corruptedDocuments.map(b=>d.jsxs("li",{children:[b," ",d.jsx("span",{style:{opacity:.6},children:"(broken arrayUnion)"})]},b))})]}),e?.sanitizedDocuments&&e.sanitizedDocuments.length>0&&d.jsxs(d.Fragment,{children:[d.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",e.sanitizedDocuments.length," sanitized document(s) to merge:"]}),d.jsx("ul",{style:{margin:0,paddingLeft:"1.25rem",fontSize:"0.9rem"},children:e.sanitizedDocuments.map(b=>d.jsx("li",{children:b},b))})]})]})}),d.jsx(qf,{onClick:i,disabled:c,isBusy:n,busyText:"Migrating...",actionName:"Run Feedback Migration",children:"Run Migration"})]}):d.jsxs(pn,{type:"clean",children:[" No issues found. All feedback documents are healthy.",d.jsxs("span",{style:{display:"block",fontSize:"0.85rem",opacity:.7,marginTop:"0.25rem"},children:["Found ",e?.documentsFound??0," document(s) total."]})]}):d.jsx(pn,{type:"unknown",children:" Status unknown  click Refresh to scan for issues"})})}function A6({hasData:t,monthsCount:e,budgetCount:n,monthsToDelete:i,isDeleting:a,onDelete:l,onRefresh:c,isRefreshing:h,disabled:f,deleteResult:p,deleteProgress:_}){const[b,v]=A.useState(!1),T=()=>{v(!0)},E=()=>{v(!1),l()},w=()=>t?p&&p.deleted>0&&p.errors.length===0?"complete":e===0?"clean":"needs-action":"unknown",D=i.reduce((L,q)=>{const B=q.budgetId;return L[B]||(L[B]=[]),L[B].push(q),L},{});return d.jsxs(Ff,{title:" Delete ALL Months",description:"DESTRUCTIVE: Deletes ALL month documents from Firebase for ALL budgets. This will reset all income, expenses, and allocations. Use with extreme caution!",status:w(),onRefresh:c,isRefreshing:h,isBusy:a,children:[a?d.jsx(pn,{type:"running",children:"Deleting all months..."}):p?d.jsx(pn,{type:p.errors.length>0?"warning":"success",children:d.jsxs("div",{children:[p.errors.length>0?"":""," Deleted ",p.deleted," month",p.deleted!==1?"s":"",p.budgetsRecalculated>0&&d.jsxs("span",{children:[", reset ",p.budgetsRecalculated," budget",p.budgetsRecalculated!==1?"s":""]}),d.jsx("span",{style:{opacity:.8},children:", cache cleared"}),p.errors.length>0&&d.jsx("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.85rem"},children:p.errors.map((L,q)=>d.jsx("li",{children:L},q))})]})}):t?e>0?d.jsxs(d.Fragment,{children:[d.jsx(pn,{type:"warning",children:d.jsxs("div",{children:[d.jsxs("div",{style:{marginBottom:"0.5rem"},children:[" Found ",d.jsx("strong",{children:e})," month",e!==1?"s":""," across ",d.jsx("strong",{children:n})," budget",n!==1?"s":"",":"]}),d.jsxs("div",{style:{maxHeight:"200px",overflowY:"auto"},children:[Object.entries(D).slice(0,5).map(([L,q])=>d.jsxs("div",{style:{marginBottom:"0.5rem"},children:[d.jsxs("div",{style:{fontWeight:500,fontSize:"0.85rem"},children:["Budget: ",L.slice(0,12),"..."]}),d.jsxs("ul",{style:{margin:"0.25rem 0 0 0",paddingLeft:"1.25rem",fontSize:"0.85rem"},children:[q.slice(0,3).map(B=>d.jsxs("li",{children:[ml[B.month-1]," ",B.year]},B.docId)),q.length>3&&d.jsxs("li",{style:{opacity:.7},children:["...and ",q.length-3," more"]})]})]},L)),Object.keys(D).length>5&&d.jsxs("div",{style:{opacity:.7,fontSize:"0.85rem",marginTop:"0.5rem"},children:["...and ",Object.keys(D).length-5," more budgets"]})]})]})}),d.jsxs(qf,{onClick:T,disabled:f,isBusy:a,busyText:"Deleting...",actionName:"Delete All Months",children:[" Delete ALL ",e," Month",e!==1?"s":""]}),d.jsx("p",{style:{fontSize:"0.8rem",color:"#ef4444",marginTop:"0.5rem",fontWeight:500},children:" This action cannot be undone!"})]}):d.jsx(pn,{type:"clean",children:" No month documents found in Firebase."}):d.jsx(pn,{type:"unknown",children:" Status unknown  click Refresh to scan for months"}),d.jsxs(aa,{isOpen:b,onClose:()=>v(!1),title:" Delete All Months?",children:[d.jsx("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:d.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" This is a destructive operation that cannot be undone!"})}),d.jsxs("p",{style:{margin:"0 0 0.75rem",opacity:.9},children:["This will permanently delete ",d.jsxs("strong",{style:{color:"#ef4444"},children:[e," month",e!==1?"s":""]})," across"," ",d.jsxs("strong",{style:{color:"#ef4444"},children:[n," budget",n!==1?"s":""]}),"."]}),d.jsx("p",{style:{margin:"0 0 1rem",opacity:.8,fontSize:"0.9rem"},children:"After deletion, all affected budgets will be reset:"}),d.jsxs("ul",{style:{margin:"0 0 1.5rem",paddingLeft:"1.5rem",opacity:.8,fontSize:"0.9rem"},children:[d.jsx("li",{children:"All account balances  $0"}),d.jsx("li",{children:"All category balances  $0"}),d.jsx("li",{children:"Month history cleared"}),d.jsx("li",{children:"Cache cleared automatically"})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(Ie,{variant:"secondary",actionName:"Cancel Delete All Months",onClick:()=>v(!1),children:"Cancel"}),d.jsxs(Ie,{variant:"danger",actionName:"Confirm Delete All Months",onClick:E,children:[" Delete All ",e," Months"]})]})]}),a&&_&&d.jsx(R6,{progress:_})]})}function R6({progress:t}){const e=()=>{switch(t.phase){case"deleting":return t.currentMonth?`Deleting ${t.currentMonth}...`:"Deleting months...";case"resetting-budgets":return t.currentMonth?`Resetting ${t.currentMonth}...`:"Resetting budgets...";case"clearing-cache":return"Clearing cache...";case"complete":return"Complete!";default:return"Processing..."}},n=()=>t.phase==="resetting-budgets"||t.phase==="clearing-cache"?"linear-gradient(90deg, #22c55e, #10b981)":"linear-gradient(90deg, #ef4444, #dc2626)",i=()=>t.phase==="resetting-budgets"||t.phase==="clearing-cache"?"#22c55e":"#ef4444";return d.jsxs(ku,{message:e(),spinnerColor:i(),children:[d.jsx(Vf,{percent:t.percentComplete,gradient:n()}),t.phase==="deleting"&&d.jsxs(pl,{columns:2,children:[d.jsx(mn,{value:`${t.deleted}/${t.total}`,label:"Months Deleted",color:"#ef4444"}),d.jsx(mn,{value:t.total-t.deleted,label:"Remaining",color:"rgba(255, 255, 255, 0.6)"})]}),t.phase==="resetting-budgets"&&d.jsxs(pl,{columns:2,children:[d.jsx(mn,{value:t.deleted,label:"Months Deleted",color:"#ef4444"}),d.jsx(mn,{value:`${t.budgetsRecalculated}/${t.totalBudgets}`,label:"Budgets Reset",color:"#22c55e"})]}),(t.phase==="clearing-cache"||t.phase==="complete")&&d.jsxs(pl,{columns:2,children:[d.jsx(mn,{value:t.deleted,label:"Months Deleted",color:"#ef4444"}),d.jsx(mn,{value:t.budgetsRecalculated,label:"Budgets Reset",color:"#22c55e"})]}),d.jsx(Uf,{percent:t.percentComplete})]})}function D6({result:t}){return d.jsx("div",{style:{marginTop:"1rem"},children:d.jsx(pn,{type:t.errors.length>0?"warning":"success",children:d.jsxs("div",{children:[t.errors.length>0?"":""," Import ",t.success?"complete":"finished with errors",d.jsxs("ul",{style:{margin:"0.5rem 0 0 0",paddingLeft:"1.5rem",fontSize:"0.9rem"},children:[d.jsxs("li",{children:[t.imported," records imported"]}),t.skipped>0&&d.jsxs("li",{children:[t.skipped," records skipped"]})]}),t.errors.length>0&&d.jsxs(d.Fragment,{children:[d.jsx("p",{style:{margin:"0.75rem 0 0.25rem 0",fontWeight:500,color:"#ef4444"},children:"Errors:"}),d.jsxs("ul",{style:{margin:0,paddingLeft:"1.5rem",fontSize:"0.85rem",color:"#ef4444"},children:[t.errors.slice(0,5).map((e,n)=>d.jsx("li",{children:e},n)),t.errors.length>5&&d.jsxs("li",{style:{opacity:.7},children:["...and ",t.errors.length-5," more errors"]})]})]})]})})})}function j6({recordCount:t,recordTypeCounts:e,monthRange:n,onCancel:i,onConfirm:a}){const l=()=>n?n.isSingleMonth?n.start:`${n.start} to ${n.end}`:"";return d.jsxs("div",{children:[d.jsxs("div",{style:{background:"color-mix(in srgb, #ef4444 15%, transparent)",border:"1px solid color-mix(in srgb, #ef4444 40%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:[d.jsx("p",{style:{margin:0,color:"#fca5a5",fontWeight:500,fontSize:"0.95rem"},children:" Warning: Destructive Operation"}),d.jsxs("p",{style:{margin:"0.5rem 0 0",color:"rgba(255, 255, 255, 0.8)",fontSize:"0.9rem"},children:["This will ",d.jsx("strong",{children:"REPLACE"})," all existing income, expenses, and allocations in"," ",d.jsx("strong",{style:{color:"#fbbf24"},children:n?.count===1?"1 month":`${n?.count} months`})," ","(",l(),")."]})]}),d.jsxs("p",{style:{margin:"0 0 0.5rem",opacity:.8},children:["You are about to import ",d.jsx("strong",{children:t.toLocaleString()})," records:"]}),d.jsxs("ul",{style:{margin:"0 0 1rem",paddingLeft:"1.5rem",fontSize:"0.9rem",opacity:.9},children:[e.income>0&&d.jsxs("li",{children:[e.income.toLocaleString()," income transactions"]}),e.spend>0&&d.jsxs("li",{children:[e.spend.toLocaleString()," expense transactions"]}),e.allocations>0&&d.jsxs("li",{children:[e.allocations.toLocaleString()," budget allocations"]})]}),d.jsxs("p",{style:{margin:"0 0 1.5rem",opacity:.8},children:["Any existing data of these types in the affected months will be ",d.jsx("strong",{style:{color:"#fca5a5"},children:"deleted and replaced"}),". This cannot be undone."]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(Ie,{variant:"secondary",actionName:"Cancel Seed Import",onClick:i,children:"Cancel"}),d.jsx(Ie,{variant:"danger",actionName:"Confirm Seed Import",onClick:a,children:"Replace & Import"})]})]})}function I6({progress:t}){const e=()=>{switch(t.phase){case"saving-mappings":return"Saving mappings...";case"reading-months":return`Reading ${t.totalMonths} months (parallel)...`;case"creating-months":return t.currentMonth?`Creating ${t.currentMonth}...`:`Creating ${t.monthsToCreate} new months...`;case"processing-months":return t.currentMonth?`Processing & recalculating ${t.currentMonth}...`:`Processing ${t.totalRecords.toLocaleString()} records...`;case"saving-months":return`Saving ${t.totalMonths} months (batch)...`;case"updating-budget":return"Updating budget balances...";case"complete":return"Import complete!";default:return"Importing..."}},n=t.phase==="creating-months"&&t.monthsToCreate>0,i=t.phase==="processing-months"||t.phase==="saving-months"||t.phase==="updating-budget"||t.phase==="complete";return d.jsxs(ku,{message:e(),spinnerColor:"#646cff",children:[d.jsx(Vf,{percent:t.percentComplete,gradient:"linear-gradient(90deg, #646cff, #8b5cf6)"}),n&&d.jsxs(pl,{columns:2,children:[d.jsx(mn,{value:`${t.monthsCreated}/${t.monthsToCreate}`,label:"Months Created",color:"#f59e0b"}),d.jsx(mn,{value:t.totalMonths,label:"Total Months",color:"#646cff"})]}),!n&&d.jsxs(pl,{columns:t.gapMonths>0?3:2,children:[d.jsx(mn,{value:t.totalMonths,label:"Months",color:"#646cff"}),t.monthsCreated>0&&d.jsx(mn,{value:t.monthsCreated,label:"New",color:"#f59e0b"}),t.gapMonths>0&&d.jsx(mn,{value:t.gapMonths,label:"Gap Filled",color:"#8b5cf6"})]}),i&&d.jsxs(pl,{columns:3,children:[d.jsx(mn,{value:t.incomeImported,label:"Income",color:"#22c55e"}),d.jsx(mn,{value:t.spendImported,label:"Expenses",color:"#ef4444"}),d.jsx(mn,{value:t.allocationsImported,label:"Allocations",color:"#3b82f6"})]}),d.jsx(Uf,{percent:t.percentComplete})]})}function M6(t,e){return t.account_group_id&&e[t.account_group_id]?e[t.account_group_id].name:"Ungrouped"}function yh({oldName:t,currentMapping:e,options:n,onMap:i,placeholder:a,isAutoMapped:l}){const c=h=>{const f=h.target.value,p=n.find(_=>_.id===f);if(p){const _=p.rawName??p.name;i(f,_)}};return d.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem",padding:"0.5rem",background:l?"color-mix(in srgb, #22c55e 8%, transparent)":"color-mix(in srgb, currentColor 5%, transparent)",borderRadius:"6px",borderLeft:l?"3px solid #22c55e":"none"},children:[d.jsxs("span",{style:{flex:"0 0 40%",fontSize:"0.85rem",fontWeight:500,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"flex",alignItems:"center",gap:"0.35rem"},title:t,children:['"',t,'"',l&&d.jsx("span",{style:{fontSize:"0.7rem",opacity:.6},children:"(auto)"})]}),d.jsx("span",{style:{opacity:.5},children:""}),d.jsxs("select",{value:e?.newId??"",onChange:c,style:{flex:1,padding:"0.4rem",borderRadius:"4px",border:e?"1px solid #22c55e":"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:e?"color-mix(in srgb, #22c55e 10%, transparent)":"color-mix(in srgb, currentColor 10%, transparent)",color:"inherit",fontSize:"0.85rem"},children:[d.jsx("option",{value:"",children:a}),n.map(h=>d.jsx("option",{value:h.id,children:h.name},h.id))]})]})}function O6({unmappedCategories:t,unmappedAccounts:e,customMappedCategories:n,customMappedAccounts:i,categoryMappings:a,accountMappings:l,categories:c,accounts:h,accountGroups:f,onCategoryMap:p,onAccountMap:_}){const b=A.useMemo(()=>{const E=Object.entries(c).sort((w,D)=>w[1].name.localeCompare(D[1].name));return[[Bs,{name:qa,category_group_id:null,sort_order:-1}],...E]},[c]),v=A.useMemo(()=>{const E=Object.entries(h).sort((w,D)=>w[1].nickname.localeCompare(D[1].nickname)).map(([w,D])=>({id:w,acc:D,displayName:`${D.nickname} (${M6(D,f)})`}));return[{id:Wy,acc:{nickname:Wh},displayName:Wh},...E]},[h,f]),T=t.length>0||e.length>0;return d.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",borderRadius:"8px",padding:"1rem",marginBottom:"1rem"},children:[d.jsx("h4",{style:{margin:"0 0 0.75rem 0",fontSize:"0.95rem"},children:" Entity Mappings"}),d.jsxs("p",{style:{margin:"0 0 1rem 0",fontSize:"0.85rem",opacity:.8},children:[T?"Map unknown entities to existing categories/accounts.":"Review saved mappings (names that don't exactly match existing entities)."," ","These mappings will be saved for future imports."]}),t.length>0&&d.jsxs("div",{style:{marginBottom:"1rem"},children:[d.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#ef4444"},children:[" Unmapped Categories (",t.length,")"]}),t.map(E=>d.jsx(yh,{oldName:E,currentMapping:a.get(E),options:b.map(([w,D])=>({id:w,name:D.name})),onMap:(w,D)=>p(E,w,D),placeholder:"Select a category..."},`cat-unmapped-${E}`))]}),n.length>0&&d.jsxs("div",{style:{marginBottom:"1rem"},children:[d.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#60a5fa"},children:[" Saved Category Mappings (",n.length,")"]}),n.map(E=>d.jsx(yh,{oldName:E,currentMapping:a.get(E),options:b.map(([w,D])=>({id:w,name:D.name})),onMap:(w,D)=>p(E,w,D),placeholder:"Select a category...",isAutoMapped:!0},`cat-custom-${E}`))]}),e.length>0&&d.jsxs("div",{style:{marginBottom:"1rem"},children:[d.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#ef4444"},children:[" Unmapped Accounts (",e.length,")"]}),e.map(E=>d.jsx(yh,{oldName:E,currentMapping:l.get(E),options:v.map(({id:w,acc:D,displayName:L})=>({id:w,name:L,rawName:D.nickname})),onMap:(w,D)=>_(E,w,D),placeholder:"Select an account..."},`acc-unmapped-${E}`))]}),i.length>0&&d.jsxs("div",{children:[d.jsxs("h5",{style:{margin:"0 0 0.5rem 0",fontSize:"0.9rem",color:"#60a5fa"},children:[" Saved Account Mappings (",i.length,")"]}),i.map(E=>d.jsx(yh,{oldName:E,currentMapping:l.get(E),options:v.map(({id:w,acc:D,displayName:L})=>({id:w,name:L,rawName:D.nickname})),onMap:(w,D)=>_(E,w,D),placeholder:"Select an account...",isAutoMapped:!0},`acc-custom-${E}`))]})]})}function k6({disabled:t}){const{selectedBudgetId:e}=zt(),{data:n}=P1(e),i=A.useRef(null),[a,l]=A.useState(null),[c,h]=A.useState(!1),{status:f,parsedData:p,unmappedCategories:_,unmappedAccounts:b,customMappedCategories:v,customMappedAccounts:T,categoryMappings:E,accountMappings:w,importResult:D,importProgress:L,parseFile:q,setCategoryMapping:B,setAccountMapping:ee,runImport:Q,reset:J,isParsing:O,isImporting:R,hasUnmappedEntities:j}=xL(e),I=v.length>0||T.length>0,M=A.useMemo(()=>n?.budget?.categories??{},[n?.budget?.categories]),F=A.useMemo(()=>n?.budget?.accounts??{},[n?.budget?.accounts]),k=A.useMemo(()=>n?.budget?.account_groups??{},[n?.budget?.account_groups]),Y=A.useCallback(z=>{const $=z.target.files?.[0];$&&(l($),q($,M,F))},[q,M,F]),H=A.useCallback(()=>{!e||!p||h(!0)},[e,p]),N=A.useCallback(async()=>{h(!1),!(!e||!p)&&await Q(M,F)},[e,p,Q,M,F]),G=A.useCallback(()=>{l(null),J(),i.current&&(i.current.value="")},[J]),W=A.useMemo(()=>D&&D.errors.length===0?"complete":f==="ready"||f==="mapping"?"needs-action":"unknown",[f,D]),ne=A.useMemo(()=>D&&D.errors.length===0?" Import Complete":f==="ready"?"Ready to Import":f==="mapping"?"Mapping Required":"Select a File",[f,D]),{monthRange:ie,recordTypeCounts:V}=A.useMemo(()=>{if(!p||p.length===0)return{monthRange:null,recordTypeCounts:{income:0,spend:0,allocations:0}};const z=new Set;let $=1/0,X=-1/0,re=12,ue=1;const he={income:0,spend:0,allocations:0};for(const Ee of p)z.add(`${Ee.year}-${Ee.month}`),(Ee.year<$||Ee.year===$&&Ee.month<re)&&($=Ee.year,re=Ee.month),(Ee.year>X||Ee.year===X&&Ee.month>ue)&&(X=Ee.year,ue=Ee.month),Ee.recordType==="income"?he.income++:Ee.recordType==="spend"?he.spend++:Ee.recordType==="allocation"&&he.allocations++;const Se=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],fe=`${Se[re-1]} ${$}`,te=`${Se[ue-1]} ${X}`;return{monthRange:{start:fe,end:te,count:z.size,isSingleMonth:z.size===1},recordTypeCounts:he}},[p]);return d.jsxs(Ff,{title:" Seed Data Import",description:"Import historical data from a combined CSV file. The file should have a 'type' column (income, spend, or allocation) as the first column. Unknown categories and accounts will be mapped to existing ones.",status:W,statusText:ne,onRefresh:G,isRefreshing:!1,isBusy:O||R,cardName:"Seed Import",children:[R&&L&&d.jsx(I6,{progress:L}),d.jsxs("div",{style:{marginBottom:"1rem"},children:[d.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontWeight:500,fontSize:"0.9rem"},children:"CSV File"}),d.jsx("input",{ref:i,type:"file",accept:".csv",onChange:Y,disabled:t||O||R,style:{display:"block",width:"100%",padding:"0.5rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",color:"inherit",cursor:t||O||R?"not-allowed":"pointer"}}),a&&d.jsxs("p",{style:{margin:"0.5rem 0 0",fontSize:"0.85rem",opacity:.7},children:["Selected: ",a.name]})]}),O&&d.jsxs(pn,{type:"running",children:[d.jsx(zf,{})," Parsing CSV file..."]}),p&&p.length>0&&!O&&d.jsx("div",{style:{marginBottom:"1rem"},children:d.jsx(pn,{type:j?"warning":"clean",children:d.jsxs("div",{children:[j?"":""," Parsed ",p.length," rows",d.jsxs("ul",{style:{margin:"0.5rem 0 0",paddingLeft:"1.5rem",fontSize:"0.85rem"},children:[V.income>0&&d.jsxs("li",{children:[V.income," income"]}),V.spend>0&&d.jsxs("li",{children:[V.spend," spend"]}),V.allocations>0&&d.jsxs("li",{children:[V.allocations," allocations"]})]}),j&&d.jsx("span",{style:{display:"block",fontSize:"0.85rem",marginTop:"0.25rem"},children:"Some categories or accounts need to be mapped"})]})})}),(j||I)&&!O&&d.jsx(O6,{unmappedCategories:_,unmappedAccounts:b,customMappedCategories:v,customMappedAccounts:T,categoryMappings:E,accountMappings:w,categories:M,accounts:F,accountGroups:k,onCategoryMap:B,onAccountMap:ee}),f==="ready"&&!O&&d.jsxs(qf,{onClick:H,disabled:t||!e,isBusy:R,busyText:"Importing...",actionName:"Run Seed Import",children:[" Import ",p?.length??0," Records"]}),D&&d.jsx(D6,{result:D}),d.jsx(aa,{isOpen:c,onClose:()=>h(!1),title:" Confirm Import",children:d.jsx(j6,{recordCount:p?.length??0,recordTypeCounts:V,monthRange:ie,onCancel:()=>h(!1),onConfirm:N})})]})}function N6(){try{localStorage.removeItem("BUDGET_APP_QUERY_CACHE"),console.log("[Cache] Cleared React Query cache from localStorage")}catch(t){console.warn("Failed to clear localStorage cache:",t)}window.location.reload()}function P6(){const e=ao().get_current_firebase_user(),[n,i]=A.useState(!1),a=sL({currentUser:e}),l=oL({currentUser:e}),c=cL({currentUser:e}),h=a.isScanning||l.isScanning||c.isScanning,f=a.isRunning||l.isMigratingFeedback||c.isDeleting,p=async()=>{await Promise.all([a.scanStatus(),l.scanStatus(),c.scanStatus()])};return d.jsxs("div",{children:[d.jsx("style",{children:"@keyframes spin { to { transform: rotate(360deg); } }"}),d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[d.jsx("h2",{style:{margin:0},children:"Data Migrations"}),d.jsxs("button",{onClick:p,disabled:h||f,style:{background:"#646cff",color:"white",border:"none",padding:"0.5rem 1rem",borderRadius:"6px",cursor:h||f?"not-allowed":"pointer",fontWeight:500,opacity:h||f?.7:1,display:"flex",alignItems:"center",gap:"0.4rem",minWidth:"130px",minHeight:"36px"},children:[d.jsx("span",{style:{width:"18px",height:"18px",display:"inline-flex",justifyContent:"center",alignItems:"center",flexShrink:0},children:h?d.jsx(zf,{noMargin:!0}):""}),"Refresh All"]})]}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:'Run migrations to validate and fix your database. Click "Refresh All" to scan Firestore directly.'}),d.jsx(T6,{hasData:!!a.status,status:a.status,hasIssues:a.hasIssues,totalIssues:a.totalIssues,isRunning:a.isRunning,result:a.result,onRunCleanup:a.runCleanup,onRefresh:a.scanStatus,isRefreshing:a.isScanning,disabled:!e}),d.jsx(C6,{hasData:!!l.status,status:l.status,isMigrating:l.isMigratingFeedback,onMigrate:l.migrateFeedbackDocuments,onRefresh:l.scanStatus,isRefreshing:l.isScanning,disabled:!e,migrationResult:l.feedbackMigrationResult}),d.jsx(A6,{hasData:!!c.status,monthsCount:c.status?.monthsCount??0,budgetCount:c.status?.budgetCount??0,monthsToDelete:c.status?.monthsToDelete??[],isDeleting:c.isDeleting,onDelete:c.deleteAllMonths,onRefresh:c.scanStatus,isRefreshing:c.isScanning,disabled:!e,deleteResult:c.deleteResult,deleteProgress:c.deleteProgress}),d.jsx(k6,{disabled:!e}),d.jsx("div",{style:{background:"color-mix(in srgb, currentColor 3%, transparent)",padding:"1rem",borderRadius:"8px",fontSize:"0.85rem"},children:d.jsxs("p",{style:{margin:0,opacity:.7},children:[d.jsx("strong",{children:"Note:"})," These migrations will process ",d.jsx("strong",{children:"all budgets and months"})," in the system, not just the ones you own or are invited to."]})}),d.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, #ff6b6b 10%, transparent)",borderRadius:"8px",border:"1px solid color-mix(in srgb, #ff6b6b 30%, transparent)"},children:[d.jsxs("p",{style:{margin:"0 0 0.75rem 0",fontSize:"0.9rem"},children:[d.jsx("strong",{children:" Clear All Caches"}),d.jsx("span",{style:{opacity:.7,display:"block",marginTop:"0.25rem"},children:"If you're seeing stale data after running migrations, clear all cached data and reload to fetch fresh data from Firestore."})]}),d.jsx(Ie,{variant:"danger",actionName:"Open Clear Caches Modal",onClick:()=>i(!0),style:{display:"flex",alignItems:"center",gap:"0.4rem"},children:" Clear All Caches & Reload"})]}),d.jsxs(aa,{isOpen:n,onClose:()=>i(!1),title:"Clear Caches & Reload?",children:[d.jsx("p",{style:{margin:"0 0 1rem 0",opacity:.8},children:"This will clear all cached data from localStorage and reload the page. The app will fetch fresh data from Firestore for everything."}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(Ie,{variant:"secondary",actionName:"Cancel Clear Caches",onClick:()=>i(!1),children:"Cancel"}),d.jsx(Ie,{variant:"danger",actionName:"Confirm Clear Caches & Reload",onClick:N6,children:"Clear & Reload"})]})]})]})}function L6(){const[t,e]=A.useState(null),[n,i]=A.useState(null),[a,l]=A.useState(null),[c,h]=A.useState(!1),[f,p]=A.useState(""),[_,b]=A.useState("bug"),[v,T]=A.useState(null),[E,w]=A.useState(null),D=A.useContext(bu),q=ao().get_current_firebase_user(),B=Ek(),{submitFeedback:ee}=IT(),{toggleFeedback:Q}=CP(),{updateSortOrder:J}=AP(),O=B.data?.items||[],{addLoadingHold:R,removeLoadingHold:j}=Qn();A.useEffect(()=>(B.isLoading?R("settings-feedback","Loading feedback..."):j("settings-feedback"),()=>j("settings-feedback")),[B.isLoading,R,j]);function I(z){z.preventDefault(),!(!f.trim()||!D.username||!q)&&(ee.mutate({userId:q.uid,userEmail:D.username,text:f.trim(),feedbackType:_,currentPath:"/settings/feedback"}),p(""),b("bug"),h(!1))}function M(z){z.is_done?F(z):T(z)}async function F(z){try{await Q.mutateAsync({item:z})}catch($){e($ instanceof Error?$.message:"Failed to update feedback")}}function k(){v&&(F(v),T(null))}async function Y(z){if(E){try{const X=O.filter(re=>re.doc_id===E.doc_id).map(re=>re.id===E.id?{id:re.id,text:re.text,created_at:re.created_at,is_done:re.is_done,completed_at:re.completed_at,sort_order:re.sort_order,feedback_type:z}:{id:re.id,text:re.text,created_at:re.created_at,is_done:re.is_done,completed_at:re.completed_at,sort_order:re.sort_order,feedback_type:re.feedback_type});await J.mutateAsync({docId:E.doc_id,items:X})}catch($){e($ instanceof Error?$.message:"Failed to update feedback type")}w(null)}}const H=O.filter(z=>!z.is_done).sort((z,$)=>z.sort_order-$.sort_order),N=O.filter(z=>z.is_done).sort((z,$)=>{const X=z.completed_at?new Date(z.completed_at).getTime():0;return($.completed_at?new Date($.completed_at).getTime():0)-X});function G(z,$){i($),z.dataTransfer.effectAllowed="move"}function W(z,$){z.preventDefault(),$!==n&&l($)}function ne(){l(null)}function ie(){i(null),l(null)}async function V(z,$){if(z.preventDefault(),!n||n===$){ie();return}const X=H.findIndex(fe=>fe.id===n),re=[...H],[ue]=re.splice(X,1);if($==="__end__")re.push(ue);else{const fe=re.findIndex(te=>te.id===$);re.splice(fe,0,ue)}const he=re.map((fe,te)=>({...fe,sort_order:te}));ie();const Se=new Map;for(const fe of he)Se.has(fe.doc_id)||Se.set(fe.doc_id,[]),Se.get(fe.doc_id).push({id:fe.id,text:fe.text,created_at:fe.created_at,is_done:fe.is_done,completed_at:fe.completed_at,sort_order:fe.sort_order,feedback_type:fe.feedback_type});for(const fe of N)Se.has(fe.doc_id)||Se.set(fe.doc_id,[]),Se.get(fe.doc_id).push({id:fe.id,text:fe.text,created_at:fe.created_at,is_done:fe.is_done,completed_at:fe.completed_at,sort_order:fe.sort_order,feedback_type:fe.feedback_type});try{for(const[fe,te]of Se)await J.mutateAsync({docId:fe,items:te})}catch(fe){e(fe instanceof Error?fe.message:"Failed to save order")}}return B.isLoading?null:d.jsxs("div",{children:[d.jsx("h2",{style:{marginTop:0},children:"Feedback"}),d.jsx("p",{style:{...jT,fontSize:"0.9rem"},children:"View and manage user feedback. Drag to reorder pending items."}),t&&d.jsx(lo,{message:t,onDismiss:()=>e(null)}),d.jsxs("div",{style:Cl,children:[H.length===0&&!c&&d.jsx("p",{style:{opacity:.7},children:"No pending feedback."}),H.map(z=>d.jsx(S6,{item:z,isDragging:n===z.id,isDragOver:a===z.id,onDragStart:$=>G($,z.id),onDragOver:$=>W($,z.id),onDragLeave:ne,onDragEnd:ie,onDrop:$=>V($,z.id),onToggleDone:()=>M(z),onTypeClick:()=>w(z)},z.id)),n&&H.length>0&&d.jsx(o_,{isActive:a==="__end__",onDragOver:z=>W(z,"__end__"),onDragLeave:ne,onDrop:z=>V(z,"__end__")})]}),c?d.jsxs(Ja,{actionName:"Add Feedback",onSubmit:I,children:[d.jsx(iE,{selectedType:_,onSelect:b}),d.jsx(a_,{value:f,onChange:z=>p(z.target.value),placeholder:"Enter your feedback, bug report, or feature request...",autoFocus:!0,required:!0}),d.jsxs(co,{children:[d.jsx(Ie,{type:"submit",actionName:"Add Feedback",disabled:!f.trim(),children:"Add Feedback"}),d.jsx(Ie,{type:"button",variant:"secondary",actionName:"Cancel Add Feedback",onClick:()=>{h(!1),p(""),b("bug")},children:"Cancel"})]})]}):d.jsx(Ie,{variant:"primary-large",actionName:"Open Add Feedback Form",onClick:()=>h(!0),children:"+ Add Feedback"}),N.length>0&&d.jsx(IP,{title:"Completed",count:N.length,children:d.jsx("div",{style:{...Cl,marginTop:"0.5rem"},children:N.map(z=>d.jsx(E6,{item:z,onToggleDone:()=>M(z),onTypeClick:()=>w(z)},z.id))})}),d.jsxs(aa,{isOpen:v!==null,onClose:()=>T(null),title:"Mark as Complete",children:[d.jsx("p",{style:{margin:"0 0 1.5rem 0"},children:"Are you sure you want to mark this feedback item as complete?"}),v&&d.jsxs("p",{style:{margin:"0 0 1.5rem 0",padding:"0.75rem",background:"rgba(255,255,255,0.05)",borderRadius:"0.5rem",fontSize:"0.9rem"},children:['"',v.text,'"']}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem",justifyContent:"flex-end"},children:[d.jsx(Ie,{variant:"secondary",actionName:"Cancel Mark Complete",onClick:()=>T(null),children:"Cancel"}),d.jsx(Ie,{variant:"primary",actionName:"Confirm Mark Complete",onClick:k,children:"Mark Complete"})]})]}),d.jsxs(aa,{isOpen:E!==null,onClose:()=>w(null),title:"Change Feedback Type",children:[d.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.8},children:"Select a new type for this feedback:"}),d.jsx(iE,{selectedType:E?.feedback_type||"bug",onSelect:Y}),d.jsx(Ie,{variant:"secondary",actionName:"Cancel Change Feedback Type",onClick:()=>w(null),style:{width:"100%"},children:"Cancel"})]})]})}function iE({selectedType:t,onSelect:e}){return d.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.75rem",paddingBottom:"1rem",flexWrap:"wrap"},children:["critical_bug","bug","new_feature","core_feature","qol"].map(n=>{const i=ey[n],a=t==="feature"?"new_feature":t,l=a===n||!a&&n==="bug";return d.jsxs("button",{type:"button",onClick:()=>{i.label,e(n)},style:{flex:1,padding:"0.6rem 0.75rem",border:`2px solid ${i.color}`,borderRadius:"0.5rem",background:l?i.bgColor:"transparent",color:l?i.color:"rgba(255,255,255,0.5)",cursor:"pointer",fontWeight:l?600:400,fontSize:"0.85rem",transition:"all 0.15s ease",opacity:l?1:.5,boxShadow:l?`0 0 12px ${i.bgColor}`:"none",position:"relative"},children:[i.label,l&&d.jsx("span",{style:{position:"absolute",bottom:"-14px",left:"10%",right:"10%",height:"3px",background:"white",borderRadius:"2px"}})]},n)})})}function B6(){const{currentUserId:t}=zt(),[e,n]=A.useState([]),[i,a]=A.useState(!1);function l(v,T){n(E=>E.map(w=>w.name===v?{...w,...T}:w))}async function c(){a(!0),n([]),n([{name:"Read unauthorized budget",status:"pending",message:"",expectedToFail:!0},{name:"Read another user's document",status:"pending",message:"",expectedToFail:!0},{name:"Read unauthorized budget month",status:"pending",message:"",expectedToFail:!0},{name:"Toggle is_admin in own permission_flags",status:"pending",message:"",expectedToFail:!0},{name:"Toggle is_test in own permission_flags",status:"pending",message:"",expectedToFail:!0},{name:"Read own user document",status:"pending",message:"",expectedToFail:!1}]),await h("Read unauthorized budget",async()=>(await Le("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0),await h("Read another user's document",async()=>(await Le("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0),await h("Read unauthorized budget month",async()=>(await Le("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0),await h("Toggle is_admin in own permission_flags",async()=>{if(!t)throw new Error("Not authenticated");const{data:T}=await Le("users",t,"security test: reading own user to get current is_admin value"),E=T?.permission_flags?.is_admin??!1;return await Hs("users",t,{"permission_flags.is_admin":!E},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${E} to ${!E} (SECURITY ISSUE!)`},!0),await h("Toggle is_test in own permission_flags",async()=>{if(!t)throw new Error("Not authenticated");const{data:T}=await Le("users",t,"security test: reading own user to get current is_test value"),E=T?.permission_flags?.is_test??!1;return await Hs("users",t,{"permission_flags.is_test":!E},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${E} to ${!E} (SECURITY ISSUE!)`},!0),await h("Read own user document",async()=>{if(!t)throw new Error("Not authenticated");const{exists:T}=await Le("users",t,"security test: reading own user document (should succeed)");if(T)return"Successfully read own document";throw new Error("Document does not exist")},!1),a(!1)}async function h(v,T,E){l(v,{status:"running",message:"Running..."});try{const w=await T();E?l(v,{status:"failed",message:` ${w}`}):l(v,{status:"passed",message:` ${w}`})}catch(w){const D=w instanceof Error?w.message:"Unknown error";E?l(v,{status:"passed",message:` Blocked as expected: ${D}`}):l(v,{status:"failed",message:` ${D}`})}}async function f(v){switch(e.find(E=>E.name===v)||n(E=>[...E,{name:v,status:"pending",message:"",expectedToFail:!0}]),a(!0),v){case"Read unauthorized budget":await h(v,async()=>(await Le("budgets","unauthorized_budget_test_12345","security test: attempting unauthorized budget read"),"Was able to read budget (unexpected)"),!0);break;case"Read another user's document":await h(v,async()=>(await Le("users","another_user_test_12345","security test: attempting unauthorized user read"),"Was able to read user document (unexpected)"),!0);break;case"Read unauthorized budget month":await h(v,async()=>(await Le("months","unauthorized_budget_test_12345_2024_01","security test: attempting unauthorized month read"),"Was able to read month document for unauthorized budget (unexpected)"),!0);break;case"Toggle is_admin in own permission_flags":await h(v,async()=>{if(!t)throw new Error("Not authenticated");const{data:E}=await Le("users",t,"security test: reading own user to get current is_admin value"),w=E?.permission_flags?.is_admin??!1;return await Hs("users",t,{"permission_flags.is_admin":!w},"security test: attempting to toggle is_admin (should fail)"),`Was able to change is_admin from ${w} to ${!w} (SECURITY ISSUE!)`},!0);break;case"Toggle is_test in own permission_flags":await h(v,async()=>{if(!t)throw new Error("Not authenticated");const{data:E}=await Le("users",t,"security test: reading own user to get current is_test value"),w=E?.permission_flags?.is_test??!1;return await Hs("users",t,{"permission_flags.is_test":!w},"security test: attempting to toggle is_test (should fail)"),`Was able to change is_test from ${w} to ${!w} (SECURITY ISSUE!)`},!0);break;case"Read own user document":await h(v,async()=>{if(!t)throw new Error("Not authenticated");const{exists:E}=await Le("users",t,"security test: reading own user document (should succeed)");if(E)return"Successfully read own document";throw new Error("Document does not exist")},!1);break}a(!1)}const p=e.filter(v=>v.status==="passed").length,_=e.filter(v=>v.status==="failed").length,b=e.length;return d.jsxs("div",{children:[d.jsx("p",{style:jT,children:'Run security tests to verify Firestore rules are working correctly. Tests that are expected to fail (blocked by security rules) should show as "passed".'}),d.jsx("div",{style:{marginBottom:"1.5rem"},children:d.jsx(Ie,{onClick:c,disabled:i,variant:"primary",children:i?"Running Tests...":"Run All Tests"})}),e.length>0&&d.jsx("div",{style:{marginBottom:"1.5rem"},children:d.jsxs("div",{style:{display:"flex",gap:"1rem",padding:"0.75rem 1rem",borderRadius:"8px",background:"color-mix(in srgb, currentColor 5%, transparent)",marginBottom:"1rem"},children:[d.jsxs("span",{children:["Total: ",d.jsx("strong",{children:b})]}),d.jsxs("span",{style:{color:ce.success},children:["Passed: ",d.jsx("strong",{children:p})]}),d.jsxs("span",{style:{color:ce.danger},children:["Failed: ",d.jsx("strong",{children:_})]})]})}),d.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:[d.jsx("h3",{style:{margin:"0.5rem 0"},children:"Individual Tests"}),d.jsx(rl,{name:"Read unauthorized budget",description:"Try to read a budget the user doesn't have access to",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(v=>v.name==="Read unauthorized budget"),onRun:()=>f("Read unauthorized budget"),disabled:i}),d.jsx(rl,{name:"Read another user's document",description:"Try to read another user's profile document",expectedBehavior:"Should be blocked by Firestore rules",result:e.find(v=>v.name==="Read another user's document"),onRun:()=>f("Read another user's document"),disabled:i}),d.jsx(rl,{name:"Read unauthorized budget month",description:"Try to read a month document for a budget you don't have access to",expectedBehavior:"Should be blocked - months inherit budget access",result:e.find(v=>v.name==="Read unauthorized budget month"),onRun:()=>f("Read unauthorized budget month"),disabled:i}),d.jsx(rl,{name:"Toggle is_admin in own permission_flags",description:"Try to change your admin privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(v=>v.name==="Toggle is_admin in own permission_flags"),onRun:()=>f("Toggle is_admin in own permission_flags"),disabled:i}),d.jsx(rl,{name:"Toggle is_test in own permission_flags",description:"Try to change your test privileges (toggles current value)",expectedBehavior:"Should be blocked - permission_flags is protected",result:e.find(v=>v.name==="Toggle is_test in own permission_flags"),onRun:()=>f("Toggle is_test in own permission_flags"),disabled:i}),d.jsx(rl,{name:"Read own user document",description:"Read your own user profile document",expectedBehavior:"Should succeed - users can read their own data",result:e.find(v=>v.name==="Read own user document"),onRun:()=>f("Read own user document"),disabled:i,expectedToSucceed:!0})]}),_>0&&d.jsxs(lo,{style:{marginTop:"1.5rem"},children:[" ",_," test(s) failed! This may indicate a security vulnerability in your Firestore rules."]})]})}function rl({name:t,description:e,expectedBehavior:n,result:i,onRun:a,disabled:l,expectedToSucceed:c}){const h=i?.status==="passed"?ce.success:i?.status==="failed"?ce.danger:i?.status==="running"?ce.warning:"inherit";return d.jsxs("div",{style:{...Ou,display:"flex",flexDirection:"column",gap:"0.5rem"},children:[d.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:"1rem"},children:[d.jsxs("div",{style:{flex:1},children:[d.jsx("h4",{style:{margin:0,fontSize:"0.95rem"},children:t}),d.jsx("p",{style:{margin:"0.25rem 0 0",opacity:.7,fontSize:"0.85rem"},children:e}),d.jsxs("p",{style:{margin:"0.25rem 0 0",fontSize:"0.8rem",color:c?ce.success:ce.warning},children:["Expected: ",n]})]}),d.jsx(Ie,{onClick:a,disabled:l,variant:"secondary",style:{flexShrink:0},children:i?.status==="running"?"":"Run"})]}),i&&i.status!=="pending"&&d.jsx("div",{style:{padding:"0.5rem 0.75rem",borderRadius:"6px",background:`color-mix(in srgb, ${h} 15%, transparent)`,border:`1px solid color-mix(in srgb, ${h} 30%, transparent)`,fontSize:"0.85rem",color:h},children:i.message})]})}function V6(){const{addLoadingHold:t,removeLoadingHold:e}=Qn(),{selectedBudgetId:n,currentUserId:i,accessibleBudgets:a,loadAccessibleBudgets:l,switchToBudget:c,checkBudgetInvite:h,isInitialized:f,setPageTitle:p}=zt();A.useLayoutEffect(()=>{p("My Budgets")},[p]),A.useEffect(()=>{f&&l()},[f,l]);const{budget:_,renameBudget:b,acceptInvite:v,isLoading:T}=Pn(n,i),[E,w]=A.useState(null),[D,L]=A.useState(null),[q,B]=A.useState(null),[ee,Q]=A.useState(null),[J,O]=A.useState(null),[R,j]=A.useState(""),[I,M]=A.useState(!1),[F,k]=A.useState(""),[Y,H]=A.useState(!1),[N,G]=A.useState(null);async function W(he){if(he!==_?.id){w(he),B(null),Q(null);try{await c(he),Q("Switched to budget successfully!"),await l()}catch(Se){B(Se instanceof Error?Se.message:"Failed to switch budget")}finally{w(null)}}}async function ne(he){L(he),B(null),Q(null);try{await v(he),Q("Invitation accepted! You now have access to this budget."),await l()}catch(Se){B(Se instanceof Error?Se.message:"Failed to accept invitation")}finally{L(null)}}async function ie(he){if(he.preventDefault(),!!F.trim()){H(!0),B(null),G(null);try{const Se=await h(F.trim());Se?G(Se):B("No pending invitation found for this budget ID. Make sure you've been invited by the budget owner.")}catch(Se){B(Se instanceof Error?Se.message:"Failed to check invitation")}finally{H(!1)}}}async function V(){if(N){N.budgetName,L(N.budgetId),B(null);try{await v(N.budgetId),Q(`Successfully joined "${N.budgetName}"!`),G(null),k(""),await l()}catch(he){B(he instanceof Error?he.message:"Failed to accept invitation")}finally{L(null)}}}function z(he,Se){j(Se),O(he)}function $(){O(null),j("")}async function X(he){if(he.preventDefault(),!(!R.trim()||!J)){R.trim(),M(!0),B(null),Q(null);try{await b(R.trim()),Q("Budget renamed successfully!"),O(null),await l()}catch(Se){B(Se instanceof Error?Se.message:"Failed to rename budget")}finally{M(!1)}}}const re=a.filter(he=>!he.isPending),ue=a.filter(he=>he.isPending);return A.useEffect(()=>(T||!f?t("my-budgets","Loading your budgets..."):e("my-budgets"),()=>e("my-budgets")),[T,f,t,e]),T||!f?null:d.jsxs("div",{children:[d.jsx("h1",{children:"My Budgets"}),d.jsx("p",{style:{opacity:.7,marginBottom:"1.5rem"},children:"Switch between budgets, accept invitations, or join a budget by ID."}),q&&d.jsxs("div",{style:{background:"rgba(220, 38, 38, 0.1)",border:"1px solid rgba(220, 38, 38, 0.3)",color:"#f87171",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:q}),d.jsx("button",{onClick:()=>B(null),style:{background:"transparent",border:"none",color:"#f87171",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),ee&&d.jsxs("div",{style:{background:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.3)",color:"#4ade80",padding:"0.75rem 1rem",borderRadius:"8px",marginBottom:"1rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[d.jsx("span",{children:ee}),d.jsx("button",{onClick:()=>Q(null),style:{background:"transparent",border:"none",color:"#4ade80",cursor:"pointer",fontSize:"1.2rem",padding:"0 0.25rem",lineHeight:1},children:""})]}),ue.length>0&&d.jsxs("div",{style:{background:"color-mix(in srgb, #f59e0b 10%, transparent)",border:"1px solid color-mix(in srgb, #f59e0b 30%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Pending Invitations (",ue.length,")"]}),d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:ue.map(he=>d.jsx(rE,{budget:he,isCurrent:!1,isAccepting:D===he.id,isSwitching:!1,isEditing:!1,editName:"",isRenaming:!1,onAccept:()=>ne(he.id),onSwitch:()=>{},onStartEdit:()=>{},onCancelEdit:()=>{},onEditNameChange:()=>{},onSaveEdit:()=>{}},he.id))})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px",marginBottom:"1.5rem"},children:[d.jsxs("h3",{style:{margin:"0 0 1rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Your Budgets (",re.length,")"]}),re.length===0?d.jsx("p",{style:{opacity:.6,margin:0},children:"You don't have access to any budgets yet."}):d.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:re.map(he=>{const Se=he.id===_?.id,fe=J===he.id;return d.jsx(rE,{budget:he,isCurrent:Se,isAccepting:!1,isSwitching:E===he.id,isEditing:fe,editName:fe?R:"",isRenaming:I,onAccept:()=>{},onSwitch:()=>W(he.id),onStartEdit:()=>z(he.id,he.name),onCancelEdit:$,onEditNameChange:j,onSaveEdit:X},he.id)})})]}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 5%, transparent)",padding:"1.25rem",borderRadius:"8px"},children:[d.jsxs("h3",{style:{margin:"0 0 0.75rem 0",fontSize:"1rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[d.jsx("span",{children:""})," Join Budget by ID"]}),d.jsx("p",{style:{margin:"0 0 1rem 0",fontSize:"0.9rem",opacity:.7},children:"If someone shared a budget ID with you, enter it below to accept the invitation:"}),N?d.jsxs("div",{style:{background:"color-mix(in srgb, #22c55e 10%, transparent)",border:"1px solid color-mix(in srgb, #22c55e 30%, transparent)",padding:"1rem",borderRadius:"8px"},children:[d.jsx("p",{style:{margin:"0 0 0.75rem 0",fontWeight:500},children:" You've been invited to join:"}),d.jsxs("div",{style:{background:"color-mix(in srgb, currentColor 8%, transparent)",padding:"0.75rem 1rem",borderRadius:"6px",marginBottom:"1rem"},children:[d.jsx("p",{style:{margin:"0 0 0.25rem 0",fontWeight:600,fontSize:"1.1rem"},children:N.budgetName}),N.ownerEmail&&d.jsxs("p",{style:{margin:0,fontSize:"0.9rem",opacity:.7},children:["Owner: ",N.ownerEmail]})]}),d.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[d.jsx("button",{onClick:V,disabled:D===N.budgetId,style:{background:"#22c55e",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:D===N.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:D===N.budgetId?.7:1},children:D===N.budgetId?"Accepting...":"Accept Invitation"}),d.jsx("button",{onClick:()=>{G(null),k("")},disabled:D===N.budgetId,style:{background:"transparent",color:"inherit",border:"1px solid color-mix(in srgb, currentColor 30%, transparent)",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:D===N.budgetId?"not-allowed":"pointer",fontWeight:500,opacity:D===N.budgetId?.7:.8},children:"Cancel"})]})]}):d.jsxs("form",{onSubmit:ie,style:{display:"flex",gap:"0.75rem"},children:[d.jsx("input",{type:"text",value:F,onChange:he=>k(he.target.value),placeholder:"Enter Budget ID",style:{flex:1,padding:"0.6rem 0.8rem",borderRadius:"6px",border:"1px solid color-mix(in srgb, currentColor 20%, transparent)",background:"color-mix(in srgb, currentColor 5%, transparent)",fontSize:"0.95rem",color:"inherit"}}),d.jsx("button",{type:"submit",disabled:Y||!F.trim(),style:{background:"#646cff",color:"white",border:"none",padding:"0.6rem 1.25rem",borderRadius:"6px",cursor:Y||!F.trim()?"not-allowed":"pointer",fontWeight:500,opacity:Y||!F.trim()?.7:1,whiteSpace:"nowrap"},children:Y?"Checking...":"Check Invite"})]})]}),i&&d.jsxs("div",{style:{marginTop:"1.5rem",padding:"1rem",background:"color-mix(in srgb, currentColor 3%, transparent)",borderRadius:"6px",fontSize:"0.85rem",opacity:.7},children:[d.jsx("p",{style:{margin:"0 0 0.5rem 0"},children:" Share your User ID with budget owners so they can invite you:"}),d.jsx("code",{style:{display:"block",padding:"0.5rem 0.75rem",background:"color-mix(in srgb, currentColor 8%, transparent)",borderRadius:"4px",fontSize:"0.8rem",wordBreak:"break-all"},children:i})]})]})}function U6({children:t}){const{addLoadingHold:e,removeLoadingHold:n}=Qn(),i=A.useContext(bu),a=jn();return A.useEffect(()=>(i.is_auth_checked?n("protected-route"):e("protected-route","Checking authentication..."),()=>n("protected-route")),[i.is_auth_checked,e,n]),i.is_auth_checked?i.is_logged_in?t?d.jsx(d.Fragment,{children:t}):d.jsx(of,{}):d.jsx(af,{to:"/account",state:{from:a.pathname},replace:!0}):null}function z6(){const{addLoadingHold:t,removeLoadingHold:e}=Qn(),{selectedBudgetId:n,currentUserId:i,isInitialized:a,pageTitle:l}=zt(),{isLoading:c,error:h}=Pn(n,i);return A.useEffect(()=>{a?e("budget-init"):t("budget-init",c?"Fetching data from server...":"Loading budget...")},[a,c,t,e]),A.useEffect(()=>()=>e("budget-init"),[e]),h?(console.error("[BudgetLayout] Error:",h),d.jsx("div",{style:mu,children:d.jsxs("p",{style:{color:"#ef4444"},children:["Error: ",h.message]})})):d.jsxs("div",{style:{...mu,paddingBottom:"5rem"},children:[d.jsx(kP,{title:l}),a&&d.jsx(of,{})]})}const F6={is_logged_in:!1,is_auth_checked:!1,username:"",set_user_context:()=>{}};function q6(){const{isLoading:t,loadingMessage:e}=Qn();return t?d.jsx(ku,{message:e}):null}function H6(){const[t,e]=A.useState(F6),n=ao(),i=A.useRef(!1),{addLoadingHold:a,removeLoadingHold:l}=Qn();return A.useEffect(function(){i.current||(i.current=!0,n.set_user_listener(c=>{e({is_logged_in:c!=null,is_auth_checked:!0,username:c?.email??"",set_user_context:e})}))},[n]),A.useEffect(()=>{t.is_auth_checked?l("auth"):a("auth","Authenticating...")},[t.is_auth_checked,a,l]),t.is_auth_checked?d.jsx(bu.Provider,{value:t,children:d.jsx(Rj,{children:d.jsx(tP,{children:d.jsxs(pD,{children:[d.jsxs(HR,{children:[d.jsx(Jt,{path:"/",element:d.jsx(xP,{})}),d.jsx(Jt,{path:"/account",element:d.jsx(PP,{})}),d.jsx(Jt,{path:"/sql-test",element:d.jsx(NP,{})}),d.jsx(Jt,{path:"/budget",element:d.jsx(U6,{}),children:d.jsxs(Jt,{element:d.jsx(z6,{}),children:[d.jsx(Jt,{index:!0,element:d.jsx(tE,{})}),d.jsx(Jt,{path:":year/:month/:tab/:view?",element:d.jsx(tE,{})}),d.jsx(Jt,{path:"analytics",element:d.jsx(s6,{})}),d.jsx(Jt,{path:"my-budgets",element:d.jsx(V6,{})}),d.jsxs(Jt,{path:"settings",element:d.jsx(y6,{}),children:[d.jsx(Jt,{index:!0,element:d.jsx(af,{to:"categories",replace:!0})}),d.jsx(Jt,{path:"accounts",element:d.jsx(h6,{})}),d.jsx(Jt,{path:"categories",element:d.jsx(p6,{})}),d.jsx(Jt,{path:"users",element:d.jsx(_6,{})})]}),d.jsxs(Jt,{path:"admin",element:d.jsx(v6,{}),children:[d.jsx(Jt,{path:"budget",element:d.jsx(x6,{})}),d.jsx(Jt,{path:"feedback",element:d.jsx(L6,{})}),d.jsx(Jt,{path:"migration",element:d.jsx(P6,{})}),d.jsx(Jt,{path:"tests",element:d.jsx(B6,{})})]})]})})]}),d.jsx(jP,{})]})})})}):null}function G6(){return d.jsxs(AD,{children:[d.jsx(q6,{}),d.jsx(H6,{})]})}HA.createRoot(document.getElementById("root")).render(d.jsx(A.StrictMode,{children:d.jsx(G6,{})}));
